{
  "type": "CMD_EXEC",
  "description": "4.1.1 Ensure a single firewall configuration utility is in use",
  "info": "\"In Linux security, employing a single, effective firewall configuration utility ensures that only legitimate traffic gets processed, reducing the system's exposure to potential threats. The choice between ufw nftables and iptables depends on organizational needs.",
  "Note": "Review the firewall subsection overview for the selected firewall to be used, it contains a script tosimplify this process.\n\n -\n\nReturn to this recommendation to ensure a single firewall configuration utility is in use",
  "solution": "\"Remediating to a single firewall configuration is a complex process and involves several steps. The following provides the basic steps to follow for a single firewall configuration:\n\n -\n\nDetermine which firewall utility best fits organizational needs\n\n -\n\nFollow the recommendations in the subsequent subsection for the single firewall to be used",
  "Impact": "The use of more than one firewall utility may produce unexpected results.\"",
  "reference": "800-171|3.13.1,800-171|3.13.5,800-171|3.13.6,800-171r3|03.13.01,800-171r3|03.13.06,800-53|CA-9,800-53|SC-7,800-53|SC-7(5),800-53r5|CA-9,800-53r5|SC-7,800-53r5|SC-7(5),CN-L3|7.1.2.2(c),CN-L3|8.1.10.6(j),CSCv7|9.4,CSCv8|4.4,CSCv8|4.5,CSF|DE.CM-1,CSF|ID.AM-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|ID.AM-03,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,GDPR|32.1.d,GDPR|32.2,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7,ITSG-33|SC-7(5),LEVEL|1A,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|GS7b,NIAv2|NS25,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.1,TBA-FIISB|43.1",
  "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
  "cmd": "#!/bin/bash\n\n{\n   active_firewall=() firewalls=(\\\"ufw\\\" \\\"nftables\\\" \\\"iptables\\\")\n   # Determine which firewall is in use\n   for firewall in \\\"${firewalls[@]}\\\"; do\n      case $firewall in\n         nftables)\n            cmd=\\\"nft\\\" ;;\n         *)\n            cmd=$firewall ;;\n      esac\n      if command -v $cmd &> /dev/null && systemctl is-enabled --quiet $firewall && systemctl is-active --quiet $firewall; then\n         active_firewall+=(\\\"$firewall\\\")\n      fi\n   done\n   # Display audit results\n   if [ ${#active_firewall[@]} -eq 1 ]; then\n      printf '%s\\\\n' \\\"\\\" \\\"Audit Results:\\\" \\\" ** PASS **\\\" \\\" - A single firewall is in use follow the recommendation in ${active_firewall[0]} subsection ONLY\\\"\n   elif [ ${#active_firewall[@]} -eq 0 ]; then\n      printf '%s\\\\n' \\\"\\\" \\\" Audit Results:\\\" \\\" ** FAIL **\\\" \\\"- No firewall in use or unable to determine firewall status\\\"\n   else\n      printf '%s\\\\n' \\\"\\\" \\\" Audit Results:\\\" \\\" ** FAIL **\\\" \\\" - Multiple firewalls are in use: ${active_firewall[*]}\\\"\n   fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$"
}