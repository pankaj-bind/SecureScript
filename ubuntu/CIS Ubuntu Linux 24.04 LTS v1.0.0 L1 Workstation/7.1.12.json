{
  "type": "CMD_EXEC",
  "description": "7.1.12 Ensure no files or directories without an owner and a group exist",
  "info": "Administrators may delete users or groups from the system and neglect to remove all files and/or directories owned by those users or groups.\n\nA new user or group who is assigned a deleted user's user ID or group ID may then end up \\\"owning\\\" a deleted user or group's files, and thus have more access on the system than was intended.",
  "solution": "Remove or set ownership and group ownership of these files and/or directories to an active user on the system as appropriate.",
  "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
  "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
  "cmd": "#!/bin/bash\n\n{\n   l_output=\\\"\\\" l_output2=\\\"\\\"\n   a_nouser=(); a_nogroup=() # Initialize arrays\n   a_path=(! -path \\\"/run/user/*\\\" -a ! -path \\\"/proc/*\\\" -a ! -path \\\"*/containerd/*\\\" -a ! -path \\\"*/kubelet/pods/*\\\" -a ! -path \\\"*/kubelet/plugins/*\\\" -a ! -path \\\"/sys/fs/cgroup/memory/*\\\" -a ! -path \\\"/var/*/private/*\\\")\n   while IFS= read -r l_mount; do\n      while IFS= read -r -d $'\\\\0' l_file; do\n         if [ -e \\\"$l_file\\\" ]; then\n            while IFS=: read -r l_user l_group; do\n               [ \\\"$l_user\\\" = \\\"UNKNOWN\\\" ] && a_nouser+=(\\\"$l_file\\\")\n               [ \\\"$l_group\\\" = \\\"UNKNOWN\\\" ] && a_nogroup+=(\\\"$l_file\\\")\n            done < <(stat -Lc '%U:%G' \\\"$l_file\\\")\n         fi\n      done < <(find \\\"$l_mount\\\" -xdev \\\\( \\\"${a_path[@]}\\\" \\\\) \\\\( -type f -o -type d \\\\) \\\\( -nouser -o -nogroup \\\\) -print0 2> /dev/null)\n   done < <(findmnt -Dkerno fstype,target | awk '($1 !~ /^\\\\s*(nfs|proc|smb|vfat|iso9660|efivarfs|selinuxfs)/ && $2 !~ /^\\\\/run\\\\/user\\\\//){print $2}')\n   if ! (( ${#a_nouser[@]} > 0 )); then\n      l_output=\\\"$l_output\\\\n  - No files or directories without a owner exist on the local filesystem.\\\"\n   else\n      l_output2=\\\"$l_output2\\\\n  - There are \\\\\\\"$(printf '%s' \\\"${#a_nouser[@]}\\\")\\\\\\\" unowned files or directories on the system.\\\\n   - The following is a list of unowned files and/or directories:\\\\n$(printf '%s\\\\n' \\\"${a_nouser[@]}\\\")\\\\n   - end of list\\\"\n   fi\n   if ! (( ${#a_nogroup[@]} > 0 )); then\n      l_output=\\\"$l_output\\\\n  - No files or directories without a group exist on the local filesystem.\\\"\n   else\n      l_output2=\\\"$l_output2\\\\n  - There are \\\\\\\"$(printf '%s' \\\"${#a_nogroup[@]}\\\")\\\\\\\" ungrouped files or directories on the system.\\\\n   - The following is a list of ungrouped files and/or directories:\\\\n$(printf '%s\\\\n' \\\"${a_nogroup[@]}\\\")\\\\n   - end of list\\\"\n   fi\n   unset a_path; unset a_arr ; unset a_nouser; unset a_nogroup # Remove arrays\n   if [ -z \\\"$l_output2\\\" ]; then # If l_output2 is empty, we pass\n      echo -e \\\"\\\\n- Audit Result:\\\\n  ** PASS **\\\\n - * Correctly configured * :\\\\n$l_output\\\\n\\\"\n   else\n      echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n - * Reasons for audit failure * :\\\\n$l_output2\\\"\n      [ -n \\\"$l_output\\\" ] && echo -e \\\"\\\\n- * Correctly configured * :\\\\n$l_output\\\\n\\\"\n   fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$"
}