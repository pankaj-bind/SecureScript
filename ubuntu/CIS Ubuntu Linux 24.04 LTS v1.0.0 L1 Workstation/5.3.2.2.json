{
  "check_type": "CONDITIONAL",
  "condition": {
    "auto_status": "FAILED",
    "type": "AND",
    "rules": [
      {
        "type": "FILE_CONTENT_CHECK",
        "description": "/etc/pam.d/common-account",
        "file": "/etc/pam.d/common-account",
        "regex": "(?i)^\\\\h*account\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_faillock\\\\.so\\\\b",
        "expect": "(?i)^\\\\h*account\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_faillock\\\\.so\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK",
        "description": "/etc/pam.d/common-auth authfail",
        "file": "/etc/pam.d/common-auth",
        "regex": "(?i)^\\\\h*auth\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_faillock\\\\.so\\\\h+([^#\\\\n\\\\r]+\\\\h+)?authfail\\\\b",
        "expect": "(?i)^\\\\h*auth\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_faillock\\\\.so\\\\h+([^#\\\\n\\\\r]+\\\\h+)?authfail\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK",
        "description": "/etc/pam.d/common-auth preauth",
        "file": "/etc/pam.d/common-auth",
        "regex": "(?i)^\\\\h*auth\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_faillock\\\\.so\\\\h+([^#\\\\n\\\\r]+\\\\h+)?preauth\\\\b",
        "expect": "(?i)^\\\\h*auth\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_faillock\\\\.so\\\\h+([^#\\\\n\\\\r]+\\\\h+)?preauth\\\\b"
      }
    ]
  },
  "then": {
    "report": {
      "description": "5.3.2.2 Ensure pam_faillock module is enabled",
      "info": "The pam_faillock.so module maintains a list of failed authentication attempts per user during a specified interval and locks the account in case there were more than the configured number of consecutive failed authentications (this is defined by the deny parameter in the faillock configuration). It stores the failure records into per-user files in the tally directory.\n\nLocking out user IDs after n unsuccessful consecutive login attempts mitigates brute force password attacks against your systems.",
      "solution": "\"Create two pam-auth-update profiles in /usr/share/pam-configs/ :\n\n - Create the faillock profile in /usr/share/pam-configs/ with the following lines:",
      "Name": "Notify of failed login attempts and reset count upon success",
      "Default": "yes",
      "Priority": "1024",
      "Auth-Type": "Primary",
      "Auth": "requisite pam_faillock.so preauth",
      "arr=('Name": "Notify of failed login attempts and reset count upon success' 'Default: yes' 'Priority: 1024' 'Auth-Type: Primary' 'Auth:' ' requisite pam_faillock.so preauth' 'Account-Type: Primary' 'Account:' ' required pam_faillock.so')\n   printf '%s\\n' \\\"${arr[@]}\\\" > /usr/share/pam-configs/faillock_notify\n}\n\nRun the following command to update the common-auth and common-account PAM files with the new profiles:\n\n# pam-auth-update --enable <profile_filename>",
      "Account-Type": "Primary",
      "Account": "required pam_faillock.so\n\nExample Script:\n\n#!/usr/bin/env bash\n\n{",
      "Example": "# pam-auth-update --enable faillock\n# pam-auth-update --enable faillock_notify",
      "Note": "- The name used for the file must be used in the pam-auth-update --enable command\n - The Name: line should be easily recognizable and understood\n - The Priority: Line is important as it effects the order of the lines in the /etc/pam.d/ files\n - If a site specific custom profile is being used in your environment to configure PAM that includes the configuration for the pam_faillock module, enable that module instead\"",
      "reference": "800-171|3.1.1,800-171r3|03.01.01,800-171r3|03.15.01,800-53|AC-1,800-53|AC-2,800-53|AC-2(1),800-53r5|AC-1,800-53r5|AC-2,800-53r5|AC-2(1),CN-L3|7.1.3.2(d),CN-L3|8.1.4.2(e),CN-L3|8.1.10.6(c),CSCv7|16.7,CSCv8|6.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|GV.OC-03,CSF2.0|GV.OV-01,CSF2.0|GV.PO-01,CSF2.0|GV.PO-02,CSF2.0|GV.SC-03,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.1,ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.4,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.5.31,ISO-27001-2022|A.5.36,ISO-27001-2022|A.5.37,ISO-27001-2022|A.8.2,ISO-27001-2022|5.2,ISO-27001-2022|5.3,ISO-27001-2022|7.5.1,ISO-27001-2022|7.5.2,ISO-27001-2022|7.5.3,ISO/IEC-27001|A.9.1.1,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-1,ITSG-33|AC-2,ITSG-33|AC-2(1),LEVEL|1A,NESA|M1.2.2,NIAv2|AM28,NIAv2|AM29,NIAv2|AM30,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2",
      "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
      "show_output": true,
      "type": "PASSED"
    }
  }
}