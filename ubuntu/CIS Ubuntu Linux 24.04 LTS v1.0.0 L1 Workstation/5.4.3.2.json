{
  "type": "CMD_EXEC",
  "description": "5.4.3.2 Ensure default user shell timeout is configured",
  "info": "TMOUT is an environmental setting that determines the timeout of a shell in seconds.\n\n - TMOUT=\n\nn\n\n- Sets the shell timeout to\n\nn\n\nseconds. A setting of TMOUT=0 disables timeout.\n - readonly TMOUT- Sets the TMOUT environmental variable as readonly, preventing unwanted modification during run-time.\n - export TMOUT - exports the TMOUT variable\n\nSystem Wide Shell Configuration Files:\n\n - /etc/profile - used to set system wide environmental variables on users shells. The variables are sometimes the same ones that are in thebash_profile however this file is used to set an initial PATH or PS1 for all shell users of the system. is only executed for interactive\n\nlogin\n\nshells, or shells executed with the --login parameter.\n - /etc/profile.d - /etc/profile will execute the scripts within /etc/profile.d/*.sh It is recommended to place your configuration in a shell script within /etc/profile.d to set your own system wide environmental variables.\n - /etc/bashrc - System wide version ofbashrc In Fedora derived distributions, /etc/bashrc also invokes /etc/profile.d/*.sh if\n\nnon-login\n\nshell, but redirects output to /dev/null if\n\nnon-interactive.\n\nIs only executed for\n\ninteractive\n\nshells or if BASH_ENV is set to /etc/bashrc\n\nSetting a timeout value reduces the window of opportunity for unauthorized user access to another user's shell session that has been left unattended. It also ends the inactive session and releases the resources associated with that session.",
  "solution": "Review /etc/bashrc /etc/profile and all files ending in *.sh in the /etc/profile.d/ directory and remove or edit all TMOUT=_n_ entries to follow local site policy. TMOUT should not exceed 900 or be equal to 0\n\nConfigure TMOUT in one of the following files:\n\n - A file in the /etc/profile.d/ directory ending insh\n - /etc/profile\n - /etc/bashrc\n\nTMOUT configuration examples:\n\n - As multiple lines:\n\nTMOUT=900\nreadonly TMOUT\nexport TMOUT\n - As a single line:\n\nreadonly TMOUT=900 ; export TMOUT",
  "reference": "800-171|3.1.1,800-171|3.1.10,800-171|3.1.11,800-171r3|03.01.01h.,800-171r3|03.01.10,800-171r3|03.01.11,800-53|AC-2(5),800-53|AC-11,800-53|AC-11(1),800-53|AC-12,800-53r5|AC-2(5),800-53r5|AC-11,800-53r5|AC-11(1),800-53r5|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv7|16.11,CSCv8|4.3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iii),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.7.7,ISO-27001-2022|A.8.1,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-2(5),ITSG-33|AC-11,ITSG-33|AC-11(1),ITSG-33|AC-12,LEVEL|1A,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM28,NIAv2|NS5j,NIAv2|NS49,NIAv2|SS14e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.1,TBA-FIISB|37.1.4",
  "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
  "cmd": "#!/bin/bash\n\n{\n   output1=\\\"\\\" output2=\\\"\\\"\n   [ -f /etc/bashrc ] && BRC=\\\"/etc/bashrc\\\"\n   for f in \\\"$BRC\\\" /etc/profile /etc/profile.d/*.sh ; do\n      grep -Pq '^\\\\s*([^#]+\\\\s+)?TMOUT=(900|[1-8][0-9][0-9]|[1-9][0-9]|[1-9])\\\\b' \\\"$f\\\" && grep -Pq '^\\\\s*([^#]+;\\\\s*)?readonly\\\\s+TMOUT(\\\\s+|\\\\s*;|\\\\s*$|=(900|[1-8][0-9][0-9]|[1-9][0-9]|[1-9]))\\\\b' \\\"$f\\\" && grep -Pq '^\\\\s*([^#]+;\\\\s*)?export\\\\s+TMOUT(\\\\s+|\\\\s*;|\\\\s*$|=(900|[1-8][0-9][0-9]|[1-9][0-9]|[1-9]))\\\\b' \\\"$f\\\" &&\n   output1=\\\"$f\\\"\n   done\n   grep -Pq '^\\\\s*([^#]+\\\\s+)?TMOUT=(9[0-9][1-9]|9[1-9][0-9]|0+|[1-9]\\\\d{3,})\\\\b' /etc/profile /etc/profile.d/*.sh \\\"$BRC\\\" && output2=$(grep -Ps '^\\\\s*([^#]+\\\\s+)?TMOUT=(9[0-9][1-9]|9[1-9][0-9]|0+|[1-9]\\\\d{3,})\\\\b' /etc/profile /etc/profile.d/*.sh $BRC)\n   if [ -n \\\"$output1\\\" ] && [ -z \\\"$output2\\\" ]; then\n      echo -e \\\"\nPASSED\n\nTMOUT is configured in: \\\\\\\"$output1\\\\\\\"\n\\\"\n   else\n      [ -z \\\"$output1\\\" ] && echo -e \\\"\nFAILED\n\nTMOUT is not configured\n\\\"\n      [ -n \\\"$output2\\\" ] && echo -e \\\"\nFAILED\n\nTMOUT is incorrectly configured in: \\\\\\\"$output2\\\\\\\"\n\\\"\n   fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*passed:?[\\\\s]*\\\\**$"
}