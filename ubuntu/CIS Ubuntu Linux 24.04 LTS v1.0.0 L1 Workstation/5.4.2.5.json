{
  "type": "CMD_EXEC",
  "description": "5.4.2.5 Ensure root path integrity",
  "info": "The root user can execute any command on the system and could be fooled into executing programs unintentionally if the PATH is not set correctly.\n\nIncluding the current working directory (.) or other writable directory in root 's executable path makes it likely that an attacker can gain superuser access by forcing an administrator operating as root to execute a Trojan horse program.",
  "solution": "Correct or justify any:\n\n - Locations that are not directories\n - Empty directories ( :: )\n - Trailing ( : )\n - Current working directory ( )\n - Non root owned directories\n - Directories that less restrictive than mode 0755",
  "reference": "800-171|3.4.7,800-171r3|03.04.06,800-53|CM-7(2),800-53r5|CM-7(2),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7(2),LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,SWIFT-CSCv1|2.3",
  "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
  "cmd": "#!/bin/bash\n\n{\n   l_output2=\\\"\\\"\n   l_pmask=\\\"0022\\\"\n   l_maxperm=\\\"$( printf '%o' $(( 0777 & ~$l_pmask )) )\\\"\n   l_root_path=\\\"$(sudo -Hiu root env | grep '^PATH' | cut -d= -f2)\\\"\n   unset a_path_loc && IFS=\\\":\\\" read -ra a_path_loc <<< \\\"$l_root_path\\\"\n   grep -q \\\"::\\\" <<< \\\"$l_root_path\\\" && l_output2=\\\"$l_output2\n - root's path contains a empty directory (::)\\\"\n   grep -Pq \\\":\\\\h*$\\\" <<< \\\"$l_root_path\\\" && l_output2=\\\"$l_output2\n - root's path contains a trailing (:)\\\"\n   grep -Pq '(\\\\h+|:)\\\\.(:|\\\\h*$)' <<< \\\"$l_root_path\\\" && l_output2=\\\"$l_output2\n - root's path contains current working directory (.)\\\"\n   while read -r l_path; do\n      if [ -d \\\"$l_path\\\" ]; then\n         while read -r l_fmode l_fown; do\n            [ \\\"$l_fown\\\" != \\\"root\\\" ] && l_output2=\\\"$l_output2\n - Directory: \\\\\\\"$l_path\\\\\\\" is owned by: \\\\\\\"$l_fown\\\\\\\" should be owned by \\\\\\\"root\\\\\\\"\\\"\n            [ $(( $l_fmode & $l_pmask )) -gt 0 ] && l_output2=\\\"$l_output2\n - Directory: \\\\\\\"$l_path\\\\\\\" is mode: \\\\\\\"$l_fmode\\\\\\\" and should be mode: \\\\\\\"$l_maxperm\\\\\\\" or more restrictive\\\"\n         done <<< \\\"$(stat -Lc '%#a %U' \\\"$l_path\\\")\\\"\n      else\n         l_output2=\\\"$l_output2\n - \\\\\\\"$l_path\\\\\\\" is not a directory\\\"\n      fi\n   done <<< \\\"$(printf \\\"%s\n\\\" \\\"${a_path_loc[@]}\\\")\\\"\n   if [ -z \\\"$l_output2\\\" ]; then\n      echo -e \\\"\n- Audit Result:\n  *** PASS ***\n - Root's path is correctly configured\n\\\"\n   else\n      echo -e \\\"\n- Audit Result:\n  ** FAIL **\n - * Reasons for audit failure * :\n$l_output2\n\\\"\n   fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$"
}