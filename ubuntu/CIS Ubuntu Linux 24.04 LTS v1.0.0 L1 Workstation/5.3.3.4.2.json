{
  "check_type": "CONDITIONAL",
  "condition": {
    "auto_status": "FAILED",
    "type": "AND",
    "rules": [
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-session remember=",
        "file": "/etc/pam.d/common-session",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-password remember=",
        "file": "/etc/pam.d/common-password",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-session-noninteractive remember=",
        "file": "/etc/pam.d/common-session-noninteractive",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-auth remember=",
        "file": "/etc/pam.d/common-auth",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-account remember=",
        "file": "/etc/pam.d/common-account",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+remember=\\\\b"
      }
    ]
  },
  "then": {
    "report": {
      "description": "5.3.3.4.2 Ensure pam_unix does not include remember",
      "info": "The remember=n argument saves the last n passwords for each user in /etc/security/opasswd in order to force password change history and keep the user from alternating between the same password too frequently. The MD5 password hash algorithm is used for storing the old passwords. Instead of this option the pam_pwhistory module should be used. The pam_pwhistory module saves the last n passwords for each user in /etc/security/opasswd using the password hash algorithm set on the pam_unix module. This allows for the yescrypt or sha512 hash algorithm to be used.\n\nThe remember=n argument should be removed to ensure a strong password hashing algorithm is being used. A stronger hash provides additional protection to the system by increasing the level of effort needed for an attacker to successfully determine local user's old passwords stored in /etc/security/opasswd",
      "solution": "\"Run the following command:\n\n# grep -PH -- '^\\h*([^#\\n\\r]+\\h+)?pam_unix\\.so\\h+([^#\\n\\r]+\\h+)?remember\\b' /usr/share/pam-configs/*\n\nEdit any files returned and remove the remember=_<N>_ argument for the pam_unix lines\n\nExample output:\n\n[success=end default=ignore] pam_unix.so obscure use_authtok try_first_pass yescrypt remember=5 # **<- remove remember=<N>**\n[success=end default=ignore] pam_unix.so obscure yescrypt remember=5 # **<- remove remember=<N>**\n\nRun the following command to update the files in the /etc/pam.d/ directory:\n\n# pam-auth-update --enable <EDITED_PROFILE_NAME>",
      "Example": "# pam-auth-update --enable unix",
      "Note": "If custom files are being used, the corresponding files in /etc/pam.d/ would need to be edited directly, and the pam-auth-update --enable <EDITED_PROFILE_NAME> command skipped\"",
      "reference": "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1",
      "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
      "show_output": true,
      "type": "PASSED"
    }
  }
}