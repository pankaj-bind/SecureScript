{
  "check_type": "CONDITIONAL",
  "condition": {
    "auto_status": "FAILED",
    "type": "AND",
    "rules": [
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-session-noninteractive nullok",
        "file": "/etc/pam.d/common-session-noninteractive",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-password nullok",
        "file": "/etc/pam.d/common-password",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-auth nullok",
        "file": "/etc/pam.d/common-auth",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-account nullok",
        "file": "/etc/pam.d/common-account",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b"
      },
      {
        "type": "FILE_CONTENT_CHECK_NOT",
        "description": "/etc/pamd./common-session nullok",
        "file": "/etc/pam.d/common-session",
        "regex": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b",
        "expect": "(?i)^\\\\h*^\\\\h*[^#\\\\n\\\\r]+\\\\h+pam_unix\\\\.so\\\\b[^#\\\\n\\\\r]+nullok\\\\b"
      }
    ]
  },
  "then": {
    "report": {
      "description": "5.3.3.4.1 Ensure pam_unix does not include nullok",
      "info": "The nullok argument overrides the default action of pam_unix.so to not permit the user access to a service if their official password is blank.\n\nUsing a strong password is essential to helping protect personal and sensitive information from unauthorized access",
      "solution": "\"Run the following command:\n\n# grep -PH -- '^\\h*([^#\\n\\r]+\\h+)?pam_unix\\.so\\h+([^#\\n\\r]+\\h+)?nullok\\b' /usr/share/pam-configs/*\n\nEdit any files returned and remove the nullok argument for the pam_unix lines\n\nExample File:",
      "Name": "Unix authentication",
      "Default": "yes",
      "Priority": "256",
      "Auth-Type": "Primary",
      "Auth": "[success=end default=ignore] pam_unix.so try_first_pass # <- **ensure line does not include nullok nullok**",
      "Auth-Initial": "[success=end default=ignore] pam_unix.so # <- **ensure line does not include nullok nullok**",
      "Account-Type": "Primary",
      "Account": "[success=end new_authtok_reqd=done default=ignore] pam_unix.so",
      "Account-Initial": "[success=end new_authtok_reqd=done default=ignore] pam_unix.so",
      "Session-Type": "Additional",
      "Session": "required pam_unix.so",
      "Session-Initial": "required pam_unix.so",
      "Password-Type": "Primary",
      "Password": "[success=end default=ignore] pam_unix.so obscure use_authtok try_first_pass yescrypt",
      "Password-Initial": "[success=end default=ignore] pam_unix.so obscure yescrypt\n\nRun the following command to update the files in the /etc/pam.d/ directory:\n\n# pam-auth-update --enable <EDITED_PROFILE_NAME>",
      "Example": "# pam-auth-update --enable unix",
      "Note": "If custom files are being used, the corresponding files in /etc/pam.d/ would need to be edited directly, and the pam-auth-update --enable <EDITED_PROFILE_NAME> command skipped\"",
      "reference": "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1",
      "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
      "show_output": true,
      "type": "PASSED"
    }
  }
}