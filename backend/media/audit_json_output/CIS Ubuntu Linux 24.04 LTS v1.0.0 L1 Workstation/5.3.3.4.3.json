{
  "type": "FILE_CONTENT_CHECK",
  "description": "5.3.3.4.3 Ensure pam_unix includes a strong password hashing algorithm",
  "info": "\"A cryptographic hash function converts an arbitrary-length input into a fixed length output. Password hashing performs a one-way transformation of a password, turning the password into another string, called the hashed password.\n\nThe pam_unix module can be configured to use one of the following hashing algorithms for user's passwords:\n\n - md5 - When a user changes their password next, encrypt it with the MD5 algorithm.\n - bigcrypt - When a user changes their password next, encrypt it with the DEC C2 algorithm.\n - sha256 - When a user changes their password next, encrypt it with the SHA256 algorithm. The SHA256 algorithm must be supported by the crypt(3) function.\n - sha512 - When a user changes their password next, encrypt it with the SHA512 algorithm. The SHA512 algorithm must be supported by the crypt(3) function.\n - blowfish - When a user changes their password next, encrypt it with the blowfish algorithm. The blowfish algorithm must be supported by the crypt(3) function.\n - gost_yescrypt - When a user changes their password next, encrypt it with the gost-yescrypt algorithm. The gost-yescrypt algorithm must be supported by the crypt(3) function.\n - yescrypt - When a user changes their password next, encrypt it with the yescrypt algorithm. The yescrypt algorithm must be supported by the crypt(3) function.\n\nThe SHA-512 and yescrypt algorithms provide a stronger hash than other algorithms used by Linux for password hash generation. A stronger hash provides additional protection to the system by increasing the level of effort needed for an attacker to successfully determine local user passwords.",
  "Note": "These changes only apply to the local system.\"",
  "solution": "\"Run the following command:\n\n# awk '/Password-Type:/{ f = 1;next } /-Type:/{ f = 0 } f {if (/pam_unix\\.so/) print FILENAME}' /usr/share/pam-configs/*\n\nEdit any returned files and edit or add a strong hashing algorithm, either sha512 or yescrypt, that meets local site policy to the pam_unix lines in the Password section:\n\nExample File:",
  "Name": "Unix authentication",
  "Default": "yes",
  "Priority": "256",
  "Auth-Type": "Primary # <- Start of \\\"Auth\\\" section",
  "Auth": "[success=end default=ignore] pam_unix.so try_first_pass",
  "Auth-Initial": "[success=end default=ignore] pam_unix.so",
  "Account-Type": "Primary # <- Start of \\\"Account\\\" section",
  "Account": "[success=end new_authtok_reqd=done default=ignore] pam_unix.so",
  "Account-Initial": "[success=end new_authtok_reqd=done default=ignore] pam_unix.so",
  "Session-Type": "Additional # <- Start of \\\"Session\\\" section",
  "Session": "required pam_unix.so",
  "Session-Initial": "required pam_unix.so",
  "Password-Type": "Primary # <- Start of \\\"Password\\\" section",
  "Password": "[success=end default=ignore] pam_unix.so obscure use_authtok try_first_pass yescrypt # <- **ensure hashing algorithm is either sha512 or yescrypt**",
  "Password-Initial": "[success=end default=ignore] pam_unix.so obscure yescrypt # <- **ensure hashing algorithm is either sha512 or yescrypt**\n\nRun the following command to update the files in the /etc/pam.d/ directory:\n\n# pam-auth-update --enable <MODIFIED_PROFILE_NAME>",
  "Example": "# pam-auth-update --enable unix\"",
  "reference": "800-171|3.5.2,800-171|3.13.16,800-171r3|03.05.07,800-171r3|03.13.08,800-53|IA-5(1),800-53|SC-28,800-53|SC-28(1),800-53r5|IA-5(1),800-53r5|SC-28,800-53r5|SC-28(1),CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSCv7|16.4,CSCv8|3.11,CSF|PR.AC-1,CSF|PR.DS-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.DS-01,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO-27001-2022|A.5.33,ITSG-33|IA-5(1),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),LEVEL|1A,NESA|T5.2.3,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|28.1",
  "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
  "file": "/etc/pam.d/common-password",
  "regex": "(?i)^\\\\h*password\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_unix\\\\.so\\\\h+([^#\\\\n\\\\r]+\\\\h+)?@PASSWORD_ENCRYPTION@\\\\b",
  "expect": "(?i)^\\\\h*password\\\\h+([^#\\\\n\\\\r]+)\\\\h+pam_unix\\\\.so\\\\h+([^#\\\\n\\\\r]+\\\\h+)?@PASSWORD_ENCRYPTION@\\\\b"
}