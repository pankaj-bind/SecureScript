{
  "check_type": "CONDITIONAL",
  "condition": {
    "auto_status": "FAILED",
    "type": "AND",
    "rules": [
      {
        "type": "FILE_CONTENT_CHECK",
        "description": "set superusers",
        "file": "/boot/grub/grub.cfg",
        "regex": "^[\\\\s]*set[\\\\s]*superusers[\\\\s]*=",
        "expect": "^[\\\\s]*set[\\\\s]*superusers[\\\\s]*=\\\".+\\\"*$"
      },
      {
        "type": "FILE_CONTENT_CHECK",
        "description": "password_pbkdf2",
        "file": "/boot/grub/grub.cfg",
        "regex": "^[\\\\s]*password",
        "expect": "^[\\\\s]*password_pbkdf2[\\\\s]+[^\\\\s]+[\\\\s]+[^\\\\s]+[\\\\s]*$"
      }
    ]
  },
  "then": {
    "report": {
      "description": "1.4.1 Ensure bootloader password is set",
      "info": "Setting the boot loader password will require that anyone rebooting the system must enter a password before being able to set command line boot parameters\n\nRequiring a boot password upon execution of the boot loader will prevent an unauthorized user from entering boot parameters or changing the boot partition. This prevents users from weakening security (e.g. turning off AppArmor at boot time).",
      "solution": "\"Create an encrypted password with grub-mkpasswd-pbkdf2 :\n\n# grub-mkpasswd-pbkdf2 --iteration-count=600000 --salt=64\n\nEnter password: <password>\nReenter password: <password>\nPBKDF2 hash of your password is <encrypted-password>\n\nAdd the following into a custom /etc/grub.d configuration file:\n\ncat <<EOF\nexec tail -n +2 $0\nset superusers=\\\"<username>\\\"\npassword_pbkdf2 <username> <encrypted-password>\nEOF\n\nThe superuser/user information and password should not be contained in the /etc/grub.d/00_header file as this file could be overwritten in a package update.\n\nIf there is a requirement to be able to boot/reboot without entering the password, edit /etc/grub.d/10_linux and add --unrestricted to the line CLASS=",
      "Example": "CLASS=\\\"--class gnu-linux --class gnu --class os --unrestricted\\\"\n\nRun the following command to update the grub2 configuration:\n\n# update-grub",
      "Impact": "If password protection is enabled, only the designated superuser can edit a GRUB 2 menu item by pressing \\\"e\\\" or access the GRUB 2 command line by pressing \\\"c\\\"\n\nIf GRUB 2 is set up to boot automatically to a password-protected menu entry the user has no option to back out of the password prompt to select another menu entry. Holding the SHIFT key will not display the menu in this case. The user must enter the correct username and password. If unable to do so, the configuration files will have to be edited via a LiveCD or other means to fix the problem\n\nYou can add --unrestricted to the menu entries to allow the system to boot without entering a password. A password will still be required to edit menu items.\n\nMore Information:",
      "https": "//help.ubuntu.com/community/Grub2/Passwords\"",
      "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
      "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
      "show_output": true,
      "type": "PASSED"
    }
  }
}