{
  "type": "CMD_EXEC",
  "description": "2.3.1.1 Ensure a single time synchronization daemon is in use",
  "info": "\"System time should be synchronized between all systems in an environment. This is typically done by establishing an authoritative time server or set of servers and having all systems synchronize their clocks to them.",
  "Note": "- Subsection:\n\nConfigure systemd-timesyncd\n\nshould be followed\n - Subsection:\n\nConfigure chrony\n\nshould be skipped\"",
  "solution": "\"On physical systems, and virtual systems where host based time synchronization is not available.\n\nSelect one of the two time synchronization daemons; chrony (1) or systemd-timesyncd (2) and following the remediation procedure for the selected daemon.",
  "<xhtml": "ol start=\\\"2\\\"> - systemd-timesyncd\n\nRun the following command to remove the chrony package:\n\n# apt purge chrony\n# apt autoremove chrony",
  "reference": "800-171|3.3.6,800-171|3.3.7,800-171r3|03.03.06a.,800-171r3|03.03.07,800-53|AU-7,800-53|AU-8,800-53r5|AU-7,800-53r5|AU-8,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(b),CSCv7|6.1,CSCv8|8.4,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.17,ITSG-33|AU-7,ITSG-33|AU-8,LEVEL|1A,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4,TBA-FIISB|37.4",
  "see_also": "https://workbench.cisecurity.org/benchmarks/18959",
  "cmd": "#!/bin/bash\n\n{\n    l_output=\\\"\\\" l_output2=\\\"\\\"\n    service_not_enabled_chk()\n    {\n        l_out2=\\\"\\\"\n        if systemctl is-enabled \\\"$l_service_name\\\" 2>/dev/null | grep -q 'enabled'; then\n            l_out2=\\\"$l_out2\\\\n  - Daemon: \\\\\\\"$l_service_name\\\\\\\" is enabled on the system\\\"\n        fi\n        if systemctl is-active \\\"$l_service_name\\\" 2>/dev/null | grep -q '^active'; then\n            l_out2=\\\"$l_out2\\\\n  - Daemon: \\\\\\\"$l_service_name\\\\\\\" is active on the system\\\"\n        fi\n    }\n    l_service_name=\\\"systemd-timesyncd.service\\\" # Check systemd-timesyncd daemon\n    service_not_enabled_chk\n    if [ -n \\\"$l_out2\\\" ]; then\n        l_timesyncd=\\\"y\\\"\n        l_out_tsd=\\\"$l_out2\\\"\n    else\n        l_timesyncd=\\\"n\\\"\n        l_out_tsd=\\\"\\\\n  - Daemon: \\\\\\\"$l_service_name\\\\\\\" is not enabled and not active on the system\\\"\n    fi\n    l_service_name=\\\"chrony.service\\\" # Check chrony\n    service_not_enabled_chk\n    if [ -n \\\"$l_out2\\\" ]; then\n        l_chrony=\\\"y\\\"\n        l_out_chrony=\\\"$l_out2\\\"\n    else\n        l_chrony=\\\"n\\\"\n        l_out_chrony=\\\"\\\\n  - Daemon: \\\\\\\"$l_service_name\\\\\\\" is not enabled and not active on the system\\\"\n    fi\n    l_status=\\\"$l_timesyncd$l_chrony\\\"\n    case \\\"$l_status\\\" in\n        yy)\n            l_output2=\\\" - More than one time sync daemon is in use on the system$l_out_tsd$l_out_chrony\\\"\n            ;;\n        nn)\n            l_output2=\\\" - No time sync daemon is in use on the system$l_out_tsd$l_out_chrony\\\"\n            ;;\n        yn|ny)\n            l_output=\\\" - Only one time sync daemon is in use on the system$l_out_tsd$l_out_chrony\\\"\n            ;;\n        *)\n            l_output2=\\\" - Unable to determine time sync daemon(s) status\\\"\n            ;;\n    esac\n\n    if [ -z \\\"$l_output2\\\" ]; then\n        echo -e \\\"\\\\n- Audit Result:\\\\n  ** PASS **\\\\n$l_output\\\\n\\\"\n    else\n        echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n - * Reasons for audit failure * :\\\\n$l_output2\\\\n\\\"\n    fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$"
}