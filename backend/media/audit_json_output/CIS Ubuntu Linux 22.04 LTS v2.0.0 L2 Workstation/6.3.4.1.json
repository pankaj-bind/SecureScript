{
  "type": "CMD_EXEC",
  "description": "6.3.4.1 Ensure audit log files mode is configured",
  "info": "Audit log files contain information about the system and system activity.\n\nAccess to audit records can reveal system and configuration data to attackers, potentially compromising its confidentiality.",
  "solution": "Run the following command to remove more permissive mode than 0640 from audit log files:\n\n# [ -f /etc/audit/auditd.conf ] && find \\\"$(dirname $(awk -F \\\"=\\\" '/^\\s*log_file/ {print $2}' /etc/audit/auditd.conf | xargs))\\\" -type f -perm /0137 -exec chmod u-x,g-wx,o-rwx {} +",
  "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|2A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
  "see_also": "https://workbench.cisecurity.org/benchmarks/17074",
  "cmd": "#!/bin/bash\n\n{\n   l_perm_mask=\\\"0137\\\"\n   if [ -e \\\"/etc/audit/auditd.conf\\\" ]; then\n      l_audit_log_directory=\\\"$(dirname \\\"$(awk -F= '/^\\\\s*log_file\\\\s*/{print $2}' /etc/audit/auditd.conf | xargs)\\\")\\\"\n      if [ -d \\\"$l_audit_log_directory\\\" ]; then\n         l_maxperm=\\\"$(printf '%o' $(( 0777 & ~$l_perm_mask )) )\\\"\n         a_files=()\n         while IFS= read -r -d $'\\\\0' l_file; do\n            [ -e \\\"$l_file\\\" ] && a_files+=(\\\"$l_file\\\")\n         done < <(find \\\"$l_audit_log_directory\\\" -maxdepth 1 -type f -perm /\\\"$l_perm_mask\\\" -print0)\n\t\t if (( \\\"${#a_files[@]}\\\" > 0 )); then\n            for l_file in \\\"${a_files[@]}\\\"; do\n               l_file_mode=\\\"$(stat -Lc '%#a' \\\"$l_file\\\")\\\"\n               echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n  - File: \\\\\\\"$l_file\\\\\\\" is mode: \\\\\\\"$l_file_mode\\\\\\\"\\\\n     (should be mode: \\\\\\\"$l_maxperm\\\\\\\" or more restrictive)\\\\n\\\"\n            done\n         else\n            echo -e \\\"\\\\n- Audit Result:\\\\n  ** PASS **\\\\n  - All files in \\\\\\\"$l_audit_log_directory\\\\\\\" are mode: \\\\\\\"$l_maxperm\\\\\\\" or more restrictive\\\"\n         fi\n      else\n         echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n  - Log file directory not set in \\\\\\\"/etc/audit/auditd.conf\\\\\\\" please set log file directory\\\"\n      fi\n   else\n      echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n  - File: \\\\\\\"/etc/audit/auditd.conf\\\\\\\" not found.\\\\n  - ** Verify auditd is installed **\\\"\n   fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$"
}