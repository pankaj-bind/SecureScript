{
  "type": "CMD_EXEC",
  "description": "6.3.1.3 Ensure auditing for processes that start prior to auditd is enabled",
  "info": "Configure grub2 so that processes that are capable of being audited can be audited even if they start up prior to auditd startup.\n\nAudit events need to be captured on processes that start up prior to auditd so that potential malicious activity cannot go undetected.",
  "solution": "\"Edit /etc/default/grub and add audit=1 to GRUB_CMDLINE_LINUX :",
  "Example": "GRUB_CMDLINE_LINUX=\\\"audit=1\\\"\n\nRun the following command to update the grub2 configuration:\n\n# update-grub\"",
  "reference": "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-53|AU-2,800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(a),CSCv7|6.2,CSCv8|8.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-2,ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|2A,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4",
  "see_also": "https://workbench.cisecurity.org/benchmarks/17074",
  "cmd": "#!/bin/bash\n  {\n  l_output=\\\"\\\" l_output2=\\\"\\\" l_gout=\\\"\\\"\n  l_gparameters=\\\"audit=1\\\"\n\n\tl_gpfile=\\\"$(find /boot -type f \\\\( -name 'grubenv' -o -name 'grub.conf' -o -name 'grub.cfg' \\\\) -exec grep -Pl -- '^\\\\h*(kernelopts=|linux|kernel)' {} +)\\\"\n\t[ -f \\\"$l_gpfile\\\" ] && l_gout=\\\"$(grep -P -- \\\"\\\\b$l_gparameters\\\\b\\\" \\\"$l_gpfile\\\")\\\"\n\tl_lout=\\\"$(grep -Ps -- \\\"\\\\b$l_gparameters\\\\b\\\" /boot/loader/entries/*)\\\"\n\tif [ -n \\\"$l_gout\\\" ] || [ -n \\\"$l_lout\\\" ]; then\n\t\t[ -n \\\"$l_gout\\\" ] && l_output=\\\"$l_output\\\\n - Grub parameter: \\\\\\\"$l_gparameters\\\\\\\" exists in: \\\\\\\"$l_gpfile\\\\\\\"\\\"\n\t\t[ -n \\\"$l_lout\\\" ] && l_output=\\\"$l_output\\\\n - Grub parameter: \\\\\\\"$l_gparameters\\\\\\\" exists in: \\\\\\\"$(grep -Pls -- \\\"\\\\b$l_gparameters\\\\b\\\" /boot/loader/entries/*)\\\\\\\"\\\"\n\telse\n\t\tl_output2=\\\"$l_output2\\\\n - Grub parameter: \\\\\\\"$l_gparameters\\\\\\\" is not set\\\"\n\tfi\n\n# If l_output2 is not set, then we pass\nif [ -z \\\"$l_output2\\\" ]; then\n\techo -e \\\"\\\\n- Audit Result:\\\\n  ** PASS **\\\\n$l_output\\\\n\\\"\nelse\n\techo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n - Reason(s) for audit failure:\\\\n$l_output2\\\\n\\\"\n\t[ -n \\\"$l_output\\\" ] && echo -e \\\"\\\\n- Correctly set:\\\\n$l_output\\\\n\\\"\nfi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$",
  "timeout": "@FIND_TIMEOUT@"
}