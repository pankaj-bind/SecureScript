{
  "type": "CMD_EXEC",
  "description": "6.3.4.4 Ensure the audit log file directory mode is configured",
  "info": "The audit log directory contains audit log files.\n\nAudit information includes all information including: audit records, audit settings and audit reports. This information is needed to successfully audit system activity. This information must be protected from unauthorized modification or deletion. If this information were to be compromised, forensic analysis and discovery of the true source of potentially malicious system activity is impossible to achieve.",
  "solution": "Run the following command to configure the audit log directory to have a mode of \\\"0750\\\" or less permissive:\n\n# chmod g-w,o-rwx \\\"$(dirname \\\"$(awk -F= '/^\\s*log_file\\s*/{print $2}' /etc/audit/auditd.conf | xargs)\\\")\\\"",
  "reference": "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|2A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3",
  "see_also": "https://workbench.cisecurity.org/benchmarks/17074",
  "cmd": "#!/bin/bash\n\n{\n   l_perm_mask=\\\"0027\\\"\n   if [ -e \\\"/etc/audit/auditd.conf\\\" ]; then\n      l_audit_log_directory=\\\"$(dirname \\\"$(awk -F= '/^\\\\s*log_file\\\\s*/{print $2}' /etc/audit/auditd.conf | xargs)\\\")\\\"\n      if [ -d \\\"$l_audit_log_directory\\\" ]; then\n         l_maxperm=\\\"$(printf '%o' $(( 0777 & ~$l_perm_mask )) )\\\"\n         l_directory_mode=\\\"$(stat -Lc '%#a' \\\"$l_audit_log_directory\\\")\\\"\n         if [ $(( $l_directory_mode & $l_perm_mask )) -gt 0 ]; then\n            echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n  - Directory: \\\\\\\"$l_audit_log_directory\\\\\\\" is mode: \\\\\\\"$l_directory_mode\\\\\\\"\\\\n     (should be mode: \\\\\\\"$l_maxperm\\\\\\\" or more restrictive)\\\\n\\\"\n         else\n            echo -e \\\"\\\\n- Audit Result:\\\\n  ** PASS **\\\\n  - Directory: \\\\\\\"$l_audit_log_directory\\\\\\\" is mode: \\\\\\\"$l_directory_mode\\\\\\\"\\\\n     (should be mode: \\\\\\\"$l_maxperm\\\\\\\" or more restrictive)\\\\n\\\"\n         fi\n      else\n         echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n  - Log file directory not set in \\\\\\\"/etc/audit/auditd.conf\\\\\\\" please set log file directory\\\"\n      fi\n   else\n      echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n  - File: \\\\\\\"/etc/audit/auditd.conf\\\\\\\" not found\\\\n  - ** Verify auditd is installed **\\\"\n   fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$"
}