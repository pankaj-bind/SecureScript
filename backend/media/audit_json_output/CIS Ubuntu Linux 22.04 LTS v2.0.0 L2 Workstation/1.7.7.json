{
  "type": "CMD_EXEC",
  "description": "1.7.7 Ensure GDM disabling automatic mounting of removable media is not overridden",
  "info": "By default GNOME automatically mounts removable media when inserted as a convenience to the user.\n\nBy using the lockdown mode in dconf, you can prevent users from changing specific settings. To lock down a dconf key or subpath, create a locks subdirectory in the keyfile directory. The files inside this directory contain a list of keys or subpaths to lock. Just as with the keyfiles, you may add any number of files to this directory.\n\nWith automounting enabled anyone with physical access could attach a USB drive or disc and have its contents available in system even if they lacked permissions to mount it themselves.",
  "solution": "\"- To prevent the user from overriding these settings, create the file /etc/dconf/db/local.d/locks/00-media-automount with the following content:\n\n[org/gnome/desktop/media-handling]\nautomount=false\nautomount-open=false <xhtml:ol start=\\\"2\\\"> - Update the systems databases:\n\n# dconf update",
  "Impact": "The use of portable hard drives is very common for workstation users\"",
  "reference": "800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|MP-2,800-53r5|MP-2,CSF|PR.PT-2,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|2A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1",
  "see_also": "https://workbench.cisecurity.org/benchmarks/17074",
  "cmd": "#!/bin/bash\n\n{\n   # Check if GNOME Desktop Manager is installed.\n   l_pkgoutput=\\\"\\\"\n   if command -v dpkg-query &> /dev/null; then\n      l_pq=\\\"dpkg-query -s\\\"\n   elif command -v rpm &> /dev/null; then\n      l_pq=\\\"rpm -q\\\"\n   fi\n   l_pcl=\\\"gdm gdm3\\\" # space-separated list of packages to check\n   for l_pn in $l_pcl; do\n      $l_pq \\\"$l_pn\\\" &> /dev/null && l_pkgoutput=\\\"$l_pkgoutput\\\\n - Package: \\\\\\\"$l_pn\\\\\\\" exists on the system\\\\n - Checking configuration\\\"\n   done\n   # Check for GDM configuration (If applicable)\n   if [ -n \\\"$l_pkgoutput\\\" ]; then\n      l_output=\\\"\\\"\n      l_output2=\\\"\\\"\n      # Search /etc/dconf/db/local.d/ for automount settings\n      l_automount_setting=$(grep -Psir -- '^\\\\h*automount=false\\\\b' /etc/dconf/db/local.d/*)\n      l_automount_open_setting=$(grep -Psir -- '^\\\\h*automount-open=false\\\\b' /etc/dconf/db/local.d/*)\n      # Check for automount setting\n      if [[ -n \\\"$l_automount_setting\\\" ]]; then\n         l_output=\\\"$l_output\\\\n - \\\\\\\"automount\\\\\\\" setting found\\\"\n      else\n         l_output2=\\\"$l_output2\\\\n - \\\\\\\"automount\\\\\\\" setting not found\\\"\n      fi\n      # Check for automount-open setting\n      if [[ -n \\\"$l_automount_open_setting\\\" ]]; then\n         l_output=\\\"$l_output\\\\n - \\\\\\\"automount-open\\\\\\\" setting found\\\"\n      else\n         l_output2=\\\"$l_output2\\\\n - \\\\\\\"automount-open\\\\\\\" setting not found\\\"\n      fi\n   else\n      l_output=\\\"$l_output\\\\n - GNOME Desktop Manager package is not installed on the system\\\\n  - Recommendation is not applicable\\\"\n   fi\n   # Report results. If no failures in l_output2, we pass\n   [ -n \\\"$l_pkgoutput\\\" ] && echo -e \\\"\\\\n$l_pkgoutput\\\"\n   if [ -z \\\"$l_output2\\\" ]; then\n      echo -e \\\"\\\\n- Audit Result:\\\\n  ** PASS **\\\\n$l_output\\\\n\\\"\n   else\n      echo -e \\\"\\\\n- Audit Result:\\\\n  ** FAIL **\\\\n - Reason(s) for audit failure:\\\\n$l_output2\\\\n\\\"\n      [ -n \\\"$l_output\\\" ] && echo -e \\\"\\\\n- Correctly set:\\\\n$l_output\\\\n\\\"\n   fi\n}",
  "expect": "(?i)^[\\\\s]*\\\\**[\\\\s]*pass:?[\\\\s]*\\\\**$"
}