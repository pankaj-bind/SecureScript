#TRUSTED 454e8fc97e0808392c4affcdbeadbb0e8104394fefb59819588f4e4817205d672af7793c7fefda0b4d2906f5dd085ae109cd2b17d4aa202c6b04c13ddfe77c85d9024e09ea89a7c89743b1953889a75f00550db3604a732754a0f9e868d70e0e63988b00a2f406517dcd14b4d99581f13e657023f327cd534658654943d93aae38232c4e47bdba2b2ad195059d463150aa93fe1885184b397b9f6f3cc6a6f1ffcdcda34d39d572a0ff6aa7d14ea728f6d84adfaa84939d4a0714e051dec30a48acccdf53454fca8bf6f70523231a78b24926289088e491030dad40c079120c16c6cfa7a0212fd821e82d47416c1fd336d4b004d349a9dbaa31bf2334fc1a26ff2bff6a112798edea0699377b7d7737abbb4d3ecc81ee2f0fa1b1671ffe439e07f16f2f104f049f34ab039aa8f7ba7c292d6ca2c6f3467c2e5dbc27fd39d9092d28c0f2e0c4f40c82b37b8eda52b094f666426a1c7a033039777fed950dc20e454f5b2eccfb9bde5e22693eebcd16712be99f20b3c55b40e33b19be70b4b6e4015ca19b872f76701fd3f8a51536416bc7777d96c821a662a83f9a59adbd0ac9a4e3828c672dd18409cc51749344f16807e0e32caba51287996e02e61139bed8c4fe7af6afb4a2ad18bbec5fa146125f6fb5e76f702c036a815295bd10441e765b451d3365048c0ed4f7de02f94c14889f9a0dbdfec515d1034d901b04551c27cb
#TRUST-RSA-SHA256 29d5fe0d356ddf4324a427a5c7f32fb3520516a41a7c621cd50c276cb9951bae4f8645aa4d8c72ed6884d0e8a27399e8c877f74bc86a7e61aabf2eec68f198b82864c21ac1e6f5d42523d8c2dd5963a817106a8b73d1f9e3de303b4cd57ef159a8eba88660612905a638c5375e30e4914750e3ce893f7513e93e30795b7a5070f3d8af811ce769a7cc4b54140e2232e7d556a7c25779344db5a3e0836d1c8de1a6cb2ffa1891afe16cb666de586c9686638455a7f15bb1e5f9d5b1edf9847f2814c60517f5c6f3d77ada2a4155dc1d75295bed2084ac4e7f7a0b0499582e2263b3bced473f1045fef13305a53aa6b30c4a9d1768d7b251451d4e4acb05636194737b4b8fcc317cbf8b6eaaf2fa0d9f79dcabf1ed14f8cc5602d0012045a199f967c07e29006c5395c90796356fba7cc5ed84aae12f1c95962b682bcdcbaa7e87cb93b6b12ce32a5c7716a4a5172308d1ebf4fd99bfa5c261070f83c2577776c890d7ea64a92f83534711291e84defa93077739ee25e5167db1602359f033676bace9faa1adc1e0633c814c1c15a0e789fdb424cfc2f3f49be2fcbff0862f3f768d0b54a1f18c3726b9a92b8945915c8f82627aff5ffb23e3a202222d312a7874a9e6e4aab8be8392baa9dac338173a807247ac215c4f35eb4a08cade977e55d77bb105d578ace353599c3c357f2617c618c0ab9859cb4e97fdb0434ab69a5cd4
#
# This script is Copyright (C) 2004-2025 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2025/06/02 $
#
# Description : This .audit is designed to VM configurations from either a vCenter or vSphere server
#               and validate their settings against the settings defined in the VMware vSphere Security Configuration and Hardening Guide
#
#               https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/
#
#<ui_metadata>
#<display_name>VMware vSphere Security Configuration and Hardening Guide</display_name>
#<spec>
#  <type>VMWare</type>
#  <name>vSphere Security Configuration and Hardening Guide</name>
#  <version>8.0.0</version>
#  <link>https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/</link>
#</spec>
#<labels>vmware,vsphere,hardening</labels>
#<benchmark_refs>CCI</benchmark_refs>
#<variables>
#  <variable>
#    <name>NTP_SERVER</name>
#    <default>10.0.0.2</default>
#    <description>Network Time Server</description>
#    <info>Host address of the NTP server for the target.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>BANNER_TEXT</name>
#    <default>All activities performed on this system will be monitored.</default>
#    <description>Banner Text</description>
#    <info>This is the text for the warning a user receives when logging onto the system.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>HOST_CLIENT_SESSION_TIMEOUT</name>
#    <default>900</default>
#    <description>Host Client Session Timeout</description>
#    <info>Value of UserVars.HostClientSessionTimeout in seconds</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PASSWORD_AGE</name>
#    <default>9999</default>
#    <description>Maximum password age</description>
#    <info>The maximum password age allowed for the ESXI target.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PASSWORD_HISTORY</name>
#    <default>5</default>
#    <description>Password history</description>
#    <info>How many passwords changes must occur before a password can be reused.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>SECURITY_APPLIANCE</name>
#    <default>192.168.0.254</default>
#    <description>dvFilter Security Appliance IP</description>
#    <info>A valid IP address for a configured security applliance used with dvFilter</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>SYSLOG_DIR</name>
#    <default>\[datastore1\] logs</default>
#    <description>System log dir</description>
#    <info>The path to the system log directory.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>LOG_HOST</name>
#    <default>udp://192\.168\.0\.1:514</default>
#    <description>Remote syslog IP</description>
#    <info>The IP address of the centralized syslog server for your organization.</info>
#    <value_type>STRING</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"VMware">

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.account-auto-unlock-time"
  info        : "The ESXi host must unlock accounts after a specified timeout period. This ensures that user accounts on the ESXi host are automatically unlocked after a defined period of inactivity. By enforcing automatic account unlocking, organizations can maintain a balance between security and usability, ensuring that idle accounts are reactivated promptly while minimizing the potential for unauthorized access."
  solution    : "PowerCLI Command Assessment Example: Get-VMHost -Name $ESXi | Get-AdvancedSetting Security.AccountUnlockTime"
  reference   : "800-171|3.1.8,800-171r3|03.01.08b.,800-53|AC-7b.,800-53r5|AC-7b.,CCI|CCI-002238,CN-L3|7.1.2.7(f),CN-L3|7.1.3.1(c),CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-7b.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.7,PCI-DSSv4.0|8.3.4,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.AccountUnlockTime']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.AccountUnlockTime']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Security.AccountUnlockTime : "
  expect      : "Security.AccountUnlockTime : 900$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.account-lockout"
  info        : "The ESXi host must lock an account after a specified number of failed login attempts. Protects against brute-force attacks and unauthorized access attempts by temporarily disabling the affected account, preventing further login attempts until the lockout period expires or is manually reset by an administrator."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Security.AccountLockFailures | Set-AdvancedSetting -Value 5"
  reference   : "800-171|3.1.8,800-171r3|03.01.08a.,800-53|AC-7a.,800-53r5|AC-7a.,CCI|CCI-000044,CN-L3|8.1.4.1(b),CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-7a.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.6,PCI-DSSv4.0|8.3.4,TBA-FIISB|45.1.2,TBA-FIISB|45.2.1,TBA-FIISB|45.2.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.AccountLockFailures']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.AccountLockFailures']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Security.AccountLockFailures : "
  expect      : "Security.AccountLockFailures : 5$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.account-password-history"
  info        : "Configure the password history setting to restrict the reuse of passwords on the ESXi host. This will prevent the reuse of previous passwords, thus mitigating potential breaches from old, compromised credentials."
  solution    : "PowerCLI Command Assessment Example: Get-VMHost -Name $ESXi | Get-AdvancedSetting Security.PasswordHistory"
  reference   : "800-171|3.5.7,800-171r3|03.05.07b.,800-53|IA-5(1)(b),800-53r5|IA-5(1)(b),CCI|CCI-004061,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(b),NESA|T5.2.3,NIAv2|AM22d,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordHistory']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordHistory']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Security.PasswordHistory : "
  expect      : "Security.PasswordHistory : @PASSWORD_HISTORY@$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.account-password-max-days"
  info        : "The ESXi host must be configured with an appropriate maximum password age. Modern best practices for passwords, as outlined in NIST 800-63B Section 5.1.1.2 and other relevant guidance, state that enforcing periodic password changes does not enhance security when passwords already possess adequate entropy."
  solution    : "PowerCLI Command Assessment Example: Get-VMHost -Name $ESXi | Get-AdvancedSetting Security.PasswordMaxDays"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordMaxDays']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordMaxDays']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Security.PasswordMaxDays : "
  expect      : "Security.PasswordMaxDays : @PASSWORD_AGE@$"
</custom_item>

<report type:"WARNING">
  description : "ESXi: esxi-8.account-vpxuser"
  info        : "The ESXi host must deny shell access for the vpxuser account. The vpxuser account is created by vCenter Server when the host is first attached, and is subseqently used for privileged authentication to ESXi. While the password is automatically rotated by vCenter Server on an interval governed by VirtualCenter.VimPasswordExpirationInDays, it also has shell access which can be deactivated to reduce attack surface.

Users who do not have shell access cannot reconfigure other users' shell access, no matter their privilege levels. Since vCenter Server connects as vpxuser, once vpxuser has been stripped of shell access it will no longer be able to change those user settings for others. Further reconfiguration will need to happen on a host-by-host basis using an account that is authorized.

For security, ESXi 8 no longer supports traditional password or account recovery operations, such as booting from media or changing init to a shell on boot.

Ensure that the host retains at least one fully privileged user, protected well.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "PowerCLI Command Remediation Example:
  $ESXcli = Get-EsxCli -VMHost $ESXi -V2
$arguments = $ESXcli.system.account.set.CreateArgs()
$arguments.id = \"vpxuser\"
$arguments.shellaccess = \"false\"
$ESXcli.system.account.set.Invoke($arguments)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "Check for min"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:value\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "Security.PasswordQualityControl : "
      expect      : "Security.PasswordQualityControl : .*\\bmin=disabled,disabled,disabled,disabled,15\\b.*$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check for similar"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:value\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "Security.PasswordQualityControl : "
      expect      : "Security.PasswordQualityControl : .*\\bsimilar=deny\\b.*$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check for retry"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:value\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "Security.PasswordQualityControl : "
      expect      : "Security.PasswordQualityControl : .*\\bretry=3\\b.*$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check for max"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Security.PasswordQualityControl']/audit:value\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "Security.PasswordQualityControl : "
      expect      : "Security.PasswordQualityControl : .*\\bmax=64\\b.*$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.account-password-policies"
      info        : "The ESXI host must enforce password complexity. Based on recommendations such as NIST 800-63B Section 5.1.1.2, it is suggested that composition rules, such as mandating mixtures of character classes, should not be enforced on systems as they often fail to enhance password security and discourage the adoption of more secure passphrases. Password strength and complexity rules are applicable to all ESXi users, including the root user. However, when the ESX host is joined to a domain, these rules do not apply to Active Directory (AD) users as password policies for AD users are enforced by the AD system."
      solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Security.PasswordQualityControl | Set-AdvancedSetting -Value \"similar=deny retry=3 min=disabled,disabled,disabled,disabled,15 max=64\""
      reference   : "800-171|3.5.7,800-171r3|03.05.07a.,800-171r3|03.05.07b.,800-53|IA-5(1)(a),800-53|IA-5(1)(b),800-53r5|IA-5(1)(h),CCI|CCI-000192,CCI|CCI-000193,CCI|CCI-000194,CCI|CCI-000195,CCI|CCI-000205,CCI|CCI-001619,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),ITSG-33|IA-5(1)(b),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,NIAv2|AM22d,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.api-soap-timeout"
  info        : "The ESXi host must configure a session timeout for the vSphere API. This practice helps mitigate potential security risks by ensuring that unattended sessions, which could be exploited by unauthorized users or malicious software, are not left open indefinitely."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Config.HostAgent.vmacore.soap.sessionTimeout | Set-AdvancedSetting -Value 30"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.vmacore.soap.sessionTimeout']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.vmacore.soap.sessionTimeout']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Config.HostAgent.vmacore.soap.sessionTimeout : "
  expect      : "Config.HostAgent.vmacore.soap.sessionTimeout : 30$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.cpu-hyperthread-warning"
  info        : "The ESXi host must not suppress warnings about unmitigated hyperthreading vulnerabilities. Hyperthreading security warnings signify unaddressed CPU vulnerabilities in the system, and ignoring these could mask potential risks. Ensure that hardware remediations align with your organization's accepted risk, and if suppressing a warning, document the decision and rationale."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting UserVars.SuppressHyperthreadWarning | Set-AdvancedSetting -Value 0"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.SuppressHyperthreadWarning']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.SuppressHyperthreadWarning']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars.SuppressHyperthreadWarning : "
  expect      : "UserVars.SuppressHyperthreadWarning : 0$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.dcui-timeout"
  info        : "Set a timeout to automatically terminate idle DCUI sessions on the ESXi host. DCUI allows direct login to the ESXi host for managing tasks. To prevent unintended DCUI usage from leftover login sessions, It is essential to terminate idle connections."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting UserVars.DcuiTimeOut | Set-AdvancedSetting -Value 600"
  reference   : "800-171|3.13.9,800-171r3|03.13.09,800-53|SC-10,800-53r5|SC-10,CCI|CCI-001133,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.20,ITSG-33|SC-10,ITSG-33|SC-10a.,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,SWIFT-CSCv1|2.6"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.DcuiTimeOut']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.DcuiTimeOut']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars.DcuiTimeOut : "
  expect      : "UserVars.DcuiTimeOut : 600$"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "Check running state"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='sfcbd-watchdog']/audit:label\"/> running : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='sfcbd-watchdog']/audit:running\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "CIM Server running : "
      expect      : "CIM Server running : FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check startup policy"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='sfcbd-watchdog']/audit:label\"/> enabled : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='sfcbd-watchdog']/audit:policy\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "CIM Server enabled : "
      expect      : "CIM Server enabled : OFF$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.deactivate-cim"
      info        : "The ESXi CIM service should be deactivated. Services which are not in use and are non-essential for operations should be deactivated."
      solution    : "Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'sfcbd-watchdog'} | Set-VMHostService -Policy Off
Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'sfcbd-watchdog'} | Stop-VMHostService"
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.deactivate-mob"
  info        : "The ESXi Managed Object Browser (MOB) must be deactivated. Services which are not in use and are non-essential for operations should be deactivated."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Config.HostAgent.plugins.solo.enableMob | Set-AdvancedSetting -Value False"
  reference   : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06a.,800-53|CM-7a.,800-53r5|CM-7a.,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.plugins.solo.enableMob']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.plugins.solo.enableMob']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Config.HostAgent.plugins.solo.enableMob : "
  expect      : "Config.HostAgent.plugins.solo.enableMob : false$"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "Check running state"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM']/audit:label\"/> enabled : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM']/audit:running\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "ESXi Shell enabled : "
      expect      : "ESXi Shell enabled : FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check startup policy"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM']/audit:label\"/> policy : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM']/audit:policy\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "ESXi Shell policy : "
      expect      : "ESXi Shell policy : off$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.deactivate-shell"
      info        : "The ESXi shell should be deactivated. Services which are not in use and are non-essential for operations should be deactivated."
      solution    : "Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'TSM'} | Set-VMHostService -Policy Off
Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'TSM'} | Stop-VMHostService"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06a.,800-53|CM-7a.,800-53r5|CM-7a.,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "Check running state"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='slpd']/audit:label\"/> running : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='slpd']/audit:running\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "slpd running : "
      expect      : "slpd running : FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check startup policy"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='slpd']/audit:label\"/> policy : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='slpd']/audit:policy\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "slpd policy : "
      expect      : "slpd policy : off$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.deactivate-slp"
      info        : "The ESXi SLP service should be deactivated. Services which are not in use and are non-essential for operations should be deactivated."
      solution    : "Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'slpd'} | Set-VMHostService -Policy Off
Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'slpd'} | Stop-VMHostService"
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "Check running state"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='snmpd']/audit:label\"/> running : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='snmpd']/audit:running\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "SNMP Server running : "
      expect      : "SNMP Server running : FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check startup policy"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='snmpd']/audit:label\"/> policy : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='snmpd']/audit:policy\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "SNMP Server policy : "
      expect      : "SNMP Server policy : off$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.deactivate-snmp"
      info        : "The ESXi SNMP service should be deactivated. Services which are not in use and are non-essential for operations should be deactivated."
      solution    : "Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'snmpd'} | Set-VMHostService -Policy Off
Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'snmpd'} | Stop-VMHostService"
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "Check running state"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM-SSH']/audit:label\"/> enabled : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM-SSH']/audit:running\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "SSH enabled : "
      expect      : "SSH enabled : FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "Check startup policy"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM-SSH']/audit:label\"/> policy : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM-SSH']/audit:policy\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "SSH policy : "
      expect      : "SSH policy : off$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.deactivate-ssh"
      info        : "The ESXi SSH service should be deactivated. Services which are not in use and are non-essential for operations should be deactivated."
      solution    : "Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'TSM-SSH'} | Set-VMHostService -Policy Off
Get-VMHostService -VMHost $ESXi | where {$_.Key -eq 'TSM-SSH'} | Stop-VMHostService"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.1.12,800-171|3.4.6,800-171|3.4.7,800-171r3|03.01.12,800-171r3|03.04.06a.,800-53|AC-17(1),800-53|AC-17(9),800-53|CM-7a.,800-53r5|AC-17(1),800-53r5|AC-17(9),800-53r5|CM-7a.,CCI|CCI-000381,CCI|CCI-002314,CCI|CCI-002322,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(i),CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,CSF2.0|PR.AA-05,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.6.7,ISO-27001-2022|A.8.16,ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17,ITSG-33|AC-17(1),ITSG-33|CM-7a.,NESA|T5.4.4,NESA|T5.4.5,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.etc-issue"
  info        : "Configure the login banner for ESXi host SSH connections. ESXi enables a login message display, often used to deter intruders and inform authorized users about system use obligations. This parameter defines the text shown during an SSH connection. It is highly recommended to keep SSH in the stopped state unless troubleshooting. An implementation inconsistency between ESXi and vCenter Server requires that \"issue\" in Config.Etc.issue be lowercase, to work in both scenarios."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Config.Etc.issue | Set-AdvancedSetting -Value \"****************************************************************************`n* Authorized users only. Actual or attempted unauthorized use of this      *`n* system is prohibited and may result in criminal, civil, security, or     *`n* administrative proceedings and/or penalties. Use of this information     *`n* system indicates consent to monitoring and recording, without notice     *`n* or permission. Users have no expectation of privacy. Any information     *`n* stored on or transiting this system, or obtained by monitoring and/or    *`n* recording, may be disclosed to law enforcement and/or used in accordance *`n* with Federal law, State statute, and organization policy. If you are not *`n* an authorized user of this system, exit the system at this time.       *`n****************************************************************************`n\""
  reference   : "800-171|3.1.9,800-171r3|03.01.09,800-53|AC-8a.,800-53r5|AC-8a.,CCI|CCI-000048,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-8a.,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,TBA-FIISB|45.2.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Config.Etc.issue']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.Etc.issue']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.Etc.issue']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Config.Etc.issue : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Config.Etc.issue : "
  expect      : "Config.Etc.issue : @BANNER_TEXT@$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.firewall-incoming-default"
  info        : "The ESXi host must configure the firewall to block network traffic by default. Ensures that all incoming and outgoing network traffic is blocked unless explicitly allowed, reducing the attack surface and preventing unauthorized access to the host."
  solution    : "$ESXcli = Get-EsxCli -VMHost $ESXi -V2
$arguments = $ESXcli.network.firewall.set.CreateArgs()
$arguments.defaultaction = $FALSE
$arguments.enabled = $true
$ESXcli.network.firewall.set.Invoke($arguments)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "  <xsl:variable name=\"addr\" select=\"audit:propSet[audit:name='name']/audit:val\"/>"
  xsl_stmt    : "  <xsl:for-each select=\"//audit:firewall\">"
  xsl_stmt    : "      <xsl:choose>"
  xsl_stmt    : "        <xsl:when test=\"audit:defaultPolicy/audit:incomingBlocked='true' and audit:defaultPolicy/audit:outgoingBlocked='true'\">"
  xsl_stmt    : "          <xsl:value-of select=\"$addr\"/> - incoming/outgoing - Default policy drops network traffic : TRUE<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "        </xsl:when>"
  xsl_stmt    : "        <xsl:otherwise>"
  xsl_stmt    : "          <xsl:value-of select=\"$addr\"/> - incoming - Default policy drops network traffic : <xsl:value-of select=\"audit:defaultPolicy/audit:incomingBlocked\"/> <xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "          <xsl:value-of select=\"$addr\"/> - outgoing - Default policy drops network traffic : <xsl:value-of select=\"audit:defaultPolicy/audit:outgoingBlocked\"/> <xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "        </xsl:otherwise>"
  xsl_stmt    : "      </xsl:choose>"
  xsl_stmt    : "  </xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Default policy drops network traffic"
  expect      : "Default policy drops network traffic : TRUE$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.firewall-restrict-access"
  info        : "Configure the ESXi host firewall to only allow traffic from authorized networks. Ensures that all incoming and outgoing network traffic is blocked unless explicitly allowed, reducing the attack surface and helping to prevent unauthorized access to the host. As of vSphere 8.0.2, firewall rules are categorized as 'user' or 'system' owned, where only 'user' owned rules are configurable. Beginning in vSphere 8 Update 2b and PowerCLI 13.2.1 there are additional queryable parameters to automate setting and checking for configurable rules.

  NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "# This is an example which you will want to customize!
$ESXcli = Get-EsxCli -VMHost $ESXi -V2
# Deactivate firewall temporarily so we don't lose connectivity
$arguments = $ESXcli.network.firewall.set.CreateArgs()
$arguments.enabled = $false
$ESXcli.network.firewall.set.Invoke($arguments)

# Unset the \"allow all\" flag
$arguments = $ESXcli.network.firewall.ruleset.set.CreateArgs()
$arguments.allowedall = $false
$arguments.rulesetid = \"sshServer\"
$ESXcli.network.firewall.ruleset.set.Invoke($arguments)

# Add an IP range
$arguments = $ESXcli.network.firewall.ruleset.allowedip.add.CreateArgs()
$arguments.ipaddress = \"192.168.0.0/16\"
$arguments.rulesetid = \"sshServer\"
$ESXcli.network.firewall.ruleset.allowedip.add.Invoke($arguments)

# Enable the firewall
$arguments = $ESXcli.network.firewall.set.CreateArgs()
$arguments.enabled = $true
$ESXcli.network.firewall.set.Invoke($arguments)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\"><xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text>&#10;</xsl:text><xsl:for-each select=\"//audit:firewall/audit:ruleset\"><xsl:choose><xsl:when test=\"audit:enabled='true'\"><xsl:text>Port </xsl:text><xsl:value-of select=\"audit:rule/audit:port\"/><xsl:text> [</xsl:text><xsl:value-of select=\"audit:label\"/><xsl:text>] -- Allowed IPs: </xsl:text><xsl:choose><xsl:when test=\"audit:allowedHosts/audit:allIp='true'\"><xsl:text>ALL&#10;</xsl:text></xsl:when><xsl:otherwise><xsl:for-each select=\"audit:allowedHosts/audit:ipNetwork\"><xsl:value-of select=\"audit:network\"/>/<xsl:value-of select=\"audit:prefixLength\"/><xsl:if test=\"position() != last()\"><xsl:text>, </xsl:text></xsl:if></xsl:for-each><xsl:text>&#10;</xsl:text></xsl:otherwise></xsl:choose></xsl:when></xsl:choose></xsl:for-each></xsl:template>"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.host-client-session-timeout"
  info        : "The ESXi host must automatically terminate idle host client sessions. This practice helps mitigate potential security risks by ensuring that unattended sessions, which could be exploited by unauthorized users or malicious software, are not left open indefinitely."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting UserVars.HostClientSessionTimeout | Set-AdvancedSetting -Value 900"
  reference   : "800-171|3.1.10,800-171r3|03.01.10a.,800-53|AC-11a.,800-53r5|AC-11a.,CCI|CCI-000057,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO-27001-2022|A.7.7,ISO-27001-2022|A.8.1,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11a.,NESA|T2.3.8,NESA|T2.3.9,NIAv2|AM23a,NIAv2|AM23b,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.HostClientSessionTimeout']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.HostClientSessionTimeout']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars.HostClientSessionTimeout : "
  expect      : "UserVars.HostClientSessionTimeout : @HOST_CLIENT_SESSION_TIMEOUT@$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.hw-virtual-nic"
  info        : "The ESXi host must not enable virtual hardware management network interfaces. Hardware management controllers often present virtual or USB NICs to the ESXi host. These can be used as backdoors and should be deactivated both in the hardware configuration and in ESXi."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Net.BMCNetworkEnable | Set-AdvancedSetting -Value 0"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Net.BMCNetworkEnable']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Net.BMCNetworkEnable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Net.BMCNetworkEnable : "
  expect      : "Net.BMCNetworkEnable : 0$"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "ESXi: esxi-8.iscsi-mutual-chap (Check iSCSI Enabled)"
      xsl_stmt    : "<xsl:template match=\"//audit:returnval\"><xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:storageDevice/audit:softwareInternetScsiEnabled\"/></xsl:template>"
      regex       : "(true|false)"
      expect      : "^true$"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : AUDIT_ESX
      description : "ESXi: esxi-8.iscsi-mutual-chap"
      info        : "Enable bidirectional/mutual CHAP authentication for iSCSI traffic. Mutual CHAP provides an additional layer of protection by requiring both the initiator (client) and the target (server) to verify their identities to each other, thereby ensuring data transmitted between the two is not intercepted or altered by unauthorized entities."
      solution    : "Get-VMHost -Name $ESXi | Get-VMHostHba | Where {$_.Type -eq \"Iscsi\"} | Set-VMHostHba <parameters>"
      reference   : "800-171r3|03.05.02,800-53|IA-3(1),800-53r5|IA-3(1),CCI|CCI-001967,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3(1),NESA|T5.4.3,QCSC-v1|13.2,TBA-FIISB|27.1"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      xsl_stmt    : "<xsl:template match=\"/\"><xsl:variable name=\"hostname\" select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:storageDevice/audit:hostBusAdapter[contains (@xsi:type,'HostInternetScsiHba')]\"><xsl:value-of select=\"$hostname\"/> (<xsl:value-of select=\"audit:device\"/>) - MutualChapAuthenticationType : <xsl:value-of select=\"audit:authenticationProperties/audit:mutualChapAuthenticationType\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "MutualChapAuthenticationType : "
      expect      : "MutualChapAuthenticationType : chapRequired$"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "ESXi: esxi-8.iscsi-mutual-chap"
      info        : "iSCSI is not enabled on this host. Mutual CHAP authentication for iSCSI traffic is not applicable."
      solution    : "No action required as iSCSI is not enabled."
      reference   : "800-171r3|03.05.02,800-53|IA-3(1),800-53r5|IA-3(1),CCI|CCI-001967,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3(1),NESA|T5.4.3,QCSC-v1|13.2,TBA-FIISB|27.1"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
    </report>
  </else>
</if>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.lockdown-dcui-access"
  info        : "The ESXi host must have an accurate DCUI.Access list. Ensures that only authorized users have direct console user interface (DCUI) access to the ESXi host when Lockdown Mode is enabled. The root user cannot be removed from the list. To control ESXi Shell and/or SSH access use the Lockdown Mode Exception Users list."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting DCUI.Access | Set-AdvancedSetting -Value root"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='DCUI.Access']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='DCUI.Access']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "DCUI.Access : "
  expect      : "DCUI.Access : root$"
</custom_item>

<report type:"WARNING">
  description : "ESXi: esxi-8.lockdown-exception-users"
  info        : "The ESXi host must have an accurate Exception Users list. Users on the Lockdown Mode \"Exception Users\" list do not lose their privileges when the host enters lockdown mode, which can potentially defeat the purpose of lockdown mode.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "(Get-View (Get-VMHost -Name $ESXi | Get-View).ConfigManager.HostAccessManager).UpdateLockdownExceptions($NULL)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.lockdown-mode"
  info        : "Enable normal lockdown mode on the ESXi host. Enabling lockdown mode deactivates direct access to an ESXi host and requires that the host be managed remotely from vCenter Server. This is done to ensure that the roles and access controls implemented in vCenter are always enforced, and users cannot bypass them by logging into a host directly. By forcing all interactions to occur through vCenter Server, the risk of someone attaining elevated privileges or performing tasks that are not properly audited is greatly reduced. Note that users listed in the Exception Users list for each host are allowed to override lockdown mode and log in. By default, no users are present on the Exception Users list. There are three settings for lockdown mode: disabled, normal, and strict. Choosing strict means that if the ESXi host loses contact with vCenter Server, it cannot be managed in any way until that connection is restored. If the connection cannot be restored, the host will need to be rebuilt. This level of lockdown mode is typically not necessary for most deployments and can present significant operational challenges. Therefore, we recommend using normal lockdown mode."
  solution    : "(Get-View (Get-VMHost -Name $ESXi | Get-View).ConfigManager.HostAccessManager).ChangeLockdownMode('lockdownNormal')"
  reference   : "800-53|AC-10,800-53r5|AC-10,CCI|CCI-000054,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - Lockdown Mode : <xsl:value-of select=\"audit:propSet/audit:val/audit:lockdownMode\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Lockdown Mode : "
  expect      : "Lockdown Mode : lockdownNormal$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-audit-local"
  info        : "The ESXi host must enable audit record logging. ESXi will store audit records locally."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.auditRecord.storageEnable | Set-AdvancedSetting -Value TRUE"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.storageEnable']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.storageEnable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.auditRecord.storageEnable : "
  expect      : "Syslog.global.auditRecord.storageEnable : TRUE$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-audit-local-capacity"
  info        : "The ESXi host must store one week of audit records. If a remote audit record storage facility is available, it is essential to ensure that the local storage capacity is sufficient to hold audit records that may accumulate during anticipated interruptions in the delivery of records to the facility. This ensures that audit records are not lost or overwritten during periods when the remote storage is unavailable, allowing for seamless continuity of the audit trail and compliance requirements."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.auditRecord.storageCapacity | Set-AdvancedSetting -Value 100"
  reference   : "800-53|AU-4,800-53r5|AU-4,CCI|CCI-001849,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.6,ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.storageCapacity']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.storageCapacity']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.auditRecord.storageCapacity : "
  expect      : "Syslog.global.auditRecord.storageCapacity : 100$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-audit-persistent"
  info        : "Configure a persistent log location for all locally stored audit records on the ESXi host. ESXi can be configured to store audit records on an in-memory file system. This occurs when the host's \"/scratch\" directory is linked to \"/tmp/scratch\". When this is done only a single day's worth of records are stored at any time. In addition audit records will be reinitialized upon each reboot. This presents a security risk as user activity logged on the host is only stored temporarily and will not persistent across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host audit record logging should always be configured to a persistent datastore. You can detect if the scratch volume is temporary or persistent by querying the ScratchConfig.CurrentScratchLocation advanced parameter. If, when queried, it returns \"/tmp/scratch\" then the volume is temporary and you should remap the audit record storage to a persistent device. Cannot be a vSAN datastore. If your only local, non-vSAN storage is SD or USB media (which can become unreliable with repeated writes from logs) you might consider leaving the logs in the ramdisk and ensuring that a remote logging host is configured instead. Document the decision and rationale in preparation for future audits."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.auditRecord.storageDirectory | Set-AdvancedSetting -Value \"<PERSISTENT LOCATION>/audit\""
  reference   : "800-53|AU-4,800-53r5|AU-4,CCI|CCI-001849,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.6,ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.storageDirectory']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.storageDirectory']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.auditRecord.storageDirectory : "
  expect      : "Syslog.global.auditRecord.storageDirectory : @SYSLOG_DIR@$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-audit-remote"
  info        : "The ESXi host must transmit audit records to a remote host. ESXi will transmit audit records to the configured log collector."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.auditRecord.remoteEnable | Set-AdvancedSetting -Value TRUE"
  reference   : "800-53|AU-4(1),800-53r5|AU-4(1),CCI|CCI-001851,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.6,ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.remoteEnable']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.auditRecord.remoteEnable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.auditRecord.remoteEnable : "
  expect      : "Syslog.global.auditRecord.remoteEnable : TRUE$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-level"
  info        : "Set the ESXi host logging informational level to info. It is important to ensure that sufficient information is present in audit logs for diagnostics and forensics purposes."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Config.HostAgent.log.level | Set-AdvancedSetting -Value info"
  reference   : "800-171|3.3.1,800-171|3.3.2,800-171r3|03.03.02a.,800-171r3|03.03.03,800-53|AU-3,800-53|AU-12b.,800-53r5|AU-3a.,800-53r5|AU-12b.,CCI|CCI-000130,CCI|CCI-000171,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.28,ISO-27001-2022|A.8.15,ITSG-33|AU-3,ITSG-33|AU-12b.,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.log.level']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.log.level']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Config.HostAgent.log.level : "
  expect      : "Config.HostAgent.log.level : info$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-level-global"
  info        : "The ESXi host must log sufficient information for events. Without sufficient log data, critical indicators of compromise may go unnoticed, leading to increased vulnerability and potential failure to respond effectively to cybersecurity incidents."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.logLevel | Set-AdvancedSetting -Value info"
  reference   : "800-171|3.3.1,800-171|3.3.2,800-171r3|03.03.02a.,800-53|AU-3,800-53r5|AU-3a.,CCI|CCI-000130,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.28,ISO-27001-2022|A.8.15,ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logLevel']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logLevel']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.logLevel : "
  expect      : "Syslog.global.logLevel : info$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-persistent"
  info        : "Configure a persistent log location for all locally stored logs on the ESXi host. ESXi can be configured to store log files on an in-memory file system. This occurs when the host's \"/scratch\" directory is linked to \"/tmp/scratch\". When this is done, only a single day's worth of logs is stored at any time. Additionally, log files will be reinitialized upon each reboot. This presents a security risk as user activity logged on the host is only stored temporarily and will not persist across reboots. It can also complicate auditing and make it harder to monitor events and diagnose issues. Therefore, it is recommended to configure ESXi host logging to a persistent datastore. You can detect if the scratch volume is temporary or persistent by querying the ScratchConfig.CurrentScratchLocation advanced parameter. If, when queried, it returns \"/tmp/scratch\" then the volume is temporary and you should remap the audit record storage to a persistent device. Cannot be a vSAN datastore unless Syslog.global.vsanBacking is set, which has caveats & dependencies. If your only local, non-vSAN storage is SD or USB media (which can become unreliable with repeated writes from logs) you might consider leaving the logs in the ramdisk and ensuring that a remote logging host is configured instead. Document the decision and rationale in preparation for future audits."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.logDir | Set-AdvancedSetting -Value \"<PERSISTENT LOCATION>\""
  reference   : "800-53|AU-4,800-53r5|AU-4,CCI|CCI-001849,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.6,ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logDir']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logDir']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.logDir : "
  expect      : "Syslog.global.logDir : @SYSLOG_DIR@$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-remote"
  info        : "Configure a remote log server for the ESXi host. Remote logging to a central log host provides a secure and centralized store for ESXi logs. By gathering host log files onto a central host, you can more easily monitor all hosts using a single tool. Additionally, you can perform aggregate analysis and searching to identify coordinated attacks on multiple hosts. Logging to a secure and centralized log server helps prevent log tampering and ensures a long-term audit record."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.logHost | Set-AdvancedSetting -Value \"<log collector>\""
  reference   : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2(1),800-53|AC-2(4),800-53|AU-4(1),800-53r5|AC-2(1),800-53r5|AU-4(1),CCI|CCI-000015,CCI|CCI-001683,CCI|CCI-001684,CCI|CCI-001686,CCI|CCI-001851,CN-L3|7.1.3.2(d),CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-4,CSF|PR.PT-1,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.6,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(1),ITSG-33|AC-2(4),ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,NESA|T5.2.2,NIAv2|AM9a,NIAv2|AM9b,NIAv2|AM9c,NIAv2|AM9d,NIAv2|AM9e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Syslog.global.logHost : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.logHost : "
  expect      : "Syslog.global.logHost : @LOG_HOST@$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-remote-tls"
  info        : "The ESXi host must verify certificates for TLS remote logging endpoints. TLS certificates help ensure that the endpoint is authentic and trustworthy."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.certificate.checkSSLCerts | Set-AdvancedSetting -Value TRUE"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.certificate.checkSSLCerts']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.certificate.checkSSLCerts']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.certificate.checkSSLCerts : "
  expect      : "Syslog.global.certificate.checkSSLCerts : TRUE$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.logs-remote-tls-x509"
  info        : "The ESXi host must use strict x509 verification for TLS-enabled remote logging endpoints. This \"x509-strict\" option performs additional validity checks on CA root certificates during verification."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Syslog.global.certificate.strictX509Compliance | Set-AdvancedSetting -Value TRUE"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.certificate.strictX509Compliance']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.certificate.strictX509Compliance']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog.global.certificate.strictX509Compliance : "
  expect      : "Syslog.global.certificate.strictX509Compliance : TRUE$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.memeagerzero"
  info        : "The ESXi host must enable volatile key destruction. By default, ESXi zeroes out pages allocated for virtual machines (VMs), userspace applications, and kernel threads at the time of allocation. This ensures that no non-zero pages are exposed to VMs or userspace applications. This measure is in place to prevent the exposure of cryptographic keys from VMs or userworlds to other clients. However, if memory is not reused, these keys can remain present in host memory for an extended period. To address this, MemEagerZero can be configured to enforce the zeroing out of userworld and guest memory pages when a userworld process or guest exits. For kernel threads, memory spaces holding keys are zeroed out as soon as the secret is no longer required."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Mem.MemEagerZero | Set-AdvancedSetting -Value 1"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Mem.MemEagerZero']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Mem.MemEagerZero']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Mem.MemEagerZero : "
  expect      : "Mem.MemEagerZero : 1$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.network-bpdu"
  info        : "Enable the Bridge Protocol Data Unit (BPDU) filter on the ESXi host. BPDUs (Bridge Protocol Data Units) are used to transmit Spanning Tree Protocol (STP) information and detect network loops. BPDU Guard and Portfast are commonly enabled on the physical switch directly connected to the ESXi host to reduce spanning tree convergence delay. However, if a BPDU packet is sent from a virtual machine on the ESXi host to the configured physical switch, it can result in a cascading lockout of all uplink interfaces from the ESXi host. To prevent this type of lockout, BPDU Filter can be enabled on the ESXi host to drop any BPDU packets being sent to the physical switch. It is important to note that Standard and Distributed Virtual Switches do not support STP and do not generate BPDUs."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Net.BlockGuestBPDU | Set-AdvancedSetting -Value 1"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet[audit:val/audit:option[audit:key='Net.BlockGuestBPDU']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Net.BlockGuestBPDU']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Net.BlockGuestBPDU : "
  expect      : "Net.BlockGuestBPDU : 1$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.network-dvfilter"
  info        : "Use of the dvFilter network APIs must be restricted on the ESXi host. If you are not using a product such as VMware NSX that utilizes the dvfilter network API, it is recommended not to configure the host to send network information to an IP address. Enabling the API and referencing an IP address that is compromised could potentially provide unauthorized access to the network of other virtual machines (VMs) on the host. If you are using a product that relies on this API, it is important to verify that the host has been configured correctly to ensure secure network communication."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Net.DVFilterBindIpAddress | Set-AdvancedSetting -Value \"\""
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Net.DVFilterBindIpAddress']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Net.DVFilterBindIpAddress']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Net.DVFilterBindIpAddress']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Net.DVFilterBindIpAddress : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Net.DVFilterBindIpAddress : "
  expect      : "Net.DVFilterBindIpAddress : (@SECURITY_APPLIANCE@|NOT in use)$"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "check Port Group Forged Transmits"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose><xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\"><xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\"><xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:key\"/>) - forgedTransmits = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:forgedTransmits\"/><xsl:text>&#10;</xsl:text></xsl:for-each></xsl:when><xsl:otherwise><xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - forgedTransmits = FALSE</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "forgedTransmits ="
      expect      : "forgedTransmits = FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "check vSwitch Forged Transmits"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose><xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\"><xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\"><xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:key\"/>) - forgedTransmits = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:forgedTransmits\"/><xsl:text>&#10;</xsl:text></xsl:for-each></xsl:when><xsl:otherwise><xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - forgedTransmits = FALSE</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "forgedTransmits ="
      expect      : "forgedTransmits = FALSE$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.network-reject-forged-transmit-standardswitch"
      info        : "All standard switches and their port groups must be configured to reject forged transmits. If the MAC address of a virtual machine operating system changes, it allows the operating system to send frames with an impersonated source MAC address, potentially enabling malicious attacks on devices within a network by impersonating an authorized network adapter. When the \"Forged transmits\" option is set to \"Accept,\" ESXi does not compare the source and effective MAC addresses. To protect against MAC impersonation, you can set the \"Forged transmits\" option to \"Reject.\" In this case, the host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to check for a match. If the addresses do not match, the ESXi host drops the packet."
      solution    : "Get-VMHost -Name $ESXi | Get-VirtualSwitch -Standard | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmits $false
Get-VMHost -Name $ESXi | Get-VirtualPortGroup -Standard | Get-SecurityPolicy | Set-SecurityPolicy -ForgedTransmitsInherited $true"
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "check for Port Group MAC Changes"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose><xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\"><xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\"><xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:key\"/>) - macChanges = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:macChanges\"/><xsl:text>&#10;</xsl:text></xsl:for-each></xsl:when><xsl:otherwise><xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - macChanges = FALSE</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "macChanges ="
      expect      : "macChanges = FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "check for vSwitch MAC Changes"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose><xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\"><xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\"><xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:key\"/>) - macChanges = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:macChanges\"/><xsl:text>&#10;</xsl:text></xsl:for-each></xsl:when><xsl:otherwise><xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - macChanges = FALSE</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "macChanges ="
      expect      : "macChanges = FALSE$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.network-reject-mac-changes-standardswitch"
      info        : "All standard switches and their port groups must be configured to reject guest MAC address changes. If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address, enabling it to stage malicious attacks on devices within a network by impersonating a network adapter authorized by the receiving network. To prevent virtual machines from changing their effective MAC address, measures should be taken to enforce MAC address stability or restrict the ability to modify MAC addresses. This helps mitigate the risk of MAC impersonation and potential malicious activities."
      solution    : "Get-VMHost -Name $ESXi | Get-VirtualSwitch -Standard | Get-SecurityPolicy | Set-SecurityPolicy -MacChanges $false
Get-VMHost -Name $ESXi | Get-VirtualPortGroup -Standard | Get-SecurityPolicy | Set-SecurityPolicy -MacChangesInherited $true"
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "check for vSwitch Promiscuous Mode"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose><xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\"><xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\"><xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:key\"/>) - allowPromiscuous = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:allowPromiscuous\"/><xsl:text>&#10;</xsl:text></xsl:for-each></xsl:when><xsl:otherwise><xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - allowPromiscuous = FALSE</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "allowPromiscuous ="
      expect      : "allowPromiscuous = FALSE$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "check for Port Group Promiscuous Mode"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose><xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\"><xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\"><xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:key\"/>) - allowPromiscuous = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:allowPromiscuous\"/><xsl:text>&#10;</xsl:text></xsl:for-each></xsl:when><xsl:otherwise><xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - allowPromiscuous = FALSE</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "allowPromiscuous ="
      expect      : "allowPromiscuous = FALSE$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.network-reject-promiscuous-mode-standardswitch"
      info        : "All standard switches and their port groups must be configured to reject guest promiscuous mode requests. When promiscuous mode is enabled for a port group, all virtual machines connected to that port group have the potential to read all packets transmitted across that port group, regardless of the intended recipient. It is important to consider the potential impact and design considerations before changing the default value of promiscuous mode."
      solution    : "Get-VMHost -Name $ESXi | Get-VirtualSwitch -Standard | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuous $false
Get-VMHost -Name $ESXi | Get-VirtualPortGroup -Standard | Get-SecurityPolicy | Set-SecurityPolicy -AllowPromiscuousInherited $true"
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.network-vgt"
  info        : "The ESXi host must restrict the use of Virtual Guest Tagging (VGT) on Standard Switches. When a port group is set to VLAN 4095, the vSwitch passes all network frames to the attached virtual machines (VMs) without modifying the VLAN tags. In vSphere, this is referred to as VGT. The VM must process the VLAN information itself via an 802.1Q driver in the operating system. VLAN 4095 must only be implemented if the attached VMs have been specifically authorized and are capable of managing VLAN tags themselves. If VLAN 4095 is enabled inappropriately, it may cause denial of service or allow a VM to interact with traffic on an unauthorized VLAN."
  solution    : "Get-VMHost -Name $ESXi | Get-VirtualPortGroup -Standard -Name $PG| Set-VirtualPortGroup -VlanID \"<new VLAN>\""
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:spec/audit:name\"/>) - vlanId : <xsl:value-of select=\"audit:spec/audit:vlanId\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "vlanId : "
  not_expect  : "vlanId : 4095$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.shell-interactive-timeout"
  info        : "Configure the inactivity timeout to automatically terminate idle ESXi host shells. If a user forgets to log out of their SSH session, the idle connection will remain open indefinitely, increasing the potential for someone to gain privileged access to the host."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting UserVars.ESXiShellInteractiveTimeOut | Set-AdvancedSetting -Value 900"
  reference   : "800-171|3.1.11,800-171|3.13.9,800-171r3|03.01.11,800-171r3|03.13.09,800-53|AC-12,800-53|SC-10,800-53r5|AC-12,800-53r5|SC-10,CCI|CCI-001133,CCI|CCI-002361,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO-27001-2022|A.8.20,ITSG-33|AC-12,ITSG-33|SC-10,ITSG-33|SC-10a.,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,NIAv2|NS49,SWIFT-CSCv1|2.6"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellInteractiveTimeOut']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellInteractiveTimeOut']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars.ESXiShellInteractiveTimeOut : "
  expect      : "UserVars.ESXiShellInteractiveTimeOut : 900$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.shell-timeout"
  info        : "Set a timeout to limit how long the ESXi Shell and SSH services are allowed to run. The ESXiShellTimeOut defines a window of time after which the ESXi Shell and SSH services will automatically be terminated."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting UserVars.ESXiShellTimeOut | Set-AdvancedSetting -Value 600"
  reference   : "800-171|3.13.9,800-171r3|03.13.09,800-53|SC-10,800-53r5|SC-10,CCI|CCI-001133,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.20,ITSG-33|SC-10,ITSG-33|SC-10a.,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,SWIFT-CSCv1|2.6"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars.ESXiShellTimeOut : "
  expect      : "UserVars.ESXiShellTimeOut : 600$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.shell-warning"
  info        : "The ESXi host must not suppress warnings that the ESXi shell is enabled. Warnings indicating that SSH or the ESXi Shell is enabled can be clues that an attack is in progress. It is important to ensure that SSH and the ESXi Shell are deactivated, and that this variable is not set."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting UserVars.SuppressShellWarning | Set-AdvancedSetting -Value 0"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.SuppressShellWarning']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.SuppressShellWarning']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars.SuppressShellWarning : "
  expect      : "UserVars.SuppressShellWarning : 0$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.timekeeping-sources"
  info        : "ESXi host must have reliable time synchronization sources. Cryptography, audit logging, cluster operations, and incident response/forensics heavily rely on synchronized time. The recommended practice for NTP is to have at least four sources. It is not advisable to have only two sources, as having one source is preferable to having two. Precision Time Protocol (PTP) is an alternative to NTP that offers sub-millisecond time accuracy. PTP has a different architecture compared to NTP and may not provide the same level of resilience in case of primary server failure. It is suggested to configure NTP as a backup source for PTP, ensuring that a time source remains available even if the accuracy is reduced."
  solution    : "$ntp0 = \"0.vmware.pool.ntp.org\"
$ntp1 = \"1.vmware.pool.ntp.org\"
$ntp2 = \"2.vmware.pool.ntp.org\"
$ntp3 = \"3.vmware.pool.ntp.org\"

Add-VMHostNTPServer -NtpServer $ntp0 , $ntp1 , $ntp2 , $ntp3 -VMHost $ESXi -Confirm:$false"
  reference   : "800-171|3.3.7,800-171r3|03.03.07,800-53|AU-8(1)(a),800-53|AU-8(1)(b),800-53r5|SC-45(1)(a),800-53r5|SC-45(1)(b),CCI|CCI-001891,CCI|CCI-002046,CCI|CCI-004923,CCI|CCI-004926,CN-L3|8.1.4.3(b),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.17,ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.2.1|10.4,PCI-DSSv3.2.1|10.4.1,PCI-DSSv3.2.1|10.4.3,PCI-DSSv4.0|10.6,PCI-DSSv4.0|10.6.1,PCI-DSSv4.0|10.6.2,PCI-DSSv4.0|10.6.3,QCSC-v1|8.2.1,QCSC-v1|13.2,TBA-FIISB|37.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"//audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - NTP Server Pool: </xsl:text>"
  xsl_stmt    : "<xsl:for-each select=\"//audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig/audit:server\">"
  xsl_stmt    : "<xsl:value-of select=\"current()\"></xsl:value-of><xsl:if test=\"following::audit:server\"><xsl:text>, </xsl:text></xsl:if>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - NTP Server Pool: NOT found&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:template>"
  regex       : "NTP Server Pool: "
  expect      : "NTP Server Pool: @NTP_SERVER@$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.tls-protocols"
  info        : "The ESXi host must enable the highest version of TLS supported. ESXi 8 ships with TLS 1.2 enabled by default, but it is possible to re-enable other protocols if necessary."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting UserVars.ESXiVPsDisabledProtocols | Set-AdvancedSetting -Value \"sslv3,tlsv1,tlsv1.1\""
  reference   : "800-171|3.13.8,800-171r3|03.13.08,800-53|SC-8(2),800-53r5|SC-8(2),CCI|CCI-002420,CCI|CCI-002422,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.33,ISO-27001-2022|A.8.20,ITSG-33|SC-8(2),ITSG-33|SC-9(2),NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|2.1"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiVPsDisabledProtocols']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiVPsDisabledProtocols']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiVPsDisabledProtocols']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>UserVars.ESXiVPsDisabledProtocols : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars.ESXiVPsDisabledProtocols : "
  expect      : "UserVars.ESXiVPsDisabledProtocols : sslv3,tlsv1,tlsv1.1$"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.transparent-page-sharing"
  info        : "The ESXi host must restrict inter-VM transparent page sharing to VMs configured with sched.mem.pshare.salt. Transparent Page Sharing (TPS) is a method used to reduce the memory usage of virtual machines. However, under specific conditions, it can potentially be exploited to gain unauthorized access to data on neighboring virtual machines. Virtual machines that do not have the sched.mem.pshare.salt option set are unable to share memory with any other virtual machines, providing an additional layer of isolation and security."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting Mem.ShareForceSalting | Set-AdvancedSetting -Value 2"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Mem.ShareForceSalting']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Mem.ShareForceSalting']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Mem.ShareForceSalting : "
  expect      : "Mem.ShareForceSalting : 2$"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "check that ntpd is running"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - NTPd running: </xsl:text> <xsl:value-of select=\"audit:propSet/audit:val/audit:service/audit:service[audit:key='ntpd']/audit:running\" />"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "NTPd running: "
      expect      : "NTPd running: true$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "check that ntpd is set to start on boot"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - NTPd starts on boot: </xsl:text> <xsl:value-of select=\"audit:propSet/audit:val/audit:service/audit:service[audit:key='ntpd']/audit:policy\" />"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "NTPd starts on boot: "
      expect      : "NTPd starts on boot: on$"
    </custom_item>

    <custom_item>
      type        : AUDIT_ESX
      description : "check that ntp servers are configured"
      xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"//audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig\">"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - NTP Server Pool: </xsl:text>"
      xsl_stmt    : "<xsl:for-each select=\"//audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig/audit:server\">"
      xsl_stmt    : "<xsl:value-of select=\"current()\"></xsl:value-of><xsl:if test=\"following::audit:server\"><xsl:text>, </xsl:text></xsl:if>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "<xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - NTP Server Pool: NOT found&#10;</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:template>"
      regex       : "NTP Server Pool: "
      expect      : "NTP Server Pool: @NTP_SERVER@$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "ESXi: esxi-8.timekeeping-services"
      info        : "ESXi host must have time synchronization services enabled and running. Cryptography, audit logging, cluster operations, and incident response/forensics heavily rely on synchronized time. To ensure this, NTP and/or PTP services must be set to start with the host and must be running."
      solution    : "Get-VMHostService -VMHost $ESXi -ErrorAction:Stop | Where-Object{$_.Key -eq \"ntpd\"} | Set-VMHostService -policy \"on\" -Confirm:$false
Get-VMHostService -VMHost $ESXi -ErrorAction:Stop | Where-Object{$_.Key -eq \"ntpd\"} | Restart-VMHostService -Confirm:$false"
      reference   : "800-171|3.3.7,800-171r3|03.03.07,800-53|AU-8(1)(a),800-53|AU-8(1)(b),800-53r5|SC-45(1)(a),800-53r5|SC-45(1)(b),CCI|CCI-001891,CCI|CCI-002046,CCI|CCI-004923,CCI|CCI-004926,CN-L3|8.1.4.3(b),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.17,ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.2.1|10.4,PCI-DSSv3.2.1|10.4.1,PCI-DSSv3.2.1|10.4.3,PCI-DSSv4.0|10.6,PCI-DSSv4.0|10.6.1,PCI-DSSv4.0|10.6.2,PCI-DSSv4.0|10.6.3,QCSC-v1|8.2.1,QCSC-v1|13.2,TBA-FIISB|37.4"
      see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
      show_output : YES
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "ESXi: esxi-8.updates"
  info        : "ESXi host has all software updates installed. By keeping ESXi patches up to date, vulnerabilities in the hypervisor can be mitigated. It is important to note that educated attackers can exploit known vulnerabilities when attempting to gain unauthorized access or elevate privileges on an ESXi host. When applying updates, it is recommended to update vCenter Server first, if an update is available, and then proceed with updating ESXi. This sequence ensures that the management layer is updated before updating the ESXi hosts.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXi: esxi-8.vib-trusted-binaries"
  info        : "Only run binaries delivered via signed VIB. ESXi conducts integrity checks of \"vSphere Installable Bundles\" or VIBs, governed by the Acceptance Level (see below). Instructing ESXi to only execute binaries that originated from a valid VIB installed on the host makes it harder for attackers to use prebuilt toolkits."
  solution    : "Get-VMHost -Name $ESXi | Get-AdvancedSetting VMkernel.Boot.execInstalledOnly | Set-AdvancedSetting -Value True"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='VMkernel.Boot.execInstalledOnly']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='VMkernel.Boot.execInstalledOnly']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "VMkernel.Boot.execInstalledOnly : "
  expect      : "VMkernel.Boot.execInstalledOnly : TRUE$"
</custom_item>

<report type:"WARNING">
  description : "ESXi: esxi-8.vmk-management"
  info        : "The ESXi host must isolate management communications. VMkernel network interfaces that are intended for specialized use can be configured with management capabilities, which may defeat network isolation and security efforts. Ensure that only vmk interfaces intended for management have management services enabled.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-VMHostNetworkAdapter -VMHost $ESXi -Name $vmkernel_interface | Set-VMHostNetworkAdapter -ManagementTrafficEnabled $false"
  reference   : "800-171|3.13.8,800-171r3|03.13.08,800-53|SC-8,800-53r5|SC-8,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.33,ISO-27001-2022|A.8.20,ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_VM
  description : "VM: guest-8.secure-boot"
  info        : "The guest OS must enable Secure Boot. Secure Boot, supported by all modern guest OSes, uses public key cryptography to validate firmware, boot loader, drivers, and OS kernel. By preventing system booting with uncertain boot chain validity, it effectively restricts malware."
  solution    : "$VMobj = (Get-VM -Name $VM)
$ConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec
$bootOptions = New-Object VMware.Vim.VirtualMachineBootOptions
$bootOptions.EfiSecureBootEnabled = $true
$ConfigSpec.BootOptions = $bootOptions
$task = $VMobj.ExtensionData.ReconfigVM_Task($ConfigSpec)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:bootOptions/audit:efiSecureBootEnabled\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - efiSecureBootEnabled : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:bootOptions/audit:efiSecureBootEnabled\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:toolsStatus\"/>) - efiSecureBootEnabled : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:bootOptions/audit:efiSecureBootEnabled\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - efiSecureBootEnabled : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:toolsStatus\"/>) - efiSecureBootEnabled : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "efiSecureBootEnabled : "
  expect      : "efiSecureBootEnabled : TRUE$"
</custom_item>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-add-feature"
  info        : "The guest OS must limit the automatic addition of VMware Tools features. VMware Tools automatic upgrade processes can add or remove features from the VMware Tools installation, which can be helpful but also presents an opportunity to alter the security profile of the guest OS from vSphere.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set autoupgrade allow-add-feature false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-allow-transforms"
  info        : "The guest OS must limit the use of MSI transforms when reconfiguring VMware Tools. MSI transforms allow the installation database on Microsoft Windows guest OSes to be changed. This can be helpful but also presents an opportunity to alter the security profile of the guest OS from vSphere.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set autoupgrade allow-msi-transforms false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-deactivate-appinfo"
  info        : "The guest OS must deactivate Appinfo information gathering unless required. Appinfo is a method to do application discovery through VMware Tools. If you are not using this tool deactivate the module to reduce attack surface.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set appinfo disabled true"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-deactivate-containerinfo"
  info        : "The guest OS must deactivate ContainerInfo unless required. The VMware Tools ContainerInfo plugin for Linux gathers the list of running containers inside a Linux guest operating system.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set containerinfo poll-interval 0"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-deactivate-guestoperations"
  info        : "The guest OS must deactivate Guest Operations unless required. Guest Operations are a set of functions that underpin most host-to-guest interaction. Deactivating them reduces attack surface but also drastically reduces functionality. Ensure that your environment does not require these functions. Do not do this on template VMs. For a list of functions see:

https://vdc-download.vmware.com/vmwb-repository/dcr-public/fe08899f-1eec-4d8d-b3bc-a6664c168c2c/7fdf97a1-4c0d-4be0-9d43-2ceebbc174d9/doc/vim.vm.guest.GuestOperationsManager.html

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set guestoperations disabled true"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-enable-logging"
  info        : "The guest OS must enable VMware Tools logging. Ensure that VMware Tools is logging information as appropriate. Logging in VMware Tools is very customizable, please see the examples in https://github.com/vmware/open-vm-tools/blob/master/open-vm-tools/tools.conf

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set logging log true"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-enable-syslog"
  info        : "The guest OS must send VMware Tools logs to the system log service. By default, VMware Tools sends logs to a file on disk. By setting this parameter it will send them to syslog on Linux guests and the Windows Event Service on Microsoft Windows guests, wherein they can be monitored, managed, and archived centrally.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set logging vmsvc.handler syslog
C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set logging toolboxcmd.handler syslog
C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set logging vgauthsvc.handler syslog
C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set logging vmtoolsd.handler syslog"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-globalconf"
  info        : "The guest OS must deactivate GlobalConf unless required. The GlobalConf feature of VMware Tools provides an ability to push tools.conf configurations to virtual machines.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set globalconf enabled false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-prevent-recustomization"
  info        : "The guest OS on deployed and customized virtual machines must prevent being recustomized. The VM deployment process offers many options for vSphere Admins to customize VMs, using scripts and running commands. This can also be an avenue for an adversary to gain access to data inside a VM, by cloning & recustomizing. Once a VM is deployed it should be prevented from being customized again (if you change your mind you can always revert it). Do not do this on template VMs.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set deployPkg enable-customization false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-remove-feature"
  info        : "The guest OS must limit the automatic removal of VMware Tools features. VMware Tools automatic upgrade processes can add or remove features from the VMware Tools installation, which can be helpful but also presents an opportunity to alter the security profile of the guest OS from vSphere.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set autoupgrade allow-remove-feature false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-updates"
  info        : "The guest OS must ensure that VMware Tools are updated. VMware Tools are an important part of the VMware ecosystem, enabling guest OSes to be shut down gracefully, managed throughout their lifecycle, providing drivers for paravirtualized devices, and helping to deploy and customize VMs from templates. Like all other software the VMware Tools need to be managed and updated. Ensure that you are running a supported version for your guest OS, whether it is delivered as part of the Linux distribution or installed by you for Microsoft Windows.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Site-Specific. Multiple ways to update VMware Tools. Drivers for vmxnet3 and pvscsi are also available via Windows Update, please ensure you are importing them into tools such as WSUS."
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "VM Tools: guest-8.tools-upgrade"
  info        : "The guest OS must configure automatic VMware Tools upgrades as appropriate for the environment. VMware Tools updates can be initiated by vSphere, which can be helpful for maintaining current VMware Tools versions. If VMware Tools is being managed and updated in other ways this functionality should be deactivated. This baseline suggests leaving automatic updates enabled.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "C:\\Program Files\\VMware\\VMware Tools\\VMwareToolboxCmd.exe config set autoupgrade allow-upgrade true"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_VM
  description : "VM: guest-8.virtual-hardware"
  info        : "The guest OS must ensure that virtual machine hardware is version 19 or newer where supported. Virtual hardware 19 is compatible with ESXi 7.0 Update 2 and later. Newer versions of virtual hardware enable new features and better performance. Consider upgrading to VM Hardware 21 if you are fully updated to vSphere 8. Other VMware guidance urges caution when upgrading; we urge testing of the process. Snapshots capture the virtual hardware version, making testing and rollback easy. Consider all locations that a virtual machine might run, or need to be restored to. Changes to the configuration of VMware-supplied virtual appliances are not supported and may cause service disruptions. This entry is intentionally categorized as \"in-guest\" due to the driver and other updates that will occur when a VM is upgraded, despite the impact being minimal."
  solution    : "Set-VM -Name $VM -HardwareVersion vmx-21"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:hwVersion\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - hwVersion : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:hwVersion\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:toolsStatus\"/>) - hwVersion : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:hwVersion\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - hwVersion : NOT found<xsl:text>&#10;</xsl:text></xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:toolsStatus\"/>) - hwVersion : NOT found<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "hwVersion : "
  expect      : "hwVersion : vmx-21$"
</custom_item>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-client-session-timeout"
  info        : "The vCenter Server must terminate vSphere Client sessions after 15 minutes of inactivity. Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free resources committed by the managed network element. Satisfies: SRG-APP-000190, SRG-APP-000295, SRG-APP-000389

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A (No public API available)"
  reference   : "800-171|3.1.11,800-171|3.13.9,800-171r3|03.01.11,800-171r3|03.05.01b.,800-171r3|03.13.09,800-53|AC-12,800-53|IA-11,800-53|SC-10,800-53r5|AC-12,800-53r5|SC-10,800-53r5|SC-11b.,CCI|CCI-001133,CCI|CCI-002038,CCI|CCI-002361,CCI|CCI-004895,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),HIPAA|164.312(d),ISO-27001-2022|A.8.20,ITSG-33|AC-12,ITSG-33|SC-10,ITSG-33|SC-10a.,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,NIAv2|NS49,QCSC-v1|13.2,SWIFT-CSCv1|2.6"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-failed-login-interval"
  info        : "The vCenter Server must set the interval for counting failed login attempts to at least 15 minutes. By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute forcing, is reduced. Limits are imposed by locking the account.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-SsoLockoutPolicy | Set-SsoLockoutPolicy -FailedAttemptIntervalSec 900"
  reference   : "800-171|3.1.8,800-171r3|03.01.08b.,800-53|AC-7b.,800-53r5|AC-7b.,CCI|CCI-002238,CN-L3|7.1.2.7(f),CN-L3|7.1.3.1(c),CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-7b.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.7,PCI-DSSv4.0|8.3.4,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-login-message-details"
  info        : "Configure the vCenter Server login banner details for the vSphere Client. vCenter Server can display a login message, which serves to deter illegal activities and communicate system usage obligations to authorized users. This configuration sets the detailed text linked from the vSphere Client login page message.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A (No public API available)

Can be configured using \"/opt/vmware/bin/sso-config.sh -set_logon_banner -title <logon_banner_title> <logonBannerFile>\" from an appliance shell. Please deactivate the shell again when you are done."
  reference   : "800-171|3.1.9,800-171r3|03.01.09,800-53|AC-8a.,800-53|AC-8b.,800-53|AC-8c.1.,800-53r5|AC-8a.,800-53r5|AC-8b.,800-53r5|AC-8c.1.,CCI|CCI-000048,CCI|CCI-000050,CCI|CCI-001384,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-8a.,ITSG-33|AC-8b.,ITSG-33|AC-8c.a.,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,NIAv2|AM10f,TBA-FIISB|45.2.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-login-message-enable"
  info        : "Enable the vCenter Server login banner for the vSphere Client. vCenter Server can show a login message, useful for deterring intruders and communicating usage obligations to authorized users. This configuration enables the display of this message on the vSphere Client login page.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A (No public API available)

Can be configured using \"/opt/vmware/bin/sso-config.sh -set_logon_banner -title <logon_banner_title> <logonBannerFile>\" from an appliance shell. Please deactivate the shell again when you are done."
  reference   : "800-171|3.1.9,800-171r3|03.01.09,800-53|AC-8a.,800-53|AC-8b.,800-53|AC-8c.1.,800-53r5|AC-8a.,800-53r5|AC-8b.,800-53r5|AC-8c.1.,CCI|CCI-000048,CCI|CCI-000050,CCI|CCI-001384,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-8a.,ITSG-33|AC-8b.,ITSG-33|AC-8c.a.,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,NIAv2|AM10f,TBA-FIISB|45.2.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-login-message-text"
  info        : "Configure the vCenter Server login banner text for the vSphere Client. vCenter Server allows a login message, which deters intruders and communicates obligations to authorized users. This configuration establishes the text displayed on the vSphere Client login page.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A (No public API available)

Can be configured using \"/opt/vmware/bin/sso-config.sh -set_logon_banner -title <logon_banner_title> <logonBannerFile>\" from an appliance shell. Please deactivate the shell again when you are done."
  reference   : "800-171|3.1.9,800-171r3|03.01.09,800-53|AC-8a.,800-53|AC-8b.,800-53|AC-8c.1.,800-53r5|AC-8a.,800-53r5|AC-8b.,800-53r5|AC-8c.1.,CCI|CCI-000048,CCI|CCI-000050,CCI|CCI-001384,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-8a.,ITSG-33|AC-8b.,ITSG-33|AC-8c.a.,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,NIAv2|AM10f,TBA-FIISB|45.2.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-sso-groups"
  info        : "The vCenter Server must separate authentication and authorization for administrators. Combining authentication and authorization, as done in services like Active Directory, risks infrastructure breaches if compromised. Hence, vCenter Server should segregate these for administrators. Consider local SSO groups for authorization to better manage risk where feasible.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A (No public API available)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-sso-lockout-policy-max-attempts"
  info        : "The vCenter Server must lock an account after a specified number of failed login attempts. Repeated failed logins for an account may signal security issues. To limit brute force attempts, lock the account after a certain threshold, balancing between avoiding automatic connection retries and potential denial-of-service attacks.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-SsoLockoutPolicy | Set-SsoLockoutPolicy -MaxFailedAttempts 5"
  reference   : "800-171|3.1.8,800-171r3|03.01.08a.,800-53|AC-7a.,800-53r5|AC-7a.,CCI|CCI-000044,CN-L3|8.1.4.1(b),CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-7a.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.6,PCI-DSSv4.0|8.3.4,TBA-FIISB|45.1.2,TBA-FIISB|45.2.1,TBA-FIISB|45.2.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-sso-lockout-policy-unlock-time"
  info        : "The vCenter Server must unlock accounts after a specified timeout period. Repeated failed logins may suggest security threats. Due to the importance of vCenter Server accounts should not automatically unlock when they have been locked due to multiple login failures. Ensure that you have your administrator@vsphere.local information and that it is valid.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-SsoLockoutPolicy | Set-SsoLockoutPolicy -AutoUnlockIntervalSec 0"
  reference   : "800-171|3.1.8,800-171r3|03.01.08b.,800-53|AC-7b.,800-53r5|AC-7b.,CCI|CCI-002238,CN-L3|7.1.2.7(f),CN-L3|7.1.3.1(c),CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-7b.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.7,PCI-DSSv4.0|8.3.4,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-sso-password-lifetime"
  info        : "The vCenter Server must be configured with an appropriate maximum password age. Modern best practices for passwords (NIST 800-63B Section 5.1.1.2, among other guidance) indicates that with adequate password entropy, security is not improved by arbitrarily requiring users to change their passwords at certain intervals. Many automated security tools and regulatory compliance frameworks do not reflect this guidance, and may override this recommendation.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-SsoPasswordPolicy | Set-SsoPasswordPolicy -PasswordLifetimeDays 9999"
  reference   : "800-171|3.5.2,800-171r3|03.05.07d.,800-53|IA-5(1)(d),800-53r5|IA-5(1)(h),CCI|CCI-000199,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(d),NESA|T5.2.3,NIAv2|AM20,NIAv2|AM21,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-sso-password-policy"
  info        : "The vCenter Server must enforce password complexity. Modern best practices for passwords (NIST 800-63B Section 5.1.1.2, among other guidance) suggests that composition rules (requiring mixtures of character classes, for example) should not be imposed on systems because they tend to not improve the security of passwords and discourage the use of more secure passphrases. Many regulatory compliance frameworks do not reflect this guidance, and may override this recommendation. Password strength and complexity rules apply to accounts created in vSphere SSO, including administrator@vsphere.local. They do not apply to Active Directory users when vCenter Server is joined to a domain, as those password policies are enforced by AD.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-SsoPasswordPolicy | Set-SsoPasswordPolicy -MinLength 15 -MaxLength 64 -MinNumericCount 1 -MinSpecialCharCount 1 -MinAlphabeticCount 2 -MinUppercaseCount 1 -MinLowercaseCount 1 -MaxIdenticalAdjacentCharacters 3"
  reference   : "800-171|3.5.7,800-171r3|03.05.07a.,800-53|IA-5(1)(a),800-53r5|IA-5(1)(h),CCI|CCI-000192,CCI|CCI-000193,CCI|CCI-000194,CCI|CCI-000205,CCI|CCI-001619,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.administration-sso-password-reuse"
  info        : "Configure the password history setting to restrict the reuse of passwords on the vCenter Server. Password complexity rules may lead users to reuse old passwords. Configuring the password history setting on the vCenter Server can help prevent this.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-SsoPasswordPolicy | Set-SsoPasswordPolicy -ProhibitedPreviousPasswordsCount 5"
  reference   : "800-171|3.5.7,800-171r3|03.05.07b.,800-53|IA-5(1)(b),800-53r5|IA-5(1)(b),CCI|CCI-004061,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(b),NESA|T5.2.3,NIAv2|AM22d,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.etc-issue"
  info        : "Configure the vCenter Server login banner text for access via SSH. vCenter Server allows a login message, which deters intruders and communicates obligations to authorized users. This configuration establishes the text displayed when a client connects via SSH. The default text leaks information about system configuration and should be changed.

          NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-AdvancedSetting -Entity $VC -Name etc.issue | Set-AdvancedSetting -Value \"****************************************************************************`n* Authorized users only. Actual or attempted unauthorized use of this      *`n* system is prohibited and may result in criminal, civil, security, or     *`n* administrative proceedings and/or penalties. Use of this information     *`n* system indicates consent to monitoring and recording, without notice     *`n* or permission. Users have no expectation of privacy. Any information     *`n* stored on or transiting this system, or obtained by monitoring and/or    *`n* recording, may be disclosed to law enforcement and/or used in accordance *`n* with Federal law, State statute, and organization policy. If you are not *`n* an authorized user of this system, exit the system at this time.       *`n****************************************************************************`n\""
  reference   : "800-171|3.1.9,800-171r3|03.01.09,800-53|AC-8a.,800-53|AC-8c.1.,800-53r5|AC-8a.,800-53r5|AC-8c.1.,CCI|CCI-000048,CCI|CCI-001384,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.5,ITSG-33|AC-8a.,ITSG-33|AC-8c.a.,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,TBA-FIISB|45.2.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.events-database-retention"
  info        : "The vCenter server must have task and event retention set to an apppropriate interval. vCenter Server retains task and event data, which ages out to save storage space. The age is configurable. This only impacts local storage of event data on the vCenter Server Appliance.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A (No public API available)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_VCENTER
  description : "vCenter: vcenter-8.events-remote-logging"
  info        : "Enable remote logging of vCenter Server events. Remote logging to a central host enhances vCenter Server's security by storing logs securely. It simplifies monitoring across hosts and supports aggregate analysis for detecting coordinated attacks. Centralized logging prevents tampering and serves as a reliable long-term audit record."
  solution    : "Get-AdvancedSetting -Entity <vcenter server name> -Name vpxd.event.syslog.enabled | Set-AdvancedSetting -Value true"
  reference   : "800-53|AU-4(1),800-53r5|AU-4(1),CCI|CCI-001851,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.6,ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:text>vpxd.event.syslog.enabled : </xsl:text><xsl:value-of select=\"audit:propSet/audit:val/audit:OptionValue[audit:key='vpxd.event.syslog.enabled']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:template>"
  regex       : "vpxd.event.syslog.enabled : "
  expect      : "vpxd.event.syslog.enabled : TRUE$"
</custom_item>

<report type:"WARNING">
  description : "vCenter: vcenter-8.fips-enable"
  info        : "The vCenter Server must enable FIPS-validated cryptography. FIPS cryptography makes a number of changes to the system to remove weaker ciphers. Enabling this will cause vCenter Server to reboot.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "$spec = Initialize-SystemSecurityGlobalFipsUpdateSpec -Enabled $true
Invoke-SetSystemGlobalFips -SystemSecurityGlobalFipsUpdateSpec $spec"
  reference   : "800-171|3.5.10,800-171|3.7.5,800-171|3.13.11,800-171|3.13.15,800-171|3.13.16,800-171r3|03.05.02,800-171r3|03.05.07c.,800-171r3|03.07.05,800-171r3|03.13.08,800-171r3|03.13.11,800-171r3|03.13.15,800-53|IA-3(1),800-53|IA-5(1)(c),800-53|IA-7,800-53|MA-4(6),800-53|SC-13,800-53|SC-23(3),800-53|SC-28,800-53r5|IA-3(1),800-53r5|IA-5(1)(c),800-53r5|IA-7,800-53r5|MA-4(6),800-53r5|SC-13b.,800-53r5|SC-23(3),800-53r5|SC-28,CCI|CCI-000197,CCI|CCI-000803,CCI|CCI-001188,CCI|CCI-001199,CCI|CCI-001967,CCI|CCI-002450,CCI|CCI-003123,CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSF|PR.AC-1,CSF|PR.DS-1,CSF|PR.DS-5,CSF|PR.MA-2,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO-27001-2022|A.5.33,ISO-27001-2022|A.8.24,ISO/IEC-27001|A.10.1.1,ITSG-33|IA-3(1),ITSG-33|IA-5(1)(c),ITSG-33|IA-7,ITSG-33|IA-7a.,ITSG-33|MA-4(6),ITSG-33|SC-13,ITSG-33|SC-13a.,ITSG-33|SC-23(3),ITSG-33|SC-28,ITSG-33|SC-28a.,NESA|M5.2.1,NESA|M5.2.6,NESA|M5.3.1,NESA|T2.3.4,NESA|T4.5.1,NESA|T5.2.3,NESA|T5.4.3,NESA|T5.4.4,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY6,NIAv2|CY7,NIAv2|NS5e,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|26.1,TBA-FIISB|27.1,TBA-FIISB|45.2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_VCENTER
  description : "vCenter: vcenter-8.logs-level-global"
  info        : "The vCenter Server must produce audit records containing information to establish what type of events occurred. It is important to ensure that sufficient information is present in audit logs for diagnostics and forensics purposes."
  solution    : "Get-AdvancedSetting -Entity <vcenter server name> -Name config.log.level | Set-AdvancedSetting -Value info"
  reference   : "800-171|3.3.1,800-171|3.3.2,800-171r3|03.03.02a.,800-53|AU-3,800-53r5|AU-3a.,CCI|CCI-000130,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.28,ISO-27001-2022|A.8.15,ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:text>config.log.level : </xsl:text><xsl:value-of select=\"audit:propSet/audit:val/audit:OptionValue[audit:key='config.log.level']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:template>"
  regex       : "config.log.level : "
  expect      : "config.log.level : info$"
</custom_item>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-mac-learning"
  info        : "All distributed switch port groups must deactivate MAC Learning unless used intentionally. MAC Learning enables a distributed switch to provide network connectivity to systems where more than one MAC address is used on a vNIC. This can be useful in special cases like nested virtualization (running ESXi inside ESXi, for example). MAC learning also supports unknown unicast flooding. Normally, when a packet that is received by a port has an unknown destination MAC address, the packet is dropped. With unknown unicast flooding enabled, the port floods unknown unicast traffic to every port on the switch that has MAC learning and unknown unicast flooding enabled. This property is enabled by default, but only if MAC learning is enabled. It is recommended to disable MAC Learning unless it is in use intentionally for a known workload that requires it.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "$VDPGview = Get-VDPortgroup -Name $VDPG | Get-View
$ConfigSpec = New-Object VMware.Vim.DVPortgroupConfigSpec
$ConfigSpec.DefaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting
$ConfigSpec.DefaultPortConfig.MacManagementPolicy = New-Object VMware.Vim.DVSMacManagementPolicy
$ConfigSpec.DefaultPortConfig.MacManagementPolicy.MacLearningPolicy = New-Object VMware.Vim.DVSMacLearningPolicy
$ConfigSpec.DefaultPortConfig.MacManagementPolicy.MacLearningPolicy.Enabled = $false
$ConfigSpec.ConfigVersion = $VDPGview.Config.ConfigVersion
$VDPGview.ReconfigureDVPortgroup_Task($ConfigSpec)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-reject-forged-transmit-dvportgroup"
  info        : "All distributed switches and their port groups must be configured to reject forged transmits. A virtual machine can impersonate network adapters by changing MAC addresses, posing security threats. By setting the Forged Transmits option to Reject on all distributed switches and port groups, ESXi verifies MAC addresses and prevents such impersonation.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-VDSwitch -Name $VDS | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false
Get-VDPortgroup -Name $VDPG | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-reject-mac-changes-dvportgroup"
  info        : "All distributed switches and their port groups must be configured to reject guest MAC address changes. Allowing virtual machines to change MAC addresses poses security risks, enabling potential network adapter impersonation. Rejecting MAC changes on all distributed switches and port groups prevents this, but may impact certain applications like Microsoft Clustering or MAC address-dependent licensing. Exceptions should be made as necessary.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-VDSwitch -Name $VDS | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false
Get-VDPortgroup -Name $VDPG | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-reject-promiscuous-mode-dvportgroup"
  info        : "All distributed switches and their port groups must be configured to reject guest promiscuous mode requests. Enabling promiscuous mode on a port group allows all connected virtual machines to read all network packets, posing a potential security risk. Although sometimes necessary for debugging or monitoring, the default setting - reject - is recommended. Exceptions can be made for specific port groups as required.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Get-VDSwitch -Name $VDS | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false
Get-VDPortgroup -Name $VDPG | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-reset-port"
  info        : "The vCenter Server must reset port configuration when virtual machines are disconnected. When a virtual machine is disconnected from the virtual switch port it is desirable to reset the port configuration, so that another virtual machine that attaches has a port in a known state.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "$VDPGview = Get-VDPortgroup -Name $VDPG | Get-View
$ConfigSpec = New-Object VMware.Vim.DVPortgroupConfigSpec
$ConfigSpec.DefaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting
$ConfigSpec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy
$ConfigSpec.Policy.PortConfigResetAtDisconnect = $true
$ConfigSpec.ConfigVersion = $VDPGview.Config.ConfigVersion
$VDPGview.ReconfigureDVPortgroup_Task($ConfigSpec)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-restrict-discovery-protocol"
  info        : "The vCenter Server must deactivate CDP/LLDP on distributed switches unless used intentionally. vSphere Distributed Virtual Switch can engage in CDP or LLDP, potentially sharing sensitive unencrypted information, like IP addresses and system names, on the network. As it can aid adversaries in understanding or impersonating your environment, However, it is also extremely helpful for legitimate use cases. It is recommended to keep it deactivated unless necessary for troubleshooting or configuration validation.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "$VDview = Get-VDSwitch -Name $VDS | Get-View
$ConfigSpec = New-Object VMware.Vim.VMwareDVSConfigSpec
$ConfigSpec.LinkDiscoveryProtocolConfig = New-Object VMware.Vim.LinkDiscoveryProtocolConfig
$ConfigSpec.LinkDiscoveryProtocolConfig.Protocol = 'cdp'
$ConfigSpec.LinkDiscoveryProtocolConfig.Operation = 'none'
$ConfigSpec.ConfigVersion = $VDview.Config.ConfigVersion
$VDview.ReconfigureDvs_Task($ConfigSpec)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-restrict-netflow-usage"
  info        : "The vCenter Server must only send NetFlow traffic to authorized collectors. The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network, making it easier for a man-in-the-middle attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target Internet Protocols (IPs) are correct.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remove collector IPs, do the following:

From the vSphere Client, go to \"Networking\".
Select a distributed switch >> Configure >> Settings >> NetFlow.

Click \"Edit\".

Remove any unknown collector IPs.

or

From a PowerCLI command prompt while connected to the vCenter server, run the following commands:

$dvs = Get-VDSwitch dvswitch | Get-View
ForEach($vs in $dvs){
$spec = New-Object VMware.Vim.VMwareDVSConfigSpec
$spec.configversion = $vs.Config.ConfigVersion
$spec.IpfixConfig = New-Object VMware.Vim.VMwareIpfixConfig
$spec.IpfixConfig.CollectorIpAddress = \"\"
$spec.IpfixConfig.CollectorPort = \"0\"
$spec.IpfixConfig.ActiveFlowTimeout = \"60\"
$spec.IpfixConfig.IdleFlowTimeout = \"15\"
$spec.IpfixConfig.SamplingRate = \"0\"
$spec.IpfixConfig.InternalFlowsOnly = $False
$vs.ReconfigureDvs_Task($spec)
}

Note: This will reset the NetFlow collector configuration back to the defaults.
To disable NetFlow on a distributed port group, do the following:

From the vSphere Client, go to \"Networking\".
Select a distributed port group >> Configure >> Settings >> Policies.

Click \"Edit\".

Click the \"Monitoring\" tab.
Change \"NetFlow\" to \"Disabled\".

or

From a PowerCLI command prompt while connected to the vCenter server, run the following commands:

$pgs = Get-VDPortgroup | Get-View
ForEach($pg in $pgs){
$spec = New-Object VMware.Vim.DVPortgroupConfigSpec
$spec.configversion = $pg.Config.ConfigVersion
$spec.defaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting
$spec.defaultPortConfig.ipfixEnabled = New-Object VMware.Vim.BoolPolicy
$spec.defaultPortConfig.ipfixEnabled.inherited = $false
$spec.defaultPortConfig.ipfixEnabled.value = $false
$pg.ReconfigureDVPortgroup_Task($spec)
}"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.network-restrict-port-level-overrides"
  info        : "The vCenter Server must not override port group settings at the port level on distributed switches, except for block ports. Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port Group level. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could exploit that broader access. If there are cases where particular VMs require unique configurations then a different port group with the required configuration should be created instead of overriding port group settings.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the vSphere Client, go to \"Networking\".
Select a distributed switch >> Select a distributed port group >> Configure >> Settings >> Properties.

Click \"Edit\".
Select advanced and update all port policies besides \"Block Ports\" to \"disabled\" and click \"OK\".

or

From a PowerCLI command prompt while connected to the vCenter server, run the following command:

$pgs = Get-VDPortgroup | Get-View
ForEach($pg in $pgs){
$spec = New-Object VMware.Vim.DVPortgroupConfigSpec
$spec.configversion = $pg.Config.ConfigVersion
$spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy
$spec.Policy.VlanOverrideAllowed = $False
$spec.Policy.UplinkTeamingOverrideAllowed = $False
$spec.Policy.SecurityPolicyOverrideAllowed = $False
$spec.Policy.IpfixOverrideAllowed = $False
$spec.Policy.BlockOverrideAllowed = $True
$spec.Policy.ShapingOverrideAllowed = $False
$spec.Policy.VendorConfigOverrideAllowed = $False
$spec.Policy.TrafficFilterOverrideAllowed = $False
$pg.ReconfigureDVPortgroup_Task($spec)
}"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.supported"
  info        : "vCenter Server is a version that has not reached End of General Support status. Ensure that vCenter Server is of a version that has not reached End of General Support status.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.tls-profile"
  info        : "The vCenter Server must maintain confidentiality and integrity of transmissions by enabling modern TLS ciphers. In vCenter Server 8.0.3 and newer, TLS profiles are available to configure client and server TLS settings to use only strong ciphers. To view the current settings, in the vSphere Client go to Developer Center, then to API Explorer. Select \"appliance\" from the \"Select API\" drop down list then scroll down to the \"tls/profiles/global\" section. Expand the GET call and click Execute. The vCenter Server will restart services after setting this parameter, disconnecting clients.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A (Use API Explorer method in Discussion)"
  reference   : "800-171|3.1.13,800-171|3.4.6,800-171|3.4.7,800-171|3.5.4,800-171|3.13.8,800-171|3.13.11,800-171|3.13.15,800-171r3|03.04.06b.,800-171r3|03.05.04,800-171r3|03.13.08,800-171r3|03.13.11,800-171r3|03.13.15,800-53|AC-17(2),800-53|CM-7b.,800-53|IA-2(8),800-53|SC-8,800-53|SC-8(1),800-53|SC-8(2),800-53|SC-13,800-53|SC-23,800-53r5|AC-17(2),800-53r5|CM-7b.,800-53r5|IA-2(8),800-53r5|SC-8,800-53r5|SC-8(1),800-53r5|SC-8(2),800-53r5|SC-13b.,800-53r5|SC-23,CCI|CCI-000068,CCI|CCI-000382,CCI|CCI-001184,CCI|CCI-001453,CCI|CCI-001941,CCI|CCI-002418,CCI|CCI-002420,CCI|CCI-002421,CCI|CCI-002422,CCI|CCI-002450,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(d),CN-L3|7.1.3.1(e),CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(a),CN-L3|8.1.4.1(c),CN-L3|8.1.4.2(a),CN-L3|8.1.4.4(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.PS-01,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),HIPAA|164.312(e)(2)(ii),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.33,ISO-27001-2022|A.6.7,ISO-27001-2022|A.8.20,ISO-27001-2022|A.8.24,ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|CM-7a.,ITSG-33|IA-2(8),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(1),ITSG-33|SC-8(2),ITSG-33|SC-9(2),ITSG-33|SC-13,ITSG-33|SC-13a.,ITSG-33|SC-23,ITSG-33|SC-23a.,NESA|M5.2.6,NESA|T2.3.8,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM18,NIAv2|AM37,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS5d,NIAv2|NS5e,NIAv2|NS6b,NIAv2|NS29,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS24,PCI-DSSv3.2.1|2.2.2,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.4,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.2,TBA-FIISB|29.1,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.vami-access-ssh"
  info        : "The vCenter Server SSH service must be deactivated. vCenter Server, delivered as an appliance, is intended for management via VAMI, vSphere Client, and APIs. While SSH is a support tool, it should be deactivated unless required, except for vCenter Server High Availability (not vSphere HA!) which necessitates its use.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "(Get-CisService -Name \"com.vmware.appliance.access.ssh\").set($false)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.vami-administration-password-expiration"
  info        : "The vCenter Server root account password expiration must be configured appropriately. Modern best practices for passwords (NIST 800-63B Section 5.1.1.2, among other guidance) indicates that with adequate password entropy, security is not improved by arbitrarily requiring users to change their passwords at certain intervals. Many automated security tools and regulatory compliance frameworks do not reflect this guidance, and may override this recommendation.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "(Get-CisService -Name \"com.vmware.appliance.local_accounts.policy\").set(@{max_days=9999; min_days=1; warn_days=7})"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.vami-backup"
  info        : "Configure File-Based Backup and Recovery to a secure location unless alternate backup methods are in use. File-Based Backup and Recovery, which allows vCenter Server and configuration recovery via the vCenter Server installer, plays a crucial role in safeguarding your environment. It should be appropriately configured. Because this backup method contains information about privileged access to the vSphere cluster it should always be stored securely.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.vami-firewall-restrict-access"
  info        : "The vCenter Server must configure the firewall to only allow traffic from authorized networks. Ensures that all incoming and outgoing network traffic is blocked unless explicitly allowed, reducing the attack surface and helping to prevent unauthorized access to the system. Note that outgoing/egress traffic is not blocked, nor are related/established connections, so vCenter Server will still be able to communicate with systems where it initiates the connection. Perimeter firewalls should be used to curtail those types of connections.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.vami-syslog"
  info        : "Configure a remote log server for the vCenter Server. Remote logging to a central host enhances vCenter Server's security by storing logs securely. It simplifies monitoring across hosts and supports aggregate analysis for detecting coordinated attacks. Centralized logging prevents tampering and serves as a reliable long-term audit record.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-53|AU-4(1),800-53r5|AU-4(1),CCI|CCI-001851,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.6,ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.vami-time"
  info        : "vCenter Server must have reliable time synchronization sources. Cryptography, audit logging, cluster operations, and incident response/forensics heavily rely on synchronized time. The recommended practice for NTP is to have at least four sources. It is not advisable to have only two sources, as having one source is preferable to having two.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "(Get-CisService -Name \"com.vmware.appliance.timesync\").set(\"NTP\")
(Get-CisService -Name \"com.vmware.appliance.ntp\").set(\"0.vmware.pool.ntp.org,1.vmware.pool.ntp.org,2.vmware.pool.ntp.org,3.vmware.pool.ntp.org\")"
  reference   : "800-171|3.3.7,800-171r3|03.03.07,800-53|AU-8(1)(a),800-53r5|SC-45(1)(a),CCI|CCI-001891,CCI|CCI-004923,CN-L3|8.1.4.3(b),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.17,ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.2.1|10.4,PCI-DSSv3.2.1|10.4.1,PCI-DSSv3.2.1|10.4.3,PCI-DSSv4.0|10.6,PCI-DSSv4.0|10.6.1,PCI-DSSv4.0|10.6.2,PCI-DSSv4.0|10.6.3,QCSC-v1|8.2.1,QCSC-v1|13.2,TBA-FIISB|37.4"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vCenter: vcenter-8.vami-updates"
  info        : "vCenter Server has all software updates installed. By keeping vCenter Server patches up to date, vulnerabilities can be mitigated. It is important to note that educated attackers can exploit known vulnerabilities when attempting to gain unauthorized access or elevate privileges. When applying updates, it is recommended to update vCenter Server first, if an update is available, and then proceed with updating ESXi. This sequence ensures that the management layer is updated before updating the ESXi hosts.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_VCENTER
  description : "vCenter: vcenter-8.vpxuser-rotation"
  info        : "The vCenter Server must configure the vpxuser password to be rotated on an appropriate interval. Ensures that the vCenter Server is properly rotating the password it automatically sets on the ESXi hosts."
  solution    : "Get-AdvancedSetting -Entity $VC -Name VirtualCenter.VimPasswordExpirationInDays | Set-AdvancedSetting -Value 30"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:text>VirtualCenter.VimPasswordExpirationInDays : </xsl:text><xsl:value-of select=\"audit:propSet/audit:val/audit:OptionValue[audit:key='VirtualCenter.VimPasswordExpirationInDays']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:template>"
  regex       : "VirtualCenter.VimPasswordExpirationInDays : "
  expect      : "VirtualCenter.VimPasswordExpirationInDays : 30$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.deactivate-console-copy"
  info        : "Virtual machines must have console copy operations deactivated. Deactivating console copy operations on virtual machines prevents data copying between the VM and the local client, regardless of whether the user is accessing through Web Console, VMRC, or another method."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name isolation.tools.copy.disable | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.copy.disable']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.copy.disable : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.copy.disable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.copy.disable : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "isolation.tools.copy.disable : "
  not_expect  : "isolation.tools.copy.disable : FALSE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.deactivate-console-paste"
  info        : "Virtual machines must have console paste operations deactivated. By disabling console paste operations on virtual machines, data transfer from the local client to the VM is blocked, whether the user is using Web Console, VMRC, or another console."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name isolation.tools.paste.disable | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.paste.disable']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.paste.disable : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.paste.disable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.paste.disable : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "isolation.tools.paste.disable : "
  not_expect  : "isolation.tools.paste.disable : FALSE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.deactivate-disk-shrinking-shrink"
  info        : "Virtual machines must have virtual disk shrinking operations deactivated. Disabling virtual disk shrinking on virtual machines helps avoid disk unavailability issues. The ability to perform this operation is typically limited for non-administrative users in the guest environment."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name isolation.tools.diskShrink.disable | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.diskShrink.disable']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.diskShrink.disable : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.diskShrink.disable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.diskShrink.disable : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "isolation.tools.diskShrink.disable : "
  not_expect  : "isolation.tools.diskShrink.disable : FALSE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.deactivate-disk-shrinking-wiper"
  info        : "Virtual machines must have virtual disk wiping operations deactivated. Disabling virtual disk wiping on virtual machines helps avoid disk unavailability issues. The ability to perform this operation is typically limited for non-administrative users in the guest environment."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name isolation.tools.diskWiper.disable | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.diskWiper.disable']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.diskWiper.disable : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.diskWiper.disable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.diskWiper.disable : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "isolation.tools.diskWiper.disable : "
  not_expect  : "isolation.tools.diskWiper.disable : FALSE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.deactivate-non-essential-3d-features"
  info        : "Virtual machines must have 3D graphics features deactivated when not required. Turning off 3D graphics features on virtual machines that don't need them reduces potential attack vectors, enhancing overall system security."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting mks.enable3d | Set-AdvancedSetting -Value $false"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='mks.enable3d']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - mks.enable3d : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='mks.enable3d']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - mks.enable3d : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "mks.enable3d : "
  expect      : "mks.enable3d : FALSE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.dvfilter"
  info        : "Virtual machines must limit access through the \"dvfilter\" network Application Programming Interface (API). The dvFilter interface is used by tools like NSX to filter and inspect network traffic. Other tools may use it, too. Ensure that those tools are authorized."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting \"ethernet*.filter*.name*\" | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:variable name=\"ipaddress\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>"
  xsl_stmt    : "<xsl:variable name=\"vmname\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/>"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig\">"
  xsl_stmt    : "<xsl:if test=\"starts-with(audit:key, 'ethernet') and contains(audit:key, '.filter') and ends-with(audit:key, '.name')\">"
  xsl_stmt    : "<xsl:value-of select=\"$vmname\"/> (<xsl:value-of select=\"$ipaddress\"/>) - <xsl:value-of select=\"audit:key\"/> : <xsl:value-of select=\"audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:if>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "ethernet[\\d]+\\.filter[\\d]+\\.name : "
  not_expect  : "ethernet[\\d]+\\.filter[\\d]+\\.name : (.+)$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.efi-boot-types"
  info        : "Virtual machines must prevent booting from unauthorized sources. Unauthorized access to a virtual machine may occur when its primary boot volume is unavailable, and the EFI firmware seeks alternative boot sources, such as network boot. This can be mitigated through network controls, as well as with the advanced parameters bios.bootDeviceClasses, bios.bootOrder, and bios.hddOrder. bios.bootDeviceClasses has the format \"allow:XXXX\" or \"deny:XXXX\" where XXXX is a comma-delimited list of boot classes. Boot classes are net (network PXE boot), usb (from attached USB devices), pcmcia (PCMCIA expansion cards, not used nowadays), cd (from attached virtual CD/DVD devices), hd (from attached virtual hard disks), fd (from attached virtual floppy devices), reserved (from unknown devices), efishell (into the EFI shell), all, or any (same as all). Use of allow or deny also implicitly states the opposite. For example, deny:all disallows all boot, deny:net disallows network boot but allows all others, allow:hd allows only hd boot denies all others, allow:hd,cd allows hd then cd device boot and denies all others. New virtual machines may require CD/DVD boot, and some dynamic environments, such as labs, may use network boot, and those environments should be set accordingly and have the rationale documented."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting bios.bootDeviceClasses | Set-AdvancedSetting -Value \"allow:hd\""
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='bios.bootDeviceClasses']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - bios.bootDeviceClasses : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='bios.bootDeviceClasses']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - bios.bootDeviceClasses : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "bios.bootDeviceClasses : "
  expect      : "bios.bootDeviceClasses : allow:hd$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.ft-encrypted"
  info        : "Virtual machines must require encryption for Fault Tolerance. Requiring encryption for Fault Tolerance in VMs ensures secure data transmission. While the default 'opportunistic' encryption likely results in encryption due to ubiquitous AES-NI support in vSphere-compatible hardware, enforcing 'required' encryption guarantees no unencrypted operations."
  solution    : "$VMview = Get-VM -Name $VM | Get-View
$ConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec
$ConfigSpec.FtEncryptionMode = New-object VMware.Vim.VirtualMachineConfigSpecEncryptedFtModes
$ConfigSpec.FtEncryptionMode = \"ftEncryptionRequired\"
$VMview.ReconfigVM_Task($ConfigSpec)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:variable name=\"ipaddress\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>"
  xsl_stmt    : "<xsl:variable name=\"vmname\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/>"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']\">"
  xsl_stmt    : "<xsl:value-of select=\"$vmname\"/> (<xsl:value-of select=\"$ipaddress\"/>) - ftEncryptionMode : <xsl:value-of select=\"audit:ftEncryptionMode\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "ftEncryptionMode : "
  expect      : "ftEncryptionMode : ftEncryptionRequired$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.isolation-device-connectable-deactivate"
  info        : "Virtual machines must prevent unauthorized removal, connection and modification of devices. Preventing unauthorized device modifications in virtual machines blocks non-admin users or processes from connecting, disconnecting, or adjusting device settings. This measure curbs unauthorized access and operation disruption, reducing denial of service risks, as well as some avenues for exfiltrating data."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name isolation.device.connectable.disable | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.device.connectable.disable']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.device.connectable.disable : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.device.connectable.disable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.device.connectable.disable : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "isolation.device.connectable.disable : "
  not_expect  : "isolation.device.connectable.disable : FALSE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.isolation-tools-dnd-deactivate"
  info        : "Virtual machines must have console drag and drop operations deactivated. Deactivating drag and drop operations in a virtual machine's console stops users from transferring data between the VM and the local client, regardless of the console type, enhancing data security."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name isolation.tools.dnd.disable | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.dnd.disable']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.dnd.disable : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='isolation.tools.dnd.disable']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - isolation.tools.dnd.disable : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "isolation.tools.dnd.disable : "
  not_expect  : "isolation.tools.dnd.disable : FALSE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.limit-console-connections"
  info        : "Virtual machines must limit console sharing. Limiting VM console sharing to one user prevents multiple observers, enhancing security. However, this might inadvertently create a potential pathway for service denial."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting RemoteDisplay.maxConnections | Set-AdvancedSetting -Value 1"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='RemoteDisplay.maxConnections']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - RemoteDisplay.maxConnections : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='RemoteDisplay.maxConnections']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - RemoteDisplay.maxConnections : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "RemoteDisplay.maxConnections : "
  expect      : "RemoteDisplay.maxConnections : 1$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.limit-setinfo-size"
  info        : "Virtual machines must limit informational messages from the virtual machine to the VMX file. Limiting VM informational messages to the VMX file prevents it from exceeding its default size of 1MB. This control prevents potential denial of service situations that could arise if the datastore becomes full."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name tools.setInfo.sizeLimit | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='tools.setInfo.sizeLimit']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - tools.setInfo.sizeLimit : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='tools.setInfo.sizeLimit']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - tools.setInfo.sizeLimit : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "tools.setInfo.sizeLimit : "
  expect      : "tools.setInfo.sizeLimit : (1048576|NOT configured)$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.log-enable"
  info        : "Virtual machines must enable diagnostic logging. Diagnostic logging for virtual machines helps with forensics and troubleshooting."
  solution    : "$VMview = Get-VM -Name $VM | Get-View
$ConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec
$ConfigSpec.Flags = New-Object VMware.Vim.VirtualMachineFlagInfo
$ConfigSpec.Flags.EnableLogging = $true
$VMview.ReconfigVM_Task($ConfigSpec)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:variable name=\"ipaddress\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>"
  xsl_stmt    : "<xsl:variable name=\"vmname\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/>"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:flags\">"
  xsl_stmt    : "<xsl:value-of select=\"$vmname\"/> (<xsl:value-of select=\"$ipaddress\"/>) - Logging Enabled : <xsl:value-of select=\"audit:enableLogging\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Logging Enabled : "
  expect      : "Logging Enabled : true$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.log-retention"
  info        : "Virtual machines must limit the number of retained diagnostic logs. By restricting the quantity of retained diagnostic logs, we can avoid filling up the datastore without compromising diagnostic functionality."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name log.keepOld | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='log.keepOld']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - log.keepOld : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='log.keepOld']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - log.keepOld : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "log.keepOld : "
  expect      : "log.keepOld : (10|NOT configured)$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.log-rotation-size"
  info        : "Virtual machines must limit the size of diagnostic logs. Limiting the size of diagnostic logs on VMs prevents excessive space consumption, particularly on long-running VMs. As per VMware guidelines, the recommended minimum limit is 2MB."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name log.rotateSize | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='log.rotateSize']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - log.rotateSize : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='log.rotateSize']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - log.rotateSize : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "log.rotateSize : "
  expect      : "log.rotateSize : (2048000|NOT configured)$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.pci-passthrough"
  info        : "Virtual machines must limit PCI device passthrough functionality. DirectPath I/O features enable VMs to directly access system hardware, impacting risk mitigation tools like vMotion, DRS, and High Availability. It also potentially gives attackers privileged hardware access. Ensure only necessary VMs have this privilege, compensating with guest OS security controls."
  solution    : "Get-VM -Name $VM | Get-PassthroughDevice | Remove-PassthroughDevice"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:variable name=\"ipaddress\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>"
  xsl_stmt    : "<xsl:variable name=\"vmname\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/>"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:hardware/audit:device\">"
  xsl_stmt    : "<xsl:if test=\"@xsi:type='VirtualPCIPassthrough'\">"
  xsl_stmt    : "<xsl:value-of select=\"$vmname\"/> (<xsl:value-of select=\"$ipaddress\"/>) - <xsl:value-of select=\"@xsi:type\"/> : <xsl:value-of select=\"audit:deviceInfo/audit:label\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:if>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "VirtualPCIPassthrough"
  not_expect  : "VirtualPCIPassthrough"
</custom_item>

<report type:"WARNING">
  description : "VM: vm-8.remove-unnecessary-devices"
  info        : "Virtual machines must remove unnecessary virtual hardware. Eliminate unnecessary virtual hardware from VMs to reduce potential attack surfaces. Rarely-used ports, temporary CD/DVD drives, and hardware introduced via migrations could be vulnerable. Removing these decreases risk of software introduction or data exfiltration from a protected environment.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.restrict-host-info"
  info        : "Virtual machines must not be able to obtain host information from the hypervisor. Preventing VMs from obtaining host information from the hypervisor mitigates risk of advanced attacks, as it denies adversaries crucial details about the physical host."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting tools.guestlib.enableHostInfo | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='tools.guestlib.enableHostInfo']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - tools.guestlib.enableHostInfo : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='tools.guestlib.enableHostInfo']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - tools.guestlib.enableHostInfo : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "tools.guestlib.enableHostInfo : "
  not_expect  : "tools.guestlib.enableHostInfo : TRUE$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.transparentpagesharing-inter-vm-enabled"
  info        : "Virtual machines must restrict sharing of memory pages between VMs. Transparent Page Sharing (TPS) reduces VM memory footprint but could enable unauthorized data access in some very limited conditions. To bolster security, VMs should be configured with the sched.mem.pshare.salt option, preventing memory sharing with other VMs."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name sched.mem.pshare.salt | Remove-AdvancedSetting"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='sched.mem.pshare.salt']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - sched.mem.pshare.salt : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='sched.mem.pshare.salt']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - sched.mem.pshare.salt : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "sched.mem.pshare.salt : "
  expect      : "sched.mem.pshare.salt : NOT configured$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.vmotion-encrypted"
  info        : "Virtual machines must require encryption for vMotion. Requiring encryption for vMotion in virtual machines guarantees secure data transfer. The default 'opportunistic' encryption likely results in encryption due to widespread AES-NI support in vSphere-compatible hardware. However, enforcing 'required' encryption prevents any unencrypted operations."
  solution    : "$VMview = Get-VM -Name $VM | Get-View
$ConfigSpec = New-Object VMware.Vim.VirtualMachineConfigSpec
$ConfigSpec.MigrateEncryption = New-Object VMware.Vim.VirtualMachineConfigSpecEncryptedVMotionModes
$ConfigSpec.MigrateEncryption = \"required\"
$VMview.ReconfigVM_Task($ConfigSpec)"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:variable name=\"ipaddress\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>"
  xsl_stmt    : "<xsl:variable name=\"vmname\" select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/>"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']\">"
  xsl_stmt    : "<xsl:value-of select=\"$vmname\"/> (<xsl:value-of select=\"$ipaddress\"/>) - migrateEncryption : <xsl:value-of select=\"audit:migrateEncryption\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "migrateEncryption : "
  expect      : "migrateEncryption : required$"
</custom_item>

<custom_item>
  type        : AUDIT_VM
  description : "VM: vm-8.vmrc-lock"
  info        : "Virtual machines must be configured to lock when the last console connection is closed. Locking virtual machines when the last console connection closes can prevent potential unauthorized access from attackers exploiting logged-in console sessions."
  solution    : "Get-VM -Name $VM | Get-AdvancedSetting -Name tools.guest.desktop.autolock | Set-AdvancedSetting -Value $true"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='tools.guest.desktop.autolock']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - tools.guest.desktop.autolock : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:extraConfig[audit:key='tools.guest.desktop.autolock']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineConfigInfo']/audit:name\"/> (<xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='VirtualMachineSummary']/audit:guest/audit:ipAddress\"/>) - tools.guest.desktop.autolock : NOT configured<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "tools.guest.desktop.autolock : "
  expect      : "tools.guest.desktop.autolock : TRUE$"
</custom_item>

<report type:"WARNING">
  description : "vSAN: vsan-8.data-at-rest"
  info        : "vSAN must protect data at rest. vSAN Data-at-Rest encryption helps maintain the confidentiality of sensitive data while it resides on storage devices and reduce the risk of unauthorized access or exposure in the event of physical theft or loss. This configuration parameter can be altered while the cluster is operational. Enabling data-at-rest protections will reformat disk groups (for vSAN OSA) and rewrite stored objects (for vSAN ESA), which may take considerable time, but it will be done in the background. Workloads do not need to be powered off. vSAN ESA 8.0.2 introduced the ability to enable data-at-rest protections on an existing vSAN ESA datastore; vSAN ESA 8.0.3 introduced the ability to disable it again. It is recommended that you run the latest version of vSAN if using ESA.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vSAN: vsan-8.data-in-transit"
  info        : "vSAN must protect storage-related network communications. vSAN Data-in-Transit encryption helps ensure that sensitive data remains confidential while traversing the network, reducing the risk of unauthorized access or interception. This configuration parameter can be altered while the cluster is operational.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vSAN: vsan-8.file-services-access-control-nfs"
  info        : "NFS file shares on vSAN File Services must be configured to restrict access. When configuring an NFS file share the \"Customize net access\" option should be selected with a restrictive set of permissions configured.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vSAN: vsan-8.file-services-authentication-smb"
  info        : "SMB file shares on vSAN File Services must accept only encrypted SMB authentication communications. When configuring an SMB file share the Protocol Encryption option must be enabled.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vSAN: vsan-8.force-provisioning"
  info        : "vSAN must not provision storage when storage policy requirements cannot be met. If the storage policy \"Force Provisioning\" option is set to Yes, the object is provisioned even if the Failures to tolerate, Number of disk stripes per object, and Flash read cache reservation policies specified in the storage policy cannot be satisfied by the datastore. While this might be helpful in bootstrapping scenarios and during an outage when standard provisioning is no longer possible, normal operations should not permit storage policy violations.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vSAN: vsan-8.iscsi-mutual-chap"
  info        : "vSAN iSCSI target must enable bidirectional/mutual CHAP authentication. Mutual CHAP provides an additional layer of protection by requiring both the initiator (client) and the target (server) to verify their identities to each other, thereby ensuring data transmitted between the two is not intercepted or altered by unauthorized entities.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vSAN: vsan-8.object-checksum"
  info        : "vSAN must calculate object checksums to protect data integrity. vSAN uses end-to-end checksum to ensure the integrity of data by confirming that each copy of a file is exactly the same as the source file. The system checks the validity of the data during read/write operations, and if an error is detected, vSAN repairs the data or reports the error. Integrity problems cannot be detected if the vSAN policy disables checksums. For vSAN Express Storage Architecture, object checksums are always computed, and cannot be deactivated.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

<report type:"WARNING">
  description : "vSAN: vsan-8.operations-reserve"
  info        : "vSAN must reserve space to complete internal maintenance operations. vSAN Operations Reserve capacity setting helps ensure that vSAN always has sufficient free space to maintain the availability and reliability of the vSAN datastore and prevent potential data loss or service disruptions due to insufficient capacity during operations like policy changes. This configuration parameter can be altered while the cluster is operational.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "N/A"
  reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://github.com/vmware/vcf-security-and-compliance-guidelines/raw/refs/heads/main/security-configuration-hardening-guide/vsphere/8.0/"
</report>

</check_type>
