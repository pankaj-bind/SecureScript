#TRUSTED 27be19d78f76cc7ed8cf92aef39a614ab1e1253866f97d69504f9c146bb3a0598ab9be55c3518953bfc9d9af57506c342e2de6632660c423ef443bff503fddf895acabe189961fd3af4237de3de15e0c62bcc150d768a65169a80ec451ebef3b4ee65cbe3a87af76517477ff060704e44c861e72fcdda8d72f06faa1428a91b39b9a8c21fd553458f4118b23ef543ed86d832271414d376ab7685a69ee0d538f970810e620fa8c08c7bd035287582c217d200b3e737f5bef9ae354a4c77432e43ce109a5e12a2a2cf4de20bec713ad20e3aff92d270a602c8ad89f601b2f598f38a96d6de0e496aaf8ee0fd57c734cc4f6d8332f1f76d698ba4f846ed1d4732348ff22f69ca9dfdc4b7cf3991845ee58f9f3b91f647ef94aa7bd97b852f16e94e5f3baabc0d45989c49900b73f9f3dfaff88ea3d9c7fd5e93642f785a378b909dd143e13fdcb6e4e225a42377aaa58179a9f2da9a854b3ac6f4a4d10429f3dbdd17086bb1cc4ef18ee88cbbdb9be83f771b04ab15080a1a2de0fe1e08925009e75209ee04572045033aee0d2fa1478225dc817097c1cf7f8a9ee6419d459a4222674caa9ab4ea8eb425bd1a64bf9c9abd7ca1e3102970e6cd4b62b4f6b1d5625b0bd3c451ed1e21d3f8823b93ab1103e206646dbf5287c3568ac00c448e7dbec04fc62d72b3afc9ce5274f7c560aae8e374a33fc20bd91ee95700512ae6ed96b
#TRUST-RSA-SHA256 3f4aea15a183caa2efe70900458484d4fb90928de84815083d93eee2d93613d0f6d304706013b99fca0c96da6439ba3f31fb852126434f4e04758e4b2a4519c71deb7fb57dda3d50c576c0ca7b18245a1da24f8b2d74ffc08fdee597e92034f3858efb53d2e06674bf987a66211cace119a1018a9e55e8356aee1ea3bb77022e6ba92bfc3afbcb6e3bf43284d432075fce84e4f6ad3eddb68f768da59249ce6a15a84432f9c91e91e59c52ec5c012344a5815bacc77c09583cce7ba0db117d777e5e7b8f0672b587804bb65ac5481565eb50e97927338984e794f7ccfa6bf1d7dbb53f1c24c9b0a047f0e8056e951d67ef22a7494f8b37ef75b88d9c2261dfe3840f51e0e0a333987c172d303910c87c6738140f3f520e7b038f76219231514e0e9cd044cbc0177d40e3f7e898186629bcce217b1b41ba605b85cc6ae95eea70bfa23a92ca4fcc3a8bd0d7be1ed13a81e7994e3af9c9be89877d26106ba727623d4a06b77615ebf855128a1a3be378e343ece0f9347d3ee08cd1c9ce4143ac39c49ab0aa5aa064893023672e9b6d28142a1a732fc79fdf251b5c4230a09d70cec898d1f6a77af466a617f6676d34522cb8fb081c2d8da561d73c71956dd97b02090b483148af06b90575d5fccaeec97eb2468e836bdf40c1eec274fa31142eb2304c6b865d2ebf9bda39981f85dae4fbd0a740af98258978879ee107c2870fef
#
# This script is Copyright (C) 2004-2025 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2025/06/11 $
#
# description : This .audit is designed against the CIS Microsoft Windows 10 Enterprise Benchmark 4.0.0
#
#<ui_metadata>
#<display_name>CIS Microsoft Windows 10 Enterprise v4.0.0 NG</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Microsoft Windows 10 Enterprise</name>
#  <profile>NG</profile>
#  <version>4.0.0</version>
#  <link>https://workbench.cisecurity.org/benchmarks/21994</link>
#</spec>
#<labels>windows,cis,microsoft_windows_10_enterprise,agent,windows_10</labels>
#<benchmark_refs>CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#<variables>
#  <variable>
#    <name>BUILD_VERSION</name>
#    <default>(1900[0-9]|190[1-9][0-9]|1[0-9][0-9][0-9]{2})</default>
#    <description>Windows Build Version</description>
#    <info>Windows build Version found under HKLM\Software\Microsoft\Windows Nt\Currentversion:CurrentBuild</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PLATFORM_VERSION</name>
#    <default>10</default>
#    <description>Windows Version</description>
#    <info>The version of Windows 10 to match against in the platform check.</info>
#    <value_type>STRING</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Windows" version:"2">
<group_policy:"CIS Microsoft Windows 10 Enterprise">

<if>
  <condition type:"AND">
    <custom_item>
      type        : REGISTRY_SETTING
      description : "Windows 10 build installed"
      value_type  : POLICY_TEXT
      value_data  : "@BUILD_VERSION@"
      reg_key     : "HKLM\Software\Microsoft\Windows Nt\Currentversion"
      reg_item    : "CurrentBuild"
      check_type  : CHECK_REGEX
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "Windows 10 is installed"
      value_type  : POLICY_TEXT
      value_data  : "^[Ww][Ii][Nn][Dd][Oo][Ww][Ss] @PLATFORM_VERSION@.+$"
      reg_key     : "HKLM\Software\Microsoft\Windows Nt\Currentversion"
      reg_item    : "ProductName"
      check_type  : CHECK_REGEX
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_Microsoft_Windows_10_Enterprise_v4.0.0_NG.audit from CIS Microsoft Windows 10 Enterprise Benchmark v4.0.0"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      show_output : YES
    </report>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.10.44.1 (NG) Ensure 'Allow auditing events in Microsoft Defender Application Guard' is set to 'Enabled'"
      info        : "This policy setting allows you to decide whether auditing events can be collected from Microsoft Defender Application Guard.

The recommended state for this setting is: Enabled

Note: Microsoft Defender Application Guard requires a 64-bit version of Windows and a CPU supporting hardware-assisted CPU virtualization (Intel VT-x or AMD-V). This feature is not officially supported on virtual hardware, although it can work on VMs (especially for testing) provided that the hardware-assisted CPU virtualization feature is exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

System requirements for Microsoft Defender Application Guard (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

Auditing of Microsoft Defender Application Guard events may be useful when investigating a security incident."
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled:

Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft Defender Application Guard\Allow auditing events in Microsoft Defender Application Guard

Note: This Group Policy path is provided by the Group Policy template AppHVSI.admx/adml that is included with the Microsoft Windows 10 Release 1709 Administrative Templates (or newer).

Note #2: In older Microsoft Windows Administrative Templates, this setting was initially named

Allow auditing events in Windows Defender Application Guard

, but it was renamed to

Allow auditing events in Microsoft Defender Application Guard

starting with the Windows 10 Release 2004 Administrative Templates.

Impact:

Microsoft Defender Application Guard will inherit its auditing policies from Microsoft Edge and start to audit system events specifically for Microsoft Defender Application Guard. Collected logs are available for review on Microsoft Edge, outside of Application Guard."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171r3|03.03.01,800-171r3|03.03.03,800-171r3|03.03.06a.,800-53|AU-2,800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(a),CSCv7|6.2,CSCv8|8.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.15,ITSG-33|AU-2,ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|NGA,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\AppHVSI"
      reg_item    : "AuditApplicationGuard"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.10.44.2 (NG) Ensure 'Allow camera and microphone access in Microsoft Defender Application Guard' is set to 'Disabled'"
      info        : "The policy allows you to determine whether applications inside Microsoft Defender Application Guard can access the device's camera and microphone.

The recommended state for this setting is: Disabled

Note: Microsoft Defender Application Guard requires a 64-bit version of Windows and a CPU supporting hardware-assisted CPU virtualization (Intel VT-x or AMD-V). This feature is not officially supported on virtual hardware, although it can work on VMs (especially for testing) provided that the hardware-assisted CPU virtualization feature is exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

System requirements for Microsoft Defender Application Guard (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

In effort to stop sensitive information from being obtained for malicious use, untrusted sites within the Microsoft Defender Application Guard container should not be accessing the computers microphone or camera."
      solution    : "To establish the recommended configuration via GP, set the following UI path to Disabled

Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft Defender Application Guard\Allow camera and microphone access in Microsoft Defender Application Guard

Note: This Group Policy path is provided by the Group Policy template AppHVSI.admx/adml that is included with the Microsoft Windows 10 Release 1809 & Server 2019 Administrative Templates (or newer).

Note #2: In older Microsoft Windows Administrative Templates, this setting was initially named

Allow camera and microphone access in Windows Defender Application Guard

, but it was renamed to

Allow camera and microphone access in Microsoft Defender Application Guard

starting with the Windows 10 Release 2004 Administrative Templates.

Impact:

This is the default value so impact should be minimal to enforce this setting."
      reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|9.2,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|NGA,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "0"
      reg_key     : "HKLM\Software\Policies\Microsoft\AppHVSI"
      reg_item    : "AllowCameraMicrophoneRedirection"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.10.44.3 (NG) Ensure 'Allow data persistence for Microsoft Defender Application Guard' is set to 'Disabled'"
      info        : 'This policy setting allows you to decide whether data should persist across different sessions in Microsoft Defender Application Guard.

The recommended state for this setting is: Disabled

Note: Microsoft Defender Application Guard requires a 64-bit version of Windows and a CPU supporting hardware-assisted CPU virtualization (Intel VT-x or AMD-V). This feature is not officially supported on virtual hardware, although it can work on VMs (especially for testing) provided that the hardware-assisted CPU virtualization feature is exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

System requirements for Microsoft Defender Application Guard (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

The primary purpose of Microsoft Defender Application Guard is to present a \'sandboxed container\' for visiting untrusted websites. If data persistence is allowed, then it reduces the effectiveness of the sandboxing, and malicious content will be able to remain active in the Microsoft Defender Application Guard container between sessions.'
      solution    : "To establish the recommended configuration via GP, set the following UI path to Disabled:

Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft Defender Application Guard\Allow data persistence for Microsoft Defender Application Guard

Note: This Group Policy path is provided by the Group Policy template AppHVSI.admx/adml that is included with the Microsoft Windows 10 Release 1709 Administrative Templates (or newer).

Note #2: In older Microsoft Windows Administrative Templates, this setting was initially named

Allow data persistence for Windows Defender Application Guard

, but it was renamed to

Allow data persistence for Microsoft Defender Application Guard

starting with the Windows 10 Release 2004 Administrative Templates.

Impact:

None - this is the default behavior."
      reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|8.3,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|NGA,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "0"
      reg_key     : "HKLM\Software\Policies\Microsoft\AppHVSI"
      reg_item    : "AllowPersistence"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.10.44.4 (NG) Ensure 'Allow files to download and save to the host operating system from Microsoft Defender Application Guard' is set to 'Disabled'"
      info        : 'This policy setting determines whether to save downloaded files to the host operating system from the Microsoft Defender Application Guard container.

The recommended state for this setting is: Disabled

Note: Microsoft Defender Application Guard requires a 64-bit version of Windows and a CPU supporting hardware-assisted CPU virtualization (Intel VT-x or AMD-V). This feature is not officially supported on virtual hardware, although it can work on VMs (especially for testing) provided that the hardware-assisted CPU virtualization feature is exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

System requirements for Microsoft Defender Application Guard (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

The primary purpose of Microsoft Defender Application Guard is to present a \'sandboxed container\'. Potentially malicious files should not be copied to the host OS from the sandboxed environment, which could put the host at risk.'
      solution    : "To establish the recommended configuration via GP, set the following UI path to Disabled :

Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft Defender Application Guard\Allow files to download and save to the host operating system from Microsoft Defender Application Guard

Note: This Group Policy path is provided by the Group Policy template AppHVSI.admx/adml that is included with the Microsoft Windows 10 Release 1803 Administrative Templates (or newer).

Note #2: In older Microsoft Windows Administrative Templates, this setting was initially named

Allow files to download and save to the host operating system from Windows Defender Application Guard

, but it was renamed to

Allow files to download and save to the host operating system from Microsoft Defender Application Guard

starting with the Windows 10 Release 2004 Administrative Templates.

Impact:

None - this is the default behavior."
      reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|8.3,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|NGA,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "0"
      reg_key     : "HKLM\Software\Policies\Microsoft\AppHVSI"
      reg_item    : "SaveFilesToHost"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.10.44.5 (NG) Ensure 'Configure Microsoft Defender Application Guard clipboard settings: Clipboard behavior setting' is set to 'Enabled: Enable clipboard operation from an isolated session to the host'"
      info        : 'This policy setting allows you to decide how the clipboard behaves while in Microsoft Defender Application Guard.

The recommended state for this setting is: Enabled: Enable clipboard operation from an isolated session to the host

Note: Microsoft Defender Application Guard requires a 64-bit version of Windows and a CPU supporting hardware-assisted CPU virtualization (Intel VT-x or AMD-V). This feature is not officially supported on virtual hardware, although it can work on VMs (especially for testing) provided that the hardware-assisted CPU virtualization feature is exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

System requirements for Microsoft Defender Application Guard (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

The primary purpose of Microsoft Defender Application Guard is to present a \'sandboxed container\' for visiting untrusted websites. If the host clipboard is made available to Microsoft Defender Application Guard, a compromised Microsoft Defender Application Guard session will have access to its content, potentially exposing sensitive information to a malicious website or application. However, the risk is reduced if the Microsoft Defender Application Guard clipboard is made accessible to the host, and indeed that functionality may often be necessary from an operational standpoint.'
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled: Enable clipboard operation from an isolated session to the host

Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft Defender Application Guard\Configure Microsoft Defender Application Guard clipboard settings: Clipboard behavior setting

Note: This Group Policy path is provided by the Group Policy template AppHVSI.admx/adml that is included with the Microsoft Windows 10 Release 1703 Administrative Templates (or newer).

Note #2: In older Microsoft Windows Administrative Templates, this setting was initially named

Configure Windows Defender Application Guard clipboard settings: Clipboard behavior setting

, but it was renamed to

Configure Microsoft Defender Application Guard clipboard settings: Clipboard behavior setting

starting with the Windows 10 Release 2004 Administrative Templates.

Impact:

Microsoft Defender Application Guard sessions will not be able to access the host device's clipboard, however the host device will be able to access the Microsoft Defender Application Guard session clipboard."
      reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|8.3,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|NGA,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\AppHVSI"
      reg_item    : "AppHVSIClipboardSettings"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.10.44.6 (NG) Ensure 'Turn on Microsoft Defender Application Guard in Managed Mode' is set to 'Enabled: 1'"
      info        : 'This policy setting enables application isolation through Microsoft Defender Application Guard (Application Guard).

There are 4 options available:

 - <xhtml:ol start=\'0\'> - Disable Microsoft Defender Application Guard

 -
 - Enable Microsoft Defender Application Guard for Microsoft Edge ONLY

 - <xhtml:ol start=\'2\'> - Enable Microsoft Defender Application Guard for Microsoft Office ONLY

 - <xhtml:ol start=\'3\'> - Enable Microsoft Defender Application Guard for Microsoft Edge AND Microsoft Office

The recommended state for this setting is: Enabled: 1 (Enable Microsoft Defender Application Guard for Microsoft Edge ONLY).

Note: Microsoft Defender Application Guard requires a 64-bit version of Windows and a CPU supporting hardware-assisted CPU virtualization (Intel VT-x or AMD-V). This feature is not officially supported on virtual hardware, although it can work on VMs (especially for testing) provided that the hardware-assisted CPU virtualization feature is exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

System requirements for Microsoft Defender Application Guard (Windows 10) | Microsoft Docs

Note #2: At time of publication, Microsoft Defender Application Guard in all currently released versions of Windows 10 does not yet support protection for Microsoft Office, only for Microsoft Edge. Therefore the additional available options of 2 and 3 in this setting are not yet valid.

Note #3: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

Microsoft Defender Application Guard uses Windows Hypervisor to create a virtualized environment for apps that are configured to use virtualization-based security isolation. While in isolation, improper user interactions and app vulnerabilities can\'t compromise the kernel or any other apps running outside of the virtualized environment.'
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled: 1 :

Computer Configuration\Policies\Administrative Templates\Windows Components\Microsoft Defender Application Guard\Turn on Microsoft Defender Application Guard in Managed Mode

Note: This Group Policy path is provided by the Group Policy template AppHVSI.admx/adml that is included with the Microsoft Windows 10 Release 1703 Administrative Templates (or newer).

Note #2: In older Microsoft Windows Administrative Templates, this setting was initially named

Turn on Windows Defender Application Guard in Enterprise Mode

, but it was renamed to

Turn on Windows Defender Application Guard in Managed Mode

starting with the Windows 10 Release 1903 Administrative Templates. It was again renamed to

Turn on Microsoft Defender Application Guard in Managed Mode

starting with the Windows 10 Release 2004 Administrative Templates.

Impact:

Microsoft Defender Application Guard will be turned on for Microsoft Edge.

Note: Microsoft Defender Application Guard requires the

Internet Connection Sharing (ICS) (SharedAccess)

service in order to operate, so an exception to disabling this service (see Section 5 in the CIS Microsoft Windows 10 benchmark only) will be required if choosing to enable Microsoft Defender Application Guard."
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv7|8.3,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\AppHVSI"
      reg_item    : "AllowAppHVSI_ProviderSet"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.9.26.2 (NG) Ensure 'Configures LSASS to run as a protected process' is set to 'Enabled: Enabled with UEFI Lock'"
      info        : "This policy setting controls whether the Local Security Authority Subservice Service (LSASS) runs in protected mode and also has the option to lock in protected mode with Unified Extensible Firmware Interface (UEFI). The Local Security Authority (LSA), which includes the LSASS process, validates users for local and remote sign-ins and enforces local security policies.

The recommended state for this setting is: Enabled: Enabled with UEFI Lock

Note: This additional protection to prevent reading memory and code injection by non-protected processes is supported by Windows 8.1 (and newer).

Provides added security for the credentials that LSA stores and manages. Enabling this setting with UEFI Lock prevents the setting from being changed remotely."
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled: Enabled with UEFI Lock :

Computer Configuration\Policies\Administrative Templates\System\Local Security Authority\Configures LSASS to run as a protected process

Note: This Group Policy path may not exist by default. It is provided by the Group Policy template LocalSecurityAuthority.admx/adml that is included with the Microsoft Windows 11 Release 22H2 Administrative Templates v1.0 (or newer).

Note #2: In the Microsoft Windows 11 Release 23H2 Administrative Templates, the registry location of

HKLM\SYSTEM\CurrentControlSet\Control\Lsa:RunAsPPL

was set for

Configures LSASS to run as a protected process

. This same registry location and value was also created if the setting

Ensure 'LSA Protection' is set to 'Enabled'

was also applied. This appears to have been a mistake in the ADMX/ADML Templates for that release.

Starting with the Microsoft Windows 11 Release 24H2 Administrative Templates, the setting

Configures LSASS to run as a protected process

has a new registry location of

HKLM\Software\Policies\Microsoft\Windows\System

. In addition, the setting

LSA Protection

will be displayed by GPME when this setting (

Configures LSASS to run as a protected process

) is configured.

If

Configures LSASS to run as a protected process

was configured using an older version of the ADML/ADML templates, the new registry location will not auto-apply to the system, and assessment scans using the latest benchmark might fail. To fix this issue, the ADMX/ADML templates must be updated to the latest version, the setting removed from the GPO, and then added back in.

If the Microsoft Windows 10 Benchmark is applied,

LSA Protection

is configured via a separate recommendation for older versions of the Windows 10 Operating System using the SecGuide.admx/adml templates. That configuration is checked for separately from this recommendation.

Impact:

Once this setting has been applied (Enabled), removing the group policy setting (set to Not Configured) will not reverse the impact. In order to reverse the impact, you must explicitly configure this setting to Disabled and follow

Microsoft's documentation on disabling the UEFI Lock

."
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\SOFTWARE\Policies\Microsoft\Windows\System"
      reg_item    : "RunAsPPL"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.9.5.1 (NG) Ensure 'Turn On Virtualization Based Security' is set to 'Enabled'"
      info        : "This policy setting specifies whether Virtualization Based Security is enabled. Virtualization Based Security uses the Windows Hypervisor to provide support for security services.

The recommended state for this setting is: Enabled

Note: Virtualization Based Security requires a 64-bit version of Windows with Secure Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS configuration, not a Legacy BIOS configuration. In addition, if running Windows on a virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V) must be exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

Windows Defender Credential Guard Requirements (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

Note #3: If implementing Virtualization Based Security (in Microsoft Defender Application Guard) with the Next Generation Windows Security (NGWS) profile, the Internet Connection Sharing (ICS) (SharedAccess) service must not be Disabled (from Section 5).

Note #4: If the Level 2 recommendation to configure

Log on as a service

(from Section 2.2) is implemented, the additional security principal WDAGUtilityAccount must also be granted that User Right Assignment in order for Virtualization Based Security (in Microsoft Defender Application Guard) with the Next Generation Windows Security (NGWS) profile to function.

Kerberos, NTLM, and Credential manager isolate secrets by using virtualization-based security. Previous versions of Windows stored secrets in the Local Security Authority (LSA). Prior to Windows 10, the LSA stored secrets used by the operating system in its process memory. With Windows Defender Credential Guard enabled, the LSA process in the operating system talks to a new component called the isolated LSA process that stores and protects those secrets. Data stored by the isolated LSA process is protected using virtualization-based security and is not accessible to the rest of the operating system."
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled :

Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security

Note: This Group Policy path is provided by the Group Policy template DeviceGuard.admx/adml that is included with the Microsoft Windows 10 RTM (Release 1507) Administrative Templates (or newer).

Impact:

Warning: All drivers on the system must be compatible with this feature or the system may crash. Ensure that this policy setting is only deployed to computers which are known to be compatible."
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv7|8.3,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\Windows\DeviceGuard"
      reg_item    : "EnableVirtualizationBasedSecurity"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.9.5.2 (NG) Ensure 'Turn On Virtualization Based Security: Select Platform Security Level' is set to 'Secure Boot' or higher"
      info        : "This policy setting specifies whether Virtualization Based Security (VBS) is enabled. VBS uses the Windows Hypervisor to provide support for security services.

The recommended state for this setting is: Secure Boot or Secure Boot and DMA Protection

Note: VBS requires a 64-bit version of Windows with Secure Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS configuration, not a Legacy BIOS configuration. In addition, if running Windows on a virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V) must be exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

Windows Defender Credential Guard Requirements (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

Secure Boot can help reduce the risk of bootloader attacks and in conjunction with DMA protections to help protect data from being scraped from memory."
      solution    : "To establish the recommended configuration via GP, set the following UI path to Secure Boot or Secure Boot and DMA Protection :

Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Select Platform Security Level

Note: This Group Policy path is provided by the Group Policy template DeviceGuard.admx/adml that is included with the Microsoft Windows 10 RTM (Release 1507) Administrative Templates (or newer).

Impact:

Choosing the Secure Boot option provides the system with as much protection as is supported by the computer's hardware. A system with input/output memory management units (IOMMUs) will have Secure Boot with DMA protection. A system without IOMMUs will simply have Secure Boot enabled without DMA protection.

Choosing the Secure Boot with DMA protection option requires the system to have IOMMUs in order to enable VBS. Without IOMMU hardware support, VBS will be disabled.

Warning: All drivers on the system must be compatible with this feature or the system may crash. Ensure that this policy setting is only deployed to computers which are known to be compatible."
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv7|8.3,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "3" || "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\Windows\DeviceGuard"
      reg_item    : "RequirePlatformSecurityFeatures"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.9.5.3 (NG) Ensure 'Turn On Virtualization Based Security: Virtualization Based Protection of Code Integrity' is set to 'Enabled with UEFI lock'"
      info        : "This setting enables virtualization based protection of Kernel Mode Code Integrity. When this is enabled, kernel mode memory protections are enforced and the Code Integrity validation path is protected by the Virtualization Based Security feature.

The recommended state for this setting is: Enabled with UEFI lock

Note: Virtualization Based Security requires a 64-bit version of Windows with Secure Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS configuration, not a Legacy BIOS configuration. In addition, if running Windows on a virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V) must be exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

Windows Defender Credential Guard Requirements (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

The Enabled with UEFI lock option ensures that Virtualization Based Protection of Code Integrity cannot be disabled remotely."
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled with UEFI lock :

Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Virtualization Based Protection of Code Integrity

Note: This Group Policy path is provided by the Group Policy template DeviceGuard.admx/adml that is included with the Microsoft Windows 10 RTM (Release 1507) Administrative Templates (or newer).

Impact:

Warning: All drivers on the system must be compatible with this feature or the system may crash. Ensure that this policy setting is only deployed to computers which are known to be compatible.

Warning #2: Once this setting is turned on and active, Virtualization Based Security cannot be disabled solely via GPO or any other remote method. After removing the setting from GPO, the features must also be manually disabled

locally at the machine

using the steps provided at this link:

Manage Windows Defender Credential Guard (Windows 10) | Microsoft Docs"
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv7|8.3,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\Windows\DeviceGuard"
      reg_item    : "HypervisorEnforcedCodeIntegrity"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.9.5.4 (NG) Ensure 'Turn On Virtualization Based Security: Require UEFI Memory Attributes Table' is set to 'True (checked)'"
      info        : "This option will only enable Virtualization Based Protection of Code Integrity on devices with UEFI firmware support for the Memory Attributes Table. Devices without the UEFI Memory Attributes Table may have firmware that is incompatible with Virtualization Based Protection of Code Integrity which in some cases can lead to crashes or data loss or incompatibility with certain plug-in cards. If not setting this option the targeted devices should be tested to ensure compatibility.

The recommended state for this setting is: True (checked)

Note: Virtualization Based Security requires a 64-bit version of Windows with Secure Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS configuration, not a Legacy BIOS configuration. In addition, if running Windows on a virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V) must be exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

Windows Defender Credential Guard Requirements (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

This setting will help protect this control from being enabled on a system that is not compatible which could lead to a crash or data loss."
      solution    : "To establish the recommended configuration via GP, set the following UI path to TRUE :

Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Require UEFI Memory Attributes Table

Note: This Group Policy path is provided by the Group Policy template DeviceGuard.admx/adml that is included with the Microsoft Windows 10 Release 1703 Administrative Templates (or newer).

Impact:

Warning: All drivers on the system must be compatible with this feature or the system may crash. Ensure that this policy setting is only deployed to computers which are known to be compatible."
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv7|8.3,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\Windows\DeviceGuard"
      reg_item    : "HVCIMATRequired"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.9.5.5 (NG) Ensure 'Turn On Virtualization Based Security: Credential Guard Configuration' is set to 'Enabled with UEFI lock'"
      info        : 'This setting lets users turn on Credential Guard with virtualization-based security to help protect credentials. The \'Enabled with UEFI lock\' option ensures that Credential Guard cannot be disabled remotely. In order to disable the feature, you must set the Group Policy to \'Disabled\' as well as remove the security functionality from each computer, with a physically present user, in order to clear configuration persisted in UEFI.

The recommended state for this setting is: Enabled with UEFI lock

Note: Virtualization Based Security requires a 64-bit version of Windows with Secure Boot enabled, which in turn requires that Windows was installed with a UEFI BIOS configuration, not a Legacy BIOS configuration. In addition, if running Windows on a virtual machine, the hardware-assisted CPU virtualization feature (Intel VT-x or AMD-V) must be exposed by the host to the guest VM.

More information on system requirements for this feature can be found at

Windows Defender Credential Guard Requirements (Windows 10) | Microsoft Docs

Note #2: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

The Enabled with UEFI lock option ensures that Credential Guard cannot be disabled remotely.'
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled with UEFI lock :

Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Credential Guard Configuration

Note: This Group Policy path is provided by the Group Policy template DeviceGuard.admx/adml that is included with the Microsoft Windows 10 Release 1511 Administrative Templates (or newer).

Impact:

Warning: All drivers on the system must be compatible with this feature or the system may crash. Ensure that this policy setting is only deployed to computers which are known to be compatible.

Warning #2: Once this setting is turned on and active, Credential Guard cannot be disabled solely via GPO or any other remote method. After removing the setting from GPO, the features must also be manually disabled

locally at the machine

using the steps provided at this link:

Manage Windows Defender Credential Guard (Windows 10) | Microsoft Docs"
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv7|8.3,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\Windows\DeviceGuard"
      reg_item    : "LsaCfgFlags"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "18.9.5.6 (NG) Ensure 'Turn On Virtualization Based Security: Secure Launch Configuration' is set to 'Enabled'"
      info        : "Secure Launch protects the Virtualization Based Security environment from exploited vulnerabilities in device firmware.

The recommended state for this setting is: Enabled

Note: Credential Guard and Device Guard are not currently supported when using Azure IaaS VMs.

Secure Launch changes the way Windows boots to use Intel Trusted Execution Technology (TXT) and Runtime BIOS Resilience features to prevent firmware exploits from being able to impact the security of the Windows Virtualization Based Security environment."
      solution    : "To establish the recommended configuration via GP, set the following UI path to Enabled :

Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Secure Launch Configuration

Note: This Group Policy path is provided by the Group Policy template DeviceGuard.admx/adml that is included with the Microsoft Windows 10 Release 1809 & Server 2019 Administrative Templates (or newer).

Impact:

Warning : All drivers on the system must be compatible with this feature or the system may crash. Ensure that this policy setting is only deployed to computers which are known to be compatible."
      reference   : "800-53|SI-16,800-53r5|SI-16,CSCv7|8.3,CSCv8|10.5,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16,LEVEL|NGA"
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      value_type  : POLICY_DWORD
      value_data  : "1"
      reg_key     : "HKLM\Software\Policies\Microsoft\Windows\DeviceGuard"
      reg_item    : "ConfigureSystemGuardLaunch"
      reg_option  : CAN_NOT_BE_NULL
    </custom_item>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_Microsoft_Windows_10_Enterprise_v4.0.0_NG.audit from CIS Microsoft Windows 10 Enterprise Benchmark v4.0.0"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/benchmarks/21994"
      show_output : YES
    </report>
  </else>
</if>

</group_policy>
</check_type>
