#TRUSTED 8a9e4dc86304fa5a7980c7d5131976cd068d27368c71a3420a4e03fff242a6f0e0c3a37568e2ca506179d0c93e1b10ef312571feb6811cdcd9c2a8dbfc278182d1113ce4dd4e8ebec16cfe28f563e085de9b6d4eaab6f080fb220863b2f34ea31446b19aa8551e537135648f32a81b20a3f7d32840673bdf04ff639646d68d98de403166599379860a1c230b3fa53119222ce46134fec2487f561df46ce189bc1dfb3cf7d3c302712be49dd278f8e3534ab63ed8d3369e88b6d71e1bed0d52b7e3a150296f6263932e4a5e71a7032913ed41eee1a74d464c37b1d3cf9abf3f63e03d2a3c947ac3acbda27a25fcf23f4e5fe352fbda539da69253345798a1271c73446e5199df547a8477b71c972ddb1fd047f199ae48c5b5894b0adaee238df1d31cfc89f0622672f958414e998568e72057c484ffad1479b365a2f829ce71054d551da98afd56a6eace67d1c52832b1d6ed6ff37009d3650f932951f8ebe95765774ae651f761a3d61a28f2d966e0a2dc3652281fcae7b5cfcb92c4caf17163b65853f5574376b8cf49b542e1a9d67915ce3f2ad2def6c2078fed57cf1f34f451b608a9490f7ae3f74e2b7038bb0f9fbd2436324f2cb34ad059da5f9e681eb73f2fabc1087af5a5b0862e9af0d617a5ae068cf86e4eef08642821ffbf9a763a6b70ff9fdd02f5505e7eeb54923489271c868ac5ef955873dd26f20f740a6646
#TRUST-RSA-SHA256 0f6cd9f04cb8e54067a38b6f889510417181b7a7b7b549e997f08beed97e9357ffce3fea649a0495f468f6e92fd78c0e145aae57b0f7abe9dc675179b0aeef577a4ab1161b442c9160adf781554ae1a9c24f373de7e7eb3ab621919c34b897ac968878297253f52556e9bb03d44662aa3427ccd6a1f2cc40e70e369068370983d7f0061912e6f24479f4968054708feaee9efd0d762f56057e6f8116959da6f211c0223b3fd160fda9b248837e6245c893afd9012990e6a73a4b06578fdbf72fecfc33457d6755c6024b4046438c80f1ec070e9835323bd51f55512db2492de398403dd64a4c8ef22fa8ea5f18f89fe4daa9a7cba979089e0b5b663b6ab7363fe95b4981358019b6e66159a77b2734913702b7b2a58c677d26be01154cbec644461f31c2988ca144f0c23804a071bed7adb9a064a077a0a81a7b03f820891eabf86251fa3217c72016376d4b1c54821b2808f1b2ebd69f1268b045f47e973931970338e5cebd07d6bb16eba01175e6a4ee760e247faf50238438af2bc1e9b4b3aa1cac283e86c3e3228c47ec10e643c31fbdbf1ea6ea04f062e9b4fce31328b810e8fd171c37cb758b1c18201f965bd455a0fa30591213df55c54b2eb5a6efdb9f604c6fb70a3304bd09fbf76a45fc35a72de40233cdcece560bd3c725a9c8353a596ac27ebcbed5d11e9bb7d663e36c900df12cd19ba865a6e679e360592d15
#
# This script is Copyright (C) 2004-2025 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2025/04/30 $
#
# Description : This document implements the security configuration as recommended by the
#               DISA F5 BIG-IP Advanced Firewall Manager v2r2 STIG.
#
#<ui_metadata>
#<display_name>DISA F5 BIG-IP Advanced Firewall Manager STIG v2r2</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>F5 BIG-IP Advanced Firewall Manager</name>
#  <version>2.2.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip</link>
#</spec>
#<labels>disa,f5,f5_big-ip</labels>
#<benchmark_refs>CAT,CCE,CCI,DISA_Benchmark,Group-ID,Rule-ID,STIG-ID,STIG-Legacy,Vuln-ID</benchmark_refs>
#</ui_metadata>

<check_type:"F5">

<if>
  <condition type:"AND">
    <custom_item>
      description    : "Verify the target returns expected F5 data"
      f5_command     : "/tm/sys/software/volume"
      json_transform : ".items[] | .product"
      expect         : "^BIG-IP$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "DISA_F5_BIG-IP_AFM_v2r2.audit from DISA F5 BIG-IP Advanced Firewall Manager v2r2 STIG"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
    </report>

    <custom_item>
      description    : "F5BI-AF-000005 - The BIG-IP AFM module must be configured to enforce approved authorizations for controlling the flow of information within the network based on attribute- and content-based inspection of the source, destination, headers, and/or content of the communications traffic."
      info           : "Information flow control regulates where information is allowed to travel within a network. The flow of all network traffic must be monitored and controlled so it does not introduce any unacceptable risk to the network infrastructure or data.

Information flow control policies and enforcement mechanisms are commonly employed by organizations to control the flow of information between designated sources and destinations (e.g., networks, individuals, devices) within information systems. Examples of information flow control restrictions include keeping export-controlled information from being transmitted in the clear to the Internet or blocking information marked as classified but being transported to an unapproved destination.

Application Layer Gateways (ALGs) enforce approved authorizations by employing security policy and/or rules that restrict information system services, provide packet filtering capability based on header or protocol information and/or message filtering capability based on data content (e.g., implementing key word searches or using document characteristics).

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution       : "If the BIG-IP AFM module is used to support user access control intermediary services for virtual servers, configure the BIG-IP AFM module to enforce approved authorizations for controlling the flow of information within the network based on attribute- and content-based inspection of the source, destination, headers, and/or content of the communications traffic."
      reference      : "800-171|3.1.3,800-171r3|03.01.03,800-53|AC-4,800-53r5|AC-4,CAT|II,CCI|CCI-001368,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-09,CSF2.0|ID.AM-03,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|F5_BIG-IP_Advanced_Firewall_Manager_11-x_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.22,ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-214498r395865_rule,STIG-ID|F5BI-AF-000005,STIG-Legacy|SV-74347,STIG-Legacy|V-59917,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-214498"
      see_also       : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
      f5_command     : "/tm/security/firewall/policy"
      json_transform : ".items[].name"
      expect         : "^Manual Review Required$"
      severity       : MEDIUM
    </custom_item>

    <custom_item>
      description    : "F5BI-AF-000007 - The BIG-IP AFM module must be configured to restrict or block harmful or suspicious communications traffic by controlling the flow of information between interconnected networks based on attribute- and content-based inspection of the source, destination, headers, and/or content of the communications traffic."
      info           : "Information flow control regulates where information is allowed to travel within a network and between interconnected networks. Blocking or restricting detected harmful or suspicious communications between interconnected networks enforces approved authorizations for controlling the flow of traffic.

This requirement applies to the flow of information between the Application Layer Gateway (ALG) when used as a gateway or boundary device which allows traffic flow between interconnected networks of differing security policies.

The ALG installed and configured in such a way that restricts or blocks information flows based on guidance in the Ports, Protocols, & Services (PPSM) regarding restrictions for boundary crossing for ports, protocols, and services. Information flow restrictions may be implemented based on attribute- and content-based inspection of the source, destination, headers, and/or content of the communications traffic.

The ALGs must be configured with policy filters (e.g., security policy, rules, and/or signatures) that restrict or block information system services; provide a packet filtering capability based on header information; and/or perform message filtering based on message content. The policy filters used depend upon the type of application gateway (e.g., web, email, or TLS).

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution       : "If the BIG-IP AFM module is used to support user access control intermediary services for virtual servers, configure the BIG-IP AFM module to restrict or block harmful or suspicious communications traffic by controlling the flow of information between interconnected networks based on attribute- and content-based inspection of the source, destination, headers, and/or content of the communications traffic."
      reference      : "800-171|3.1.3,800-171r3|03.01.03,800-53|AC-4,800-53r5|AC-4,CAT|I,CCI|CCI-001414,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-09,CSF2.0|ID.AM-03,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|F5_BIG-IP_Advanced_Firewall_Manager_11-x_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.22,ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-214499r395868_rule,STIG-ID|F5BI-AF-000007,STIG-Legacy|SV-74351,STIG-Legacy|V-59921,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-214499"
      see_also       : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
      f5_command     : "/tm/security/firewall/policy"
      json_transform : ".items[].name"
      expect         : "^Manual Review Required$"
      severity       : MEDIUM
    </custom_item>

    <custom_item>
      description    : "F5BI-AF-000039 - The BIG-IP AFM module must be configured to produce audit records containing information to establish what type of events occurred."
      info           : "Without establishing what type of event occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack.

Audit record content that may be necessary to satisfy this requirement includes, for example, event descriptions, success/fail indications, filenames involved, and access control or flow control rules invoked.

Associating event types with detected events in the gateway logs provides a means of investigating an attack, recognizing resource utilization or capacity thresholds, or identifying an improperly configured network element.

This requirement does not apply to audit logs generated on behalf of the device itself (management).

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution       : "Configure the BIG-IP AFM module to produce audit records containing information to establish what type of events occurred.

Navigate to the BIG-IP System manager >> Security >> Event Logs >> Logging Profiles.

Click on 'Create'.

Name the Profile.

Check the box next to 'Network Firewall'.

Configure settings to log required information.

Click 'Finished'."
      reference      : "800-171|3.3.1,800-171|3.3.2,800-171r3|03.03.02a.,800-53|AU-3,800-53r5|AU-3a.,CAT|II,CCI|CCI-000130,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,DISA_Benchmark|F5_BIG-IP_Advanced_Firewall_Manager_11-x_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.28,ISO-27001-2022|A.8.15,ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-214500r395919_rule,STIG-ID|F5BI-AF-000039,STIG-Legacy|SV-74353,STIG-Legacy|V-59923,SWIFT-CSCv1|6.4,Vuln-ID|V-214500"
      see_also       : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
      f5_command     : "/tm/security/log/profile"
      json_transform : ".items[].name"
      expect         : "^Manual Review Required$"
      severity       : MEDIUM
    </custom_item>

    <if>
      <condition auto:"WARNING" type:"AND">
        <custom_item>
          description    : "Virtual Servers"
          f5_command     : "/tm/ltm/virtual"
          json_transform : ".items[].name"
          regex          : ".*"
          expect         : "^Manual Review Required$"
          severity       : MEDIUM
        </custom_item>

        <custom_item>
          description    : "Security Policies"
          f5_command     : "/tm/ltm/virtual"
          json_transform : ".items[].fwEnforcedPolicy"
          regex          : ".*"
          expect         : "^Manual Review Required$"
          severity       : MEDIUM
        </custom_item>

        <custom_item>
          description    : "Active FW Rules"
          f5_command     : "/tm/security/firewall/policy"
          json_transform : ".items[].name"
          regex          : ".*"
          expect         : "^Manual Review Required$"
          severity       : MEDIUM
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "F5BI-AF-000223 - The BIG-IP AFM module must be configured to only allow incoming communications from authorized sources routed to authorized destinations."
          info        : "Unrestricted traffic may contain malicious traffic that poses a threat to an enclave or to other connected networks. Additionally, unrestricted traffic may transit a network, which uses bandwidth and other resources.

Access control policies and access control lists implemented on devices that control the flow of network traffic (e.g., application-level firewalls and Web content filters) ensure the flow of traffic is only allowed from authorized sources to authorized destinations. Networks with different levels of trust (e.g., the Internet or CDS) must be kept separate.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Configure the BIG-IP AFM module to only allow incoming communications from authorized sources routed to authorized destinations."
          reference   : "800-171|3.13.1,800-171r3|03.13.01,800-53|SC-7(11),800-53r5|SC-7(11),CAT|II,CCI|CCI-002403,CN-L3|8.1.10.6(j),CSF|PR.AC-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|F5_BIG-IP_Advanced_Firewall_Manager_11-x_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7(11),NESA|T4.5.4,NIAv2|GS7c,PCI-DSSv3.2.1|1.3.1,PCI-DSSv3.2.1|1.3.2,PCI-DSSv3.2.1|1.3.3,PCI-DSSv3.2.1|1.3.5,PCI-DSSv4.0|1.3.1,PCI-DSSv4.0|1.4.2,PCI-DSSv4.0|1.4.3,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,Rule-ID|SV-214501r831450_rule,STIG-ID|F5BI-AF-000223,STIG-Legacy|SV-74355,STIG-Legacy|V-59925,TBA-FIISB|31.3,Vuln-ID|V-214501"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
          show_output : YES
        </report>
      </then>
    </if>

    <report type:"WARNING">
      description : "F5BI-AF-000229 - The BIG-IP AFM module must be configured to handle invalid inputs in a predictable and documented manner that reflects organizational and system objectives."
      info        : "A common vulnerability of network elements is unpredictable behavior when invalid inputs are received. This requirement guards against adverse or unintended system behavior caused by invalid inputs where information system responses to the invalid input may be disruptive or cause the system to fail into an unsafe state.

The behavior will be derived from the organizational and system requirements and includes, but is not limited to, notification of the appropriate personnel, creating an audit record, and rejecting invalid input.

This requirement applies to gateways and firewalls that perform content inspection or have higher layer proxy functions.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Configure the BIG-IP AFM module to handle invalid inputs in a predictable and documented manner that reflects organizational and system objectives."
      reference   : "800-53|SI-10(3),800-53r5|SI-10(3),CAT|II,CCI|CCI-002754,CN-L3|8.1.4.4(d),CSF2.0|PR.DS-10,DISA_Benchmark|F5_BIG-IP_Advanced_Firewall_Manager_11-x_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-10,ITSG-33|SI-10a.,NESA|T7.3.1,NIAv2|SS6e,Rule-ID|SV-214502r831451_rule,STIG-ID|F5BI-AF-000229,STIG-Legacy|SV-74357,STIG-Legacy|V-59927,Vuln-ID|V-214502"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
    </report>

    <report type:"WARNING">
      description : "F5BI-AF-999999 - The version of F5 BIG-IP must be a supported version."
      info        : "Security flaws with software applications are discovered daily. Vendors are constantly updating and patching their products to address newly discovered security vulnerabilities. Organizations (including any contractor to the organization) are required to promptly install security-relevant software updates (e.g., patches, service packs, and hot fixes). Flaws discovered during security assessments, continuous monitoring, incident response activities, or information system error handling must also be addressed expeditiously.

    Organization-defined time periods for updating security-relevant software may vary based on a variety of factors including, for example, the security category of the information system or the criticality of the update (i.e., severity of the vulnerability related to the discovered flaw).

    This requirement will apply to software patch management solutions that are used to install patches across the enclave and to applications that are not part of that patch management solution. For example, many browsers today provide the capability to install their own patch software. Patch criticality, as well as system criticality, will vary. Therefore, the tactical situations regarding the patch management process will also vary. This means that the period used must be a configurable parameter. Time frames for application of security-relevant software updates may be dependent upon the Information Assurance Vulnerability Management (IAVM) process.

    The application will be configured to check for and install security-relevant software updates within an identified period from the availability of the update. The specific period will be defined by an authoritative source (e.g., IAVM, CTOs, DTMs, and STIGs).

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Upgrade to a supported version."
      reference   : "800-171|3.14.1,800-171r3|03.14.01b.,800-53|SI-2c.,800-53r5|SI-2c.,CAT|I,CCI|CCI-002605,CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|ID.RA-1,CSF|PR.IP-12,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|PR.PS-02,DISA_Benchmark|F5_BIG-IP_Advanced_Firewall_Manager_11-x_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.6.8,ISO-27001-2022|A.8.8,ISO-27001-2022|A.8.32,ITSG-33|SI-2,NESA|T7.6.2,NESA|T7.7.1,NIAv2|AM38,NIAv2|AM39,NIAv2|SS14b,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,QCSC-v1|11.2,Rule-ID|SV-270900r1056144_rule,STIG-ID|F5BI-AF-999999,SWIFT-CSCv1|2.2,Vuln-ID|V-270900"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
    </report>
  </then>

  <else>
    <report type:"WARNING">
      description : "DISA_F5_BIG-IP_AFM_v2r2.audit from DISA F5 BIG-IP Advanced Firewall Manager v2r2 STIG"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_F5_BIG-IP_Y25M01_STIG.zip"
    </report>
  </else>
</if>

</check_type>
