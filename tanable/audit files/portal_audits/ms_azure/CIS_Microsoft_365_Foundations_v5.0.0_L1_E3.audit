#TRUSTED 0185cb7920ece64a1b108f7f4ce337d1ec6c0a4f695fce3b93e46212408f397006d381c28914c23879b8064ced5ed07bb57839a3e65c27210899e5ff7b39b60c3c6e46a5b7adfb959c908602fc8f8005a34ee88fd84fe99f7489617886cf9eb4c5913bd8f683443f55adf62aae86400f6b78f021aa721775ab4e9a871050c1b70abed17481f0395a2874bdcb45b52654c580c38bb9d6570a8b79af7f8498c1e8da5c2fb2b19ee7b4268b1d4a91f18be94c66b246ce4a8f305dadce5053d6e81c0c7013556773b2c707b1c677a986b16a56680fdcbff80a6602d91cab80f29c42912768a835d06ccc211f059b34a92d1c97ac52922d5427b284751940d2f5dde34591a6dca2127619cf4d0d8499371eaea1c2c577905f70a5a328d001bb3861cf7587649d6e91fff20d29927a479e1dd7975556c328b04e038d46b9a923540c4587ff165444c51ef22611731c6ae2c7b768d469ec6cd2e98c116b8f2c30163e6b3640e2be2a7199f62c8b4fa359381310a1ec96311ea9b8989c364a8e28f2841713d7118d3b97ab721ef81730246183a3863ac3c523977f541f031ea92597bb5fa140f40318852ed4d2beffd6fe9767d0718b67a6edb782a4535cd0af4e4eccf686604798206f5dc51447e566280d93fea3ff7fd8a22df1ce5ad553cc134be83e9b4e81d09641eecdafe875ed93d7fddaa95f1d86e683115ba56263210c67636e
#TRUST-RSA-SHA256 5a23d9077b46dccb228217205287df8fbd0258a7b6e759c7826215bb180e50ccd2115443aec580864a17d8195ab8fe5dedca13de43ce9e86f98e0a4141d33649b76d77a1330555b47c53a9cc80dd8161cb465fca02fda1deaafc3a7a4ab8d72fb2f7e745bd57a082941b47a54f497e34c74748d4d70b40db67d6d41123a5a213cbc9bc0ab2caad3c64919d44e543a14a7467bd740efd8349c08a93154d314599ba0e267aa80c7dc4cc3e8ea82a186d09bebd8335a88b001d3a45f4284b2222dfe6d286a108ddfeda9350317340ff3fb0db84bf12359f44929f1bc836535d7ba49d8241c315384d2604eb2b6afe1be29e4303b623058bd2e43c9cef5226b8b75755e5d1e4ca429ba16289da1d0809c9632452a897911bc6be45036ae43cb9b098ebf493a7b73dbbc9286c18e0f85cd87e5a36c04afe96e5174c35ad4a60d7e6b592967fc83f99e745e2752f627e72b0e715b297d02cd94a689489e1ab9d50002257c185837e1ab3d214c71f1e97e30e8f2de63f4459c4ad3d1c650e4f986adc55be3b33d24aee2e2590889ebcbdd960e44e376bcb8a8f31f71f4937909e5daf616ab180ad4682357a86ce4e50e92ffdf9474c0d6ed6bf11b20ae49bcaabb1d85262b7aa8cc0811934a8f9f9555cf657d2eea359d66552b25fc0105a568bf29d0bc14f7410e4e6a85bdc881f453bfd41a67192f557accd2194208abaa260342154
#
# This script is Copyright (C) 2004-2025 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2025/07/08 $
#
# description : This .audit is designed against the CIS Microsoft 365 Foundations Benchmark 5.0.0
#
#<ui_metadata>
#<display_name>CIS Microsoft 365 Foundations v5.0.0 L1 E3</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Microsoft 365 Foundations</name>
#  <profile>L1 E3</profile>
#  <version>5.0.0</version>
#  <link>https://workbench.cisecurity.org/benchmarks/20006</link>
#</spec>
#<labels>microsoft_azure,cis,microsoft_365_foundations</labels>
#<benchmark_refs>CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#<variables>
#  <variable>
#    <name>MALWARE_POLICY_IDENTITY</name>
#    <default>Default</default>
#    <description>Malware Filter Policy Identity</description>
#    <info>The Identity (name) for the Malware Filter Policy in use.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>SENDER_ADMIN_ADDRESS</name>
#    <default>admin@domain1.com</default>
#    <description>Administrator email address</description>
#    <info>The Administrator email address used by the Malware Filter Policy.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>SUSPICIOUS_OUTBOUND_ADDRESS</name>
#    <default>admin@domain1.com</default>
#    <description>Suspicious Outbound email address</description>
#    <info>The Suspicious Outbound email address used by the Outbound Spam Filter Policy.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>NOTIFY_OUTBOUND_ADDRESS</name>
#    <default>admin@domain1.com</default>
#    <description>Notify Outbound email address</description>
#    <info>The Notify Outbound email address used by the Outbound Spam Filter Policy.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>OUTBOUND_SPAM_POLICY_IDENTITY</name>
#    <default>Default</default>
#    <description>Outbound Spam Filter Policy Identity</description>
#    <info>The Identity (name) for the Outbound Spam Filter Policy in use.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MAILTIPS_LARGE_THRESHOLD</name>
#    <default>25</default>
#    <description>Mail Tips Large Audience Threshold</description>
#    <info>Acceptable value for Mail Tips Large Audience Threshold (default 25).</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>JUNK_ADDRESS</name>
#    <default>audits@tenable027.onmicrosoft.com</default>
#    <description>Report Junk Addresses</description>
#    <info>The email address for reporting junk email.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>NOT_JUNK_ADDRESS</name>
#    <default>audits@tenable027.onmicrosoft.com</default>
#    <description>Report Not Junk Addresses</description>
#    <info>The email address for reporting not-junk email.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PHISH_ADDRESS</name>
#    <default>audits@tenable027.onmicrosoft.com</default>
#    <description>Report Phish Addresses</description>
#    <info>The email address for reporting phishing email.</info>
#    <value_type>STRING</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"microsoft_azure">

<custom_item>
  type        : POLICY
  description : "1.1.1 (L1) Ensure Administrative accounts are cloud-only"
  info        : "Administrative accounts are special privileged accounts that could have varying levels of access to data, users, and settings. Regular user accounts should never be utilized for administrative tasks and care should be taken, in the case of a hybrid environment, to keep administrative accounts separate from on-prem accounts. Administrative accounts should not have applications assigned so that they have no access to potentially vulnerable services (EX. email, Teams, SharePoint, etc.) and only access to perform tasks as needed for administrative purposes.

Ensure administrative accounts are not On-premises sync enabled

In a hybrid environment, having separate accounts will help ensure that in the event of a breach in the cloud, that the breach does not affect the on-prem environment and vice versa."
  solution    : "Remediation will require first identifying the privileged accounts that are synced from on-premises and then creating a new cloud-only account for that user. Once a replacement account is established, the hybrid account should have its role reduced to that of a non-privileged user or removed depending on the need.

Impact:

Administrative users will need to utilize login/logout functionality to switch accounts when performing administrative tasks, which means they will not benefit from SSO. This will require a migration process from the 'daily driver' account to a dedicated admin account.

Once the new admin account is created, permission sets should be migrated from the 'daily driver' account to the new admin account. This includes both M365 and Azure RBAC roles. Failure to migrate Azure RBAC roles could prevent an admin from seeing their subscriptions/resources while using their admin account."
  reference   : "800-171|3.1.5,800-171|3.1.6,800-171r3|03.01.06a.,800-171r3|03.01.06b.,800-53|AC-6(2),800-53|AC-6(5),800-53r5|AC-6(2),800-53r5|AC-6(5),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.1,CSCv8|5.4,CSF|PR.AC-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.15,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.18,ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),LEVEL|1A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
  name        : "M365_Cloud_Only"
</custom_item>

<report type:"WARNING">
  description : "1.1.2 (L1) Ensure two emergency access accounts have been defined"
  info        : "Emergency access or \"break glass\" accounts are limited for emergency scenarios where normal administrative accounts are unavailable. They are not assigned to a specific user and will have a combination of physical and technical controls to prevent them from being accessed outside a true emergency. These emergencies could be due to several things, including:

 - Technical failures of a cellular provider or Microsoft related service such as MFA.
 - The last remaining Global Administrator account is inaccessible.

Ensure two Emergency Access accounts have been defined.

Note: Microsoft provides several recommendations for these accounts and how to configure them. For more information on this, please refer to the references section. The CIS Benchmark outlines the more critical things to consider.

In various situations, an organization may require the use of a break glass account to gain emergency access. In the event of losing access to administrative functions, an organization may experience a significant loss in its ability to provide support, lose insight into its security posture, and potentially suffer financial losses.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Step 1 - Create two emergency access accounts:

 - Navigate to Microsoft 365 admin center

https://admin.microsoft.com

 - Expand Users > Active Users
 - Click Add user and create a new user with this criteria:
 - Name the account in a way that does NOT identify it with a particular person.
 - Assign the account to the defaultonmicrosoft.com domain and not the organization's.
 - The password must be at least 16 characters and generated randomly.
 - Do not assign a license.
 - Assign the user the Global Administrator role.

 - Repeat the above steps for the second account.

Step 2 - Exclude at least one account from conditional access policies:

 - Navigate Microsoft Entra admin center

https://entra.microsoft.com/

 - Expand Protection > Conditional Access
 - Inspect the conditional access policies.
 - For each rule add an exclusion for at least one of the emergency access accounts.
 - Users > Exclude > Users and groups and select one emergency access account.

Step 3 - Ensure the necessary procedures and policies are in place:

 - In order for accounts to be effectively used in a break glass situation the proper policies and procedures must be authorized and distributed by senior management.
 - FIDO2 Security Keys should be locked in a secure separate fireproof location.
 - Passwords should be at least 16 characters, randomly generated and MAY be separated in multiple pieces to be joined on emergency.

Warning: As of 10/15/2024 MFA is required for all users including Break Glass Accounts. It is recommended to update these accounts to use passkey (FIDO2) or configure certificate-based authentication for MFA. Both methods satisfy the MFA requirement.

Additional suggestions for emergency account management:

 - Create access reviews for these users.
 - Exclude users from conditional access rules.
 - Add the account to a

restricted management administrative unit

.

Warning : If CA (conditional access) exclusion is managed by a group, this group should be added to PIM for groups (licensing required) or be created as a role-assignable group. If it is a regular security group, then users with the Group Administrators role are able to bypass CA entirely.

Impact:

Failure to properly implement emergency access accounts can weaken the security posture. Microsoft recommends excluding at least one of the two emergency access accounts from all conditional access rules, necessitating passwords with sufficient entropy and length to protect against random guesses. For a secure passwordless solution, FIDO2 security keys may be used instead of passwords."
  reference   : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSCv8|5.1,CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1M,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "1.1.3 (L1) Ensure that between two and four global admins are designated"
  info           : "Between two and four global administrators should be designated in the tenant. Ideally, these accounts will not have licenses assigned to them which supports additional controls found in this benchmark.

If there is only one global administrator, they could perform malicious activities without being detected by another admin. Designating multiple global administrators eliminates this risk and ensures redundancy if the sole remaining global administrator leaves the organization.

However, to minimize the attack surface, there should be no more than four global admins set for any tenant. A large number of global admins increases the likelihood of a successful account breach by an external attacker.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution       : "To remediate using the UI:

 - Navigate to the Microsoft 365 admin center

https://admin.microsoft.com

 - Select Users > Active Users
 - In the Search field enter the name of the user to be made a Global Administrator.
 - To create a new Global Admin:
 - Select the user's name.
 - A window will appear to the right.
 - Select Manage roles
 - Select Admin center access
 - Check Global Administrator
 - Click Save changes

 - To remove Global Admins:
 - Select User.
 - Under Roles select Manage roles
 - De-Select the appropriate role.
 - Click Save changes

Impact:

The potential impact associated with ensuring compliance with this requirement is dependent upon the current number of global administrators configured in the tenant. If there is only one global administrator in a tenant, an additional global administrator will need to be identified and configured. If there are more than four global administrators, a review of role requirements for current global administrators will be required to identify which of the users require global administrator access."
  reference      : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSCv7|4.1,CSCv8|5.1,CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1A,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "listDirectoryRoleMembers"
  json_transform : '.[] | select(.displayName == "Global Administrator") | .value[] | "Display Name: \(.displayName), User Principal Name: \(.userPrincipalName)"'
  regex          : ".+"
  expect         : "^Manual Review Required$"
  severity       : MEDIUM
</custom_item>

<custom_item>
  type        : POLICY
  description : "1.1.4 (L1) Ensure administrative accounts use licenses with a reduced application footprint"
  info        : "Administrative accounts are special privileged accounts that could have varying levels of access to data, users, and settings. A license can enable an account to gain access to a variety of different applications, depending on the license assigned.

The recommended state is to not license a privileged account or use licenses without associated applications such as Microsoft Entra ID P1 or Microsoft Entra ID P2

Ensuring administrative accounts do not use licenses with applications assigned to them will reduce the attack surface of high privileged identities in the organization's environment. Granting access to a mailbox or other collaborative tools increases the likelihood that privileged users might interact with these applications, raising the risk of exposure to social engineering attacks or malicious content. These activities should be restricted to an unprivileged 'daily driver' account.

Note: In order to participate in Microsoft 365 security services such as Identity Protection, PIM and Conditional Access an administrative account will need a license attached to it. Ensure that the license used does not include any applications with potentially vulnerable services by using either Microsoft Entra ID P1 or Microsoft Entra ID P2 for the cloud-only account with administrator roles.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft 365 admin center

https://admin.microsoft.com

.
 - Click to expand Users select Active users
 - Click Add a user
 - Fill out the appropriate fields for Name, user, etc.
 - When prompted to assign licenses select as needed Microsoft Entra ID P1 or Microsoft Entra ID P2 then click Next
 - Under the Option settings screen you may choose from several types of privileged roles. Choose Admin center access followed by the appropriate role then click Next
 - Select Finish adding

Note: Utilizing PIM to best practices will satisfy this control. CIS and Microsoft recommend an organization keep zero permanently active assignments for roles other than emergency access accounts.

Impact:

Administrative users will have to switch accounts and utilize login/logout functionality when performing administrative tasks, as well as not benefiting from SSO.

Note: Alerts will be sent to TenantAdmins including Global Administrators, by default. To ensure proper receipt, configure alerts to be sent to security or operations staff with valid email addresses or a security operations center. Otherwise, after adoption of this recommendation, alerts sent to TenantAdmins may go unreceived due to the lack of an application-based license assigned to the Global Administrator accounts."
  reference   : "800-171|3.1.5,800-171|3.1.6,800-171r3|03.01.06a.,800-171r3|03.01.06b.,800-53|AC-6(2),800-53|AC-6(5),800-53r5|AC-6(2),800-53r5|AC-6(5),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.1,CSCv8|5.4,CSF|PR.AC-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.15,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.18,ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),LEVEL|1A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
  name        : "M365_Admin_SKU"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : POLICY
  description : "1.2.2 (L1) Ensure sign-in to shared mailboxes is blocked"
  info        : "Shared mailboxes are used when multiple people need access to the same mailbox, such as a company information or support email address, reception desk, or other function that might be shared by multiple people.

Users with permissions to the group mailbox can send as or send on behalf of the mailbox email address if the administrator has given that user permissions to do that. This is particularly useful for help and support mailboxes because users can send emails from \"Contoso Support\" or \"Building A Reception Desk.\"

Shared mailboxes are created with a corresponding user account using a system generated password that is unknown at the time of creation.

The recommended state is Sign in blocked for Shared mailboxes

The intent of the shared mailbox is the only allow delegated access from other mailboxes. An admin could reset the password, or an attacker could potentially gain access to the shared mailbox allowing the direct sign-in to the shared mailbox and subsequently the sending of email from a sender that does not have a unique identity. To prevent this, block sign-in for the account that is associated with the shared mailbox."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft 365 admin center

https://admin.microsoft.com/

 - Click to expand Teams & groups and select Shared mailboxes
 - Take note of all shared mailboxes.
 - Click to expand Users and select Active users
 - Select a shared mailbox account to open it's properties pane and then select Block sign-in
 - Check the box for Block this user from signing in
 - Repeat for any additional shared mailboxes.

To remediate using PowerShell:

 - Connect to Microsoft Graph using Connect-MgGraph -Scopes \"User.ReadWrite.All\"
 - Connect to Exchange Online using Connect-ExchangeOnline
 - To disable sign-in for a single account:

$MBX = Get-EXOMailbox -Identity TestUser@example.com
Update-MgUser -UserId $MBX.ExternalDirectoryObjectId -AccountEnabled:$false <xhtml:ol start=\"3\"> - The following will block sign-in to all Shared Mailboxes.

$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox
$MBX | ForEach-Object { Update-MgUser -UserId $_.ExternalDirectoryObjectId -AccountEnabled:$false }"
  reference   : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06b.,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|1A,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
  name        : "M365_Active_Shared_Mailbox"
</custom_item>

<custom_item>
  description    : "1.3.1 (L1) Ensure the 'Password expiration policy' is set to 'Set passwords to never expire (recommended)'"
  info           : "Microsoft cloud-only accounts have a pre-defined password policy that cannot be changed. The only items that can change are the number of days until a password expires and whether or whether passwords expire at all.

Organizations such as NIST and Microsoft have updated their password policy recommendations to not arbitrarily require users to change their passwords after a specific amount of time, unless there is evidence that the password is compromised, or the user forgot it. They suggest this even for single factor (Password Only) use cases, with a reasoning that forcing arbitrary password changes on users actually make the passwords less secure. Other recommendations within this Benchmark suggest the use of MFA authentication for at least critical accounts (at minimum), which makes password expiration even less useful as well as password protection for Entra ID."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 admin center

https://admin.microsoft.com

.
 - Click to expand Settings select Org Settings
 - Click on Security & privacy
 - Check the Set passwords to never expire (recommended) box.
 - Click Save

To remediate using PowerShell:

 - Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \"Domain.ReadWrite.All\"
 - Run the following Microsoft Graph PowerShell command:

Update-MgDomain -DomainId <Domain> -PasswordValidityPeriodInDays 2147483647

Impact:

When setting passwords not to expire it is important to have other controls in place to supplement this setting. See below for related recommendations and user guidance.

 - Ban common passwords.
 - Educate users to not reuse organization passwords anywhere else.
 - Enforce Multi-Factor Authentication registration for all users."
  reference      : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "listDomains"
  json_transform : '.[] | "ID: \(.id), Password Validity Period In Days: \(.passwordValidityPeriodInDays)"'
  regex          : "Password Validity Period In Days:"
  expect         : "Password Validity Period In Days: 2147483647"
  match_all      : YES
</custom_item>

<custom_item>
  description    : "1.3.4 (L1) Ensure 'User owned apps and services' is restricted"
  info           : "By default, users can install add-ins in their Microsoft Word, Excel, and PowerPoint applications, allowing data access within the application.

Do not allow users to install add-ins in Word, Excel, or PowerPoint.

Attackers commonly use vulnerable and custom-built add-ins to access data in user applications.

While allowing users to install add-ins by themselves does allow them to easily acquire useful add-ins that integrate with Microsoft applications, it can represent a risk if not used and monitored carefully.

Disable future user's ability to install add-ins in Microsoft Word, Excel, or PowerPoint helps reduce your threat-surface and mitigate this risk."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 admin center

https://admin.microsoft.com

.
 - Click to expand Settings > Org settings
 - In Services select User owned apps and services
 - Uncheck Let users access the Office Store and Let users start trials on behalf of your organization
 - Click Save

To remediate using PowerShell

 - Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \"OrgSettings-AppsAndServices.ReadWrite.All\"
 - Run the following Microsoft Graph PowerShell commands:

$uri = \"https://graph.microsoft.com/beta/admin/appsAndServices\"
$body = @{
    \"Settings\" = @{
        \"isAppAndServicesTrialEnabled\" = $false
        \"isOfficeStoreEnabled\" = $false
    }
} | ConvertTo-Json
Invoke-MgGraphRequest -Method PATCH -Uri $uri -Body $body

Impact:

Implementation of this change will impact both end users and administrators. End users will not be able to install add-ins that they may want to install."
  reference      : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|5.1,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getBetaAppsAndServicesSettings"
  json_transform : '"isOfficeStoreEnabled: \(.isOfficeStoreEnabled), isAppAndServicesTrialEnabled: \(.isAppAndServicesTrialEnabled)"'
  regex          : ".+"
  expect         : "isOfficeStoreEnabled: false, isAppAndServicesTrialEnabled: false"
</custom_item>

<custom_item>
  description    : "1.3.5 (L1) Ensure internal phishing protection for Forms is enabled"
  info           : "Microsoft Forms can be used for phishing attacks by asking personal or sensitive information and collecting the results. Microsoft 365 has built-in protection that will proactively scan for phishing attempt in forms such personal information request.

Enabling internal phishing protection for Microsoft Forms will prevent attackers using forms for phishing attacks by asking personal or other sensitive information and URLs."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 admin center

https://admin.microsoft.com

.
 - Click to expand Settings then select Org settings
 - Under Services select Microsoft Forms
 - Click the checkbox labeled Add internal phishing protection under Phishing protection
 - Click Save.

To remediate using PowerShell

 - Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \"OrgSettings-AppsAndServices.ReadWrite.All\"
 - Run the following Microsoft Graph PowerShell commands:

$uri = 'https://graph.microsoft.com/beta/admin/forms/settings'
$body = @{ \"isInOrgFormsPhishingScanEnabled\" = $true } | ConvertTo-Json
Invoke-MgGraphRequest -Method PATCH -Uri $uri -Body $body

Impact:

If potential phishing was detected, the form will be temporarily blocked and cannot be distributed, and response collection will not happen until it is unblocked by the administrator or keywords were removed by the creator."
  reference      : "800-171|3.2.1,800-171|3.2.2,800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-171r3|03.02.01,800-171r3|03.14.02,800-53|AT-2,800-53|SI-3,800-53r5|AT-2(3),800-53r5|SI-3,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv8|10.1,CSCv8|14.2,CSF|DE.CM-4,CSF|DE.DP-3,CSF|PR.AT-1,CSF2.0|PR.AT-01,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.6.3,ISO-27001-2022|A.8.7,ISO-27001-2022|7.3,ISO/IEC-27001|A.12.2.1,ITSG-33|AT-2,ITSG-33|SI-3,LEVEL|1A,NESA|M1.3.6,NESA|M3.4.1,NESA|T3.4.1,NIAv2|AM13,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,SWIFT-CSCv1|7.2,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getBetaFormsSettings"
  json_transform : '"isInOrgFormsPhishingScanEnabled: \(.isInOrgFormsPhishingScanEnabled)"'
  regex          : ".+"
  expect         : "isInOrgFormsPhishingScanEnabled: true"
</custom_item>

<report type:"WARNING">
  description : "2.1.10 (L1) Ensure DMARC Records for all Exchange Online domains are published"
  info        : "DMARC, or Domain-based Message Authentication, Reporting, and Conformance, assists recipient mail systems in determining the appropriate action to take when messages from a domain fail to meet SPF or DKIM authentication criteria.

DMARC strengthens the trustworthiness of messages sent from an organization's domain to destination email systems. By integrating DMARC with SPF (Sender Policy Framework) and DKIM (DomainKeys Identified Mail), organizations can significantly enhance their defenses against email spoofing and phishing attempts.

Leaving a DMARC policy set to p=none can result in failed action when a spear phishing email fails DMARC but passes SPF and DKIM checks. Having DMARC fully configured is a critical part in preventing business email compromise.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using a DNS Provider:

 - For each Exchange Online Accepted Domain, add the following record to DNS:

Record: _dmarc.domain1.comType: TXTValue: v=DMARC1; p=none; rua=mailto:<rua-report@example.com>; ruf=mailto:<ruf-report@example.com> <xhtml:ol start=\"2\"> - This will create a basic DMARC policy that will allow the organization to start monitoring message statistics.3. One week is enough time for data generated by the reports to be useful in understanding email trends and traffic. The final step requires implementing a policy of p=reject OR p=quarantine and pct=100 with the necessary rua and ruf email addresses defined:

Record: _dmarc.domain1.comType: TXTValue: v=DMARC1; p=reject; pct=100; rua=mailto:<rua-report@example.com>; ruf=mailto:<ruf-report@example.com>

Also remediate the MOREA domain using the UI:

 - Navigate to the Microsoft 365 admin center

https://admin.microsoft.com/

 - Expand Settings and select Domains
 - Select your tenant domain (for example, contoso.onmicrosoft.com).
 - Select DNS records and click + Add record
 - Add a new record with the TXT name of _dmarc with the appropriate values outlined above.

Note: The remediation portion involves a multi-staged approach over a period of time. First, a baseline of the current state of email will be established with p=none and rua and ruf Once the environment is better understood and reports have been analyzed an organization will move to the final state with dmarc record values as outlined in the audit section.

Microsoft has a list of

best practices for implementing DMARC

that cover these steps in detail.

Impact:

There should be no impact of setting up DMARC however, organizations should ensure appropriate setup to ensure continuous mail-flow."
  reference   : "800-171|3.13.1,800-171|3.13.5,800-171r3|03.13.01,800-53|SC-7,800-53r5|SC-7,CN-L3|8.1.10.6(j),CSCv7|7.8,CSCv8|9.5,CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7,LEVEL|1A,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,TBA-FIISB|43.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "2.1.12 (L1) Ensure the connection filter IP allow list is not used"
  info           : "In Microsoft 365 organizations with Exchange Online mailboxes or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, connection filtering and the default connection filter policy identify good or bad source email servers by IP addresses. The key components of the default connection filter policy are IP Allow List IP Block List and Safe list

The recommended state is IP Allow List empty or undefined.

Without additional verification like mail flow rules, email from sources in the IP Allow List skips spam filtering and sender authentication (SPF, DKIM, DMARC) checks. This method creates a high risk of attackers successfully delivering email to the Inbox that would otherwise be filtered. Messages that are determined to be malware or high confidence phishing are filtered."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com

.
 - Click to expand Email & collaboration select Policies & rules > Threat policies
 - Under Policies select Anti-spam
 - Click on the Connection filter policy (Default)
 - Click Edit connection filter policy
 - Remove any IP entries from Always allow messages from the following IP addresses or address range:
 - Click Save

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-HostedConnectionFilterPolicy -Identity Default -IPAllowList @{}

Impact:

This is the default behavior. IP Allow lists may reduce false positives, however, this benefit is outweighed by the importance of a policy which scans all messages regardless of the origin. This supports the principle of zero trust."
  reference      : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-171r3|03.14.02,800-53|SI-3,800-53|SI-8,800-53|SI-16,800-53r5|SI-3,800-53r5|SI-8,800-53r5|SI-16,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv8|9.7,CSF|DE.CM-4,CSF|DE.DP-3,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.7,ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-8,ITSG-33|SI-16,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getHostedConnectionFilterPolicy"
  json_transform : '.[] | if (.Identity == "Default") then "Identity: \(.Identity), IPAllowList: \(.IPAllowList)" else null end'
  regex          : "Identity:"
  expect         : "IPAllowList: \[\]"
</custom_item>

<custom_item>
  description    : "2.1.13 (L1) Ensure the connection filter safe list is off"
  info           : "In Microsoft 365 organizations with Exchange Online mailboxes or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, connection filtering and the default connection filter policy identify good or bad source email servers by IP addresses. The key components of the default connection filter policy are IP Allow List IP Block List and Safe list

The safe list is a pre-configured allow list that is dynamically updated by Microsoft.

The recommended safe list state is: Off or False

Without additional verification like mail flow rules, email from sources in the IP Allow List skips spam filtering and sender authentication (SPF, DKIM, DMARC) checks. This method creates a high risk of attackers successfully delivering email to the Inbox that would otherwise be filtered. Messages that are determined to be malware or high confidence phishing are filtered.

The safe list is managed dynamically by Microsoft, and administrators do not have visibility into which sender are included. Incoming messages from email servers on the safe list bypass spam filtering."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com

.
 - Click to expand Email & collaboration select Policies & rules > Threat policies
 - Under Policies select Anti-spam
 - Click on the Connection filter policy (Default)
 - Click Edit connection filter policy
 - Uncheck Turn on safe list
 - Click Save

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-HostedConnectionFilterPolicy -Identity Default -EnableSafeList $false

Impact:

This is the default behavior. IP Allow lists may reduce false positives, however, this benefit is outweighed by the importance of a policy which scans all messages regardless of the origin. This supports the principle of zero trust."
  reference      : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-171r3|03.14.02,800-53|SI-3,800-53|SI-8,800-53|SI-16,800-53r5|SI-3,800-53r5|SI-8,800-53r5|SI-16,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv8|9.7,CSF|DE.CM-4,CSF|DE.DP-3,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.7,ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-8,ITSG-33|SI-16,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getHostedConnectionFilterPolicy"
  json_transform : '.[] | if (.Identity == "Default") then "Identity: \(.Identity), EnableSafeList: \(.EnableSafeList)" else null end'
  regex          : "Identity:"
  expect         : "EnableSafeList: false"
</custom_item>

<custom_item>
  description    : "2.1.14 (L1) Ensure inbound anti-spam policies do not contain allowed domains"
  info           : "Anti-spam protection is a feature of Exchange Online that utilizes policies to help to reduce the amount of junk email, bulk and phishing emails a mailbox receives. These policies contain lists to allow or block specific senders or domains.

 - The allowed senders list
 - The allowed domains list
 - The blocked senders list
 - The blocked domains list

The recommended state is: Do not define any Allowed domains

Messages from entries in the allowed senders list or the allowed domains list bypass most email protection (except malware and high confidence phishing) and email authentication checks (SPF, DKIM and DMARC). Entries in the allowed senders list or the allowed domains list create a high risk of attackers successfully delivering email to the Inbox that would otherwise be filtered. The risk is increased even more when allowing common domain names as these can be easily spoofed by attackers.

Microsoft specifies in its documentation that allowed domains should be used for testing purposes only."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com

.
 - Click to expand Email & collaboration select Policies & rules > Threat policies
 - Under Policies select Anti-spam
 - Open each out of compliance inbound anti-spam policy by clicking on it.
 - Click Edit allowed and blocked senders and domains
 - Select Allow domains
 - Delete each domain from the domains list.
 - Click Done > Save
 - Repeat as needed.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-HostedContentFilterPolicy -Identity <Policy name> -AllowedSenderDomains @{}

Or, run this to remove allowed domains from all inbound anti-spam policies:

$AllowedDomains = Get-HostedContentFilterPolicy | Where-Object {$_.AllowedSenderDomains}
$AllowedDomains | Set-HostedContentFilterPolicy -AllowedSenderDomains @{}

Impact:

This is the default behavior. Allowed domains may reduce false positives, however, this benefit is outweighed by the importance of having a policy which scans all messages regardless of the origin. As an alternative consider sender based lists. This supports the principle of zero trust."
  reference      : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-171r3|03.14.02,800-53|SI-3,800-53|SI-8,800-53|SI-16,800-53r5|SI-3,800-53r5|SI-8,800-53r5|SI-16,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv8|9.7,CSF|DE.CM-4,CSF|DE.DP-3,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.7,ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-8,ITSG-33|SI-16,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getHostedContentFilterPolicy"
  json_transform : '.[] | "Identity: \(.Identity), AllowedSenderDomains: \(.AllowedSenderDomains)"'
  regex          : "Identity:"
  not_expect     : "AllowedSenderDomains: \[[^#\s\n\r]+\]"
</custom_item>

<custom_item>
  description    : "2.1.2 (L1) Ensure the Common Attachment Types Filter is enabled"
  info           : "The Common Attachment Types Filter lets a user block known and custom malicious file types from being attached to emails.

Blocking known malicious file types can help prevent malware-infested files from infecting a host."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com

.
 - Click to expand Email & collaboration select Policies & rules
 - On the Policies & rules page select Threat policies
 - Under polices select Anti-malware and click on the Default (Default) policy.
 - On the Policy page that appears on the right hand pane scroll to the bottom and click on Edit protection settings check the Enable the common attachments filter
 - Click Save.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following Exchange Online PowerShell command:

Set-MalwareFilterPolicy -Identity Default -EnableFileFilter $true

Note: Audit and Remediation guidance may focus on the Default policy however, if a Custom Policy exists in the organization's tenant, then ensure the setting is set as outlined in the highest priority policy listed.

Impact:

Blocking common malicious file types should not cause an impact in modern computing environments."
  reference      : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-171r3|03.14.02,800-53|SI-3,800-53|SI-8,800-53r5|SI-3,800-53r5|SI-8,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv7|7.9,CSCv7|8.1,CSCv8|9.6,CSF|DE.CM-4,CSF|DE.DP-3,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.7,ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-8,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getMalwareFilterPolicy"
  json_transform : '.[] | if (.Identity == "@MALWARE_POLICY_IDENTITY@") then "Identity: @MALWARE_POLICY_IDENTITY@, EnableFileFilter: \(.EnableFileFilter)" else "Identity \(.Identity) not found" end'
  regex          : "Identity: @MALWARE_POLICY_IDENTITY@"
  expect         : "EnableFileFilter: true"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "EnableInternalSenderAdminNotifications"
      request        : "getMalwareFilterPolicy"
      json_transform : '.[] | if (.Identity == "@MALWARE_POLICY_IDENTITY@") then "Identity: @MALWARE_POLICY_IDENTITY@, EnableInternalSenderAdminNotifications: \(.EnableInternalSenderAdminNotifications)" else "Identity \(.Identity) not found" end'
      regex          : "Identity: @MALWARE_POLICY_IDENTITY@"
      expect         : "EnableInternalSenderAdminNotifications: true"
    </custom_item>

    <custom_item>
      description    : "InternalSenderAdminAddress"
      request        : "getMalwareFilterPolicy"
      json_transform : '.[] | if (.Identity == "@MALWARE_POLICY_IDENTITY@") then "Identity: @MALWARE_POLICY_IDENTITY@, InternalSenderAdminAddress: \(.InternalSenderAdminAddress)" else "Identity \(.Identity) not found" end'
      regex          : "Identity: @MALWARE_POLICY_IDENTITY@"
      expect         : "InternalSenderAdminAddress: @SENDER_ADMIN_ADDRESS@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.1.3 (L1) Ensure notifications for internal users sending malware is Enabled"
      info        : "Exchange Online Protection (EOP) is Microsoft's cloud-based filtering service that protects organizations against spam, malware, and other email threats. EOP is included in all Microsoft 365 organizations with Exchange Online mailboxes.

EOP uses flexible anti-malware policies for malware protection settings. These policies can be set to notify Admins of malicious activity.

This setting alerts administrators that an internal user sent a message that contained malware. This may indicate an account or machine compromise that would need to be investigated."
      solution    : "To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com

.
 - Click to expand E-mail & Collaboration select Policies & rules
 - On the Policies & rules page select Threat policies
 - Under Policies select Anti-malware
 - Click on the Default (Default) policy.
 - Click on Edit protection settings and change the settings for Notify an admin about undelivered messages from internal senders to On and enter the email address of the administrator who should be notified under Administrator email address
 - Click Save.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following command:

Set-MalwareFilterPolicy -Identity '{Identity Name}' -EnableInternalSenderAdminNotifications $True -InternalSenderAdminAddress {admin@domain1.com}

Note: Audit and Remediation guidance may focus on the Default policy however, if a Custom Policy exists in the organization's tenant, then ensure the setting is set as outlined in the highest priority policy listed.

Impact:

Notification of account with potential issues should not have an impact on the user."
      reference   : "800-171r3|03.06.05,800-171r3|03.15.01,800-53|IR-1,800-53|IR-8,800-53r5|IR-1,800-53r5|IR-8,CSCv7|7.1,CSCv7|8.1,CSCv8|17.5,CSF|DE.AE-3,CSF|DE.AE-5,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.IP-7,CSF|PR.IP-9,CSF|RC.IM-1,CSF|RC.IM-2,CSF|RC.RP-1,CSF|RS.AN-4,CSF|RS.CO-1,CSF|RS.CO-2,CSF|RS.CO-3,CSF|RS.CO-4,CSF|RS.IM-1,CSF|RS.IM-2,CSF|RS.RP-1,CSF2.0|DE.AE-03,CSF2.0|DE.AE-08,CSF2.0|GV.OC-03,CSF2.0|GV.OV-01,CSF2.0|GV.PO-01,CSF2.0|GV.PO-02,CSF2.0|GV.SC-03,CSF2.0|GV.SC-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.IM-04,CSF2.0|RC.RP-01,CSF2.0|RC.RP-02,CSF2.0|RC.RP-04,CSF2.0|RC.RP-06,CSF2.0|RS.AN-08,CSF2.0|RS.MA,CSF2.0|RS.MA-01,CSF2.0|RS.MA-05,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.1,ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.4,ISO-27001-2022|A.5.24,ISO-27001-2022|A.5.31,ISO-27001-2022|A.5.36,ISO-27001-2022|A.5.37,ISO-27001-2022|5.2,ISO-27001-2022|5.3,ISO-27001-2022|7.5.1,ISO-27001-2022|7.5.2,ISO-27001-2022|7.5.3,ITSG-33|IR-1,ITSG-33|IR-8,LEVEL|1A,NESA|M1.2.2,NIAv2|IM9,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|7.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "BccSuspiciousOutboundMail"
      request        : "getHostedOutboundSpamFilterPolicy"
      json_transform : '.[] | if (.Identity == "@OUTBOUND_SPAM_POLICY_IDENTITY@") then .Identity as $Identity | .BccSuspiciousOutboundMail as $BccSuspiciousOutboundMail | .BccSuspiciousOutboundAdditionalRecipients[] | "Identity: \($Identity), BccSuspiciousOutboundMail: \($BccSuspiciousOutboundMail), BccSuspiciousOutboundAdditionalRecipients: \(.)" else "Policy @OUTBOUND_SPAM_POLICY_IDENTITY@ not found" end'
      regex          : "Identity: @OUTBOUND_SPAM_POLICY_IDENTITY@"
      expect         : "BccSuspiciousOutboundMail: true, BccSuspiciousOutboundAdditionalRecipients: @SUSPICIOUS_OUTBOUND_ADDRESS@"
    </custom_item>

    <custom_item>
      description    : "NotifyOutboundSpam"
      request        : "getHostedOutboundSpamFilterPolicy"
      json_transform : '.[] | if (.Identity == "@OUTBOUND_SPAM_POLICY_IDENTITY@") then .Identity as $Identity | .NotifyOutboundSpam as $NotifyOutboundSpam | .NotifyOutboundSpamRecipients[] | "Identity: \($Identity), NotifyOutboundSpam: \($NotifyOutboundSpam), NotifyOutboundSpamRecipients: \(.)" else "Policy @OUTBOUND_SPAM_POLICY_IDENTITY@ not found" end'
      regex          : "Identity: @OUTBOUND_SPAM_POLICY_IDENTITY@"
      expect         : "NotifyOutboundSpam: true, NotifyOutboundSpamRecipients: @NOTIFY_OUTBOUND_ADDRESS@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.1.6 (L1) Ensure Exchange Online Spam Policies are set to notify administrators"
      info        : "In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, email messages are automatically protected against spam (junk email) by EOP.

Configure Exchange Online Spam Policies to copy emails and notify someone when a sender in the organization has been blocked for sending spam emails.

A blocked account is a good indication that the account in question has been breached, and an attacker is using it to send spam emails to other people."
      solution    : "To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com

.
 - Click to expand Email & collaboration select Policies & rules > Threat policies
 - Under Policies select Anti-spam
 - Click on the Anti-spam outbound policy (default)
 - Select Edit protection settings then under Notifications
 - Check Send a copy of suspicious outbound messages or message that exceed these limits to these users and groups then enter the desired email addresses.
 - Check Notify these users and groups if a sender is blocked due to sending outbound spam then enter the desired email addresses.
 - Click Save

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

$BccEmailAddress = @(\"<INSERT-EMAIL>\")

$NotifyEmailAddress = @(\"<INSERT-EMAIL>\")

Set-HostedOutboundSpamFilterPolicy -Identity Default -BccSuspiciousOutboundAdditionalRecipients $BccEmailAddress -BccSuspiciousOutboundMail $true -NotifyOutboundSpam $true -NotifyOutboundSpamRecipients $NotifyEmailAddress

Note: Audit and Remediation guidance may focus on the Default policy however, if a Custom Policy exists in the organization's tenant, then ensure the setting is set as outlined in the highest priority policy listed.

Impact:

Notification of users that have been blocked should not cause an impact to the user."
      reference   : "800-171r3|03.06.05,800-171r3|03.15.01,800-53|IR-1,800-53|IR-8,800-53r5|IR-1,800-53r5|IR-8,CSCv7|7.9,CSCv7|7.10,CSCv8|17.5,CSF|DE.AE-3,CSF|DE.AE-5,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.IP-7,CSF|PR.IP-9,CSF|RC.IM-1,CSF|RC.IM-2,CSF|RC.RP-1,CSF|RS.AN-4,CSF|RS.CO-1,CSF|RS.CO-2,CSF|RS.CO-3,CSF|RS.CO-4,CSF|RS.IM-1,CSF|RS.IM-2,CSF|RS.RP-1,CSF2.0|DE.AE-03,CSF2.0|DE.AE-08,CSF2.0|GV.OC-03,CSF2.0|GV.OV-01,CSF2.0|GV.PO-01,CSF2.0|GV.PO-02,CSF2.0|GV.SC-03,CSF2.0|GV.SC-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.IM-04,CSF2.0|RC.RP-01,CSF2.0|RC.RP-02,CSF2.0|RC.RP-04,CSF2.0|RC.RP-06,CSF2.0|RS.AN-08,CSF2.0|RS.MA,CSF2.0|RS.MA-01,CSF2.0|RS.MA-05,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.1,ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.4,ISO-27001-2022|A.5.24,ISO-27001-2022|A.5.31,ISO-27001-2022|A.5.36,ISO-27001-2022|A.5.37,ISO-27001-2022|5.2,ISO-27001-2022|5.3,ISO-27001-2022|7.5.1,ISO-27001-2022|7.5.2,ISO-27001-2022|7.5.3,ITSG-33|IR-1,ITSG-33|IR-8,LEVEL|1A,NESA|M1.2.2,NIAv2|IM9,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|7.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "2.1.8 (L1) Ensure that SPF records are published for all Exchange Domains"
  info        : "For each domain that is configured in Exchange, a corresponding Sender Policy Framework (SPF) record should be created.

SPF records allow Exchange Online Protection and other mail systems to know where messages from domains are allowed to originate. This information can be used by that system to determine how to treat the message based on if it is being spoofed or is valid.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using a DNS Provider:

 - If all email in your domain is sent from and received by Exchange Online, add the following TXT record for each Accepted Domain:

v=spf1 include:spf.protection.outlook.com -all <xhtml:ol start=\"2\"> - If there are other systems that send email in the environment, refer to this article for the proper SPF configuration:

https://docs.microsoft.com/en-us/office365/SecurityCompliance/set-up-spf-in-office-365-to-help-prevent-spoofing

.

Impact:

There should be minimal impact of setting up SPF records however, organizations should ensure proper SPF record setup as email could be flagged as spam if SPF is not setup appropriately."
  reference   : "800-171|3.13.1,800-171|3.13.5,800-171r3|03.13.01,800-53|SC-7,800-53r5|SC-7,CN-L3|8.1.10.6(j),CSCv7|7.8,CSCv8|9.5,CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7,LEVEL|1A,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,TBA-FIISB|43.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "2.1.9 (L1) Ensure that DKIM is enabled for all Exchange Online Domains"
  info           : "DKIM is one of the trio of Authentication methods (SPF, DKIM and DMARC) that help prevent attackers from sending messages that look like they come from your domain.

DKIM lets an organization add a digital signature to outbound email messages in the message header. When DKIM is configured, the organization authorizes it's domain to associate, or sign, its name to an email message using cryptographic authentication. Email systems that get email from this domain can use a digital signature to help verify whether incoming email is legitimate.

Use of DKIM in addition to SPF and DMARC to help prevent malicious actors using spoofing techniques from sending messages that look like they are coming from your domain.

By enabling DKIM with Office 365, messages that are sent from Exchange Online will be cryptographically signed. This will allow the receiving email system to validate that the messages were generated by a server that the organization authorized and not being spoofed.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution       : "To remediate using a DNS Provider:

 - For each accepted domain in Exchange Online, two DNS entries are required.

Host name:selector1._domainkey
Points to address or value:selector1-<domainGUID>._domainkey.<initialDomain>
TTL:3600
Host name:selector2._domainkey
Points to address or value:selector2-<domainGUID>._domainkey.<initialDomain>
TTL:3600

For Office 365, the selectors will always be selector1 or selector2

domainGUID is the same as the domainGUID in the customized MX record for your custom domain that appears before mail.protection.outlook.com. For example, in the following MX record for the domain contoso.com, the domainGUID is contoso-com:

contoso.com. 3600 IN MX 5 contoso-com.mail.protection.outlook.com

The initial domain is the domain that you used when you signed up for Office 365. Initial domains always end with on.microsoft.com.

 - After the DNS records are created, enable DKIM signing in Defender.
 - Navigate to Microsoft 365 Defender

https://security.microsoft.com/

 - Expand Email & collaboration > Policies & rules > Threat policies
 - Under Rules section click Email authentication settings
 - Select DKIM
 - Click on each domain and click Enable next to Sign messages for this domain with DKIM signature

Final remediation step using the Exchange Online PowerShell Module:

 - Connect to Exchange Online service using Connect-ExchangeOnline
 - Run the following Exchange Online PowerShell command:

Set-DkimSigningConfig -Identity < domainName > -Enabled $True

Impact:

There should be no impact of setting up DKIM however, organizations should ensure appropriate setup to ensure continuous mail-flow."
  reference      : "800-171|3.13.1,800-171|3.13.5,800-171r3|03.13.01,800-53|SC-7,800-53r5|SC-7,CN-L3|8.1.10.6(j),CSCv7|7.8,CSCv8|9.5,CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7,LEVEL|1A,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,TBA-FIISB|43.1"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getDkimSigningConfig"
  json_transform : '.[] | "Name: \(.Name), Enabled: \(.Enabled), Status: \(.Status)"'
  regex          : "Name:"
  expect         : "^Manual Review Required$"
  severity       : MEDIUM
</custom_item>

<custom_item>
  description    : "3.1.1 (L1) Ensure Microsoft 365 audit log search is Enabled"
  info           : "When audit log search is enabled in the Microsoft Purview compliance portal, user and admin activity within the organization is recorded in the audit log and retained for 180 days by default. However, some organizations may prefer to use a third-party security information and event management (SIEM) application to access their auditing data. In this scenario, a global admin can choose to turn off audit log search in Microsoft 365.

Enabling audit log search in the Microsoft Purview compliance portal can help organizations improve their security posture, meet regulatory compliance requirements, respond to security incidents, and gain valuable operational insights."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Purview

https://purview.microsoft.com/

 - Select Solutions and then Audit to open the audit search.
 - Click blue bar Start recording user and admin activity
 - Click Yes on the dialog box to confirm.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true"
  reference      : "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171r3|03.03.01,800-171r3|03.03.03,800-171r3|03.03.06a.,800-53|AU-2,800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(a),CSCv7|6.2,CSCv8|8.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.15,ITSG-33|AU-2,ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getAdminAuditLogConfig"
  json_transform : '.[] | "UnifiedAuditLogIngestionEnabled: \(.UnifiedAuditLogIngestionEnabled)"'
  regex          : "UnifiedAuditLogIngestionEnabled:"
  expect         : "UnifiedAuditLogIngestionEnabled: true"
</custom_item>

<report type:"WARNING">
  description : "3.2.1 (L1) Ensure DLP policies are enabled"
  info        : "Data Loss Prevention (DLP) policies allow Exchange Online and SharePoint Online content to be scanned for specific types of data like social security numbers, credit card numbers, or passwords.

Enabling DLP policies alerts users and administrators that specific types of data should not be exposed, helping to protect the data from accidental exposure.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Purview

https://purview.microsoft.com/

 - Click Solutions > Data loss prevention then Policies
 - Click Create policy
 - Create a policy that is specific to the types of data the organization wishes to protect.

Impact:

Enabling a Teams DLP policy will allow sensitive data in Exchange Online and SharePoint Online to be detected or blocked. Always ensure to follow appropriate procedures during testing and implementation of DLP policies based on organizational standards."
  reference   : "800-171r3|03.03.03b.,800-171r3|03.14.08,800-53|AU-11,800-53|SI-12,800-53r5|AU-11,800-53r5|CM-12,800-53r5|SI-12,CSCv7|13,CSCv7|14.7,CSCv8|3.1,CSF|PR.PT-1,CSF2.0|ID.AM-07,CSF2.0|ID.AM-08,CSF2.0|PR.PS-04,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.28,ISO-27001-2022|A.8.15,ITSG-33|AU-11,ITSG-33|SI-12,ITSG-33|SI-12a.,LEVEL|1M,NESA|M5.2.3,NESA|M5.2.4,NESA|M5.3.1,NESA|T3.6.2,NIAv2|DR1,NIAv2|DR1a,NIAv2|DR1b,NIAv2|DR1c,NIAv2|DR2,NIAv2|DR3,NIAv2|DR4,NIAv2|DR5,NIAv2|DR6,NIAv2|SM7,PCI-DSSv3.2.1|3.1,PCI-DSSv3.2.1|10.7,PCI-DSSv4.0|3.2.1,PCI-DSSv4.0|10.5.1,QCSC-v1|8.2.1,QCSC-v1|13.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "3.3.1 (L1) Ensure Information Protection sensitivity label policies are published"
  info        : "Sensitivity labels enable organizations to classify and label content across Microsoft 365 based on its sensitivity and business impact. These labels can be applied manually by users or automatically based on the content. When applied, labels can automatically encrypt content, provide \"Confidential\" watermarks, restrict access, and offer various data protection features.

Labels can be scoped to data assets and containers:

 - Files & other data assets in Microsoft 365, Fabric, Azure, AWS and other platforms
 - Email messages sent from all versions of Outlook
 - Meeting calendar events and schedules in Outlook and Teams
 - Teams, Microsoft 365 Groups and SharePoint sites

Consistent usage of sensitivity labels can help reduce the risk of data loss or exposure and enable more effective incident response if a breach does occur. They can also help organizations comply with regulatory requirements and provide visibility and control over sensitive information.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Purview compliance portal

https://purview.microsoft.com/

 - Select Information protection > Sensitivity labels
 - Click Create a label to create a label.
 - Click Publish labels and select any newly created labels to publish according to the organization's information protection needs.

Impact:

Encryption configurations (control access, DKE, BYOK) in the individual labels may impact users' ability to access site documents and information. Careful consideration of the individual sensitivity label configurations should be exercised prior to applying an auto labeling policy, publishing policy, sensitivity label configuration, or PowerShell based label settings to SharePoint sites.

Additionally, when updating or deleting Sensitivity Labels, an assessment of the potential impacts should be conducted to avoid unintended consequences. If tenants are configured for sharing with guests or external domains and Sensitivity Labels have encryption applied, this can affect the ability to share documents via email stored in SharePoint. Some recipients may be unable to open the document depending on their email client, which could trigger Purview Advanced Encryptions and OME flows based on the recipient type and the cloud license from which the email is sent (e.g., government clouds vs. commercial clouds)."
  reference   : "800-53|RA-2,800-53r5|RA-2,CSCv7|13.1,CSCv7|14.6,CSCv8|3.7,CSF|ID.AM-5,CSF|ID.RA-4,CSF|ID.RA-5,CSF2.0|ID.AM-05,CSF2.0|ID.RA-04,CSF2.0|ID.RA-05,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.12,ITSG-33|RA-2,LEVEL|1M,NESA|M2.2.1,NESA|T1.3.1,QCSC-v1|6.2,QCSC-v1|11.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.1.2.1 (L1) Ensure 'Per-user MFA' is disabled"
  info        : "Legacy per-user Multi-Factor Authentication (MFA) can be configured to require individual users to provide multiple authentication factors, such as passwords and additional verification codes, to access their accounts. It was introduced in earlier versions of Office 365, prior to the more comprehensive implementation of Conditional Access (CA).

Both security defaults and conditional access with security defaults turned off are not compatible with per-user multi-factor authentication (MFA), which can lead to undesirable user authentication states. The CIS Microsoft 365 Benchmark explicitly employs Conditional Access for MFA as an enhancement over security defaults and as a replacement for the outdated per-user MFA. To ensure a consistent authentication state disable per-user MFA on all accounts.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Identity > Users select All users
 - Click on Per-user MFA on the top row.
 - Click the empty box next to Display Name to select all accounts.
 - On the far right under

quick steps

click Disable

Impact:

Accounts using per-user MFA will need to be migrated to use CA.

Prior to disabling per-user MFA the organization must be prepared to implement conditional access MFA to avoid security gaps and allow for a smooth transition. This will help ensure relevant accounts are covered by MFA during the change phase from disabling per-user MFA to enabling CA MFA. Section 5.2.2 in this document covers the creation of a CA rule for both administrators and all users in the tenant.

Microsoft has documentation on migrating from per-user MFA

Convert users from per-user MFA to Conditional Access based MFA"
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1A,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "5.1.2.3 (L1) Ensure 'Restrict non-admin users from creating tenants' is set to 'Yes'"
  info           : "Non-privileged users can create tenants in the Microsoft Entra ID and Microsoft Entra administration portal under \"Manage tenant\". The creation of a tenant is recorded in the Audit log as category \"DirectoryManagement\" and activity \"Create Company\". By default, the user who creates a Microsoft Entra tenant is automatically assigned the Global Administrator role. The newly created tenant doesn't inherit any settings or configurations.

Restricting tenant creation prevents unauthorized or uncontrolled deployment of resources and ensures that the organization retains control over its infrastructure. User generation of shadow IT could lead to multiple, disjointed environments that can make it difficult for IT to manage and secure the organization's data, especially if other users in the organization began using these tenants for business purposes under the misunderstanding that they were secured by the organization's security team."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

 - Click to expand Identity > Users > User settings
 - Set Restrict non-admin users from creating tenants to Yes then Save

To remediate using PowerShell:

 - Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.ReadWrite.Authorization\"
 - Run the following commands:

# Create hashtable and update the auth policy
$params = @{ AllowedToCreateTenants = $false }
Update-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions $params

Impact:

Non-admin users will need to contact I.T. if they have a valid reason to create a tenant."
  reference      : "800-171|3.1.5,800-171r3|03.01.05a.,800-53|AC-6,800-53r5|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-4,CSF|PR.DS-5,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.15,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.18,ITSG-33|AC-6,LEVEL|1A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "listAuthorizationPolicy"
  json_transform : '"Allowed to Create Tenants: \(.defaultUserRolePermissions.allowedToCreateTenants)"'
  regex          : "Allowed to Create Tenants:"
  expect         : "Allowed to Create Tenants: false"
</custom_item>

<report type:"WARNING">
  description : "5.1.2.4 (L1) Ensure access to the Entra admin center is restricted"
  info        : "Restrict non-privileged users from signing into the Microsoft Entra admin center.

Note: This recommendation only affects access to the web portal. It does not prevent privileged users from using other methods such as Rest API or PowerShell to obtain information. Those channels are addressed elsewhere in this document.

The Microsoft Entra admin center contains sensitive data and permission settings, which are still enforced based on the user's role. However, an end user may inadvertently change properties or account settings that could result in increased administrative overhead. Additionally, a compromised end user account could be used by a malicious attacker as a means to gather additional information and escalate an attack.

Note: Users will still be able to sign into Microsoft Entra admin center but will be unable to see directory information.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

 - Click to expand Identity > Users > User settings
 - Set Restrict access to Microsoft Entra admin center to Yes then Save

Impact:

In the event there are resources a user owns that need to be changed in the Entra Admin center, then an administrator would need to make those changes."
  reference   : "800-171|3.1.5,800-171r3|03.01.05a.,800-53|AC-6,800-53r5|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-4,CSF|PR.DS-5,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.15,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.18,ITSG-33|AC-6,LEVEL|1M,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "5.1.3.1 (L1) Ensure a dynamic group for guest users is created"
  info           : "A dynamic group is a dynamic configuration of security group membership for Microsoft Entra ID. Administrators can set rules to populate groups that are created in Entra ID based on user attributes (such as userType, department, or country/region). Members can be automatically added to or removed from a security group based on their attributes.

The recommended state is to create a dynamic group that includes guest accounts.

Dynamic groups allow for an automated method to assign group membership.

Guest user accounts will be automatically added to this group and through this existing conditional access rules, access controls and other security measures will ensure that new guest accounts are restricted in the same manner as existing guest accounts."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Identity > Groups select All groups
 - Select New group and assign the following values:
 - Group type: Security
 - Microsoft Entra roles can be assigned to the group: No
 - Membership type: Dynamic User

 - Select Add dynamic query
 - Above the Rule syntax text box, select Edit
 - Place the following expression in the box:

(user.userType -eq \"Guest\") <xhtml:ol start=\"7\"> - Select OK and Save

To remediate using PowerShell:

 - Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Group.ReadWrite.All\"
 - In the script below edit DisplayName and MailNickname as needed and run:

$params = @{
     DisplayName = \"Dynamic Test Group\"
     MailNickname = \"DynGuestUsers\"
     MailEnabled = $false
     SecurityEnabled = $true
     GroupTypes = \"DynamicMembership\"
     MembershipRule = '(user.userType -eq \"Guest\")'
     MembershipRuleProcessingState = \"On\"
}

New-MgGroup @params"
  reference      : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "listGroupsFull"
  json_transform : '.[] | .displayName as $groupName | .groupTypes as $groupTypes | .membershipRule as $membershipRule | .groupTypes[] | select(. == "DynamicMembership") | "Group Name: \($groupName), Group Types: \($groupTypes), Rule: \($membershipRule)"'
  regex          : ".+"
  expect         : 'Rule: \(user.userType -eq \\?"Guest\\?"\)'
</custom_item>

<custom_item>
  description    : "5.1.5.2 (L1) Ensure the admin consent workflow is enabled"
  info           : "The admin consent workflow gives admins a secure way to grant access to applications that require admin approval. When a user tries to access an application but is unable to provide consent, they can send a request for admin approval. The request is sent via email to admins who have been designated as reviewers. A reviewer takes action on the request, and the user is notified of the action.

The admin consent workflow (Preview) gives admins a secure way to grant access to applications that require admin approval. When a user tries to access an application but is unable to provide consent, they can send a request for admin approval. The request is sent via email to admins who have been designated as reviewers. A reviewer acts on the request, and the user is notified of the action."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Identity > Applications select Enterprise applications
 - Under Security select Consent and permissions
 - Under Manage select Admin consent settings
 - Set Users can request admin consent to apps they are unable to consent to to Yes under Admin consent requests
 - Under the Reviewers choose the Roles and Groups that will review user generated app consent requests.
 - Set Selected users will receive email notifications for requests to Yes
 - Select Save at the top of the window.

Impact:

To approve requests, a reviewer must be a global administrator, cloud application administrator, or application administrator. The reviewer must already have one of these admin roles assigned; simply designating them as a reviewer doesn't elevate their privileges."
  reference      : "800-171|3.4.8,800-171r3|03.04.08,800-53|CM-7(5),800-53|CM-10,800-53r5|CM-7(5),800-53r5|CM-10,CSCv7|18.3,CSCv8|2.5,CSF|DE.CM-3,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.32,ISO-27001-2022|A.8.19,ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ITSG-33|CM-7,LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getAdminConsentRequestPolicy"
  json_transform : '"AdminConsentRequestPolicy: \(.isEnabled), notifyReviewers: \(.notifyReviewers)"'
  expect         : "AdminConsentRequestPolicy: true"
</custom_item>

<custom_item>
  description    : "5.1.6.2 (L1) Ensure that guest user access is restricted"
  info           : "Microsoft Entra ID, part of Microsoft Entra, allows you to restrict what external guest users can see in their organization in Microsoft Entra ID. Guest users are set to a limited permission level by default in Microsoft Entra ID, while the default for member users is the full set of user permissions.

These directory level permissions are enforced across Microsoft Entra services including Microsoft Graph, PowerShell v2, the Azure portal, and My Apps portal. Microsoft 365 services leveraging Microsoft 365 groups for collaboration scenarios are also affected, specifically Outlook, Microsoft Teams, and SharePoint. They do not override the SharePoint or Microsoft Teams guest settings.

The recommended state is at least Guest users have limited access to properties and memberships of directory objects or more restrictive.

By limiting guest access to the

most restrictive

state this helps prevent malicious group and user object enumeration in the Microsoft 365 environment. This first step, known as

reconnaissance

in The Cyber Kill Chain, is often conducted by attackers prior to more advanced targeted attacks."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Identity > External Identities select External collaboration settings
 - Under Guest user access set Guest user access restrictions to one of the following:
 - State: Guest users have limited access to properties and memberships of directory objects
 - State: Guest user access is restricted to properties and memberships of their own directory objects (most restrictive)

To remediate using PowerShell:

 - Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.ReadWrite.Authorization\"
 - Run the following command to set the guest user access restrictions to default:

# Guest users have limited access to properties and memberships of directory objects
Update-MgPolicyAuthorizationPolicy -GuestUserRoleId '10dae51f-b6af-4016-8d66-8c2a99b929b3' <xhtml:ol start=\"3\"> - Or, run the following command to set it to the \"most restrictive\":

# Guest user access is restricted to properties and memberships of their own directory objects (most restrictive)
Update-MgPolicyAuthorizationPolicy -GuestUserRoleId '2af84b1e-32c8-42b7-82bc-daa82404023b'

Note: Either setting allows for a passing state.

Impact:

The default is Guest users have limited access to properties and memberships of directory objects

When using the 'most restrictive' setting, guests will only be able to access their own profiles and will not be allowed to see other users' profiles, groups, or group memberships.

There are some known issues with Yammer that will prevent guests that are signed in from leaving the group."
  reference      : "800-171|3.1.1,800-171|3.5.2,800-171|3.5.5,800-171|3.5.6,800-171r3|03.01.01,800-171r3|03.05.05,800-171r3|03.05.12,800-171r3|03.15.01,800-53|AC-1,800-53|AC-2,800-53|IA-4,800-53|IA-5,800-53r5|AC-1,800-53r5|AC-2,800-53r5|AC-2(1),800-53r5|IA-4,800-53r5|IA-5,CN-L3|7.1.2.7(b),CN-L3|7.1.3.2(d),CN-L3|8.1.4.2(e),CN-L3|8.1.10.6(c),CSCv8|6.1,CSF|DE.CM-1,CSF|DE.CM-3,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|GV.OC-03,CSF2.0|GV.OV-01,CSF2.0|GV.PO-01,CSF2.0|GV.PO-02,CSF2.0|GV.SC-03,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.1,ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.4,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO-27001-2022|A.5.18,ISO-27001-2022|A.5.31,ISO-27001-2022|A.5.36,ISO-27001-2022|A.5.37,ISO-27001-2022|A.8.2,ISO-27001-2022|5.2,ISO-27001-2022|5.3,ISO-27001-2022|7.5.1,ISO-27001-2022|7.5.2,ISO-27001-2022|7.5.3,ISO/IEC-27001|A.9.1.1,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-1,ITSG-33|AC-2,ITSG-33|IA-4,ITSG-33|IA-5,LEVEL|1A,NESA|M1.2.2,NESA|T5.2.3,NIAv2|AM28,NIAv2|AM29,NIAv2|AM30,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "listAuthorizationPolicy"
  json_transform : '"Authorization Policy: \(.guestUserRoleId)"'
  regex          : ".+"
  expect         : "Authorization Policy: (10dae51f-b6af-4016-8d66-8c2a99b929b3|2af84b1e-32c8-42b7-82bc-daa82404023b)"
</custom_item>

<report type:"WARNING">
  description : "5.1.8.1 (L1) Ensure that password hash sync is enabled for hybrid deployments"
  info        : "Password hash synchronization is one of the sign-in methods used to accomplish hybrid identity synchronization. Microsoft Entra Connect synchronizes a hash, of the hash, of a user's password from an on-premises Active Directory instance to a cloud-based Entra ID instance.

Note: Audit and remediation procedures in this recommendation only apply to Microsoft 365 tenants operating in a hybrid configuration using Entra Connect sync, and do not apply to federated domains.

Password hash synchronization helps by reducing the number of passwords your users need to maintain to just one and enables leaked credential detection for your hybrid accounts. Leaked credential protection is leveraged through Entra ID Protection and is a subset of that feature which can help identify if an organization's user account passwords have appeared on the dark web or public spaces.

Using other options for your directory synchronization may be less resilient as Microsoft can still process sign-ins to 365 with Hash Sync even if a network connection to your on-premises environment is not available. This minimizes downtime and ensures business continuity.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the on-prem Microsoft Entra Connect tool:

 - Log in to the on premises server that hosts the Microsoft Entra Connect tool
 - Double-click the Azure AD Connect icon that was created on the desktop
 - Click Configure
 - On the Additional tasks page, select Customize synchronization options and click Next
 - Enter the username and password for your global administrator.
 - On the Connect your directories screen, click Next
 - On the Domain and OU filtering screen, click Next
 - On the Optional features screen, check Password hash synchronization and click Next
 - On the Ready to configure screen click Configure
 - Once the configuration completes, click Exit

Impact:

Compliance or regulatory restrictions may exist, depending on the organization's business sector, that preclude hashed versions of passwords from being securely transmitted to cloud data centers."
  reference   : "800-171|3.1.1,800-171r3|03.01.01,800-171r3|03.01.02,800-53|AC-2(1),800-53|AC-3,800-53r5|AC-2(1),800-53r5|AC-3,CN-L3|7.1.3.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|16.4,CSCv8|6.7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.PT-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.5.33,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-2(1),ITSG-33|AC-3,LEVEL|1M,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|31.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.1 (L1) Ensure multifactor authentication is enabled for all users in administrative roles"
  info        : "Multifactor authentication is a process that requires an additional form of identification during the sign-in process, such as a code from a mobile device or a fingerprint scan, to enhance security.

Ensure users in administrator roles have MFA capabilities enabled.

Multifactor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted. Multifactor authentication provides additional assurance that the individual attempting to gain access is who they claim to be. With multifactor authentication, an attacker would need to compromise at least two different authentication mechanisms, increasing the difficulty of compromise and thus reducing the risk.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click expand Protection > Conditional Access select Policies
 - Click New policy
 - Under Users include Select users and groups and check Directory roles
 - At a minimum, include the directory roles listed below in this section of the document.
 - Under Target resources include All resources (formerly 'All cloud apps') and do not create any exclusions.
 - Under Grant select Grant Access and check either Require multifactor authentication or Require authentication strength
 - Click Select at the bottom of the pane.

 - Under Enable policy set it to Report-only until the organization is ready to enable it.
 - Click Create

At minimum these directory roles should be included for MFA:

 - Application administrator
 - Authentication administrator
 - Billing administrator
 - Cloud application administrator
 - Conditional Access administrator
 - Exchange administrator
 - Global administrator
 - Global reader
 - Helpdesk administrator
 - Password administrator
 - Privileged authentication administrator
 - Privileged role administrator
 - Security administrator
 - SharePoint administrator
 - User administrator

Note: Report-only is an acceptable first stage when introducing any CA policy. The control, however, is not complete until the policy is on.

Impact:

Implementation of multifactor authentication for all users in administrative roles will necessitate a change to user routine. All users in administrative roles will be required to enroll in multifactor authentication using phone, SMS, or an authentication application. After enrollment, use of multifactor authentication will be required for future access to the environment."
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53r5|IA-2(1),CN-L3|7.1.2.7(b),CSCv7|16.3,CSCv8|6.5,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),LEVEL|1A,NESA|T5.4.2,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.10 (L1) Ensure a managed device is required to register security information"
  info        : "Conditional Access (CA) can be configured to enforce access based on the device's compliance status or whether it is Entra hybrid joined. Collectively this allows CA to classify devices as managed or not, providing more granular control over whether or not a user can register MFA on a device.

When using Require device to be marked as compliant the device must pass checks configured in Compliance policies defined within Intune (Endpoint Manager). Before these checks can be applied, the device must first be enrolled in Intune MDM.

By selecting Require Microsoft Entra hybrid joined device this means the device must first be synchronized from an on-premises Active Directory to qualify for authentication.

When configured to the recommended state below only one condition needs to be met for the user to register MFA from the device. This functions as an \"OR\" operator.

The recommended state is to restrict Register security information to a device that is marked as compliant or Entra hybrid joined.

Requiring registration on a managed device significantly reduces the risk of bad actors using stolen credentials to register security information. Accounts that are created but never registered with an MFA method are particularly vulnerable to this type of attack. Enforcing this requirement will both reduce the attack surface for fake registrations and ensure that legitimate users register using trusted devices which typically have additional security measures in place already.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click expand Protection > Conditional Access select Policies
 - Create a new policy by selecting New policy
 - Under Users include All users
 - Under Target resources select User actions and check Register security information
 - Under Grant select Grant access
 - Check only Require multifactor authentication and Require Microsoft Entra hybrid joined device
 - Choose Require one of the selected controls and click Select at the bottom.

 - Under Enable policy set it to Report-only until the organization is ready to enable it.
 - Click Create

Note: Break-glass accounts should be excluded from all Conditional Access policies.

Impact:

The organization will be required to have a mature device management process. New devices provided to users will need to be pre-enrolled in Intune, auto-enrolled or be Entra hybrid joined. Otherwise, the user will be unable to complete registration, requiring additional resources from I.T. This could be more disruptive in remote worker environments where the MDM maturity is low.

In these cases where the person enrolling in MFA (enrollee) doesn't have physical access to a managed device, a help desk process can be created using a Teams meeting to complete enrollment using: 1) a durable process to verify the enrollee's identity including government identification with a photograph held up to the camera, information only the enrollee should know, and verification by the enrollee's direct manager in the same meeting; 2) complete enrollment in the same Teams meeting with the enrollee being granted screen and keyboard access to the help desk person's InPrivate Edge browser session."
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1A,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.11 (L1) Ensure sign-in frequency for Intune Enrollment is set to 'Every time'"
  info        : "Sign-in frequency defines the time period before a user is asked to sign in again when attempting to access a resource. The Microsoft Entra ID default configuration for user sign-in frequency is a rolling window of 90 days.

The recommended state is a Sign-in frequency of Every time for Microsoft Intune Enrollment

Note: Microsoft accounts for a five-minute clock skew when 'every time' is selected in a conditional access policy, ensuring that users are not prompted more frequently than once every five minutes.

Intune Enrollment is considered a sensitive action and should be safeguarded. An attack path existsthat allows for a bypass of device compliance Conditional Access rule. This could allow compromised credentials to be used through a newly registered device enrolled in Intune, enabling persistence and privilege escalation.

Setting sign-in frequency to every time limits the timespan an attacker could use fresh credentials to enroll a new device to Intune.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click expand Protection > Conditional Access select Policies
 - Create a new policy by selecting New policy
 - Under Users include All users
 - Under Target resources select Resources (formerly cloud apps) choose Select resources and add Microsoft Intune Enrollment to the list.
 - Under Grant select Grant access
 - Check either Require multifactor authentication or Require authentication strength
 - Under Session check Sign-in frequency and select Every time

 - Under Enable policy set it to Report-only until the organization is ready to enable it.
 - Click Create

Note: If the Microsoft Intune Enrollment cloud app isn't available then it must be created. To add the app for new tenants, a Microsoft Entra administrator must create a service principal object, with app ID d4ebce55-015a-49b5-a083-c84d1797ae8c in PowerShell or Microsoft Graph.

Note: Break-glass accounts should be excluded from all Conditional Access policies.

Impact:

New users enrolling into Intune through an automated process may need to sign-in again if the enrollment process goes on for too long."
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1A,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.12 (L1) Ensure the device code sign-in flow is blocked"
  info        : "The Microsoft identity platform supports the device authorization grant, which allows users to sign in to input-constrained devices such as a smart TV, IoT device, or a printer. To enable this flow, the device has the user visit a webpage in a browser on another device to sign in. Once the user signs in, the device is able to get access tokens and refresh tokens as needed.

The recommended state is to Block access for Device code flow in Conditional Access.

Since August 2024, Microsoft has observed threat actors, such as Storm-2372, employing \"device code phishing\" attacks. These attacks deceive users into logging into productivity applications, capturing authentication tokens to gain further access to compromised accounts.

To mitigate this specific attack, block authentication code flows and permit only those from devices within trusted environments, identified by specific IP addresses.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click expand Protection > Conditional Access select Policies
 - Create a new policy by selecting New policy
 - Under Users include All users
 - Under Target resources > Resources (formerly cloud apps) include All resources (formerly 'All cloud apps')
 - Under Conditions > Authentication flows set Configure is set to Yes select Device code flow and click Save
 - Under Grant select Block access and click Select

 - Under Enable policy set it to Report-only until the organization is ready to enable it.
 - Click Create

Note: Break-glass accounts should be excluded from all Conditional Access policies.

Impact:

Some administrative overhead will be required for stricter management of these devices. Since exclusions do not violate compliance, this feature can still be utilized effectively within a controlled environment."
  reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv8|16.7,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.2 (L1) Ensure multifactor authentication is enabled for all users"
  info        : "Enable multifactor authentication for all users in the Microsoft 365 tenant. Users will be prompted to authenticate with a second factor upon logging in to Microsoft 365 services. The second factor is most commonly a text message to a registered mobile phone number where they type in an authorization code, or with a mobile application like Microsoft Authenticator.

Multifactor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted. Multifactor authentication provides additional assurance that the individual attempting to gain access is who they claim to be. With multifactor authentication, an attacker would need to compromise at least two different authentication mechanisms, increasing the difficulty of compromise and thus reducing the risk.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click expand Protection > Conditional Access select Policies
 - Click New policy
 - Under Users include All users
 - Under Target resources include All resources (formerly 'All cloud apps') and do not create any exclusions.
 - Under Grant select Grant Access and check either Require multifactor authentication or Require authentication strength
 - Click Select at the bottom of the pane.

 - Under Enable policy set it to Report-only until the organization is ready to enable it.
 - Click Create

Note: Break-glass accounts should be excluded from all Conditional Access policies.

Impact:

Implementation of multifactor authentication for all users will necessitate a change to user routine. All users will be required to enroll in multifactor authentication using phone, SMS, or an authentication application. After enrollment, use of multifactor authentication will be required for future authentication to the environment.

External identities that attempt to access documents that utilize Purview Information Protection (Sensitivity Labels) will find their access disrupted. In order to mitigate this create an exclusion for Microsoft Rights Management Services ID: 00000012-0000-0000-c000-000000000000

Note: Organizations that struggle to enforce MFA globally due to budget constraints preventing the provision of company-owned mobile devices to every user, or due to regulations, unions, or policies that prevent forcing end users to use their personal devices, have another option. FIDO2 security keys can be used as an alternative. They are more secure, phishing-resistant, and affordable for organizations to issue to every end user."
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv7|16.3,CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1A,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.3 (L1) Enable Conditional Access policies to block legacy authentication"
  info        : "Entra ID supports the most widely used authentication and authorization protocols including legacy authentication. This authentication pattern includes basic authentication, a widely used industry-standard method for collecting username and password information.

The following messaging protocols support legacy authentication:

 - Authenticated SMTP - Used to send authenticated email messages.
 - Autodiscover - Used by Outlook and EAS clients to find and connect to mailboxes in Exchange Online.
 - Exchange ActiveSync (EAS) - Used to connect to mailboxes in Exchange Online.
 - Exchange Online PowerShell - Used to connect to Exchange Online with remote PowerShell. If you block Basic authentication for Exchange Online PowerShell, you need to use the Exchange Online PowerShell Module to connect. For instructions, see Connect to Exchange Online PowerShell using multifactor authentication.
 - Exchange Web Services (EWS) - A programming interface that's used by Outlook, Outlook for Mac, and third-party apps.
 - IMAP4 - Used by IMAP email clients.
 - MAPI over HTTP (MAPI/HTTP) - Primary mailbox access protocol used by Outlook 2010 SP2 and later.
 - Offline Address Book (OAB) - A copy of address list collections that are downloaded and used by Outlook.
 - Outlook Anywhere (RPC over HTTP) - Legacy mailbox access protocol supported by all current Outlook versions.
 - POP3 - Used by POP email clients.
 - Reporting Web Services - Used to retrieve report data in Exchange Online.
 - Universal Outlook - Used by the Mail and Calendar app for Windows 10.
 - Other clients - Other protocols identified as utilizing legacy authentication.

Legacy authentication protocols do not support multi-factor authentication. These protocols are often used by attackers because of this deficiency. Blocking legacy authentication makes it harder for attackers to gain access.

Note: Basic authentication is now disabled in all tenants. Before December 31 2022, you could re-enable the affected protocols if users and apps in your tenant couldn't connect. Now no one (you or Microsoft support) can re-enable Basic authentication in your tenant.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click expand Protection > Conditional Access select Policies
 - Create a new policy by selecting New policy
 - Under Users include All users
 - Under Target resources include All resources (formerly 'All cloud apps')
 - Under Conditions select Client apps and check the boxes for Exchange ActiveSync clients and Other clients
 - Under Grant select Block Access
 - Click Select

 - Set the policy On and click Create

Note: Break-glass accounts should be excluded from all Conditional Access policies.

Impact:

Enabling this setting will prevent users from connecting with older versions of Office, ActiveSync or using protocols like IMAP, POP or SMTP and may require upgrades to older versions of Office, and use of mobile mail clients that support modern authentication.

This will also cause multifunction devices such as printers from using scan to e-mail function if they are using a legacy authentication method. Microsoft has mail flow best practices in the link below which can be used to configure a MFP to work with modern authentication:

https://learn.microsoft.com/en-us/exchange/mail-flow-best-practices/how-to-set-up-a-multifunction-device-or-application-to-send-email-using-microsoft-365-or-office-365"
  reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|9.2,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.4 (L1) Ensure Sign-in frequency is enabled and browser sessions are not persistent for Administrative users"
  info        : "In complex deployments, organizations might have a need to restrict authentication sessions. Conditional Access policies allow for the targeting of specific user accounts. Some scenarios might include:

 - Resource access from an unmanaged or shared device
 - Access to sensitive information from an external network
 - High-privileged users
 - Business-critical applications

Note: This CA policy can be added to the previous CA policy in this benchmark \"Ensure multifactor authentication is enabled for all users in administrative roles\"

Forcing a time out for MFA will help ensure that sessions are not kept alive for an indefinite period of time, ensuring that browser sessions are not persistent will help in prevention of drive-by attacks in web browsers, this also prevents creation and saving of session cookies leaving nothing for an attacker to take.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Protection > Conditional Access Select Policies
 - Click New policy
 - Under Users include Select users and groups and check Directory roles
 - At a minimum, include the directory roles listed below in this section of the document.
 - Under Target resources include All resources (formerly 'All cloud apps')
 - Under Grant select Grant Access and check Require multifactor authentication
 - Under Session select Sign-in frequency select Periodic reauthentication and set it to 4 hours (or less).
 - Check Persistent browser session then select Never persistent in the drop-down menu.

 - Under Enable policy set it to Report-only until the organization is ready to enable it.

At minimum these directory roles should be included in the policy:

 - Application administrator
 - Authentication administrator
 - Billing administrator
 - Cloud application administrator
 - Conditional Access administrator
 - Exchange administrator
 - Global administrator
 - Global reader
 - Helpdesk administrator
 - Password administrator
 - Privileged authentication administrator
 - Privileged role administrator
 - Security administrator
 - SharePoint administrator
 - User administrator

Note: Break-glass accounts should be excluded from all Conditional Access policies.

Impact:

Users with Administrative roles will be prompted at the frequency set for MFA."
  reference   : "800-171|3.1.1,800-171|3.1.10,800-171|3.1.11,800-171r3|03.01.01h.,800-171r3|03.01.10,800-171r3|03.01.11,800-53|AC-2(5),800-53|AC-11,800-53|AC-11(1),800-53|AC-12,800-53r5|AC-2(5),800-53r5|AC-11,800-53r5|AC-11(1),800-53r5|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv7|16.3,CSCv8|4.3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iii),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.7.7,ISO-27001-2022|A.8.1,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-2(5),ITSG-33|AC-11,ITSG-33|AC-11(1),ITSG-33|AC-12,LEVEL|1A,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM28,NIAv2|NS5j,NIAv2|NS49,NIAv2|SS14e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.1,TBA-FIISB|37.1.4"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.2.9 (L1) Ensure a managed device is required for authentication"
  info        : "Conditional Access (CA) can be configured to enforce access based on the device's compliance status or whether it is Entra hybrid joined. Collectively this allows CA to classify devices as managed or unmanaged, providing more granular control over authentication policies.

When using Require device to be marked as compliant the device must pass checks configured in Compliance policies defined within Intune (Endpoint Manager). Before these checks can be applied, the device must first be enrolled in Intune MDM.

By selecting Require Microsoft Entra hybrid joined device this means the device must first be synchronized from an on-premises Active Directory to qualify for authentication.

When configured to the recommended state below only one condition needs to be met for the user to authenticate from the device. This functions as an \"OR\" operator.

The recommended state is:

 - Require device to be marked as compliant
 - Require Microsoft Entra hybrid joined device
 - Require one of the selected controls

\"Managed\" devices are considered more secure because they often have additional configuration hardening enforced through centralized management such as Intune or Group Policy. These devices are also typically equipped with MDR/EDR, managed patching and alerting systems. As a result, they provide a safer environment for users to authenticate and operate from.

This policy also ensures that attackers must first gain access to a compliant or trusted device before authentication is permitted, reducing the risk posed by compromised account credentials. When combined with other distinct Conditional Access (CA) policies, such as requiring multi-factor authentication, this adds one additional factor before authentication is permitted.

Note: Avoid combining these two settings with other Grant settings in the same policy. In a single policy you can only choose between Require all the selected controls or Require one of the selected controls which limits the ability to integrate this recommendation with others in this benchmark. CA policies function as an \"AND\" operator across multiple policies. The goal here is to both (Require MFA for all users) AND (Require device to be marked as compliant OR Require Microsoft Entra hybrid joined device).

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click expand Protection > Conditional Access select Policies
 - Create a new policy by selecting New policy
 - Under Users include All users
 - Under Target resources include All resources (formerly 'All cloud apps')
 - Under Grant select Grant access
 - Select only the checkboxes Require device to be marked as compliant and Require Microsoft Entra hybrid joined device
 - Choose Require one of the selected controls and click Select at the bottom.

 - Under Enable policy set it to Report-only until the organization is ready to enable it.
 - Click Create

Note: Guest user accounts, if collaborating with the organization, should be considered when testing this policy.

Impact:

Unmanaged devices will not be permitted as a valid authenticator. As a result this may require the organization to mature their device enrollment and management. The following devices can be considered managed:

 - Entra hybrid joined from Active Directory
 - Entra joined and enrolled in Intune, with compliance policies
 - Entra registered and enrolled in Intune, with compliances policies

If Guest or external users are collaborating with the organization, they must either be excluded or onboarded with a compliant device to authenticate. Failure to adequately survey the environment and test the Conditional Access (CA) policy in the Report-only state could result in access disruptions for these guest users."
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1A,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.3.1 (L1) Ensure Microsoft Authenticator is configured to protect against MFA fatigue"
  info        : "Microsoft provides supporting settings to enhance the configuration of the Microsoft Authenticator application. These settings provide users with additional information and context when they receive MFA passwordless and push requests, including the geographic location of the request, the requesting application, and a requirement for number matching.

Ensure the following are Enabled

 - Require number matching for push notifications
 - Show application name in push and passwordless notifications
 - Show geographic location in push and passwordless notifications

NOTE: On February 27, 2023 Microsoft started enforcing number matching tenant-wide for all users using Microsoft Authenticator.

As the use of strong authentication has become more widespread, attackers have started to exploit the tendency of users to experience \"MFA fatigue.\" This occurs when users are repeatedly asked to provide additional forms of identification, leading them to eventually approve requests without fully verifying the source. To counteract this, number matching can be employed to ensure the security of the authentication process. With this method, users are prompted to confirm a number displayed on their original device and enter it into the device being used for MFA. Additionally, other information such as geolocation and application details are displayed to enhance the end user's awareness. Among these 3 options, number matching provides the strongest net security gain.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to the Microsoft Entra admin center

https://entra.microsoft.com

.
 - Click to expand Protection > Authentication methods select Policies
 - Select Microsoft Authenticator
 - Under Enable and Target ensure the setting is set to Enable
 - Select Configure
 - Set the following Microsoft Authenticator settings:
 - Require number matching for push notifications Status is set to Enabled Target All users
 - Show application name in push and passwordless notifications is set to Enabled Target All users
 - Show geographic location in push and passwordless notifications is set to Enabled Target All users

Note: Valid groups such as break glass accounts can be excluded per organization policy.

Impact:

Additional interaction will be required by end users using number matching as opposed to simply pressing \"Approve\" for login attempts."
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53r5|AC-19,800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CSCv8|6.4,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),LEVEL|1A,NESA|T5.4.2,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "EnableBannedPasswordCheck"
      request        : "listGroupSettings"
      json_transform : '.[] | select(.templateId == "5cf42378-d67d-4f36-ba46-e8b86229381d") | .values[] | select(.name == "EnableBannedPasswordCheck") | "EnableBannedPasswordCheck: \(.value)"'
      expect         : "EnableBannedPasswordCheck: True"
    </custom_item>

    <custom_item>
      description    : "BannedPasswordList"
      request        : "listGroupSettings"
      json_transform : '.[] | select(.templateId == "5cf42378-d67d-4f36-ba46-e8b86229381d") | .values[] | select(.name == "BannedPasswordList") | if (.value == "") then "BannedPasswordList is empty" else "BannedPasswordList has values populated" end'
      expect         : "BannedPasswordList has values populate"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "5.2.3.2 (L1) Ensure custom banned passwords lists are used"
      info        : "With Entra Password Protection, default global banned password lists are automatically applied to all users in an Entra ID tenant. To support business and security needs, custom banned password lists can be defined. When users change or reset their passwords, these banned password lists are checked to enforce the use of strong passwords.

A custom banned password list should include some of the following examples:

 - Brand names
 - Product names
 - Locations, such as company headquarters
 - Company-specific internal terms
 - Abbreviations that have specific company meaning

Creating a new password can be difficult regardless of one's technical background. It is common to look around one's environment for suggestions when building a password, however, this may include picking words specific to the organization as inspiration for a password. An adversary may employ what is called a 'mangler' to create permutations of these specific words in an attempt to crack passwords or hashes making it easier to reach their goal."
      solution    : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

 - Click to expand Protection > Authentication methods
 - Select Password protection
 - Set Enforce custom list to Yes
 - In Custom banned password list create a list using suggestions outlined in this document.
 - Click Save

Note: Below is a list of examples that can be used as a starting place. The references section contains more suggestions.

 - Brand names
 - Product names
 - Locations, such as company headquarters
 - Company-specific internal terms
 - Abbreviations that have specific company meaning

Impact:

If a custom banned password list includes too many common dictionary words, or short words that are part of compound words, then perfectly secure passwords may be blocked. The organization should consider a balance between security and usability when creating a list."
      reference   : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "5.2.3.3 (L1) Ensure password protection is enabled for on-prem Active Directory"
  info        : "Microsoft Entra Password Protection provides a global and custom banned password list. A password change request fails if there's a match in these banned password list. To protect on-premises Active Directory Domain Services (AD DS) environment, install and configure Entra Password Protection.

Note : This recommendation applies to Hybrid deployments only and will have no impact unless working with on-premises Active Directory.

This feature protects an organization by prohibiting the use of weak or leaked passwords. In addition, organizations can create custom banned password lists to prevent their users from using easily guessed passwords that are specific to their industry. Deploying this feature to Active Directory will strengthen the passwords that are used in the environment.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Download and install the Azure AD Password Proxies and DC Agents from the following location:

https://www.microsoft.com/download/details.aspx?id=57071

After installed follow the steps below.

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Protection select Authentication methods
 - Select Password protection and set Enable password protection on Windows Server Active Directory to Yes and Mode to Enforced

Impact:

The potential impact associated with implementation of this setting is dependent upon the existing password policies in place in the environment. For environments that have strong password policies in place, the impact will be minimal. For organizations that do not have strong password policies in place, implementation of Microsoft Entra Password Protection may require users to change passwords and adhere to more stringent requirements than they have been accustomed to."
  reference   : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "5.2.3.4 (L1) Ensure all member users are 'MFA capable'"
  info           : "Microsoft defines Multifactor authentication capable as being registered and enabled for a strong authentication method. The method must also be allowed by the authentication methods policy.

Ensure all member users are MFA capable

Multifactor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted.

Users who are not MFA Capable have never registered a strong authentication method for multifactor authentication that is within policy and may not be using MFA. This could be a result of having never signed in, exclusion from a Conditional Access (CA) policy requiring MFA, or a CA policy does not exist. Reviewing this list of users will help identify possible lapses in policy or procedure.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution       : "Remediation steps will depend on the status of the personnel in question or configuration of Conditional Access policies and will not be covered in detail. Administrators should review each user identified on a case-by-case basis using the conditions below.

User has never signed on:

 - Employment status should be reviewed, and appropriate action taken on the user account's roles, licensing and enablement.

Conditional Access policy applicability:

 - Ensure a CA policy is in place requiring all users to use MFA.
 - Ensure the user is not excluded from the CA MFA policy.
 - Ensure the policy's state is set to On
 - Use What if to determine applicable CA policies. (Protection > Conditional Access > Policies)
 - Review the user account in Sign-in logs Under the Activity Details pane click the Conditional Access tab to view applied policies.

Note: Conditional Access is covered step by step in section 5.2.2

Impact:

When using the UI audit method guest users will appear in the report and unless the organization is applying MFA rules to guests then they will need to be manually filtered. Accounts that provide on-premises directory synchronization also appear in these reports."
  reference      : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv7|16.3,CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1A,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getMgReportAuthenticationMethodUserRegistrationDetail"
  json_transform : '.[] | "User Display Name: \(.userDisplayName), User Principal Name: \(.userPrincipalName), IsMfaCapable: \(.isMfaCapable), IsAdmin: \(.isAdmin)"'
  regex          : ".+"
  expect         : "^Manual Review Required$"
  severity       : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "SMS"
      request        : "getMgBetaPolicyAuthenticationMethodPolicy"
      json_transform : '.authenticationMethodConfigurations[] | select(.id == "Sms") | "SMS: \(.state)"'
      expect         : "SMS: disabled"
    </custom_item>

    <custom_item>
      description    : "Voice call"
      request        : "getMgBetaPolicyAuthenticationMethodPolicy"
      json_transform : '.authenticationMethodConfigurations[] | select(.id == "Voice") | "Voice call: \(.state)"'
      expect         : "Voice call: disabled"
    </custom_item>

    <custom_item>
      description    : "Email OTP"
      request        : "getMgBetaPolicyAuthenticationMethodPolicy"
      json_transform : '.authenticationMethodConfigurations[] | select(.id == "Email") | "Email OTP: \(.state)"'
      expect         : "Email OTP: disabled"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "5.2.3.5 (L1) Ensure weak authentication methods are disabled"
      info        : "Authentication methods support a wide variety of scenarios for signing in to Microsoft 365 resources. Some of these methods are inherently more secure than others but require more investment in time to get users enrolled and operational.

SMS and Voice Call rely on telephony carrier communication methods to deliver the authenticating factor.

The email one-time passcode feature is a way to authenticate B2B collaboration users when they can't be authenticated through other means, such as Microsoft Entra ID, Microsoft account (MSA), or social identity providers. When a B2B guest user tries to redeem your invitation or sign in to your shared resources, they can request a temporary passcode, which is sent to their email address. Then they enter this passcode to continue signing in.

The recommended state is to Disable these methods:

 - SMS
 - Voice Call
 - Email OTP

The SMS and Voice call methods are vulnerable to SIM swapping which could allow an attacker to gain access to your Microsoft 365 account."
      solution    : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Protection select Authentication methods
 - Select Policies
 - Inspect each method that is out of compliance and remediate:
 - Click on the method to open it.
 - Change the Enable toggle to the off position.
 - Click Save

Note: If the save button remains greyed out after toggling a method off, then first turn it back on and then change the position of the Target selection (all users or select groups). Turn the method off again and save. This was observed to be a bug in the UI at the time this document was published.

To remediate using Powershell:

 - Connect to Graph using Connect-MgGraph -Scopes \"Policy.ReadWrite.AuthenticationMethod\"
 - Run the following to disable all three authentication methods:

$params = @(
@{ Id = \"Sms\"; State = \"disabled\" },
@{ Id = \"Voice\"; State = \"disabled\" },
@{ Id = \"Email\"; State = \"disabled\" }
)

Update-MgPolicyAuthenticationMethodPolicy -AuthenticationMethodConfigurations $params

Impact:

Disabling Email OTP will prevent one-time pass codes from being sent to unverified guest users accessing Microsoft 365 resources on the tenant such as \"@yahoo.com\". They will be required to use a personal Microsoft account, a managed Microsoft Entra account, be part of a federation or be configured as a guest in the host tenant's Microsoft Entra ID."
      reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1A,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "5.2.3.6 (L1) Ensure system-preferred multifactor authentication is enabled"
  info        : "System-preferred multifactor authentication (MFA) prompts users to sign in by using the most secure method they registered.

The user is prompted to sign-in with the most secure method according to the below order. The order of authentication methods is dynamic. It's updated by Microsoft as the security landscape changes, and as better authentication methods emerge.

 - Temporary Access Pass
 - Passkey (FIDO2)
 - Microsoft Authenticator notifications
 - External authentication methods
 - Time-based one-time password (TOTP)
 - Telephony
 - Certificate-based authentication

The recommended state is Enabled

Regardless of the authentication method enabled by an administrator or set as preferred by the user, the system will dynamically select the most secure option available at the time of authentication. This approach acts as an additional safeguard to prevent the use of weaker methods, such as voice calls, SMS, and email OTPs, which may have been inadvertently left enabled due to misconfiguration or lack of configuration hardening.

Enforcing the default behavior also ensures the feature is not disabled.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Protection select Authentication methods
 - Select Settings
 - Set the System-preferred multifactor authentication State to Enabled and include All users
 - Any users exclusions should be documented and reviewed annually.

Impact:

The Microsoft managed value of system-preferred MFA is Enabled and as such enforces the default behavior. No additional impact is expected.

Note: Due to known issues with certificate-based authentication (CBA) and system-preferred MFA, Microsoft moved CBA to the bottom of the list. It is still considered a strong authentication method."
  reference   : "800-171|3.5.3,800-171r3|03.05.03,800-53|IA-2(1),800-53|IA-2(2),800-53r5|IA-2(1),800-53r5|IA-2(2),CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSCv8|6.3,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ITSG-33|IA-2(1),ITSG-33|IA-2(2),LEVEL|1M,NESA|T5.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "5.2.4.1 (L1) Ensure 'Self service password reset enabled' is set to 'All'"
  info        : "Enabling self-service password reset allows users to reset their own passwords in Entra ID. When users sign in to Microsoft 365, they will be prompted to enter additional contact information that will help them reset their password in the future. If combined registration is enabled additional information, outside of multi-factor, will not be needed.

Note: Effective Oct. 1st, 2022, Microsoft will begin to enable combined registration for all users in Entra ID tenants created before August 15th, 2020. Tenants created after this date are enabled with combined registration by default.

Users will no longer need to engage the helpdesk for password resets, and the password reset mechanism will automatically block common, easily guessable passwords.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Entra admin center

https://entra.microsoft.com/

.
 - Click to expand Protection > Password reset select Properties
 - Set Self service password reset enabled to All

Impact:

Users will be required to provide additional contact information to enroll in self-service password reset. Additionally, minor user education may be required for users that are used to calling a help desk for assistance with password resets.

Note: This is unavailable if using Entra Connect / Sync in a hybrid environment."
  reference   : "800-171r3|03.05.01b.,800-53|IA-11,800-53r5|IA-11,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),LEVEL|1M,QCSC-v1|13.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "6.1.1 (L1) Ensure 'AuditDisabled' organizationally is set to 'False'"
  info           : "The value False indicates that mailbox auditing on by default is turned on for the organization. Mailbox auditing on by default in the organization overrides the mailbox auditing settings on individual mailboxes. For example, if mailbox auditing is turned off for a mailbox (the AuditEnabled property on the mailbox is False), the default mailbox actions are still audited for the mailbox, because mailbox auditing on by default is turned on for the organization.

Turning off mailbox auditing on by default ($true) has the following results:

 - Mailbox auditing is turned off for your organization.
 - From the time you turn off mailbox auditing on by default, no mailbox actions are audited, even if mailbox auditing is enabled on a mailbox (the AuditEnabled property on the mailbox is True).
 - Mailbox auditing isn't turned on for new mailboxes and setting the AuditEnabled property on a new or existing mailbox to True is ignored.
 - Any mailbox audit bypass association settings (configured by using the Set-MailboxAuditBypassAssociation cmdlet) are ignored.
 - Existing mailbox audit records are retained until the audit log age limit for the record expires.

The recommended state for this setting is False at the organization level. This will enable auditing and enforce the default.

Enforcing the default ensures auditing was not turned off intentionally or accidentally. Auditing mailbox actions will allow forensics and IR teams to trace various malicious activities that can generate TTPs caused by inbox access and tampering.

Note: Without advanced auditing (E5 function) the logs are limited to 90 days."
  solution       : "To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-OrganizationConfig -AuditDisabled $false

Impact:

None - this is the default behavior as of 2019."
  reference      : "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171r3|03.03.01,800-171r3|03.03.03,800-171r3|03.03.06a.,800-53|AU-2,800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(a),CSCv7|6.2,CSCv8|8.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.15,ITSG-33|AU-2,ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getOrganizationConfig"
  json_transform : '.[] | "AuditDisabled: \(.AuditDisabled)"'
  regex          : "AuditDisabled:"
  expect         : "AuditDisabled: false"
</custom_item>

<custom_item>
  type        : POLICY
  description : "6.1.2 (L1) Ensure mailbox audit actions are configured"
  info        : "Mailbox audit logging is turned on by default in all organizations. This effort started in January 2019, and means that certain actions performed by mailbox owners, delegates, and admins are automatically logged. The corresponding mailbox audit records are available for admins to search in the mailbox audit log.

Mailboxes and shared mailboxes have actions assigned to them individually in order to audit the data the organization determines valuable at the mailbox level.

The recommended state per mailbox is AuditEnabled to True including all default audit actions with additional actions outlined below in the audit and remediation sections.

Note: Audit (Standard) licensing allows for up to 180 days log retention as of October 2023.

Whether it is for regulatory compliance or for tracking unauthorized configuration changes in Microsoft 365, enabling mailbox auditing and ensuring the proper mailbox actions are accounted for allows for Microsoft 365 teams to run security operations, forensics or general investigations on mailbox activities.

The following mailbox types ignore the organizational default and must have AuditEnabled set to True at the mailbox level in order to capture relevant audit data.

 - Resource Mailboxes
 - Public Folder Mailboxes
 - DiscoverySearch Mailbox"
  solution    : "For each UserMailbox ensure AuditEnabled is True and the following audit actions are included

in addition

to default actions of each sign-in type.

 - Admin actions: Copy FolderBind and Move
 - Delegate actions: FolderBind and Move
 - Owner actions: Create MailboxLogin and Move

Note: The defaults can be found in the Default Value section and the combined total can be found in the scripts of the Audit/Remediation sections.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell script to remediate every 'UserMailbox' in the organization:

$AuditAdmin = @(
    \"ApplyRecord\", \"Copy\", \"Create\", \"FolderBind\", \"HardDelete\",
    \"MailItemsAccessed\", \"Move\", \"MoveToDeletedItems\", \"SendAs\",
    \"SendOnBehalf\", \"Send\", \"SoftDelete\", \"Update\", \"UpdateCalendarDelegation\",
    \"UpdateFolderPermissions\", \"UpdateInboxRules\"
)

$AuditDelegate = @(
    \"ApplyRecord\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",
    \"MailItemsAccessed\", \"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\",
    \"SoftDelete\", \"Update\", \"UpdateFolderPermissions\", \"UpdateInboxRules\"
)

$AuditOwner = @(
    \"ApplyRecord\", \"Create\", \"HardDelete\", \"MailboxLogin\", \"Move\",
    \"MailItemsAccessed\", \"MoveToDeletedItems\", \"Send\", \"SoftDelete\", \"Update\",
    \"UpdateCalendarDelegation\", \"UpdateFolderPermissions\", \"UpdateInboxRules\"
)

$MBX = Get-EXOMailbox -ResultSize Unlimited | Where-Object { $_.RecipientTypeDetails -eq \"UserMailbox\" }
$MBX | Set-Mailbox -AuditEnabled $true `
-AuditLogAgeLimit 180 -AuditAdmin $AuditAdmin -AuditDelegate $AuditDelegate `
-AuditOwner $AuditOwner <xhtml:ol start=\"3\"> - The script will apply the prescribed Audit Actions for each sign-in type (Owner, Delegate, Admin) and the AuditLogAgeLimit to each UserMailbox in the organization.

Note: Mailboxes with Audit (Premium) licenses, which is included with E5, can retain audit logs beyond 180 days.

Impact:

Adding additional audit action types and increasing the AuditLogAgeLimit from 90 to 180 days will have a limited impact on mailbox storage. Mailbox audit log records are stored in a subfolder (named Audits) in the Recoverable Items folder in each user's mailbox.

 - Mailbox audit records count against the storage quota of the Recoverable Items folder.
 - Mailbox audit records also count against the folder limit for the Recoverable Items folder. A maximum of 3 million items (audit records) can be stored in the Audits subfolder.

The following cmdlet in Exchange Online PowerShell can be run to display the size and number of items in the Audits subfolder in the Recoverable Items folder:

Get-MailboxFolderStatistics -Identity <MailboxIdentity> -FolderScope RecoverableItems |
  Where-Object {$_.Name -eq 'Audits'} | Format-List FolderPath,FolderSize,ItemsInFolder

Note: It's unlikely that mailbox auditing on by default impacts the storage quota or the folder limit for the Recoverable Items folder."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171r3|03.03.01,800-171r3|03.03.03,800-171r3|03.03.06a.,800-53|AU-2,800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(a),CSCv7|6.2,CSCv8|8.2,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.8.15,ITSG-33|AU-2,ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
  name        : "M365_Mailbox_Audit_E5"
</custom_item>

<report type:"WARNING">
  description : "6.1.3 (L1) Ensure 'AuditBypassEnabled' is not enabled on mailboxes"
  info        : "When configuring a user or computer account to bypass mailbox audit logging, the system will not record any access, or actions performed by the said user or computer account on any mailbox. Administratively this was introduced to reduce the volume of entries in the mailbox audit logs on trusted user or computer accounts.

Ensure AuditBypassEnabled is not enabled on accounts without a written exception.

If a mailbox audit bypass association is added for an account, the account can access any mailbox in the organization to which it has been assigned access permissions, without generating any mailbox audit logging entries for such access or recording any actions taken, such as message deletions.

Enabling this parameter, whether intentionally or unintentionally, could allow insiders or malicious actors to conceal their activity on specific mailboxes. Ensuring proper logging of user actions and mailbox operations in the audit log will enable comprehensive incident response and forensics.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - The following example PowerShell script will disable AuditBypass for all mailboxes which currently have it enabled:

# Get mailboxes with AuditBypassEnabled set to $true
$MBXAudit = Get-MailboxAuditBypassAssociation -ResultSize unlimited | Where-Object { $_.AuditBypassEnabled -eq $true }

foreach ($mailbox in $MBXAudit) {
    $mailboxName = $mailbox.Name
    Set-MailboxAuditBypassAssociation -Identity $mailboxName -AuditBypassEnabled $false
    Write-Host \"Audit Bypass disabled for mailbox Identity: $mailboxName\" -ForegroundColor Green
}

Impact:

None - this is the default behavior."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171r3|03.03.02a.,800-171r3|03.03.02b.,800-171r3|03.03.03,800-171r3|03.03.06a.,800-53|AU-3,800-53|AU-3(1),800-53|AU-7,800-53|AU-12,800-53r5|AU-3,800-53r5|AU-3(1),800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.2.3(c),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|8.1.4.3(b),CSCv8|8.5,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.28,ISO-27001-2022|A.8.15,ITSG-33|AU-3,ITSG-33|AU-3(1),ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|1A,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<if>
  <condition type:"AND">
    <custom_item>
      description    : "rules found"
      request        : "getTransportRule"
      json_transform : '.[] | "RedirectMessageTo: \(.RedirectMessageTo)"'
      regex          : ".+"
      expect         : ".+"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition auto:"WARNING" type:"AND">
        <custom_item>
          description    : "Transport Rules"
          request        : "getTransportRule"
          json_transform : '.[] | "RedirectMessageTo: \(.RedirectMessageTo)"'
          regex          : "RedirectMessageTo:"
          expect         : "^Manual Review Required$"
          severity       : MEDIUM
        </custom_item>

        <custom_item>
          description    : "Forwarding Mode"
          request        : "getHostedOutboundSpamFilterPolicy"
          json_transform : '.[] | if (.Identity == "@OUTBOUND_SPAM_POLICY_IDENTITY@") then "Identity: \(.Identity), AutoForwardingMode: \(.AutoForwardingMode)" else "Policy @OUTBOUND_SPAM_POLICY_IDENTITY@ not found" end'
          regex          : "Identity: @OUTBOUND_SPAM_POLICY_IDENTITY@"
          expect         : "AutoForwardingMode: Off"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "6.2.1 (L1) Ensure all forms of mail forwarding are blocked and/or disabled"
          info        : "Exchange Online offers several methods of managing the flow of email messages. These are Remote domain, Transport Rules, and Anti-spam outbound policies. These methods work together to provide comprehensive coverage for potential automatic forwarding channels:

 - Outlook forwarding using inbox rules.
 - Outlook forwarding configured using OOF rule.
 - OWA forwarding setting (ForwardingSmtpAddress).
 - Forwarding set by the admin using EAC (ForwardingAddress).
 - Forwarding using Power Automate / Flow.

Ensure a Transport rule and Anti-spam outbound policy are used to block mail forwarding.

NOTE: Any exclusions should be implemented based on organizational policy.

Attackers often create these rules to exfiltrate data from your tenancy, this could be accomplished via access to an end-user account or otherwise. An insider could also use one of these methods as a secondary channel to exfiltrate sensitive data.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Note:

Remediation is a two step procedure as follows:

STEP 1: Transport rules

To remediate using the UI:

 - Select Exchange to open the Exchange admin center.
 - Select Mail Flow then Rules
 - For each rule that redirects email to external domains, select the rule and click the 'Delete' icon.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Remove-TransportRule {RuleName}

STEP 2: Anti-spam outbound policy

To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com/

 - Expand E-mail & collaboration then select Policies & rules
 - Select Threat policies > Anti-spam
 - Select Anti-spam outbound policy (default)
 - Click Edit protection settings
 - Set Automatic forwarding rules dropdown to Off - Forwarding is disabled and click Save
 - Repeat steps 4-6 for any additional higher priority, custom policies.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-HostedOutboundSpamFilterPolicy -Identity {policyName} -AutoForwardingMode Off <xhtml:ol start=\"3\"> - To remove AutoForwarding from all outbound policies you can also run:

Get-HostedOutboundSpamFilterPolicy | Set-HostedOutboundSpamFilterPolicy -AutoForwardingMode Off

Impact:

Care should be taken before implementation to ensure there is no business need for case-by-case auto-forwarding. Disabling auto-forwarding to remote domains will affect all users and in an organization. Any exclusions should be implemented based on organizational policy."
          reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
          see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
          show_output : YES
        </report>
      </then>
    </if>
  </then>

  <else>
    <custom_item>
      description    : "6.2.1 (L1) Ensure all forms of mail forwarding are blocked and/or disabled"
      info           : "Exchange Online offers several methods of managing the flow of email messages. These are Remote domain, Transport Rules, and Anti-spam outbound policies. These methods work together to provide comprehensive coverage for potential automatic forwarding channels:

 - Outlook forwarding using inbox rules.
 - Outlook forwarding configured using OOF rule.
 - OWA forwarding setting (ForwardingSmtpAddress).
 - Forwarding set by the admin using EAC (ForwardingAddress).
 - Forwarding using Power Automate / Flow.

Ensure a Transport rule and Anti-spam outbound policy are used to block mail forwarding.

NOTE: Any exclusions should be implemented based on organizational policy.

Attackers often create these rules to exfiltrate data from your tenancy, this could be accomplished via access to an end-user account or otherwise. An insider could also use one of these methods as a secondary channel to exfiltrate sensitive data."
      solution       : "Note:

Remediation is a two step procedure as follows:

STEP 1: Transport rules

To remediate using the UI:

 - Select Exchange to open the Exchange admin center.
 - Select Mail Flow then Rules
 - For each rule that redirects email to external domains, select the rule and click the 'Delete' icon.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Remove-TransportRule {RuleName}

STEP 2: Anti-spam outbound policy

To remediate using the UI:

 - Navigate to Microsoft 365 Defender

https://security.microsoft.com/

 - Expand E-mail & collaboration then select Policies & rules
 - Select Threat policies > Anti-spam
 - Select Anti-spam outbound policy (default)
 - Click Edit protection settings
 - Set Automatic forwarding rules dropdown to Off - Forwarding is disabled and click Save
 - Repeat steps 4-6 for any additional higher priority, custom policies.

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-HostedOutboundSpamFilterPolicy -Identity {policyName} -AutoForwardingMode Off <xhtml:ol start=\"3\"> - To remove AutoForwarding from all outbound policies you can also run:

Get-HostedOutboundSpamFilterPolicy | Set-HostedOutboundSpamFilterPolicy -AutoForwardingMode Off

Impact:

Care should be taken before implementation to ensure there is no business need for case-by-case auto-forwarding. Disabling auto-forwarding to remote domains will affect all users and in an organization. Any exclusions should be implemented based on organizational policy."
      reference      : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
      request        : "getHostedOutboundSpamFilterPolicy"
      json_transform : '.[] | if (.Identity == "@OUTBOUND_SPAM_POLICY_IDENTITY@") then "Identity: \(.Identity), AutoForwardingMode: \(.AutoForwardingMode)" else "Policy @OUTBOUND_SPAM_POLICY_IDENTITY@ not found" end'
      regex          : "Identity: @OUTBOUND_SPAM_POLICY_IDENTITY@"
      expect         : "AutoForwardingMode: Off"
    </custom_item>
  </else>
</if>

<custom_item>
  description    : "6.2.2 (L1) Ensure mail transport rules do not whitelist specific domains"
  info           : "Mail flow rules (transport rules) in Exchange Online are used to identify and take action on messages that flow through the organization.

Whitelisting domains in transport rules bypasses regular malware and phishing scanning, which can enable an attacker to launch attacks against your users from a safe haven domain.

Note: If an organization identifies a business need for an exception, the domain should only be whitelisted if inbound emails from that domain originate from a specific IP address. These exceptions should be documented and regularly reviewed."
  solution       : "To remediate using the UI:

 - Navigate to Exchange admin center

https://admin.exchange.microsoft.com

..
 - Click to expand Mail Flow and then select Rules
 - For each rule that sets the spam confidence level to -1 for a specific domain, select the rule and click Delete

To remediate using PowerShell:

 - Connect to Exchange online using Connect-ExchangeOnline
 - To modify the rule:

Remove-TransportRule {RuleName} <xhtml:ol start=\"3\"> - Verify the rules no longer exists by re-running the audit procedure.

Impact:

Care should be taken before implementation to ensure there is no business need for case-by-case whitelisting. Removing all whitelisted domains could affect incoming mail flow to an organization although modern systems sending legitimate mail should have no issue with this."
  reference      : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-171r3|03.14.02,800-53|SI-3,800-53|SI-8,800-53|SI-16,800-53r5|SI-3,800-53r5|SI-8,800-53r5|SI-16,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv8|9.7,CSF|DE.CM-4,CSF|DE.DP-3,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.7,ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-8,ITSG-33|SI-16,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getTransportRule"
  json_transform : 'if (.[] | length) == 0 or (.[].SenderDomainIs[] | length) == 0 then "No rules, or no rules with domains, were found" else (.[] | .Identity as $Identity | .SetSCL as $SetSCL | .SenderDomainIs[] | . as $domain | "Identity: \($Identity), SetSCL: \($SetSCL), Domain: \($domain)") end'
  regex          : ".*"
  not_expect     : "SetSCL: -1, Domain: [^#\n\r\s]+"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      description    : "Enabled, allowlist"
      request        : "getExternalInOutlook"
      json_transform : '.[] | if (.AllowList[] | length) == 0 then "Identity: \(.Identity), Enabled: \(.Enabled), No AllowList specified" else (.Identity as $Identity | .Enabled as $Enabled | .AllowList[] | . as $Allowed | "Identity: \($Identity), Enabled: \($Enabled), Allowed: \($Allowed)") end'
      regex          : ".+"
      expect         : "Enabled: true, Allowed:"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      description    : "6.2.3 (L1) Ensure email from external senders is identified"
      info           : "External callouts provide a native experience to identify emails from senders outside the organization. This is achieved by presenting a new tag on emails called \"External\" (the string is localized based on the client language setting) and exposing related user interface at the top of the message reading view to see and verify the real sender's email address.

The recommended state is ExternalInOutlook set to Enabled True

Tagging emails from external senders helps to inform end users about the origin of the email. This can allow them to proceed with more caution and make informed decisions when it comes to identifying spam or phishing emails.

Mail flow rules are often used by Exchange administrators to accomplish the External email tagging by appending a tag to the front of a subject line. There are limitations to this outlined

here.

The preferred method in the CIS Benchmark is to use the native experience.

Note: Existing emails in a user's inbox from external senders are not tagged retroactively.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution       : "To remediate using PowerShell:

 - Connect to Exchange online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-ExternalInOutlook -Enabled $true

Impact:

Mail flow rules using external tagging must be disabled, along with third-party mail filtering tools that offer similar features, to avoid duplicate [External] tags.

External tags can consume additional screen space on systems with limited real estate, such as thin clients or mobile devices.

After enabling this feature via PowerShell, it may take 24-48 hours for users to see the External sender tag in emails from outside your organization. Rolling back the feature takes the same amount of time.

Note: Third-party tools that provide similar functionality will also meet compliance requirements, although Microsoft recommends using the native experience for better interoperability."
      reference      : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
      request        : "getExternalInOutlook"
      json_transform : '.[] | if (.AllowList[] | length) == 0 then "Identity: \(.Identity), Enabled: \(.Enabled), No AllowList specified" else (.Identity as $Identity | .Enabled as $Enabled | .AllowList[] | . as $Allowed | "Identity: \($Identity), Enabled: \($Enabled), Allowed: \($Allowed)") end'
      regex          : ".+"
      expect         : "^Manual Review Required$"
      severity       : MEDIUM
    </custom_item>
  </then>

  <else>
    <custom_item>
      description    : "6.2.3 (L1) Ensure email from external senders is identified"
      info           : "External callouts provide a native experience to identify emails from senders outside the organization. This is achieved by presenting a new tag on emails called \"External\" (the string is localized based on the client language setting) and exposing related user interface at the top of the message reading view to see and verify the real sender's email address.

The recommended state is ExternalInOutlook set to Enabled True

Tagging emails from external senders helps to inform end users about the origin of the email. This can allow them to proceed with more caution and make informed decisions when it comes to identifying spam or phishing emails.

Mail flow rules are often used by Exchange administrators to accomplish the External email tagging by appending a tag to the front of a subject line. There are limitations to this outlined

here.

The preferred method in the CIS Benchmark is to use the native experience.

Note: Existing emails in a user's inbox from external senders are not tagged retroactively."
      solution       : "To remediate using PowerShell:

 - Connect to Exchange online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-ExternalInOutlook -Enabled $true

Impact:

Mail flow rules using external tagging must be disabled, along with third-party mail filtering tools that offer similar features, to avoid duplicate [External] tags.

External tags can consume additional screen space on systems with limited real estate, such as thin clients or mobile devices.

After enabling this feature via PowerShell, it may take 24-48 hours for users to see the External sender tag in emails from outside your organization. Rolling back the feature takes the same amount of time.

Note: Third-party tools that provide similar functionality will also meet compliance requirements, although Microsoft recommends using the native experience for better interoperability."
      reference      : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
      request        : "getExternalInOutlook"
      json_transform : '.[] | "Identity: \(.Identity), Enabled: \(.Enabled)"'
      regex          : "Identity:"
      expect         : "Enabled: true"
    </custom_item>
  </else>
</if>

<custom_item>
  description    : "6.5.1 (L1) Ensure modern authentication for Exchange Online is enabled"
  info           : "Modern authentication in Microsoft 365 enables authentication features like multifactor authentication (MFA) using smart cards, certificate-based authentication (CBA), and third-party SAML identity providers. When you enable modern authentication in Exchange Online, Outlook 2016 and Outlook 2013 use modern authentication to log in to Microsoft 365 mailboxes. When you disable modern authentication in Exchange Online, Outlook 2016 and Outlook 2013 use basic authentication to log in to Microsoft 365 mailboxes.

When users initially configure certain email clients, like Outlook 2013 and Outlook 2016, they may be required to authenticate using enhanced authentication mechanisms, such as multifactor authentication. Other Outlook clients that are available in Microsoft 365 (for example, Outlook Mobile and Outlook for Mac 2016) always use modern authentication to log in to Microsoft 365 mailboxes.

Strong authentication controls, such as the use of multifactor authentication, may be circumvented if basic authentication is used by Exchange Online email clients such as Outlook 2016 and Outlook 2013. Enabling modern authentication for Exchange Online ensures strong authentication mechanisms are used when establishing sessions between email clients and Exchange Online."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft 365 admin center

https://admin.microsoft.com

.
 - Click to expand Settings select Org Settings
 - Select Modern authentication
 - Check Turn on modern authentication for Outlook 2013 for Windows and later (recommended) to enable modern authentication.

To remediate using PowerShell:

 - Run the Microsoft Exchange Online PowerShell Module.
 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-OrganizationConfig -OAuth2ClientProfileEnabled $True

Impact:

Users of older email clients, such as Outlook 2013 and Outlook 2016, will no longer be able to authenticate to Exchange using Basic Authentication, which will necessitate migration to modern authentication practices."
  reference      : "800-171|3.1.13,800-171|3.5.2,800-171|3.13.8,800-171r3|03.05.07,800-171r3|03.05.12,800-171r3|03.13.08,800-53|AC-17(2),800-53|IA-5,800-53|IA-5(1),800-53|SC-8,800-53|SC-8(1),800-53r5|AC-17(2),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|SC-8,800-53r5|SC-8(1),CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSCv7|16.3,CSCv7|16.5,CSCv8|3.10,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO-27001-2022|A.5.33,ISO-27001-2022|A.6.7,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(1),LEVEL|1A,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.2.3,NESA|T5.4.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS5d,NIAv2|NS6b,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|29.1"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getOrganizationConfig"
  json_transform : '.[] |  "OAuth2ClientProfileEnabled: \(.OAuth2ClientProfileEnabled)"'
  regex          : "OAuth2ClientProfileEnabled:"
  expect         : "OAuth2ClientProfileEnabled: true"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "MailTipsAllTipsEnabled"
      request        : "getOrganizationConfig"
      json_transform : '.[] |  "MailTipsAllTipsEnabled: \(.MailTipsAllTipsEnabled)"'
      regex          : "MailTipsAllTipsEnabled:"
      expect         : "MailTipsAllTipsEnabled: true"
    </custom_item>

    <custom_item>
      description    : "MailTipsExternalRecipientsTipsEnabled"
      request        : "getOrganizationConfig"
      json_transform : '.[] |  "MailTipsExternalRecipientsTipsEnabled: \(.MailTipsExternalRecipientsTipsEnabled)"'
      regex          : "MailTipsExternalRecipientsTipsEnabled:"
      expect         : "MailTipsExternalRecipientsTipsEnabled: true"
    </custom_item>

    <custom_item>
      description    : "MailTipsGroupMetricsEnabled"
      request        : "getOrganizationConfig"
      json_transform : '.[] |  "MailTipsGroupMetricsEnabled: \(.MailTipsGroupMetricsEnabled)"'
      regex          : "MailTipsGroupMetricsEnabled:"
      expect         : "MailTipsGroupMetricsEnabled: true"
    </custom_item>

    <custom_item>
      description    : "MailTipsLargeAudienceThreshold"
      request        : "getOrganizationConfig"
      json_transform : '.[] |  "MailTipsLargeAudienceThreshold: \(.MailTipsLargeAudienceThreshold)"'
      regex          : "MailTipsLargeAudienceThreshold:"
      expect         : "MailTipsLargeAudienceThreshold: @MAILTIPS_LARGE_THRESHOLD@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "6.5.2 (L1) Ensure MailTips are enabled for end users"
      info        : "MailTips are informative messages displayed to users while they're composing a message. While a new message is open and being composed, Exchange analyzes the message (including recipients). If a potential problem is detected, the user is notified with a MailTip prior to sending the message. Using the information in the MailTip, the user can adjust the message to avoid undesirable situations or non-delivery reports (also known as NDRs or bounce messages).

Setting up MailTips gives a visual aid to users when they send emails to large groups of recipients or send emails to recipients not within the tenant."
      solution    : "To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

$TipsParams = @{
    MailTipsAllTipsEnabled = $true
    MailTipsExternalRecipientsTipsEnabled = $true
    MailTipsGroupMetricsEnabled = $true
    MailTipsLargeAudienceThreshold = '25'
}

Set-OrganizationConfig @TipsParams

Impact:

Not applicable."
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description    : "6.5.4 (L1) Ensure SMTP AUTH is disabled"
  info           : "This setting enables or disables authenticated client SMTP submission (SMTP AUTH) at an organization level in Exchange Online.

The recommended state is Turn off SMTP AUTH protocol for your organization (checked).

SMTP AUTH is a legacy protocol. Disabling it at the organization level supports the principle of least functionality and serves to further back additional controls that block legacy protocols, such as in Conditional Access. Virtually all modern email clients that connect to Exchange Online mailboxes in Microsoft 365 can do so without using SMTP AUTH."
  solution       : "To remediate using the UI:

 - Navigate to Exchange admin center

https://admin.exchange.microsoft.com

.
 - Select Settings > Mail flow
 - Uncheck Turn off SMTP AUTH protocol for your organization

To remediate using PowerShell:

 - Connect to Exchange Online using Connect-ExchangeOnline
 - Run the following PowerShell command:

Set-TransportConfig -SmtpClientAuthenticationDisabled $true

Impact:

This enforces the default behavior, so no impact is expected unless the organization is using it globally. A per-mailbox setting exists that overrides the tenant-wide setting, allowing an individual mailbox SMTP AUTH capability for special cases."
  reference      : "800-171|3.1.16,800-171|3.13.15,800-171r3|03.01.16,800-171r3|03.13.15,800-53|AC-18,800-53|SC-23,800-53r5|AC-18,800-53r5|SC-23,CSCv8|12.6,CSF|PR.PT-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.20,ITSG-33|AC-18,ITSG-33|SC-23,ITSG-33|SC-23a.,LEVEL|1A,NESA|T4.5.1,QCSC-v1|5.2.1,SWIFT-CSCv1|2.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getTransportConfig"
  json_transform : '.[] |  "SmtpClientAuthenticationDisabled: \(.SmtpClientAuthenticationDisabled)"'
  regex          : "SmtpClientAuthenticationDisabled:"
  expect         : "SmtpClientAuthenticationDisabled: true"
</custom_item>

<custom_item>
  description    : "7.2.1 (L1) Ensure modern authentication for SharePoint applications is required"
  info           : "Modern authentication in Microsoft 365 enables authentication features like multifactor authentication (MFA) using smart cards, certificate-based authentication (CBA), and third-party SAML identity providers.

Strong authentication controls, such as the use of multifactor authentication, may be circumvented if basic authentication is used by SharePoint applications. Requiring modern authentication for SharePoint applications ensures strong authentication mechanisms are used when establishing sessions between these applications, SharePoint, and connecting users."
  solution       : "To remediate using the UI:

 - Navigate to SharePoint admin center

https://admin.microsoft.com/sharepoint

.
 - Click to expand Policies select Access control
 - Select Apps that don't use modern authentication
 - Select the radio button for Block access
 - Click Save

To remediate using PowerShell:

 - Connect to SharePoint Online using Connect-SPOService -Url https://tenant-admin.sharepoint.com replacing tenant with your value.
 - Run the following SharePoint Online PowerShell command:

Set-SPOTenant -LegacyAuthProtocolsEnabled $false

Impact:

Implementation of modern authentication for SharePoint will require users to authenticate to SharePoint using modern authentication. This may cause a minor impact to typical user behavior.

This may also prevent third-party apps from accessing SharePoint Online resources. Also, this will also block apps using the SharePointOnlineCredentials class to access SharePoint Online resources."
  reference      : "800-171|3.1.13,800-171|3.5.2,800-171|3.13.8,800-171r3|03.05.07,800-171r3|03.05.12,800-171r3|03.13.08,800-53|AC-17(2),800-53|IA-5,800-53|IA-5(1),800-53|SC-8,800-53|SC-8(1),800-53r5|AC-17(2),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|SC-8,800-53r5|SC-8(1),CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSCv7|16.3,CSCv8|3.10,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO-27001-2022|A.5.33,ISO-27001-2022|A.6.7,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(1),LEVEL|1A,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.2.3,NESA|T5.4.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS5d,NIAv2|NS6b,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|29.1"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "listSharePointTenantSettings"
  json_transform : '.| "Legacy Auth Protocols Enabled: \(.isLegacyAuthProtocolsEnabled)"'
  regex          : "Legacy Auth Protocols Enabled:"
  expect         : "Legacy Auth Protocols Enabled: false"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "EmailAttestationRequired"
      request        : "getSPOTenant"
      json_transform : '.[] | select(.EmailAttestationRequired? | . != null) | "EmailAttestationRequired: \(.EmailAttestationRequired)"'
      regex          : "EmailAttestationRequired:"
      expect         : "EmailAttestationRequired: true"
    </custom_item>

    <custom_item>
      description    : "EmailAttestationReAuthDays"
      request        : "getSPOTenant"
      json_transform : '.[] | select(.EmailAttestationReAuthDays? | . != null) | "EmailAttestationReAuthDays: \(.EmailAttestationReAuthDays)"'
      regex          : "EmailAttestationReAuthDays:"
      expect         : "EmailAttestationReAuthDays: ([0-9]|1[0-5])[\\s]*$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "7.2.10 (L1) Ensure reauthentication with verification code is restricted"
      info        : "This setting configures if guests who use a verification code to access the site or links are required to reauthenticate after a set number of days.

The recommended state is 15 or less.

By increasing the frequency of times guests need to reauthenticate this ensures guest user access to data is not prolonged beyond an acceptable amount of time."
      solution    : "To remediate using the UI:

 - Navigate to SharePoint admin center

https://admin.microsoft.com/sharepoint

 - Click to expand Policies > Sharing
 - Scroll to and expand More external sharing settings
 - Set People who use a verification code must reauthenticate after this many days to 15 or less.

To remediate using PowerShell:

 - Connect to SharePoint Online service using Connect-SPOService
 - Run the following cmdlet:

Set-SPOTenant -EmailAttestationRequired $true -EmailAttestationReAuthDays 15

Impact:

Guests who use Microsoft 365 in their organization can sign in using their work or school account to access the site or document. After the one-time passcode for verification has been entered for the first time, guests will authenticate with their work or school account and have a guest account created in the host's organization.

Note: If OneDrive and SharePoint integration with Entra ID B2B is enabled as per the CIS Benchmark the one-time-passcode experience will be replaced. Please visit

Secure external sharing in SharePoint - SharePoint in Microsoft 365 | Microsoft Learn

for more information."
      reference   : "800-171r3|03.05.01b.,800-53|IA-11,800-53r5|IA-11,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),LEVEL|1A,QCSC-v1|13.2"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description    : "7.2.11 (L1) Ensure the SharePoint default sharing link permission is set"
  info           : "This setting configures the permission that is selected by default for sharing link from a SharePoint site.

The recommended state is View

Setting the view permission as the default ensures that users must deliberately select the edit permission when sharing a link. This approach reduces the risk of unintentionally granting edit privileges to a resource that only requires read access, supporting the principle of least privilege."
  solution       : "To remediate using the UI:

 - Navigate to SharePoint admin center

https://admin.microsoft.com/sharepoint

 - Click to expand Policies > Sharing
 - Scroll to File and folder links
 - Set Choose the permission that's selected by default for sharing links to View

To remediate using PowerShell:

 - Connect to SharePoint Online service using Connect-SPOService
 - Run the following cmdlet:

Set-SPOTenant -DefaultLinkPermission View

Impact:

Not applicable."
  reference      : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1A,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getSPOTenant"
  json_transform : '.[] | select(.DefaultLinkPermission? | . != null) | if (.DefaultLinkPermission == 1) then "Default Link Permission: View" else "Default Link Permission: Edit" end'
  regex          : "Default Link Permission:"
  expect         : "Default Link Permission: View"
</custom_item>

<custom_item>
  description    : "7.2.2 (L1) Ensure SharePoint and OneDrive integration with Azure AD B2B is enabled"
  info           : "Entra ID B2B provides authentication and management of guests. Authentication happens via one-time passcode when they don't already have a work or school account or a Microsoft account. Integration with SharePoint and OneDrive allows for more granular control of how guest user accounts are managed in the organization's AAD, unifying a similar guest experience already deployed in other Microsoft 365 services such as Teams.

Note: Global Reader role currently can't access SharePoint using PowerShell.

External users assigned guest accounts will be subject to Entra ID access policies, such as multi-factor authentication. This provides a way to manage guest identities and control access to SharePoint and OneDrive resources. Without this integration, files can be shared without account registration, making it more challenging to audit and manage who has access to the organization's data."
  solution       : "To remediate using PowerShell:

 - Connect to SharePoint Online using Connect-SPOService
 - Run the following command:

Set-SPOTenant -EnableAzureADB2BIntegration $true

Impact:

B2B collaboration is used with other Entra services so should not be new or unusual. Microsoft also has made the experience seamless when turning on integration on SharePoint sites that already have active files shared with guest users. The referenced Microsoft article on the subject has more details on this."
  reference      : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getSPOTenant"
  json_transform : '.[] |  "Entra ID B2B: \(.EnableAzureADB2BIntegration?)"'
  regex          : "Entra ID B2B: (true|false)"
  expect         : "Entra ID B2B: true"
</custom_item>

<custom_item>
  description    : "7.2.3 (L1) Ensure external content sharing is restricted"
  info           : "The external sharing settings govern sharing for the organization overall. Each site has its own sharing setting that can be set independently, though it must be at the same or more restrictive setting as the organization.

The new and existing guests option requires people who have received invitations to sign in with their work or school account (if their organization uses Microsoft 365) or a Microsoft account, or to provide a code to verify their identity. Users can share with guests already in your organization's directory, and they can send invitations to people who will be added to the directory if they sign in.

The recommended state is New and existing guests or less permissive.

Forcing guest authentication on the organization's tenant enables the implementation of controls and oversight over external file sharing. When a guest is registered with the organization, they now have an identity which can be accounted for. This identity can also have other restrictions applied to it through group membership and conditional access rules."
  solution       : "To remediate using the UI:

 - Navigate to SharePoint admin center

https://admin.microsoft.com/sharepoint

 - Click to expand Policies > Sharing
 - Locate the External sharing section
 - Under SharePoint, move the slider bar to New and existing guests or a less permissive level.
 - OneDrive will also be moved to the same level and can never be more permissive than SharePoint.

To remediate using PowerShell:

 - Connect to SharePoint Online service using Connect-SPOService
 - Run the following cmdlet to establish the minimum recommended state:

Set-SPOTenant -SharingCapability ExternalUserSharingOnly

Note: Other acceptable values for this parameter that are more restrictive include: Disabled and ExistingExternalUserSharingOnly

Impact:

When using B2B integration, Entra ID external collaboration settings, such as guest invite settings and collaboration restrictions apply."
  reference      : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "listSharePointTenantSettings"
  json_transform : '. | "Sharing Capability: \(.sharingCapability)"'
  regex          : "Sharing Capability:"
  expect         : "Sharing Capability: (externalUserSharingOnly|existingExternalUserSharingOnly|disabled)"
  match_all      : YES
</custom_item>

<custom_item>
  description    : "7.2.7 (L1) Ensure link sharing is restricted in SharePoint and OneDrive"
  info           : "This setting sets the default link type that a user will see when sharing content in OneDrive or SharePoint. It does not restrict or exclude any other options.

The recommended state is Specific people (only the people the user specifies) or Only people in your organization (more restrictive).

By defaulting to specific people, the user will first need to consider whether or not the content being shared should be accessible by the entire organization versus select individuals. This aids in reinforcing the concept of least privilege."
  solution       : "To remediate using the UI:

 - Navigate to SharePoint admin center

https://admin.microsoft.com/sharepoint

 - Click to expand Policies > Sharing
 - Scroll to File and folder links
 - Set Choose the type of link that's selected by default when users share files and folders in SharePoint and OneDrive to Specific people (only the people the user specifies) or Only people in your organization

To remediate using PowerShell:

 - Connect to SharePoint Online using Connect-SPOService
 - Run the following PowerShell command:

Set-SPOTenant -DefaultSharingLinkType Direct <xhtml:ol start=\"3\"> - Or, to set a more restrictive state:

Set-SPOTenant -DefaultSharingLinkType Internal"
  reference      : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getSPOTenant"
  json_transform : '.[] | select(.DefaultSharingLinkType? | . != null) | if (.DefaultSharingLinkType == 1) or (.DefaultSharingLinkType == 2) then "Link Sharing: Direct or Internal" else "Link Sharing: AnonymousAccess" end'
  regex          : "Link Sharing:"
  expect         : "Link Sharing: Direct or Internal"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "ExternalUserExpirationRequired"
      request        : "getSPOTenant"
      json_transform : '.[] | select(.ExternalUserExpirationRequired? | . != null) | "ExternalUserExpirationRequired: \(.ExternalUserExpirationRequired)"'
      regex          : "ExternalUserExpirationRequired:"
      expect         : "ExternalUserExpirationRequired: true"
    </custom_item>

    <custom_item>
      description    : "ExternalUserExpireInDays"
      request        : "getSPOTenant"
      json_transform : '.[] | select(.ExternalUserExpireInDays? | . != null) | "ExternalUserExpireInDays: \(.ExternalUserExpireInDays)"'
      regex          : "ExternalUserExpireInDays:"
      expect         : "ExternalUserExpireInDays: ([0-9]|[1-2][0-9]|30)[\\s]*$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "7.2.9 (L1) Ensure guest access to a site or OneDrive will expire automatically"
      info        : "This policy setting configures the expiration time for each guest that is invited to the SharePoint site or with whom users share individual files and folders with.

The recommended state is 30 or less.

This setting ensures that guests who no longer need access to the site or link no longer have access after a set period of time. Allowing guest access for an indefinite amount of time could lead to loss of data confidentiality and oversight.

Note: Guest membership applies at the Microsoft 365 group level. Guests who have permission to view a SharePoint site or use a sharing link may also have access to a Microsoft Teams team or security group."
      solution    : "To remediate using the UI:

 - Navigate to SharePoint admin center

https://admin.microsoft.com/sharepoint

 - Click to expand Policies > Sharing
 - Scroll to and expand More external sharing settings
 - Set Guest access to a site or OneDrive will expire automatically after this many days to 30

To remediate using PowerShell:

 - Connect to SharePoint Online service using Connect-SPOService
 - Run the following cmdlet:

Set-SPOTenant -ExternalUserExpireInDays 30 -ExternalUserExpirationRequired $True

Impact:

Site collection administrators will have to renew access to guests who still need access after 30 days. They will receive an e-mail notification once per week about guest access that is about to expire.

Note: The guest expiration policy only applies to guests who use sharing links or guests who have direct permissions to a SharePoint site after the guest policy is enabled. The guest policy does not apply to guest users that have pre-existing permissions or access through a sharing link before the guest expiration policy is applied."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06b.,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|1A,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "7.3.3 (L1) Ensure custom script execution is restricted on personal sites"
  info        : "This setting controls custom script execution on self-service created sites.

Custom scripts can allow users to change the look, feel and behavior of sites and pages. Every script that runs in a SharePoint page (whether it's an HTML page in a document library or a JavaScript in a Script Editor Web Part) always runs in the context of the user visiting the page and the SharePoint application. This means:

 - Scripts have access to everything the user has access to.
 - Scripts can access content across several Microsoft 365 services and even beyond with Microsoft Graph integration.

The recommended state is Prevent users from running custom script on self-service created sites

Custom scripts could contain malicious instructions unknown to the user or administrator. When users are allowed to run custom script, the organization can no longer enforce governance, scope the capabilities of inserted code, block specific parts of code, or block all custom code that has been deployed. If scripting is allowed the following things can't be audited:

 - What code has been inserted
 - Where the code has been inserted
 - Who inserted the code

Note: Microsoft recommends using the

SharePoint Framework

instead of custom scripts.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to SharePoint admin center

https://admin.microsoft.com/sharepoint

 - Select Settings
 - At the bottom of the page click the classic settings page hyperlink.
 - Scroll to locate the Custom Script section. On the right set the following:
 - Select Prevent users from running custom script on self-service created sites

Impact:

None - this is the default behavior."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06,800-53|CM-7,800-53|CM-7(1),800-53|SI-7,800-53|SI-7(1),800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|SI-7,800-53r5|SI-7(1),CN-L3|7.1.3.5(b),CSCv8|2.7,CSF|PR.DS-6,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.RA-09,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.PS-01,CSF2.0|PR.PS-02,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|SI-7,ITSG-33|SI-7a.,ITSG-33|SI-7(1),LEVEL|1M,NESA|T3.4.1,NESA|T7.3.2,NESA|T7.3.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,PCI-DSSv3.2.1|10.5.5,QCSC-v1|3.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|6.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "7.3.4 (L1) Ensure custom script execution is restricted on site collections"
  info           : "This setting controls custom script execution on a particular site (previously called \"site collection\").

Custom scripts can allow users to change the look, feel and behavior of sites and pages. Every script that runs in a SharePoint page (whether it's an HTML page in a document library or a JavaScript in a Script Editor Web Part) always runs in the context of the user visiting the page and the SharePoint application. This means:

 - Scripts have access to everything the user has access to.
 - Scripts can access content across several Microsoft 365 services and even beyond with Microsoft Graph integration.

The recommended state is DenyAddAndCustomizePages set to $true

Custom scripts could contain malicious instructions unknown to the user or administrator. When users are allowed to run custom script, the organization can no longer enforce governance, scope the capabilities of inserted code, block specific parts of code, or block all custom code that has been deployed. If scripting is allowed the following things can't be audited:

 - What code has been inserted
 - Where the code has been inserted
 - Who inserted the code

Note: Microsoft recommends using the

SharePoint Framework

instead of custom scripts."
  solution       : "To remediate using PowerShell:

 - Connect to SharePoint Online using Connect-SPOService
 - Edit the below and run for each site as needed:

Set-SPOSite -Identity <SiteUrl> -DenyAddAndCustomizePages $true

Note: The property DenyAddAndCustomizePages cannot be set on the MySite host, which is displayed with a URL like https:// tenant id -my.sharepoint.com/

Impact:

None - this is the default behavior."
  reference      : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06,800-53|CM-7,800-53|CM-7(1),800-53|SI-7,800-53|SI-7(1),800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|SI-7,800-53r5|SI-7(1),CN-L3|7.1.3.5(b),CSCv8|2.7,CSF|PR.DS-6,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.RA-09,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.PS-01,CSF2.0|PR.PS-02,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|SI-7,ITSG-33|SI-7a.,ITSG-33|SI-7(1),LEVEL|1A,NESA|T3.4.1,NESA|T7.3.2,NESA|T7.3.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,PCI-DSSv3.2.1|10.5.5,QCSC-v1|3.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|6.2"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getSPOSite"
  json_transform : '.[] | if (._Child_Items_) then (if ((._Child_Items_ | length) == 0) then "No sites configured" else (._Child_Items_[] | .Url as $site | .DenyAddAndCustomizePages as $DenyAddAndCustomizePages | if ($DenyAddAndCustomizePages == 1) then "Site: \($site), DenyAddAndCustomizePages: Disabled" else "Site: \($site), DenyAddAndCustomizePages: Enabled" end) end) else null end'
  regex          : ".+"
  not_expect     : "Site: ((?!\-my.sharepoint.com).)*, DenyAddAndCustomizePages: Disabled"
</custom_item>

<custom_item>
  description    : "8.1.2 (L1) Ensure users can't send emails to a channel email address"
  info           : "Teams channel email addresses are an optional feature that allows users to email the Teams channel directly.

Channel email addresses are not under the tenant's domain and organizations do not have control over the security settings for this email address. An attacker could email channels directly if they discover the channel email address."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com

.
 - Click to expand Teams select Teams settings
 - Under email integration set Users can send emails to a channel email address to Off

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command to set the recommended state:

Set-CsTeamsClientConfiguration -Identity Global -AllowEmailIntoChannel $false

Impact:

Users will not be able to email the channel directly."
  reference      : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getCsTeamsClientConfiguration"
  json_transform : '.[] | if (.Identity == "Global") then "AllowEmailIntoChannel: \(.AllowEmailIntoChannel)" else null end'
  regex          : "AllowEmailIntoChannel:"
  expect         : "AllowEmailIntoChannel: false"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      description    : "AllowTeamsConsumer"
      request        : "getCsTenantFederationConfiguration"
      json_transform : '.[] | select(.Identity == "Global") | "AllowTeamsConsumer: \(.AllowTeamsConsumer)"'
      expect         : "AllowTeamsConsumer: false"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "8.2.2 (L1) Ensure communication with unmanaged Teams users is disabled"
      info        : "This policy setting controls chats and meetings with external unmanaged Teams users (those not managed by an organization, such as Microsoft Teams (free)).

The recommended state is: People in my organization can communicate with unmanaged Teams accounts set to Off

Allowing users to communicate with unmanaged Teams users presents a potential security threat as little effort is required by threat actors to gain access to a trial or free Microsoft Teams account.

Some real-world attacks and exploits delivered via Teams over external access channels include:

 - DarkGate malware
 - Social engineering / Phishing attacks by \"Midnight Blizzard\"
 - GIFShell
 - Username enumeration"
      solution    : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com/

.
 - Click to expand Users select External access
 - Select the Policies tab
 - Click on the Global (Org-wide default) policy.
 - Set People in my organization can communicate with unmanaged Teams accounts to Off
 - Click Save

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command:

Set-CsExternalAccessPolicy -Identity Global -EnableTeamsConsumerAccess $false

Note: Configuring the organization settings to block communication is also in compliance with this control.

Impact:

Users will be unable to communicate with Teams users who are not managed by an organization.

Organizations may choose create additional policies for specific groups needing to communicating with unmanaged external users.

Note: The settings that govern chats and meetings with external unmanaged Teams users aren't available in GCC, GCC High, or DOD deployments, or in private cloud environments."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06b.,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|1A,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>

  <else>
    <custom_item>
      description    : "8.2.2 (L1) Ensure communication with unmanaged Teams users is disabled"
      info           : "This policy setting controls chats and meetings with external unmanaged Teams users (those not managed by an organization, such as Microsoft Teams (free)).

The recommended state is: People in my organization can communicate with unmanaged Teams accounts set to Off

Allowing users to communicate with unmanaged Teams users presents a potential security threat as little effort is required by threat actors to gain access to a trial or free Microsoft Teams account.

Some real-world attacks and exploits delivered via Teams over external access channels include:

 - DarkGate malware
 - Social engineering / Phishing attacks by \"Midnight Blizzard\"
 - GIFShell
 - Username enumeration"
      solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com/

.
 - Click to expand Users select External access
 - Select the Policies tab
 - Click on the Global (Org-wide default) policy.
 - Set People in my organization can communicate with unmanaged Teams accounts to Off
 - Click Save

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command:

Set-CsExternalAccessPolicy -Identity Global -EnableTeamsConsumerAccess $false

Note: Configuring the organization settings to block communication is also in compliance with this control.

Impact:

Users will be unable to communicate with Teams users who are not managed by an organization.

Organizations may choose create additional policies for specific groups needing to communicating with unmanaged external users.

Note: The settings that govern chats and meetings with external unmanaged Teams users aren't available in GCC, GCC High, or DOD deployments, or in private cloud environments."
      reference      : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06b.,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|1A,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
      request        : "getCSExternalAccessPolicy"
      json_transform : '.[] | select(.Identity == "Global") | "EnableTeamsConsumerAccess: \(.EnableTeamsConsumerAccess)"'
      expect         : "EnableTeamsConsumerAccess: false"
    </custom_item>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      description    : "AllowTeamsConsumer"
      request        : "getCsTenantFederationConfiguration"
      json_transform : '.[] | select(.Identity == "Global") | "AllowTeamsConsumerInbound: \(.AllowTeamsConsumerInbound)"'
      expect         : "AllowTeamsConsumerInbound: false"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "8.2.3 (L1) Ensure external Teams users cannot initiate conversations"
      info        : "This setting prevents external users who are not managed by an organization from initiating contact with users in the protected organization.

The recommended state is to uncheck External users with Teams accounts not managed by an organization can contact users in my organization

Note: Disabling this setting is used as an additional stop gap for the previous setting which disables communication with unmanaged Teams users entirely. If an organization chooses to have an exception to (L1) Ensure communication with unmanaged Teams users is disabled they can do so while also disabling the ability for the same group of users to initiate contact. Disabling communication entirely will also disable the ability for unmanaged users to initiate contact.

Allowing users to communicate with unmanaged Teams users presents a potential security threat as little effort is required by threat actors to gain access to a trial or free Microsoft Teams account.

Some real-world attacks and exploits delivered via Teams over external access channels include:

 - DarkGate malware
 - Social engineering / Phishing attacks by \"Midnight Blizzard\"
 - GIFShell
 - Username enumeration"
      solution    : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com/

.
 - Click to expand Users select External access
 - Select the Policies tab.
 - Click on the Global (Org-wide default) policy.
 - Locate the parent setting People in my organization can communicate with unmanaged Teams accounts
 - Uncheck External users with Teams accounts not managed by an organization can contact users in my organization
 - Click Save

Note: If People in my organization can communicate with unmanaged Teams accounts is already set to Off then this setting will not be visible and will satisfy the requirements of this recommendation.

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command:

Set-CsExternalAccessPolicy -Identity Global -EnableTeamsConsumerInbound $false

Note: Configuring the organization settings to block inbound communication is also in compliance with this control.

Impact:

The impact of disabling this is very low.

Organizations may choose to create additional policies for specific groups that need to communicate with unmanaged external users.

Note: Chats and meetings with external unmanaged Teams users isn't available in GCC, GCC High, or DOD deployments, or in private cloud environments."
      reference   : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1A,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>

  <else>
    <custom_item>
      description    : "8.2.3 (L1) Ensure external Teams users cannot initiate conversations"
      info           : "This setting prevents external users who are not managed by an organization from initiating contact with users in the protected organization.

The recommended state is to uncheck External users with Teams accounts not managed by an organization can contact users in my organization

Note: Disabling this setting is used as an additional stop gap for the previous setting which disables communication with unmanaged Teams users entirely. If an organization chooses to have an exception to (L1) Ensure communication with unmanaged Teams users is disabled they can do so while also disabling the ability for the same group of users to initiate contact. Disabling communication entirely will also disable the ability for unmanaged users to initiate contact.

Allowing users to communicate with unmanaged Teams users presents a potential security threat as little effort is required by threat actors to gain access to a trial or free Microsoft Teams account.

Some real-world attacks and exploits delivered via Teams over external access channels include:

 - DarkGate malware
 - Social engineering / Phishing attacks by \"Midnight Blizzard\"
 - GIFShell
 - Username enumeration"
      solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com/

.
 - Click to expand Users select External access
 - Select the Policies tab.
 - Click on the Global (Org-wide default) policy.
 - Locate the parent setting People in my organization can communicate with unmanaged Teams accounts
 - Uncheck External users with Teams accounts not managed by an organization can contact users in my organization
 - Click Save

Note: If People in my organization can communicate with unmanaged Teams accounts is already set to Off then this setting will not be visible and will satisfy the requirements of this recommendation.

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command:

Set-CsExternalAccessPolicy -Identity Global -EnableTeamsConsumerInbound $false

Note: Configuring the organization settings to block inbound communication is also in compliance with this control.

Impact:

The impact of disabling this is very low.

Organizations may choose to create additional policies for specific groups that need to communicate with unmanaged external users.

Note: Chats and meetings with external unmanaged Teams users isn't available in GCC, GCC High, or DOD deployments, or in private cloud environments."
      reference      : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1A,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
      see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
      request        : "getCSExternalAccessPolicy"
      json_transform : '.[] | select(.Identity == "Global") | "EnableTeamsConsumerInbound: \(.EnableTeamsConsumerInbound)"'
      expect         : "EnableTeamsConsumerInbound: false"
    </custom_item>
  </else>
</if>

<custom_item>
  description    : "8.2.4 (L1) Ensure communication with Skype users is disabled"
  info           : "This policy setting controls chat with external unmanaged Skype users.

Note: Starting in May 2025, Skype will no longer be available. This setting will be removed and users won't be able to communicate with Skype users.

Skype was deprecated July 31, 2021. Disabling communication with skype users reduces the attack surface of the organization. If a partner organization or satellite office wishes to collaborate and has not yet moved off of Skype, then a valid exception will need to be considered for this recommendation."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com/

.
 - Click to expand Users select External access
 - Select the Organization settings tab.
 - Set People in my organization can communicate with Skype users to Off
 - Click Save

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command:

Set-CsTenantFederationConfiguration -AllowPublicUsers $false

Impact:

Teams users will be unable to communicate with Skype users that are not in the same organization."
  reference      : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getCsTenantFederationConfiguration"
  json_transform : '.[] | "AllowPublicUsers: \(.AllowPublicUsers)"'
  regex          : "AllowPublicUsers:"
  expect         : "AllowPublicUsers: (false|null)"
</custom_item>

<report type:"WARNING">
  description : "8.4.1 (L1) Ensure app permission policies are configured"
  info        : "This policy setting controls which class of apps are available for users to install.

Allowing users to install third-party or unverified apps poses a potential risk of introducing malicious software to the environment.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com

.
 - Click to expand Teams apps select Manage apps
 - In the upper right click Actions > Org-wide app settings
 - For Microsoft apps set Let users install and use available apps by default to On or less permissive.
 - For Third-party apps set Let users install and use available apps by default to Off
 - For Custom apps set Let users install and use available apps by default to Off
 - For Custom apps set Let users interact with custom apps in preview to Off

Impact:

Users will only be able to install approved classes of apps."
  reference   : "800-171|3.4.8,800-171r3|03.04.08,800-53|CM-7(5),800-53|CM-10,800-53r5|CM-7(5),800-53r5|CM-10,CSCv7|2.7,CSCv8|2.5,CSF|DE.CM-3,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.32,ISO-27001-2022|A.8.19,ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ITSG-33|CM-7,LEVEL|1M,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<custom_item>
  description    : "8.5.2 (L1) Ensure anonymous users and dial-in callers can't start a meeting"
  info           : "This policy setting controls if an anonymous participant can start a Microsoft Teams meeting without someone in attendance. Anonymous users and dial-in callers must wait in the lobby until the meeting is started by someone in the organization or an external user from a trusted organization.

Anonymous participants are classified as:

 - Participants who are not logged in to Teams with a work or school account.
 - Participants from non-trusted organizations (as configured in external access).
 - Participants from organizations where there is not mutual trust.

Note: This setting only applies when Who can bypass the lobby is set to Everyone If the anonymous users can join a meeting organization-level setting or meeting policy is Off this setting only applies to dial-in callers.

Not allowing anonymous participants to automatically join a meeting reduces the risk of meeting spamming."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com

.
 - Click to expand Meetings select Meeting policies
 - Click Global (Org-wide default)
 - Under meeting join & lobby set Anonymous users and dial-in callers can start a meeting to Off

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command to set the recommended state:

Set-CsTeamsMeetingPolicy -Identity Global -AllowAnonymousUsersToStartMeeting $false

Impact:

Anonymous participants will not be able to start a Microsoft Teams meeting."
  reference      : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1A,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getCSTeamsMeetingPolicy"
  json_transform : '.[] | if (.Identity == "Global") then "AllowAnonymousUsersToStartMeeting: \(.AllowAnonymousUsersToStartMeeting)" else null end'
  regex          : "AllowAnonymousUsersToStartMeeting:"
  expect         : "AllowAnonymousUsersToStartMeeting: false"
</custom_item>

<custom_item>
  description    : "8.5.3 (L1) Ensure only people in my org can bypass the lobby"
  info           : "This policy setting controls who can join a meeting directly and who must wait in the lobby until they're admitted by an organizer, co-organizer, or presenter of the meeting.

The recommended state is People who were invited or more restrictive.

For meetings that could contain sensitive information, it is best to allow the meeting organizer to vet anyone not directly sent an invite before admitting them to the meeting. This will also prevent the anonymous user from using the meeting link to have meetings at unscheduled times."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com

.
 - Click to expand Meetings select Meeting policies
 - Click Global (Org-wide default)
 - Under meeting join & lobby set Who can bypass the lobby to People who were invited or a more restrictive value: People in my org Only organizers and co-organizers

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command to set the recommended state:

Set-CsTeamsMeetingPolicy -Identity Global -AutoAdmittedUsers \"InvitedUsers\"

Note: More restrictive values EveryoneInCompanyExcludingGuests or OrganizerOnly are also in compliance.

Impact:

Individuals who are not part of the organization will have to wait in the lobby until they're admitted by an organizer, co-organizer, or presenter of the meeting.

Any individual who dials into the meeting regardless of status will also have to wait in the lobby. This includes internal users who are considered unauthenticated when dialing in."
  reference      : "800-171|3.1.1,800-171|3.1.5,800-171|3.3.8,800-171|3.3.9,800-171r3|03.01.01,800-171r3|03.01.02,800-171r3|03.01.05,800-171r3|03.01.05a.,800-171r3|03.01.05b.,800-171r3|03.03.08b.,800-53|AC-2,800-53|AC-3,800-53|AC-6,800-53|AC-6(1),800-53|AC-6(7),800-53|AU-9(4),800-53r5|AC-2,800-53r5|AC-5,800-53r5|AC-6,800-53r5|AC-6(1),800-53r5|AC-6(7),800-53r5|AU-9(4),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.3(d),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|6.8,CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-1,CSF|PR.PT-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.5.33,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.15,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.5,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.4,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AC-3,ITSG-33|AC-6,ITSG-33|AC-6(1),ITSG-33|AU-9(4),ITSG-33|AU-9(4)(a),ITSG-33|AU-9(4)(b),LEVEL|1A,NESA|M1.1.3,NESA|M1.2.2,NESA|M5.2.3,NESA|M5.5.2,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|AM28,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SS13c,NIAv2|SS14e,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL3b,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getCSTeamsMeetingPolicy"
  json_transform : '.[] | if (.Identity == "Global") then "AutoAdmittedUsers: \(.AutoAdmittedUsers)" else null end'
  regex          : "AutoAdmittedUsers:"
  expect         : "AutoAdmittedUsers: (EveryoneInCompanyExcludingGuests|OrganizerOnly)"
</custom_item>

<custom_item>
  description    : "8.5.4 (L1) Ensure users dialing in can't bypass the lobby"
  info           : "This policy setting controls if users who dial in by phone can join the meeting directly or must wait in the lobby. Admittance to the meeting from the lobby is authorized by the meeting organizer, co-organizer, or presenter of the meeting.

For meetings that could contain sensitive information, it is best to allow the meeting organizer to vet anyone not directly from the organization."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com

.
 - Click to expand Meetings select Meeting policies
 - Click Global (Org-wide default)
 - Under meeting join & lobby set People dialing in can bypass the lobby to Off

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command to set the recommended state:

Set-CsTeamsMeetingPolicy -Identity Global -AllowPSTNUsersToBypassLobby $false

Impact:

Individuals who are dialing in to the meeting must wait in the lobby until a meeting organizer, co-organizer, or presenter admits them."
  reference      : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1A,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getCSTeamsMeetingPolicy"
  json_transform : '.[] | if (.Identity == "Global") then "AllowPSTNUsersToBypassLobby: \(.AllowPSTNUsersToBypassLobby)" else null end'
  regex          : "AllowPSTNUsersToBypassLobby:"
  expect         : "AllowPSTNUsersToBypassLobby: false"
</custom_item>

<custom_item>
  description    : "8.5.7 (L1) Ensure external participants can't give or request control"
  info           : "This policy setting allows control of who can present in meetings and who can request control of the presentation while a meeting is underway.

Ensuring that only authorized individuals and not external participants are able to present and request control reduces the risk that a malicious user can inadvertently show content that is not appropriate.

External participants are categorized as follows: external users, guests, and anonymous users."
  solution       : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com

.
 - Click to expand Meetings select Meeting policies
 - Click Global (Org-wide default)
 - Under content sharing set External participants can give or request control to Off

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Run the following command to set the recommended state:

Set-CsTeamsMeetingPolicy -Identity Global -AllowExternalParticipantGiveRequestControl $false

Impact:

External participants will not be able to present or request control during the meeting.

Warning: This setting also affects webinars.

Note: At this time, to give and take control of shared content during a meeting, both parties must be using the Teams desktop client. Control isn't supported when either party is running Teams in a browser."
  reference      : "800-171|3.1.1,800-171r3|03.01.01,800-53|AC-2,800-53r5|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1A,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
  see_also       : "https://workbench.cisecurity.org/benchmarks/20006"
  request        : "getCSTeamsMeetingPolicy"
  json_transform : '.[] | if (.Identity == "Global") then "AllowExternalParticipantGiveRequestControl: \(.AllowExternalParticipantGiveRequestControl)" else null end'
  regex          : "AllowExternalParticipantGiveRequestControl:"
  expect         : "AllowExternalParticipantGiveRequestControl: false"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description    : "AllowSecurityEndUserReporting"
      request        : "getCSTeamsMessagingPolicy"
      json_transform : '.[] | if (.Identity == "Global") then "AllowSecurityEndUserReporting: \(.AllowSecurityEndUserReporting)" else null end'
      regex          : "AllowSecurityEndUserReporting:"
      expect         : "AllowSecurityEndUserReporting: true"
    </custom_item>

    <custom_item>
      description    : "ReportJunkToCustomizedAddress"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportJunkToCustomizedAddress: \(.ReportJunkToCustomizedAddress)"'
      regex          : "ReportJunkToCustomizedAddress:"
      expect         : "ReportJunkToCustomizedAddress: true"
    </custom_item>

    <custom_item>
      description    : "ReportNotJunkToCustomizedAddress"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportNotJunkToCustomizedAddress: \(.ReportNotJunkToCustomizedAddress)"'
      regex          : "ReportNotJunkToCustomizedAddress:"
      expect         : "ReportNotJunkToCustomizedAddress: true"
    </custom_item>

    <custom_item>
      description    : "ReportPhishToCustomizedAddress"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportPhishToCustomizedAddress: \(.ReportPhishToCustomizedAddress)"'
      regex          : "ReportPhishToCustomizedAddress:"
      expect         : "ReportPhishToCustomizedAddress: true"
    </custom_item>

    <custom_item>
      description    : "ReportJunkAddresses"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportJunkAddresses: \(.ReportJunkAddresses)"'
      regex          : "ReportJunkAddresses:"
      expect         : "ReportJunkAddresses: \[\"@JUNK_ADDRESS@\"\]"
    </custom_item>

    <custom_item>
      description    : "ReportNotJunkAddresses"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportNotJunkAddresses: \(.ReportNotJunkAddresses)"'
      regex          : "ReportNotJunkAddresses:"
      expect         : "ReportNotJunkAddresses: \[\"@NOT_JUNK_ADDRESS@\"\]"
    </custom_item>

    <custom_item>
      description    : "ReportPhishAddresses"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportPhishAddresses: \(.ReportPhishAddresses)"'
      regex          : "ReportPhishAddresses:"
      expect         : "ReportPhishAddresses: \[\"@PHISH_ADDRESS@\"\]"
    </custom_item>

    <custom_item>
      description    : "ReportChatMessageEnabled"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportChatMessageEnabled: \(.ReportChatMessageEnabled)"'
      regex          : "ReportChatMessageEnabled:"
      expect         : "ReportChatMessageEnabled: false"
    </custom_item>

    <custom_item>
      description    : "ReportChatMessageToCustomizedAddressEnabled"
      request        : "getReportSubmissionPolicy"
      json_transform : '.[] | "ReportChatMessageToCustomizedAddressEnabled: \(.ReportChatMessageToCustomizedAddressEnabled)"'
      regex          : "ReportChatMessageToCustomizedAddressEnabled:"
      expect         : "ReportChatMessageToCustomizedAddressEnabled: true"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "8.6.1 (L1) Ensure users can report security concerns in Teams"
      info        : "User reporting settings allow a user to report a message as malicious for further analysis. This recommendation is composed of 3 different settings and all be configured to pass:

 -

In the Teams admin center: On by default and controls whether users are able to report messages from Teams. When this setting is turned off, users can't report messages within Teams, so the corresponding setting in the Microsoft 365 Defender portal is irrelevant.

 -

In the Microsoft 365 Defender portal: On by default for new tenants. Existing tenants need to enable it. If user reporting of messages is turned on in the Teams admin center, it also needs to be turned on the Defender portal for user reported messages to show up correctly on the User reported tab on the Submissions page.

 -

Defender - Report message destinations: This applies to more than just Microsoft Teams and allows for an organization to keep their reports contained. Due to how the parameters are configured on the backend it is included in this assessment as a requirement.

Users will be able to more quickly and systematically alert administrators of suspicious malicious messages within Teams. The content of these messages may be sensitive in nature and therefore should be kept within the organization and not shared with Microsoft without first consulting company policy.

Note:

 - The reported message remains visible to the user in the Teams client.
 - Users can report the same message multiple times.
 - The message sender isn't notified that messages were reported."
      solution    : "To remediate using the UI:

 - Navigate to Microsoft Teams admin center

https://admin.teams.microsoft.com

.
 - Click to expand Messaging select Messaging policies
 - Click Global (Org-wide default)
 - Set Report a security concern to On
 - Next, navigate to Microsoft 365 Defender

https://security.microsoft.com/

 - Click on Settings > Email & collaboration > User reported settings
 - Scroll to Microsoft Teams
 - Check Monitor reported messages in Microsoft Teams and Save
 - Set Send reported messages to: to My reporting mailbox only with reports configured to be sent to authorized staff.

To remediate using PowerShell:

 - Connect to Teams PowerShell using Connect-MicrosoftTeams
 - Connect to Exchange Online PowerShell using Connect-ExchangeOnline
 - Run the following cmdlet:

Set-CsTeamsMessagingPolicy -Identity Global -AllowSecurityEndUserReporting $true <xhtml:ol start=\"4\"> - To configure the Defender reporting policies, edit and run this script:

$usersub = \"userreportedmessages@fabrikam.com\" # Change this.

$params = @{
    Identity = \"DefaultReportSubmissionPolicy\"
    EnableReportToMicrosoft = $false
    ReportChatMessageEnabled = $false
    ReportChatMessageToCustomizedAddressEnabled = $true
    ReportJunkToCustomizedAddress = $true
    ReportNotJunkToCustomizedAddress = $true
    ReportPhishToCustomizedAddress = $true
    ReportJunkAddresses = $usersub
    ReportNotJunkAddresses = $usersub
    ReportPhishAddresses = $usersub
}

Set-ReportSubmissionPolicy @params

New-ReportSubmissionRule -Name DefaultReportSubmissionRule -ReportSubmissionPolicy DefaultReportSubmissionPolicy -SentTo $usersub

Impact:

Enabling message reporting has an impact beyond just addressing security concerns. When users of the platform report a message, the content could include messages that are threatening or harassing in nature, possibly stemming from colleagues.

Due to this the security staff responsible for reviewing and acting on these reports should be equipped with the skills to discern and appropriately direct such messages to the relevant departments, such as Human Resources (HR)."
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|1A,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
      show_output : YES
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "9.1.1 (L1) Ensure guest user access is restricted"
  info        : "This setting allows business-to-business (B2B) guests access to Microsoft Fabric, and contents that they have permissions to. With the setting turned off, B2B guest users receive an error when trying to access Power BI.

The recommended state is Enabled for a subset of the organization or Disabled

Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Azure that are new or assigned guest status from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Export and Sharing settings
 - Set Guest users can access Microsoft Fabric to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Specific security groups selected and defined.

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

Security groups will need to be more closely tended to and monitored."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.3.8,800-171|3.3.9,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.01,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05,800-171r3|03.01.05a.,800-171r3|03.01.05b.,800-171r3|03.03.08b.,800-171r3|03.08.02,800-53|AC-2,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|AC-6(1),800-53|AC-6(7),800-53|AU-9(4),800-53|MP-2,800-53r5|AC-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|AC-6(1),800-53r5|AC-6(7),800-53r5|AU-9(4),800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.3(d),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|3.3,CSCv8|6.8,CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-1,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.15,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.5,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.4,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|AC-6(1),ITSG-33|AU-9(4),ITSG-33|AU-9(4)(a),ITSG-33|AU-9(4)(b),ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1M,NESA|M1.1.3,NESA|M1.2.2,NESA|M5.2.3,NESA|M5.5.2,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|AM28,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SS13c,NIAv2|SS14e,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL3b,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.10 (L1) Ensure access to APIs by Service Principals is restricted"
  info        : "Web apps registered in Microsoft Entra ID use an assigned service principal to access Power BI APIs without a signed-in user. This setting allows an app to use service principal authentication.

The recommended state is Enabled for a subset of the organization or Disabled

Leaving API access unrestricted increases the attack surface in the event an adversary gains access to a Service Principal. APIs are a feature-rich method for programmatic access to many areas of Power Bi and should be guarded closely.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Developer settings
 - Set Service principals can use Fabric APIs to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Specific security groups selected and defined.

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

Disabled is the default behavior."
  reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1M,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.11 (L1) Ensure Service Principals cannot create and use profiles"
  info        : "Service principal profiles provide a flexible solution for apps used in a multitenancy deployment. The profiles enable customer data isolation and tighter security boundaries between customers that are utilizing the app.

The recommended state is Enabled for a subset of the organization or Disabled

Service Principals should be restricted to a security group to limit which Service Principals can interact with profiles. This supports the principle of least privilege.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Developer settings
 - Set Allow service principals to create and use profiles to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Specific security groups selected and defined.

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

Disabled is the default behavior."
  reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1M,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.2 (L1) Ensure external user invitations are restricted"
  info        : "This setting helps organizations choose whether new external users can be invited to the organization through Power BI sharing, permissions, and subscription experiences. This setting only controls the ability to invite through Power BI.

The recommended state is Enabled for a subset of the organization or Disabled

Note: To invite external users to the organization, the user must also have the Microsoft Entra Guest Inviter role.

Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Azure that are new or assigned guest status from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Export and Sharing settings
 - Set Users can invite guest users to collaborate through item sharing and permissions to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Specific security groups selected and defined.

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

Guest user invitations will be limited to only specific employees."
  reference   : "800-171|3.1.1,800-171|3.1.5,800-171|3.3.8,800-171|3.3.9,800-171r3|03.01.01,800-171r3|03.01.02,800-171r3|03.01.05,800-171r3|03.01.05a.,800-171r3|03.01.05b.,800-171r3|03.03.08b.,800-53|AC-2,800-53|AC-3,800-53|AC-6,800-53|AC-6(1),800-53|AC-6(7),800-53|AU-9(4),800-53r5|AC-2,800-53r5|AC-5,800-53r5|AC-6,800-53r5|AC-6(1),800-53r5|AC-6(7),800-53r5|AU-9(4),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.3(d),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|6.8,CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-1,CSF|PR.PT-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.5.33,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.15,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.5,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.4,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AC-3,ITSG-33|AC-6,ITSG-33|AC-6(1),ITSG-33|AU-9(4),ITSG-33|AU-9(4)(a),ITSG-33|AU-9(4)(b),LEVEL|1M,NESA|M1.1.3,NESA|M1.2.2,NESA|M5.2.3,NESA|M5.5.2,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|AM28,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SS13c,NIAv2|SS14e,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL3b,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.3 (L1) Ensure guest access to content is restricted"
  info        : "This setting allows Microsoft Entra B2B guest users to have full access to the browsing experience using the left-hand navigation pane in the organization. Guest users who have been assigned workspace roles or specific item permissions will continue to have those roles and/or permissions, even if this setting is disabled.

The recommended state is Enabled for a subset of the organization or Disabled

Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Entra that are new or assigned guest status from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Export and Sharing settings
 - Set Guest users can browse and access Fabric content to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Specific security groups selected and defined.

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

Security groups will need to be more closely tended to and monitored."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1M,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.4 (L1) Ensure 'Publish to web' is restricted"
  info        : "Power BI enables users to share reports and materials directly on the internet from both the application's desktop version and its web user interface. This functionality generates a publicly reachable web link that doesn't necessitate authentication or the need to be an Entra ID user in order to access and view it.

The recommended state is Enabled for a subset of the organization or Disabled

When using Publish to Web anyone on the Internet can view a published report or visual. Viewing requires no authentication. It includes viewing detail-level data that your reports aggregate. By disabling the feature, restricting access to certain users and allowing existing embed codes organizations can mitigate the exposure of confidential or proprietary information.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Export and Sharing settings
 - Set Publish to web to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Choose how embed codes work set to Only allow existing codes AND Specific security groups selected and defined

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

Depending on the organization's utilization administrators may experience more overhead managing embed codes, and requests."
  reference   : "800-171|3.13.1,800-171|3.13.2,800-171r3|03.16.01,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,CSF2.0|ID.AM-03,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-06,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|1M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.6 (L1) Ensure 'Allow users to apply sensitivity labels for content' is 'Enabled'"
  info        : "Information protection tenant settings help to protect sensitive information in the Power BI tenant. Allowing and applying sensitivity labels to content ensures that information is only seen and accessed by the appropriate users.

The recommended state is Enabled or Enabled for a subset of the organization

Note: Sensitivity labels and protection are only applied to files exported to Excel, PowerPoint, or PDF files, that are controlled by \"Export to Excel\" and \"Export reports as PowerPoint presentation or PDF documents\" settings. All other export and sharing options do not support the application of sensitivity labels and protection.

Note 2: There are some prerequisite steps that need to be completed in order to fully utilize labeling. See

here

.

Establishing data classifications and affixing labels to data at creation enables organizations to discern the data's criticality, sensitivity, and value. This initial identification enables the implementation of appropriate protective measures, utilizing technologies like Data Loss Prevention (DLP) to avert inadvertent exposure and enforcing access controls to safeguard against unauthorized access.

This practice can also promote user awareness and responsibility in regard to the nature of the data they interact with. Which in turn can foster awareness in other areas of data management across the organization.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Information protection
 - Set Allow users to apply sensitivity labels for content to one of these states:
 - State 1: Enabled
 - State 2: Enabled with Specific security groups selected and defined.

Impact:

Additional license requirements like Power BI Pro are required, as outlined in the Licensed and requirements page linked in the description and references sections."
  reference   : "800-53|PM-5,800-53|RA-2,800-53r5|CM-12,800-53r5|PM-5(1),800-53r5|RA-2,CSCv8|3.2,CSCv8|3.7,CSF|ID.AM-5,CSF|ID.RA-4,CSF|ID.RA-5,CSF2.0|ID.AM-01,CSF2.0|ID.AM-02,CSF2.0|ID.AM-05,CSF2.0|ID.RA-04,CSF2.0|ID.RA-05,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.12,ITSG-33|RA-2,LEVEL|1M,NESA|M2.2.1,NESA|T1.2.1,NESA|T1.2.2,NESA|T1.3.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|11.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.7 (L1) Ensure shareable links are restricted"
  info        : "Creating a shareable link allows a user to create a link to a report or dashboard, then add that link to an email or another messaging application.

There are 3 options that can be selected when creating a shareable link:

 - People in your organization
 - People with existing access
 - Specific people

This setting solely deals with restrictions to People in the organization External users by default are not included in any of these categories, and therefore cannot use any of these links regardless of the state of this setting.

The recommended state is Enabled for a subset of the organization or Disabled

While external users are unable to utilize shareable links, disabling or restricting this feature ensures that a user cannot generate a link accessible by individuals within the same organization who lack the necessary clearance to the shared data. For example, a member of Human Resources intends to share sensitive information with a particular employee or another colleague within their department. The owner would be prompted to specify either People with existing access or Specific people when generating the link requiring the person clicking the link to pass a first layer access control list. This measure along with proper file and folder permissions can help prevent unintended access and potential information leakage.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Export and Sharing settings
 - Set Allow shareable links to grant access to everyone in your organization to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Specific security groups selected and defined.

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

If the setting is Enabled then only specific people in the organization would be allowed to create general links viewable by the entire organization."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1M,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.8 (L1) Ensure enabling of external data sharing is restricted"
  info        : "Power BI admins can specify which users or user groups can share datasets externally with guests from a different tenant through the in-place mechanism. Disabling this setting prevents any user from sharing datasets externally by restricting the ability of users to turn on external sharing for datasets they own or manage.

The recommended state is Enabled for a subset of the organization or Disabled

Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Azure that are new or from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Export and Sharing settings
 - Set Allow specific users to turn on external data sharing to one of these states:
 - State 1: Disabled
 - State 2: Enabled with Specific security groups selected and defined.

Important: If the organization doesn't actively use this feature it is recommended to keep it Disabled

Impact:

Security groups will need to be more closely tended to and monitored."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.3.8,800-171|3.3.9,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.01,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05,800-171r3|03.01.05a.,800-171r3|03.01.05b.,800-171r3|03.03.08b.,800-171r3|03.08.02,800-53|AC-2,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|AC-6(1),800-53|AC-6(7),800-53|AU-9(4),800-53|MP-2,800-53r5|AC-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|AC-6(1),800-53r5|AC-6(7),800-53r5|AU-9(4),800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.3(d),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv8|3.3,CSCv8|6.8,CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-1,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.15,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.5,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.4,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|AC-6(1),ITSG-33|AU-9(4),ITSG-33|AU-9(4)(a),ITSG-33|AU-9(4)(b),ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1M,NESA|M1.1.3,NESA|M1.2.2,NESA|M5.2.3,NESA|M5.5.2,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|AM28,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SS13c,NIAv2|SS14e,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL3b,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

<report type:"WARNING">
  description : "9.1.9 (L1) Ensure 'Block ResourceKey Authentication' is 'Enabled'"
  info        : "This setting blocks the use of resource key based authentication. The Block ResourceKey Authentication setting applies to streaming and PUSH datasets. If blocked users will not be allowed to send data to streaming and PUSH datasets using the API with a resource key.

The recommended state is Enabled

Resource keys are a form of authentication that allows users to access Power BI resources (such as reports, dashboards, and datasets) without requiring individual user accounts. While convenient, this method bypasses the organization's centralized identity and access management controls. Enabling ensures that access to Power BI resources is tied to the organization's authentication mechanisms, providing a more secure and controlled environment.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To remediate using the UI:

 - Navigate to Microsoft Fabric

https://app.powerbi.com/admin-portal

 - Select Tenant settings
 - Scroll to Developer settings
 - Set Block ResourceKey Authentication to Enabled

Impact:

Developers will need to request a special exception in order to use this feature."
  reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|1M,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/20006"
</report>

</check_type>
