#TRUSTED 5c90d79715778af07c5070587d3b077248a9baf686981760c5c7ef393e19027c046fce22e309fe3238971643da1317f69f11f0bf838e045a0dcda2fa4cdcbcf8960b9f01053a1d35214040b1d780d2a9f6ad2e06d7e85f86d18cd2907df34eaf1e51bed90c912abaf07b9037610d9a5d8de0cccde79ff589e2c50794e5c20cd7456935f69bdb006737e56892d6fc030f137dbc56cca508c5bfbb5db5ebb833bc8cece51d5d8ecc757cb7b60b09f04de2af0017bd191d4b7d50dd608b9ca0ad02ba73f0ef5b1ee3d49573f52f534b60fff44ee5fe9f71bd8a7e29f886c2c91656c326545f0f5e5ef6945226caeff93bf175098615774126f378c97f7ce9d8be83dbed704a1fa152fe9409fdd4d11cc742322947d552068bd6bb934abc95bcc1959bb955d84d8ac30a93fed6fd981629b865b266c39f7bf97464d81336312a4cfb31591ef37c0f6d7134f802ec6d6bbff4b92271631b9d465b81fc61b0e2b57c0f126eaf443b10fa39f2ef812b2775e9f9cf9b0fad07bff1e16ab5286d3ae56d7e64d5bcf59a88cbc073f91e714169ab95a2be92c34aa4217eeb16fa23f5972ffe0a697a4ac8ddbccad1b8e9f20f91197b54a56e2373b46d2f2580fb9766bf82647cdae7207eed1a991397638302218cce50345d8ed3172d1c00986a97ec6e7c130b03e319f2ff2e893a4b635632fa5f8f2a3589ffd52af128546fe26eaf823212
#TRUST-RSA-SHA256 79b6a2b77a46e3fd143af100940baeb6ec8f4ec4d0eeb9c34aa4ca1cc331d7b97199f5d46dbbb7c8ef51b2920fc2e3ea757589841faf917049c0a55fbf552652333132cbf6ff4314b628cd97f2544f7d740f82e6685edb371d116a39396c4363aaa8e7cf9783ef7d4737f4f1262ba0493d75836a5a555b19eff253b8c678b0f10a52ae3a5cc918d84c3dffbf0a8d88b7b53069bba3ca64296bfd5ce573795c299e1e047ea58ddf72a7ea0bbe595f3bd7bd8fcd023bc1d1cb0a2abcb72b2960b821c25949409d8157e2906931475566bdf7e8be93bdf9eede8e40bd521c00cc97d9a3da7897ea9c55d1fcd9b695a73d6852e4e1fde7c661096000c632651be06636e0bb48b4a6cb63f72808e3d8919e41add6bc0ee792bc6e709876eef660e3e650c76cb059b636c5188c85b7828db5d7a7340522c458c8eee4ca2477d55da1f5e67482d58be31ea196160675ae2144e074021dfd6b516716d0239a18c904f1100fc5aa634a1374413af0d596e2d17c2c37529cff7b62480335bf8ec330d07e333ba196f49a1f110198e91d7b514fe3677481b01ef718929cc374ee36a7506a7b95cecf573edf025d42b02af4eafdd3de0b2448523c70552ffeae5c6fa12fed65f8736f399d31cfc5e471e1a8a5038788b74f80449e6374d44aef1dcdf933183486027aab7ec767fee4f27765767ff4aa440f70976175c773c38994bc6f9d99d6
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.1 $
# $Date: 2024/06/17 $
#
# Description : This document implements the security configuration as recommended by the
#               DISA VMware vSphere 6.7 VAMI-lighttpd v1r3 STIG.
#
#<ui_metadata>
#<display_name>DISA STIG VMware vSphere 6.7 VAMI-lighttpd v1r3</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>VMware vSphere 6.7</name>
#  <profile>VAMI-lighttpd</profile>
#  <version>1.3.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip</link>
#</spec>
#<labels>unix,disa,vmware_vami_lighttpd,agent,update_20230227</labels>
#<benchmark_refs>CAT,CCE,CCI,DISA_Benchmark,Group-ID,Rule-ID,STIG-ID,STIG-Legacy,Vuln-ID</benchmark_refs>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : FILE_CHECK
      description : "Photon OS is installed"
      file        : "/opt/vmware/etc/lighttpd/lighttpd.conf"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "DISA_STIG_VMware_vSphere_6.7_VAMI-lighttpd_v1r3.audit from DISA VMware vSphere 6.7 VAMI-lighttpd v1r3 STIG"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
    </report>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "VCLD-67-000001 - VAMI must limit the number of simultaneous requests."
      info        : "Denial of service (DoS) is one threat against web servers. Many DoS attacks attempt to consume web server resources in such a way that no more resources are available to satisfy legitimate requests. Mitigation against these threats is to take steps to limit the number of resources that can be consumed in certain ways.

VAMI provides the 'maxConnections' attribute of the <Connector Elements> to limit the number of concurrent TCP connections. This comes preconfigured with a tested, supported value that must be verified and maintained."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

server.max-connections = 1024"
      reference   : "800-53|AC-10,800-53r5|AC-10,CAT|II,CCI|CCI-000054,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,Rule-ID|SV-239715r879511_rule,STIG-ID|VCLD-67-000001,Vuln-ID|V-239715"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      file        : "/opt/vmware/etc/lighttpd/lighttpd.conf"
      regex       : "^[\\s]*server.max-connections[\\s]*="
      expect      : "^[\\s]*server.max-connections[\\s]*=[\\s]*1024[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000002 - VAMI must be configured with FIPS 140-2 compliant ciphers for HTTPS connections."
      info        : "Encryption of data in flight is an essential element of protecting information confidentiality. If a web server uses weak or outdated encryption algorithms, the server's communications can potentially be compromised.

The U.S. Federal Information Processing Standards (FIPS) publication 140-2, Security Requirements for Cryptographic Modules (FIPS 140-2), identifies 11 areas for a cryptographic module used inside a security system that protects information. FIPS 140-2 approved ciphers provide the maximum level of encryption possible for a private web server.

VAMI is compiled to use VMware's FIPS-validated OpenSSL module and cannot be configured otherwise. Ciphers may still be specified in order of preference, but no non-FIPS-approved ciphers will be implemented.

Satisfies: SRG-APP-000014-WSR-000006, SRG-APP-000179-WSR-000111, SRG-APP-000416-WSR-000118, SRG-APP-000439-WSR-000188"
      solution    : "Navigate to and open /etc/applmgmt/appliance/lighttpd.conf.

Add or reconfigure the following value:

ssl.cipher-list                   = '!aNULL:kECDH+AESGCM:ECDH+AESGCM:RSA+AESGCM:kECDH+AES:ECDH+AES:RSA+AES'"
      reference   : "800-171|3.1.13,800-171|3.13.8,800-53|AC-17(2),800-53|IA-7,800-53|SC-8,800-53r5|AC-17(2),800-53r5|IA-7,800-53r5|SC-8,CAT|I,CCI|CCI-000068,CCI|CCI-000803,CCI|CCI-002418,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17(2),ITSG-33|IA-7,ITSG-33|IA-7a.,ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|M5.2.1,NESA|M5.2.6,NESA|M5.3.1,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.4.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,Rule-ID|SV-239716r879519_rule,STIG-ID|VCLD-67-000002,SWIFT-CSCv1|2.6,Vuln-ID|V-239716"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf| /usr/bin/grep 'ssl.cipher-list'"
      expect      : "^[\\s]*ssl.cipher-list[\\s]*=[\\s]*[\"']\\!aNULL:.*kECDH\\+AESGCM:ECDH\\+AESGCM:RSA\\+AESGCM:kECDH\\+AES:ECDH\\+AES:RSA\\+AES[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000003 - VAMI must use cryptography to protect the integrity of remote sessions."
      info        : "Data exchanged between the user and the web server can range from static display data to credentials used to log in to the hosted application. Even when data appears to be static, the non-displayed logic in a web page may expose business logic or trusted system relationships. The integrity of all the data being exchanged between the user and web server must always be trusted. To protect the integrity and trust, encryption methods should be used to protect the complete communication session.

To protect the integrity and confidentiality of the remote sessions, VAMI uses SSL/TLS.

Satisfies: SRG-APP-000015-WSR-000014, SRG-APP-000172-WSR-000104, SRG-APP-000315-WSR-000003, SRG-APP-000141-WSR-000076, SRG-APP-000439-WSR-000151, SRG-APP-000439-WSR-000152, SRG-APP-000442-WSR-000182"
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

ssl.engine = 'enable'"
      reference   : "800-171|3.1.12,800-171|3.1.13,800-171|3.4.6,800-171|3.4.7,800-171|3.5.10,800-171|3.13.8,800-53|AC-17(1),800-53|AC-17(2),800-53|CM-7a.,800-53|IA-5(1)(c),800-53|SC-8,800-53|SC-8(2),800-53r5|AC-17(1),800-53r5|AC-17(2),800-53r5|CM-7a.,800-53r5|IA-5(1)(c),800-53r5|SC-8,800-53r5|SC-8(2),CAT|II,CCI|CCI-000197,CCI|CCI-000381,CCI|CCI-001453,CCI|CCI-002314,CCI|CCI-002418,CCI|CCI-002422,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|7.1.3.5(c),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.4(a),CN-L3|8.1.4.4(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.1.10.6(i),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17(1),ITSG-33|AC-17(2),ITSG-33|CM-7a.,ITSG-33|IA-5(1)(c),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(2),ITSG-33|SC-9(2),NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.2.3,NESA|T5.4.2,NESA|T5.4.4,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|CY6,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS15a,NIAv2|SS24,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.3,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,Rule-ID|SV-239717r879520_rule,STIG-ID|VCLD-67-000003,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|26.1,Vuln-ID|V-239717"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf| /usr/bin/grep 'ssl.engine'"
      expect      : "^[\\s]*ssl.engine[\\s]*=[\\s]*[\"']enable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000004 - VAMI must be configured to monitor remote access."
      info        : "Remote access can be exploited by an attacker to compromise the server. By recording all remote access activities, it will be possible to determine the attacker's location, intent, and degree of success.

VAMI uses the 'mod_accesslog' module to log information relating to remote requests. These logs can then be piped to external monitoring systems.

Satisfies: SRG-APP-000016-WSR-000005"
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add the following value in the 'server.modules' section:

mod_accesslog

The result should be similar to the following:

    server.modules                    = (
        'mod_access',
        'mod_accesslog',
        'mod_proxy',
        'mod_cgi',
        'mod_rewrite',
        'mod_magnet',
        'mod_setenv',
        # 7
    )"
      reference   : "800-171|3.1.12,800-53|AC-17(1),800-53|AU-14(2),800-53r5|AC-17(1),800-53r5|AU-14,CAT|II,CCI|CCI-000067,CCI|CCI-001462,CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(i),CSF|PR.AC-3,CSF|PR.PT-1,CSF|PR.PT-4,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17(1),ITSG-33|AU-14a.,NESA|T5.4.4,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-239718r879521_rule,STIG-ID|VCLD-67-000004,SWIFT-CSCv1|2.6,SWIFT-CSCv1|6.4,Vuln-ID|V-239718"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'| /usr/bin/grep mod_accesslog"
      expect      : "^[\\s]*[\"']mod_accesslog[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000005 - VAMI must generate log records for system startup and shutdown."
      info        : "Logging must be started as soon as possible when a service starts and when a service is stopped. Many forms of suspicious actions can be detected by analyzing logs for unexpected service starts and stops. Also, by starting to log immediately after a service starts, it becomes more difficult for suspicious activity to go unlogged."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

server.errorlog = '/opt/vmware/var/log/lighttpd/error.log'"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12a.,800-53r5|AU-12a.,CAT|II,CCI|CCI-000169,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-12a.,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-239719r879559_rule,STIG-ID|VCLD-67-000005,SWIFT-CSCv1|6.4,Vuln-ID|V-239719"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'server.errorlog'"
      expect      : "^[\\s]*server.errorlog[\\s]*=[\\s]*[\"']/opt/vmware/var/log/lighttpd/error.log[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK_NOT
      description : "VCLD-67-000006 - VAMI must produce log records containing sufficient information to establish what type of events occurred."
      info        : "After a security incident has occurred, investigators will often review log files to determine what happened. Understanding what type of event occurred is critical for investigation of a suspicious event.

Satisfies: SRG-APP-000095-WSR-000056, SRG-APP-000096-WSR-000057, SRG-APP-000097-WSR-000058, SRG-APP-000098-WSR-000059, SRG-APP-000099-WSR-000061, SRG-APP-000100-WSR-000064, SRG-APP-000374-WSR-000172, SRG-APP-000375-WSR-000171"
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Comment any existing accesslog.format lines by adding a '#' at the beginning of the line."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.3.7,800-53|AU-3,800-53|AU-8b.,800-53r5|AU-3,800-53r5|AU-8b.,CAT|II,CCI|CCI-000130,CCI|CCI-000131,CCI|CCI-000132,CCI|CCI-000133,CCI|CCI-000134,CCI|CCI-001487,CCI|CCI-001889,CCI|CCI-001890,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-3,ITSG-33|AU-8,NESA|T3.6.2,NESA|T3.6.7,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-239720r879563_rule,STIG-ID|VCLD-67-000006,SWIFT-CSCv1|6.4,TBA-FIISB|37.4,Vuln-ID|V-239720"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      file        : "/opt/vmware/etc/lighttpd/lighttpd.conf"
      regex       : "^[\\s]*accesslog.format[\\s]*="
      expect      : "^[\\s]*accesslog.format[\\s]*="
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK
      description : "VCLD-67-000011 - VAMI log files must only be accessible by privileged users - access.log"
      info        : "Log data is essential in the investigation of events. If log data were to become compromised, competent forensic analysis and discovery of the true source of potentially malicious system activity would be difficult, if not impossible, to achieve.

In addition, access to log records provides information an attacker could potentially use to their advantage since each event record might contain communication ports, protocols, services, trust relationships, user names, etc.

Satisfies: SRG-APP-000118-WSR-000068, SRG-APP-000119-WSR-000069, SRG-APP-000120-WSR-000070"
      solution    : "At the command prompt, enter the following command:

# chown root:root /opt/vmware/var/log/lighttpd/*.log
# chmod 640 /opt/vmware/var/log/lighttpd/*.log"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CAT|II,CCI|CCI-000162,CCI|CCI-000163,CCI|CCI-000164,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-239721r879576_rule,STIG-ID|VCLD-67-000011,Vuln-ID|V-239721"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      file        : "/opt/vmware/var/log/lighttpd/access.log"
      owner       : "root"
      mask        : "137"
      group       : "root"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK
      description : "VCLD-67-000011 - VAMI log files must only be accessible by privileged users - error.log"
      info        : "Log data is essential in the investigation of events. If log data were to become compromised, competent forensic analysis and discovery of the true source of potentially malicious system activity would be difficult, if not impossible, to achieve.

In addition, access to log records provides information an attacker could potentially use to their advantage since each event record might contain communication ports, protocols, services, trust relationships, user names, etc.

Satisfies: SRG-APP-000118-WSR-000068, SRG-APP-000119-WSR-000069, SRG-APP-000120-WSR-000070"
      solution    : "At the command prompt, enter the following command:

# chown root:root /opt/vmware/var/log/lighttpd/*.log
# chmod 640 /opt/vmware/var/log/lighttpd/*.log"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CAT|II,CCI|CCI-000162,CCI|CCI-000163,CCI|CCI-000164,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-239721r879576_rule,STIG-ID|VCLD-67-000011,Vuln-ID|V-239721"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      file        : "/opt/vmware/var/log/lighttpd/error.log"
      owner       : "root"
      mask        : "137"
      group       : "root"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000014 - Rsyslog must be configured to monitor VAMI logs."
      info        : "For performance reasons, rsyslog file monitoring is preferred over configuring VAMI to send events to a syslog facility. Without ensuring that logs are created, that rsyslog configs are created, and that those configs are loaded, the log file monitoring and shipping will not be effective.

Satisfies: SRG-APP-000125-WSR-000071, SRG-APP-000358-WSR-000063, SRG-APP-000358-WSR-000163"
      solution    : "Navigate to and open /etc/vmware-syslog/stig-services-vami.conf.

Create the file if it does not exist.

Set the contents of the file as follows:

input(type='imfile' File='/opt/vmware/var/log/lighttpd/access.log'
Tag='vami-access'
Severity='info'
Facility='local0')"
      reference   : "800-171|3.3.8,800-53|AU-4(1),800-53|AU-9(2),800-53r5|AU-4(1),800-53r5|AU-9(2),CAT|II,CCI|CCI-001348,CCI|CCI-001851,CN-L3|8.1.3.5(d),CN-L3|8.1.4.3(c),CSF|PR.DS-4,CSF|PR.PT-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-4,ITSG-33|AU-9(2),NESA|M5.2.3,NESA|M5.5.2,NESA|T3.3.1,NESA|T3.6.2,NIAv2|SS13e,PCI-DSSv3.2.1|10.5.3,PCI-DSSv3.2.1|10.5.4,PCI-DSSv4.0|10.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-239722r879582_rule,STIG-ID|VCLD-67-000014,Vuln-ID|V-239722"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/usr/bin/echo $(/usr/bin/cat /etc/vmware-syslog/stig-services-vami.conf | /usr/bin/grep -v '^#')"
      expect      : "input\\(type=\"imfile\" File=\"/opt/vmware/var/log/lighttpd/access.log\" Tag=\"vami-access\" Severity=\"info\" Facility=\"local0\"\\)"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000015 - VAMI server binaries and libraries must be verified for their integrity."
      info        : "Being able to verify that a patch, upgrade, certificate, etc., being added to the web server is unchanged from the producer of the file is essential for file validation and non-repudiation of the information.

VMware delivers product updates and patches regularly. When VAMI is updated, the signed packages will also be updated. These packages can be used to verify that VAMI has not been inappropriately modified since it was installed."
      solution    : "If the VAMI binaries have been modified from the default state when deployed as part of the VCSA, the system must be wiped and redeployed or restored from backup.

VMware does not recommend or support recovering from such a state by reinstalling RPMs or similar efforts."
      reference   : "800-171|3.4.5,800-53|CM-5(3),800-53r5|CM-14,CAT|II,CCI|CCI-001749,CSF|PR.IP-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(3),NESA|T3.2.3,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,QCSC-v1|7.2,Rule-ID|SV-239723r879584_rule,STIG-ID|VCLD-67-000015,Vuln-ID|V-239723"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/usr/bin/rpm -qa | /usr/bin/grep lighttpd | /usr/bin/xargs /usr/bin/rpm -V | /usr/bin/grep -vE 'lighttpd.conf|vami-lighttp.*\.service' | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "^pass$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000016 - VAMI must only load allowed server modules - mod_access"
      info        : "A web server can provide many features, services, and processes. Some of these may be deemed unnecessary or too unsecure to run on a production DoD system.

VAMI can be configured to load any number of external modules, but only a specific few are provided and supported by VMware. Additional, unexpected modules must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'server.modules' section to the following:

server.modules = (
  'mod_access',
  'mod_accesslog',
  'mod_proxy',
  'mod_cgi',
  'mod_rewrite',
)
server.modules += ( 'mod_magnet' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239724r879587_rule,STIG-ID|VCLD-67-000016,SWIFT-CSCv1|2.3,Vuln-ID|V-239724"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'"
      expect      : "^[\\s]*[\"']mod_access[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000016 - VAMI must only load allowed server modules - mod_accesslog"
      info        : "A web server can provide many features, services, and processes. Some of these may be deemed unnecessary or too unsecure to run on a production DoD system.

VAMI can be configured to load any number of external modules, but only a specific few are provided and supported by VMware. Additional, unexpected modules must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'server.modules' section to the following:

server.modules = (
  'mod_access',
  'mod_accesslog',
  'mod_proxy',
  'mod_cgi',
  'mod_rewrite',
)
server.modules += ( 'mod_magnet' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239724r879587_rule,STIG-ID|VCLD-67-000016,SWIFT-CSCv1|2.3,Vuln-ID|V-239724"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'"
      expect      : "^[\\s]*[\"']mod_accesslog[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000016 - VAMI must only load allowed server modules - mod_proxy"
      info        : "A web server can provide many features, services, and processes. Some of these may be deemed unnecessary or too unsecure to run on a production DoD system.

VAMI can be configured to load any number of external modules, but only a specific few are provided and supported by VMware. Additional, unexpected modules must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'server.modules' section to the following:

server.modules = (
  'mod_access',
  'mod_accesslog',
  'mod_proxy',
  'mod_cgi',
  'mod_rewrite',
)
server.modules += ( 'mod_magnet' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239724r879587_rule,STIG-ID|VCLD-67-000016,SWIFT-CSCv1|2.3,Vuln-ID|V-239724"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'"
      expect      : "^[\\s]*[\"']mod_proxy[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000016 - VAMI must only load allowed server modules - mod_cgi"
      info        : "A web server can provide many features, services, and processes. Some of these may be deemed unnecessary or too unsecure to run on a production DoD system.

VAMI can be configured to load any number of external modules, but only a specific few are provided and supported by VMware. Additional, unexpected modules must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'server.modules' section to the following:

server.modules = (
  'mod_access',
  'mod_accesslog',
  'mod_proxy',
  'mod_cgi',
  'mod_rewrite',
)
server.modules += ( 'mod_magnet' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239724r879587_rule,STIG-ID|VCLD-67-000016,SWIFT-CSCv1|2.3,Vuln-ID|V-239724"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'"
      expect      : "^[\\s]*[\"']mod_cgi[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000016 - VAMI must only load allowed server modules - mod_rewrite"
      info        : "A web server can provide many features, services, and processes. Some of these may be deemed unnecessary or too unsecure to run on a production DoD system.

VAMI can be configured to load any number of external modules, but only a specific few are provided and supported by VMware. Additional, unexpected modules must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'server.modules' section to the following:

server.modules = (
  'mod_access',
  'mod_accesslog',
  'mod_proxy',
  'mod_cgi',
  'mod_rewrite',
)
server.modules += ( 'mod_magnet' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239724r879587_rule,STIG-ID|VCLD-67-000016,SWIFT-CSCv1|2.3,Vuln-ID|V-239724"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'"
      expect      : "^[\\s]*[\"']mod_rewrite[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000016 - VAMI must only load allowed server modules - mod_magnet"
      info        : "A web server can provide many features, services, and processes. Some of these may be deemed unnecessary or too unsecure to run on a production DoD system.

VAMI can be configured to load any number of external modules, but only a specific few are provided and supported by VMware. Additional, unexpected modules must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'server.modules' section to the following:

server.modules = (
  'mod_access',
  'mod_accesslog',
  'mod_proxy',
  'mod_cgi',
  'mod_rewrite',
)
server.modules += ( 'mod_magnet' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239724r879587_rule,STIG-ID|VCLD-67-000016,SWIFT-CSCv1|2.3,Vuln-ID|V-239724"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'"
      expect      : "^[\\s]*[\"']mod_magnet[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000016 - VAMI must only load allowed server modules - mod_setenv"
      info        : "A web server can provide many features, services, and processes. Some of these may be deemed unnecessary or too unsecure to run on a production DoD system.

VAMI can be configured to load any number of external modules, but only a specific few are provided and supported by VMware. Additional, unexpected modules must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'server.modules' section to the following:

server.modules = (
  'mod_access',
  'mod_accesslog',
  'mod_proxy',
  'mod_cgi',
  'mod_rewrite',
)
server.modules += ( 'mod_magnet' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239724r879587_rule,STIG-ID|VCLD-67-000016,SWIFT-CSCv1|2.3,Vuln-ID|V-239724"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/'"
      expect      : "^[\\s]*[\"']mod_setenv[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000017 - VAMI must have Multipurpose Internet Mail Extensions (MIME) that invoke OS shell programs disabled."
      info        : "Controlling what a user of a hosted application can access is part of the security posture of the web server. Any time a user can access more functionality than is needed for the operation of the hosted application poses a security issue. A user with too much access can view information that is not needed for the user's job role, or the user could use the function in an unintentional manner.

A MIME tells the web server what type of program various file types and extensions are and what external utilities or programs are needed to execute the file type. There is no reason for VAMI to have MIME types configured for shell scripts."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Remove any lines that reference '.sh' or '.csh' from the 'mimetype.assign' section."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239725r879587_rule,STIG-ID|VCLD-67-000017,SWIFT-CSCv1|2.3,Vuln-ID|V-239725"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/mimetype\.assign/,/\)/' | /usr/bin/grep -E '\\.sh|\\.csh' | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "^pass$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000018 - VAMI must explicitly disable Multipurpose Internet Mail Extensions (MIME) mappings based on 'Content-Type' - Content-Type."
      info        : "Controlling what a user of a hosted application can access is part of the security posture of the web server. Any time a user can access more functionality than is needed for the operation of the hosted application poses a security issue. A user with too much access can view information that is not needed for the user's job role, or the user could use the function in an unintentional manner.

A MIME tells the web server what type of program various file types and extensions are and what external utilities or programs are needed to execute the file type. A limited number of MIME types must be configured manually and automatic mapping must be disabled."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

mimetype.use-xattr        = 'disable'"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239726r879587_rule,STIG-ID|VCLD-67-000018,SWIFT-CSCv1|2.3,Vuln-ID|V-239726"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'mimetype.use-xattr'"
      expect      : "^[\\s]*mimetype.use-xattr[\\s]*=[\\s]*[\"']disable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000019 - VAMI must remove all mappings to unused scripts - pl"
      info        : "Scripts allow server-side processing on behalf of the hosted application user or as processes needed in the implementation of hosted applications. Removing scripts not needed for application operation or deemed vulnerable helps to secure the web server. To ensure scripts are not added to the web server and run maliciously, script mappings that are not needed or used by the web server for hosted application operation must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'cgi.assign' section to the following:

    cgi.assign                        = (
        '.pl'  => '/usr/bin/perl',
        '.cgi' => '/usr/bin/perl',
        '.rb'  => '/usr/bin/ruby',
        '.erb' => '/usr/bin/eruby',
        '.py'  => '/usr/bin/python',
        # 5
    )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239727r879587_rule,STIG-ID|VCLD-67-000019,SWIFT-CSCv1|2.3,Vuln-ID|V-239727"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/cgi\.assign/,/\)/'"
      expect      : "^[\\s]*[\"'].pl[\"'][\\s]*=>[\\s]*[\"']/usr/bin/perl[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000019 - VAMI must remove all mappings to unused scripts - cgi"
      info        : "Scripts allow server-side processing on behalf of the hosted application user or as processes needed in the implementation of hosted applications. Removing scripts not needed for application operation or deemed vulnerable helps to secure the web server. To ensure scripts are not added to the web server and run maliciously, script mappings that are not needed or used by the web server for hosted application operation must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'cgi.assign' section to the following:

    cgi.assign                        = (
        '.pl'  => '/usr/bin/perl',
        '.cgi' => '/usr/bin/perl',
        '.rb'  => '/usr/bin/ruby',
        '.erb' => '/usr/bin/eruby',
        '.py'  => '/usr/bin/python',
        # 5
    )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239727r879587_rule,STIG-ID|VCLD-67-000019,SWIFT-CSCv1|2.3,Vuln-ID|V-239727"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/cgi\.assign/,/\)/'"
      expect      : "^[\\s]*[\"'].cgi[\"'][\\s]*=>[\\s]*[\"']/usr/bin/perl[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000019 - VAMI must remove all mappings to unused scripts - rb"
      info        : "Scripts allow server-side processing on behalf of the hosted application user or as processes needed in the implementation of hosted applications. Removing scripts not needed for application operation or deemed vulnerable helps to secure the web server. To ensure scripts are not added to the web server and run maliciously, script mappings that are not needed or used by the web server for hosted application operation must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'cgi.assign' section to the following:

    cgi.assign                        = (
        '.pl'  => '/usr/bin/perl',
        '.cgi' => '/usr/bin/perl',
        '.rb'  => '/usr/bin/ruby',
        '.erb' => '/usr/bin/eruby',
        '.py'  => '/usr/bin/python',
        # 5
    )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239727r879587_rule,STIG-ID|VCLD-67-000019,SWIFT-CSCv1|2.3,Vuln-ID|V-239727"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/cgi\.assign/,/\)/'"
      expect      : "^[\\s]*[\"'].rb[\"'][\\s]*=>[\\s]*[\"']/usr/bin/ruby[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000019 - VAMI must remove all mappings to unused scripts - erb"
      info        : "Scripts allow server-side processing on behalf of the hosted application user or as processes needed in the implementation of hosted applications. Removing scripts not needed for application operation or deemed vulnerable helps to secure the web server. To ensure scripts are not added to the web server and run maliciously, script mappings that are not needed or used by the web server for hosted application operation must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'cgi.assign' section to the following:

    cgi.assign                        = (
        '.pl'  => '/usr/bin/perl',
        '.cgi' => '/usr/bin/perl',
        '.rb'  => '/usr/bin/ruby',
        '.erb' => '/usr/bin/eruby',
        '.py'  => '/usr/bin/python',
        # 5
    )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239727r879587_rule,STIG-ID|VCLD-67-000019,SWIFT-CSCv1|2.3,Vuln-ID|V-239727"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/cgi\.assign/,/\)/'"
      expect      : "^[\\s]*[\"'].erb[\"'][\\s]*=>[\\s]*[\"']/usr/bin/eruby[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000019 - VAMI must remove all mappings to unused scripts - py"
      info        : "Scripts allow server-side processing on behalf of the hosted application user or as processes needed in the implementation of hosted applications. Removing scripts not needed for application operation or deemed vulnerable helps to secure the web server. To ensure scripts are not added to the web server and run maliciously, script mappings that are not needed or used by the web server for hosted application operation must be removed."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Configure the 'cgi.assign' section to the following:

    cgi.assign                        = (
        '.pl'  => '/usr/bin/perl',
        '.cgi' => '/usr/bin/perl',
        '.rb'  => '/usr/bin/ruby',
        '.erb' => '/usr/bin/eruby',
        '.py'  => '/usr/bin/python',
        # 5
    )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239727r879587_rule,STIG-ID|VCLD-67-000019,SWIFT-CSCv1|2.3,Vuln-ID|V-239727"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/cgi\.assign/,/\)/'"
      expect      : "^[\\s]*[\"'].py[\"'][\\s]*=>[\\s]*[\"']/usr/bin/python[\"'][\\s]*,[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000020 - VAMI must have resource mappings set to disable the serving of certain file types."
      info        : "Resource mapping is the process of tying a particular file type to a process in the web server that can serve that type of file to a requesting client and identify which file types are not to be delivered to a client.

By not specifying which files can and cannot be served to a user, VAMI could potentially deliver sensitive files."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

url.access-deny             = ( '~', '.inc' )"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239728r879587_rule,STIG-ID|VCLD-67-000020,SWIFT-CSCv1|2.3,Vuln-ID|V-239728"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'url.access-deny'"
      expect      : "^[\\s]*url.access-deny[\\s]*=[\\s]*\\([\\s]*[\"']~[\"'],[\\s]*[\"'].inc[\"'][\\s]*\\)[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000021 - VAMI must not have the Web Distributed Authoring (WebDAV) servlet installed."
      info        : "A web server can be installed with functionality that, by its nature, is not secure. WebDAV is an extension to the HTTP protocol that, when developed, was meant to allow users to create, change, and move documents on a server, typically a web server or web share. Allowing this functionality, development, and deployment is much easier for web authors.

WebDAV is not widely used and has serious security concerns because it may allow clients to modify unauthorized files on the web server."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Delete or comment out the 'mod_webdav' line.

The line may be in an included config and not in the parent config."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239729r879587_rule,STIG-ID|VCLD-67-000021,SWIFT-CSCv1|2.3,Vuln-ID|V-239729"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/' | /usr/bin/grep mod_webdav | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "^pass$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000022 - VAMI must prevent hosted applications from exhausting system resources."
      info        : "Most of the attention to denial-of-service (DoS) attacks focuses on ensuring that systems and applications are not victims of these attacks. However, these systems and applications must also be secured against use to launch such an attack against others.

A variety of technologies exist to limit or, in some cases, eliminate the effects of DoS attacks. Limiting system resources that are allocated to any user to a bare minimum may also reduce the ability of users to launch some DoS attacks.

One DoS mitigation is to prevent VAMI from keeping idle connections open for too long."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf file.

Add or reconfigure the following value:

server.max-keep-alive-idle = 30"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239730r879587_rule,STIG-ID|VCLD-67-000022,SWIFT-CSCv1|2.3,Vuln-ID|V-239730"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'server.max-keep-alive-idle'"
      expect      : "^[\\s]*server.max-keep-alive-idle[\\s]*=[\\s]*30[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000023 - VAMI must not have any symbolic links in the web content directory tree."
      info        : "A web server is designed to deliver content and execute scripts or applications on the request of a client or user. Containing user requests to files in the directory tree of the hosted web application and limiting the execution of scripts and applications guarantees that the user is not accessing information protected outside the application's realm.

By checking that no symbolic links exist in the document root, the web server is protected from users jumping outside the hosted application directory tree and gaining access to the other directories, including the system root."
      solution    : "At the command prompt, enter the following command:

# unlink <file_name>

Note: Replace <file_name> for the name of any files that were returned.

Repeat the command for each file that was listed."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-239731r879587_rule,STIG-ID|VCLD-67-000023,SWIFT-CSCv1|2.3,Vuln-ID|V-239731"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/usr/bin/find /opt/vmware/share/htdocs -type l | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "^pass$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK
      description : "VCLD-67-000025 - VAMI must protect the keystore from unauthorized access."
      info        : "The web server's private key is used to prove the identity of the server to clients and securely exchange the shared secret key used to encrypt communications between the web server and clients. By gaining access to the private key, an attacker can pretend to be an authorized server and decrypt the SSL traffic between a client and the web server."
      solution    : "At the command prompt, execute the following commands:

# chown root:root /etc/applmgmt/appliance/server.pem
# chmod 600 /etc/applmgmt/appliance/server.pem"
      reference   : "800-171|3.5.2,800-53|IA-5(2)(b),800-53r5|IA-5(2)(b),CAT|II,CCI|CCI-000186,CSF|PR.AC-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(2)(b),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-239732r879613_rule,STIG-ID|VCLD-67-000025,Vuln-ID|V-239732"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      file        : "/etc/applmgmt/appliance/server.pem"
      owner       : "root"
      mask        : "177"
      group       : "root"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000026 - VAMI must restrict access to the web root."
      info        : "As a rule, accounts on a web server are to be kept to a minimum, and those accounts are then restricted as to what they are allowed to access. The web root of the VAMI Lighttpd installation contains the content that is served up to the end user. This content must have the minimum necessary permissions and proper ownership to help protect against unprivileged modification of the content."
      solution    : "At the command prompt, execute the following commands:

# chmod 0755 <directory>
# chown root:root <directory>

Note: Substitute <directory> with each directory returned from the check."
      reference   : "800-171|3.13.3,800-53|SC-2,800-53r5|SC-2,CAT|II,CCI|CCI-001082,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-2,ITSG-33|SC-2a.,NESA|T3.4.1,NIAv2|SS15b,Rule-ID|SV-239733r879631_rule,STIG-ID|VCLD-67-000026,Vuln-ID|V-239733"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/usr/bin/find /opt/vmware/share/htdocs/ -xdev -type d -a '(' -not -perm 0755 -o -not -user root -o -not -group root ')' -exec ls -ld {} \\; | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "^pass$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000027 - VAMI must protect against or limit the effects of HTTP types of denial-of-service (DoS) attacks."
      info        : "In UNIX and related computer operating systems, a file descriptor is an indicator used to access a file or other input/output resource, such as a pipe or network connection. File descriptors index into a per-process file descriptor table maintained by the kernel, which in turn indexes into a system-wide table of files opened by all processes, called the file table.

As a single-threaded server, Lighttpd must be limited in the number of file descriptors that can be allocated. This will prevent Lighttpd from being used in a form of DoS attack against the operating system."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

server.max-fds = 2048"
      reference   : "800-53|SC-5(1),800-53r5|SC-5(1),CAT|II,CCI|CCI-001094,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5(1),NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-239734r879650_rule,STIG-ID|VCLD-67-000027,Vuln-ID|V-239734"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'server.max-fds'"
      expect      : "^[\\s]*server.max-fds[\\s]*=[\\s]*2048[\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000028 - VAMI must set the encoding for all text mime types to UTF-8."
      info        : "Invalid user input occurs when a user inserts data or characters into a hosted application's data entry field and the hosted application is unprepared to process that data. This results in unanticipated application behavior, potentially leading to an application compromise. Invalid user input is one of the primary methods employed when attempting to compromise an application.

An attacker can also enter Unicode into hosted applications in an effort to break out of the document home or root home directory or to bypass security checks."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Navigate to the 'mimetype.assign' block.

Replace all the mappings whose assigned type is 'text/*' with mappings for UTF-8 encoding, as follows:

  '.css'          =>      'text/css; charset=utf-8',
  '.html'         =>      'text/html; charset=utf-8',
  '.htm'          =>      'text/html; charset=utf-8',
  '.js'           =>      'text/javascript; charset=utf-8',
  '.asc'          =>      'text/plain; charset=utf-8',
  '.c'            =>      'text/plain; charset=utf-8',
  '.cpp'          =>      'text/plain; charset=utf-8',
  '.log'          =>      'text/plain; charset=utf-8',
  '.conf'         =>      'text/plain; charset=utf-8',
  '.text'         =>      'text/plain; charset=utf-8',
  '.txt'          =>      'text/plain; charset=utf-8',
  '.spec'         =>      'text/plain; charset=utf-8',
  '.dtd'          =>      'text/xml; charset=utf-8',
  '.xml'          =>      'text/xml; charset=utf-8',"
      reference   : "800-53|SI-10,800-53r5|SI-10,CAT|II,CCI|CCI-001310,CN-L3|8.1.4.4(d),DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-10,ITSG-33|SI-10a.,NESA|T7.3.1,NESA|T7.3.2,NIAv2|SS6e,Rule-ID|SV-239735r879652_rule,STIG-ID|VCLD-67-000028,Vuln-ID|V-239735"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/mimetype\.assign/,/\)/' | /usr/bin/grep 'text/' | /usr/bin/grep -v 'charset=utf-8' | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "^pass$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000029 - VAMI must disable directory browsing."
      info        : "The goal is to completely control the web user's experience in navigating any portion of the web document root directories. Ensuring all web content directories have at least the equivalent of an 'index.html' file is a significant factor to accomplish this end.

Enumeration techniques, such as URL parameter manipulation, rely on being able to obtain information about the web server's directory structure by locating directories without default pages. In this scenario, the web server will display to the user a listing of the files in the directory being accessed. By having a default hosted application web page, the anonymous web user will not obtain directory browsing information or an error message that reveals the server type and version."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

 dir-listing.activate  = 'disable'"
      reference   : "800-53|SI-11a.,800-53r5|SI-11a.,CAT|II,CCI|CCI-001312,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11b.,Rule-ID|SV-239736r879655_rule,STIG-ID|VCLD-67-000029,Vuln-ID|V-239736"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'dir-listing.activate'"
      expect      : "^[\\s]*dir-listing.activate[\\s]*=[\\s]*[\"']disable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000030 - VAMI must not be configured to use 'mod_status' - mod_status."
      info        : "Any application providing too much information in error logs and in administrative messages to the screen risks compromising the data and security of the application and system.

VAMI must only generate error messages that provide information necessary for corrective actions without revealing sensitive or potentially harmful information in error logs and administrative messages. The 'mod_status' module generates the status overview of the webserver.

The information covers:

- uptime
- average throughput
- current throughput
- active connections and their state

While this information is useful on a development system, production systems must not have 'mod_status' enabled."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Remove the line containing 'mod_status'.

The line may be in an included config and not in the parent config itself."
      reference   : "800-53|SI-11a.,800-53r5|SI-11a.,CAT|II,CCI|CCI-001312,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11b.,Rule-ID|SV-239737r879655_rule,STIG-ID|VCLD-67-000030,Vuln-ID|V-239737"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/awk '/server\.modules/,/\)/' | /usr/bin/grep 'text/' | /usr/bin/grep -v mod_status | /usr/bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "^pass$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000031 - VAMI must have debug logging disabled."
      info        : "Information needed by an attacker to begin looking for possible vulnerabilities in a web server includes any information about the web server and plug-ins or modules being used. When debugging or trace information is enabled in a production web server, information about the web server, such as web server type, version, patches installed, plug-ins and modules installed, type of code being used by the hosted application, and any backends being used for data storage, may be displayed.

Since this information may be placed in logs and general messages during normal operation of the web server, an attacker does not need to cause an error condition to gain this information."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Add or reconfigure the following value:

debug.log-request-handling = 'disable'"
      reference   : "800-53|SI-11a.,800-53r5|SI-11a.,CAT|II,CCI|CCI-001312,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11b.,Rule-ID|SV-239738r879655_rule,STIG-ID|VCLD-67-000031,Vuln-ID|V-239738"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'debug.log-request-handling'"
      expect      : "^[\\s]*debug.log-request-handling[\\s]*=[\\s]*[\"']disable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK
      description : "VCLD-67-000032 - VAMI configuration files must be protected from unauthorized access - opt"
      info        : "Accounts on the VAMI server are to be kept to a minimum. Only administrators, web managers, developers, auditors, and web authors require accounts on the machine hosting the Lighttpd server. The resources to which these accounts have access must also be closely monitored and controlled. Only the system administrator needs access to all of the system's capabilities, while the web administrator and associated staff require access and control of the web content and the Lighttpd server configuration files."
      solution    : "At the command prompt, enter the following command:

# chmod 644 <file>
# chown root:root <file>

Note: Replace <file> with every file returned from the command in the check."
      reference   : "800-171|3.4.5,800-53|CM-5(1),800-53r5|CM-5(1),CAT|II,CCI|CCI-001813,CSF|PR.IP-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(1),NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,QCSC-v1|7.2,Rule-ID|SV-239739r879753_rule,STIG-ID|VCLD-67-000032,Vuln-ID|V-239739"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      file        : "/opt/vmware/etc/lighttpd/lighttpd.conf"
      owner       : "root"
      mask        : "133"
      group       : "root"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK
      description : "VCLD-67-000032 - VAMI configuration files must be protected from unauthorized access - etc"
      info        : "Accounts on the VAMI server are to be kept to a minimum. Only administrators, web managers, developers, auditors, and web authors require accounts on the machine hosting the Lighttpd server. The resources to which these accounts have access must also be closely monitored and controlled. Only the system administrator needs access to all of the system's capabilities, while the web administrator and associated staff require access and control of the web content and the Lighttpd server configuration files."
      solution    : "At the command prompt, enter the following command:

# chmod 644 <file>
# chown root:root <file>

Note: Replace <file> with every file returned from the command in the check."
      reference   : "800-171|3.4.5,800-53|CM-5(1),800-53r5|CM-5(1),CAT|II,CCI|CCI-001813,CSF|PR.IP-1,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(1),NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,QCSC-v1|7.2,Rule-ID|SV-239739r879753_rule,STIG-ID|VCLD-67-000032,Vuln-ID|V-239739"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      file        : "/etc/applmgmt/appliance/lighttpd.conf"
      owner       : "root"
      mask        : "133"
      group       : "root"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000033 - VAMI must be protected from being stopped by a non-privileged user."
      info        : "An attacker has at least two reasons to stop a web server. The first is to cause a denial of service, and the second is to put in place changes the attacker made to the web server configuration. Therefore, only administrators should ever be able to stop VAMI.

The VAMI is configured out of the box to be owned by root. This configuration must be verified and maintained."
      solution    : "Navigate to and open /usr/lib/systemd/system/vami-lighttp.service in a text editor.

Under the '[Service]' section, remove the line that beings with 'User='.

At the command prompt, execute the following command:

# service vami-lighttp restart"
      reference   : "800-53|SC-5,800-53r5|SC-5,CAT|II,CCI|CCI-002385,CSF|DE.CM-1,CSF|PR.DS-4,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5,ITSG-33|SC-5a.,NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-239740r879806_rule,STIG-ID|VCLD-67-000033,Vuln-ID|V-239740"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/usr/bin/ps -f -U root | /usr/bin/awk '$0 ~ /vami-lighttpd/ && $0 !~ /awk/ {print $1}'"
      expect      : "^root$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000034 - VAMI must implement TLS1.2 exclusively - tlsv12"
      info        : "Transport Layer Security (TLS) is a required transmission protocol for a web server hosting controlled information. The use of TLS provides confidentiality of data in transit between the web server and client. FIPS 140-2 approved TLS versions must be enabled, and non-FIPS-approved SSL versions must be disabled.

VAMI comes configured to use only TLS 1.2. This configuration must be verified and maintained."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Replace any and all 'ssl.use-*' lines with following:

ssl.use-tlsv12 = 'enable'
ssl.use-sslv2 = 'disable'
ssl.use-sslv3 = 'disable'
ssl.use-tlsv10 = 'disable'
ssl.use-tlsv11 = 'disable'"
      reference   : "800-171|3.13.8,800-53|SC-8,800-53r5|SC-8,CAT|I,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-239741r879810_rule,STIG-ID|VCLD-67-000034,Vuln-ID|V-239741"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'ssl.use'"
      expect      : "^[\\s]*ssl.use-tlsv12[\\s]*=[\\s]*[\"']enable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000034 - VAMI must implement TLS1.2 exclusively - sslv2"
      info        : "Transport Layer Security (TLS) is a required transmission protocol for a web server hosting controlled information. The use of TLS provides confidentiality of data in transit between the web server and client. FIPS 140-2 approved TLS versions must be enabled, and non-FIPS-approved SSL versions must be disabled.

VAMI comes configured to use only TLS 1.2. This configuration must be verified and maintained."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Replace any and all 'ssl.use-*' lines with following:

ssl.use-tlsv12 = 'enable'
ssl.use-sslv2 = 'disable'
ssl.use-sslv3 = 'disable'
ssl.use-tlsv10 = 'disable'
ssl.use-tlsv11 = 'disable'"
      reference   : "800-171|3.13.8,800-53|SC-8,800-53r5|SC-8,CAT|I,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-239741r879810_rule,STIG-ID|VCLD-67-000034,Vuln-ID|V-239741"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'ssl.use'"
      expect      : "^[\\s]*ssl.use-sslv2[\\s]*=[\\s]*[\"']disable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000034 - VAMI must implement TLS1.2 exclusively - sslv3"
      info        : "Transport Layer Security (TLS) is a required transmission protocol for a web server hosting controlled information. The use of TLS provides confidentiality of data in transit between the web server and client. FIPS 140-2 approved TLS versions must be enabled, and non-FIPS-approved SSL versions must be disabled.

VAMI comes configured to use only TLS 1.2. This configuration must be verified and maintained."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Replace any and all 'ssl.use-*' lines with following:

ssl.use-tlsv12 = 'enable'
ssl.use-sslv2 = 'disable'
ssl.use-sslv3 = 'disable'
ssl.use-tlsv10 = 'disable'
ssl.use-tlsv11 = 'disable'"
      reference   : "800-171|3.13.8,800-53|SC-8,800-53r5|SC-8,CAT|I,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-239741r879810_rule,STIG-ID|VCLD-67-000034,Vuln-ID|V-239741"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'ssl.use'"
      expect      : "^[\\s]*ssl.use-sslv3[\\s]*=[\\s]*[\"']disable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000034 - VAMI must implement TLS1.2 exclusively - tlsv10"
      info        : "Transport Layer Security (TLS) is a required transmission protocol for a web server hosting controlled information. The use of TLS provides confidentiality of data in transit between the web server and client. FIPS 140-2 approved TLS versions must be enabled, and non-FIPS-approved SSL versions must be disabled.

VAMI comes configured to use only TLS 1.2. This configuration must be verified and maintained."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Replace any and all 'ssl.use-*' lines with following:

ssl.use-tlsv12 = 'enable'
ssl.use-sslv2 = 'disable'
ssl.use-sslv3 = 'disable'
ssl.use-tlsv10 = 'disable'
ssl.use-tlsv11 = 'disable'"
      reference   : "800-171|3.13.8,800-53|SC-8,800-53r5|SC-8,CAT|I,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-239741r879810_rule,STIG-ID|VCLD-67-000034,Vuln-ID|V-239741"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'ssl.use'"
      expect      : "^[\\s]*ssl.use-tlsv10[\\s]*=[\\s]*[\"']disable[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "VCLD-67-000034 - VAMI must implement TLS1.2 exclusively - tlsv11"
      info        : "Transport Layer Security (TLS) is a required transmission protocol for a web server hosting controlled information. The use of TLS provides confidentiality of data in transit between the web server and client. FIPS 140-2 approved TLS versions must be enabled, and non-FIPS-approved SSL versions must be disabled.

VAMI comes configured to use only TLS 1.2. This configuration must be verified and maintained."
      solution    : "Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf.

Replace any and all 'ssl.use-*' lines with following:

ssl.use-tlsv12 = 'enable'
ssl.use-sslv2 = 'disable'
ssl.use-sslv3 = 'disable'
ssl.use-tlsv10 = 'disable'
ssl.use-tlsv11 = 'disable'"
      reference   : "800-171|3.13.8,800-53|SC-8,800-53r5|SC-8,CAT|I,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-239741r879810_rule,STIG-ID|VCLD-67-000034,Vuln-ID|V-239741"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
      cmd         : "/opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf | /usr/bin/grep 'ssl.use'"
      expect      : "^[\\s]*ssl.use-tlsv11[\\s]*=[\\s]*[\"']disable[\"'][\\s]*$"
    </custom_item>

    <report type:"WARNING">
      description : "VCLD-67-000999 - The version of VAMI-lighttpd running on the system must be a supported version."
      info        : "Security flaws with software applications are discovered daily. Vendors are constantly updating and patching their products to address newly discovered security vulnerabilities. Organizations (including any contractor to the organization) are required to promptly install security-relevant software updates (e.g., patches, service packs, and hot fixes). Flaws discovered during security assessments, continuous monitoring, incident response activities, or information system error handling must also be addressed expeditiously.

Organization-defined time periods for updating security-relevant software may vary based on a variety of factors including, for example, the security category of the information system or the criticality of the update (i.e., severity of the vulnerability related to the discovered flaw).

This requirement will apply to software patch management solutions that are used to install patches across the enclave and to applications that are not part of that patch management solution. For example, many browsers today provide the capability to install their own patch software. Patch criticality, as well as system criticality, will vary. Therefore, the tactical situations regarding the patch management process will also vary. This means the time period used must be a configurable parameter. Time frames for application of security-relevant software updates may be dependent upon the Information Assurance Vulnerability Management (IAVM) process.

The application will be configured to check for and install security-relevant software updates within an identified time period from the availability of the update. The specific time period will be defined by an authoritative source (e.g., IAVM, CTOs, DTMs, and STIGs).

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Upgrade to a supported version."
      reference   : "800-171|3.14.1,800-53|SI-2c.,800-53r5|SI-2c.,CAT|I,CCI|CCI-002605,CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|ID.RA-1,CSF|PR.IP-12,DISA_Benchmark|VMW_vSphere_6-7_VAMI-lighttpd_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-2,NESA|T7.6.2,NESA|T7.7.1,NIAv2|AM38,NIAv2|AM39,NIAv2|SS14b,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,QCSC-v1|11.2,Rule-ID|SV-257285r919286_rule,STIG-ID|VCLD-67-000999,SWIFT-CSCv1|2.2,Vuln-ID|V-257285"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
    </report>
  </then>

  <else>
    <report type:"WARNING">
      description : "DISA_STIG_VMware_vSphere_6.7_VAMI-lighttpd_v1r3.audit from DISA VMware vSphere 6.7 VAMI-lighttpd v1r3 STIG"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_6-7_Y23M07_STIG.zip"
    </report>
  </else>
</if>

</check_type>
