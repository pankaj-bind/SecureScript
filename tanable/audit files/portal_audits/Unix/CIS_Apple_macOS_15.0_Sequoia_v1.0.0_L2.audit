#TRUSTED 8de6b7b6fec7fa0e79f84e7bf7ad70f02b9986a2afd03dcc208523640209914849f8317521fb208c738032ae9086ea8199e4d2f66c268c2537fda52ea86f058d4c8c91f67402f7c3a17b7d6347b3634f129e0ccfe80387ba068c3bbda596808d237616d133825c96f34b303a859f6b1252c001e6f030246cc2634c720f1acbba4aff8c32c35a74a8ee3e73fde4e92fa802ebf47f4fc67e12196f306b7195a391bba824c104503f77d68fc4ba22974d583a30097839ce689e7a3966122b82ca1ee68926e08e52d79a113d611545f022857e54ec94497d3bca2366f703fd54e278b82b6b77ed776a3fac919184f0337535500173e1267bf15d322f5cd54d10537c2c0750b7f24b4123c0044be7da47d08d50ea1dab112e11517636b317dd213e0fc2dff197fe2ebed1926bc1f7534ae2e68f5304100513218c3c1b61ce8d08ca54945c3542ccd5e6b3ce5c8dfeb26de50c27a6b9e645bd8efd011ca21e271f6f05d50c8b3d4a8898b17517b19dd0391a70bea8e0edcf292f5ad269aa5600914d945c16a3c994edc231e66e7cf7de094025d11fc5f3ddfe321169539daecd16ad4385692bee39d78d3b43c7f3557f5970d2ae98b730c3e2ef601ab30511668640b309cfa836f6776e4af0dbb84e90a2f5adce1896adaed6c6cb634cf7bfbfe331c78b04774d518f1e1b3e6d1d1f7f1af8662e8a580fc2bf792f74803d0f920bf43d
#TRUST-RSA-SHA256 064a1aa579266ae36060e837df77fa760a2019bd74c02cbb9d36ed04743fc453ff0d8cb910efae9655bce8b616a1fea2741c24c1f642c612f29ab25cb6a3c100d32ff17ecc158c8d03fc24856d10aec001dabe60ae115b43901b1224ed16c206f75c6840c9db58febc0fbf5fd6abc07a881eb28748dfdfc289f8cbe244173693468093c422cdec3a8b8019ef2974e01714a2a2e9dd4c187e3d7ebf3d4f26ef35f74ab3ac33b2b1c376316f9aacea64009bfea41a13051b4afd1b73f3733b8c84e24dccd6e33e25259c349f21a1bc0bd932d479d984212b0ded6a1430cf0c25437fb2a6589abd2d9d3163d7b365905c3fc4885715ed12b65ee1c966e15519229783d3af954d800a78c3af569e1c9cee939f538830a7f6cc7a4976d1aa51d3790824ca5b18eac04f6b94b9e3f2fb76f62835de7a1777b4c0d419114ee3c9c1c967d10380a92b29cf1665ecbd56725fd03dfbc3b8b662d0ccd73e4f404c1ca267d8a35db7c837d7fdf94b13a7ac592a031ada170bbe5b94f0d590567955809637719b55ee0ab698bdc7483db3dd8863e02483800a49bcb37853262428c0c922204574a12882997d3234fa0d7a767589fbdbaf225f68077bf31be5a612638d388056a1883fee574e6ac674092b01b66924bfb59355bb860768b10826258de8cb2aff3d0947c92d62c28d8ef6ca7c2c1a7f0926effc9ad1c2d817294c8fab5b53db62
#
# This script is Copyright (C) 2004-2025 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.2 $
# $Date: 2025/02/18 $
#
# description : This .audit is designed against the CIS Apple macOS 15.0 Sequoia Benchmark 1.0.0
#
#<ui_metadata>
#<display_name>CIS Apple macOS 15.0 Sequoia v1.0.0 L2</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Apple macOS 15.0 Sequoia</name>
#  <profile>L2</profile>
#  <version>1.0.0</version>
#  <link>https://workbench.cisecurity.org/benchmarks/18636</link>
#</spec>
#<labels>cis,macos_15,agent,unix</labels>
#<benchmark_refs>CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#<variables>
#  <variable>
#    <name>AUTOFILL_ADDRESS_BOOK</name>
#    <default>0</default>
#    <description>Auto Fill From Address Book</description>
#    <info>Safari setting to auto fill data from address book enforced by configuration profile.0 - disabled. 1 - enabled.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>AUTOFILL_PASSWORDS</name>
#    <default>0</default>
#    <description>Auto Fill Passwords</description>
#    <info>Safari setting to auto fill passwords enforced by configuration profile.0 - disabled. 1 - enabled.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>AUTOFILL_CREDIT_CARD_DATA</name>
#    <default>0</default>
#    <description>Auto Fill Credit Card Data</description>
#    <info>Safari setting to auto fill credit card data enforced by configuration profile.0 - disabled. 1 - enabled.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>AUTOFILL_MISC_FORMS</name>
#    <default>0</default>
#    <description>Auto Fill Miscellaneous Forms</description>
#    <info>Safari setting to auto fill miscellaneous forms enforced by configuration profile.0 - disabled. 1 - enabled.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>GAME_CENTER</name>
#    <default>false</default>
#    <description>Game Center</description>
#    <info>Game center enforced by configuration profile.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>HISTORY_AGE</name>
#    <default>365</default>
#    <description>History Age</description>
#    <info>History Age in days limit enforced by configuration profile.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>ICLOUD_KEYCHAIN</name>
#    <default>true</default>
#    <description>iCloud Keychain Sync</description>
#    <info>iCloud keychain sync enforced by configuration profile.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>ICLOUD_DOCUMENT</name>
#    <default>true</default>
#    <description>iCloud Document Sync</description>
#    <info>iCloud document sync enforced by configuration profile.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>ICLOUD_FREEFORM</name>
#    <default>true</default>
#    <description>iCloud Freeform Sync</description>
#    <info>iCloud freeform sync enforced by configuration profile.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>IPHONE_MIRRORING</name>
#    <default>false</default>
#    <description>iPhone Mirroring</description>
#    <info>iPhone mirroring enforced by configuration profile.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MINIMUM_ALPHABETIC_CHAR</name>
#    <default>([1-9]|[1-9][0-9]+)</default>
#    <description>Minimum Alphabetic Characters</description>
#    <info>Miminum alphaetic characters enforced by pwpolicy.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MINIMUM_NUMERIC_CHAR</name>
#    <default>([1-9]|[1-9][0-9]+)</default>
#    <description>Minimum Numeric Characters</description>
#    <info>Miminum numeric characters length enforced by pwpolicy.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MINIMUM_SPECIAL_CHAR</name>
#    <default>([1-9]|[1-9][0-9]+)</default>
#    <description>Minimum Special Characters</description>
#    <info>Miminum special characters length enforced by pwpolicy.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MINIMUM_MIXED_CASE_CHAR</name>
#    <default>([1-9]|[1-9][0-9]+)</default>
#    <description>Minimum Mixed Case Characters</description>
#    <info>Miminum special characters length enforced by pwpolicy.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>SAFARI_TRACKER_SETTING</name>
#    <default>33422560</default>
#    <description>Safari 'Hide IP address from trackers' Setting</description>
#    <info>Hide IP addresses from trackers disabled - 33422560. Hide IP addresses from Trackers Only - 33422564. Hide IP addresses from Trackers and Websites - 33422572.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>FIND_TIMEOUT</name>
#    <default>7200</default>
#    <description>Timeout for checks that search for files</description>
#    <info>Timeout, in seconds, for checks that search for files. Range of 1-7200.</info>
#    <value_type>INTEGER</value_type>
#  </variable>
#  <variable>
#    <name>BANNER_TEXT</name>
#    <default>All activities performed on this system will be monitored.</default>
#    <description>Banner Text</description>
#    <info>This is the text for the warning a user receives when logging onto the system.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PLATFORM_VERSION</name>
#    <default>15</default>
#    <description>MacOS platform version</description>
#    <info>MacOS platform version</info>
#    <value_type>STRING</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : CMD_EXEC
      description : "MacOS 15 is installed"
      cmd         : "/usr/bin/sw_vers | /usr/bin/grep 'ProductVersion'"
      expect      : "^ProductVersion[\\s]*:[\\s]*@PLATFORM_VERSION@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_Apple_macOS_15.0_Sequoia_v1.0.0_L2.audit from CIS Apple macOS 15.0 Sequoia Benchmark v1.0.0"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.1.1.1 Audit iCloud Keychain"
      info         : "The iCloud keychain is Apple's password manager that works with macOS and iOS. The capability allows users to store passwords in either iOS or macOS for use in Safari on both platforms and other iOS-integrated applications. The most pervasive use is driven by iOS use rather than macOS. The passwords stored in a macOS keychain on an Enterprise-managed computer could be stored in Apple's cloud and then be available on a personal computer using the same account. The stored passwords could be for organizational as well as for personal accounts.

If passwords are no longer being used as organizational tokens, they are not in scope for iCloud keychain storage.

Ensure that the iCloud keychain is used consistently with organizational requirements."
      solution     : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowCloudKeychainSync
 - The key should be set <true/> to allow iCloud keychain syncing, or <false/> to disable it, based on your organization's requirements

Note: Since the profile method sets a system-wide setting and not a user-level one, the profile method is the preferred method. It is always better to set system-wide than per user."
      reference    : "800-171|3.1.20,800-171|3.1.21,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.01.20c.,800-171r3|03.01.20d.,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|AC-20(1),800-53|AC-20(2),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|AC-20(1),800-53r5|AC-20(2),800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|PM-17,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,800-53r5|SR-5,CSCv7|5.1,CSCv7|9.2,CSCv8|4.1,CSCv8|4.8,CSCv8|15.3,CSF|DE.AE-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-02,CSF2.0|ID.AM-04,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.5.14,ISO-27001-2022|A.7.9,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.20,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|AC-20(1),ITSG-33|AC-20(2),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T1.2.3,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "@ICLOUD_KEYCHAIN@"
      payload_key  : "allowCloudKeychainSync"
      payload_type : "com.apple.applicationaccess"
    </custom_item>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.1.1.2 Audit iCloud Drive"
      info         : "iCloud Drive is Apple's storage solution for applications on both macOS and iOS to use the same files that are resident in Apple's cloud storage. The iCloud Drive folder is available much like Dropbox, Microsoft OneDrive, or Google Drive.

One of the concerns in public cloud storage is that proprietary data may be inappropriately stored in an end user's personal repository. Organizations that need specific controls on information should ensure that this service is turned off or the user knows what information must be stored on services that are approved for storage of controlled information.

Organizations should review third party storage solutions pertaining to existing data confidentiality and integrity requirements."
      solution     : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowCloudDocumentSync
 - The key should be set <true/> to allow iCloud Drive, or <false/> to disable it, based on your organization's requirements

Note: Since the profile method sets a system-wide setting and not a user-level one, the profile method is the preferred method. It is always better to set system-wide than per user.

Impact:

Users will not be able to use continuity on macOS to resume the use of newly composed but unsaved files."
      reference    : "800-171|3.1.20,800-171|3.1.21,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.01.20c.,800-171r3|03.01.20d.,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|AC-20(1),800-53|AC-20(2),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|AC-20(1),800-53r5|AC-20(2),800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|PM-17,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,800-53r5|SR-5,CSCv7|5.1,CSCv8|4.1,CSCv8|4.8,CSCv8|15.3,CSF|DE.AE-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-02,CSF2.0|ID.AM-04,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.5.14,ISO-27001-2022|A.7.9,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.20,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|AC-20(1),ITSG-33|AC-20(2),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T1.2.3,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "@ICLOUD_DOCUMENT@"
      payload_key  : "allowCloudDocumentSync"
      payload_type : "com.apple.applicationaccess"
    </custom_item>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.1.1.3 Ensure iCloud Drive Document and Desktop Sync Is Disabled"
      info         : "With macOS 10.12, Apple introduced the capability to have a user's Desktop and Documents folders automatically synchronize to the user's iCloud Drive, provided they have enough room purchased through Apple on their iCloud Drive. This capability mirrors what Microsoft is doing with the use of OneDrive and Office 365. There are concerns with using this capability.

The storage space that Apple provides for free is used by users with iCloud mail, all of a user's Photo Library created with the ever larger Multi-Pixel iPhone cameras, and all iOS Backups. Adding a synchronization capability for users who have files going back a decade or more, storage may be tight using the free 5GB provided without purchasing much larger storage capacity from Apple. Users with multiple computers running 10.12 and above with unique content on each will have issues as well.

Enterprise users may not be allowed to store Enterprise information in a third-party public cloud. In previous implementations, such as iCloud Drive or DropBox, the user selected what files were synchronized even if there were no other controls. The new feature synchronizes all files in a folder widely used to put working files.

The automatic synchronization of all files in a user's Desktop and Documents folders should be disabled.

https://derflounder.wordpress.com/2016/09/23/icloud-desktop-and-documents-in-macos-sierra-the-good-the-bad-and-the-ugly/

Automated Document synchronization should be planned and controlled to approved storage."
      solution     : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowCloudDesktopAndDocuments
 - The key must be set to <false/>

Impact:

Users will not be able to use iCloud for the automatic sync of the Desktop and Documents folders."
      reference    : "800-171|3.1.20,800-171|3.1.21,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.01.20c.,800-171r3|03.01.20d.,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|AC-20(1),800-53|AC-20(2),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|AC-20(1),800-53r5|AC-20(2),800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|PM-17,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,800-53r5|SR-5,CSCv7|5.1,CSCv8|4.1,CSCv8|4.8,CSCv8|15.3,CSF|DE.AE-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-02,CSF2.0|ID.AM-04,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.5.14,ISO-27001-2022|A.7.9,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.20,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|AC-20(1),ITSG-33|AC-20(2),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T1.2.3,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "false"
      payload_key  : "allowCloudDesktopAndDocuments"
      payload_type : "com.apple.applicationaccess"
    </custom_item>

    <report type:"WARNING">
      description : "2.1.1.4 Audit Security Keys Used With Apple Accounts"
      info        : "Apple has introduced the capability of using security keys to protect Apple Accounts using two-factor authentication in macOS Ventura 13.2, in iOS 16.3, and in iPadOS 16.3. This feature along with the purchase of two hardware tokens (a backup device is required) protects against the compromise of Apple Accounts. This feature requires all devices using an enrolled Apple Account to meet the minimum OS standard.

Users of Apple devices are supported across their devices by using the same Apple Account to support shared data in both iCloud and across devices. Compromising an Apple Account has become a very attractive target for attackers to gain unauthorized access to iCloud storage and user devices. Two-factor authentication reduces the risk.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to set Security Keys is set to your organization's requirements:

 - Open System Settings
 - Select Apple Account
 - Select Password & Security
 - Select Add.. to add a security key, or Remove All Security Keys ro remove security keys, to meet your organization's requirements

Impact:

Legacy devices and test machines will be challenging to ensure that they are all running recent Operating Systems that can utilize Security Keys. It is best practice not to use Apple Accounts with access to current user data on legacy and test machines. Technical staff that use legacy devices are encouraged to create additional Apple Accounts that do not need two-factor protection and can be used for testing on legacy devices when required."
      reference   : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|2M,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.1.1.5 Audit Freeform Sync to iCloud"
      info         : "Starting with macOS 13.1 (Ventura) Apple has made a collaboration tool (Freeform) available on macOS, iOS and iPadOS. This application allows for extensive whiteboard creation and sharing using iCloud. Organizations may want to audit the use of Freeform iCloud sharing of internally created boards.

Internally created whiteboards may not be authorized to share to external contacts through iCloud."
      solution     : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowCloudFreeform
 - The key must be set to <<true/false>/>"
      reference    : "800-171|3.1.20,800-171|3.1.21,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.01.20c.,800-171r3|03.01.20d.,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|AC-20(1),800-53|AC-20(2),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|AC-20(1),800-53r5|AC-20(2),800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|PM-17,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,800-53r5|SR-5,CSCv7|5.1,CSCv8|4.1,CSCv8|4.8,CSCv8|15.3,CSF|DE.AE-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-02,CSF2.0|ID.AM-04,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.5.14,ISO-27001-2022|A.7.9,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.20,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|AC-20(1),ITSG-33|AC-20(2),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T1.2.3,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "@ICLOUD_FREEFORM@"
      payload_key  : "allowCloudFreeform"
      payload_type : "com.apple.applicationaccess"
    </custom_item>

    <report type:"WARNING">
      description : "2.1.1.6 Audit Find My Mac"
      info        : "Find My is Apple's consumer solution for device tracking of your devices. This allows a user to track the location of devices associated with their Apple Account. This is a great solution for consumer or user device management and tracking, but it is not meant to be an enterprise management solution to device tracking and information management on enterprise managed devices. There are multiple enterprise MDM solutions for managing organizational devices.

An enterprise solution should be used for tracking and information management of all devices, including Apple devices. Apple's Find My solution only handles Apple devices. If no enterprise solution is available, Find My provides capabilities for a user to manage and track Apple devices. It is not designed as an enterprise solution, and should not be used as one. It is better to allow the user to track devices that use their Apple Account than to have no tracking at all.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to set Security Keys is set to your organization's requirements:

 - Open System Settings
 - Select Apple Account
 - Select iCloud
 - Select Show More Apps..
 - Set Find My Mac is set to your organization's requirements

Impact:

There should be no impact on the user while using the device. If someone other than the user has access to tracking information, this can impact the user and needs to be researched. Users should audit to ensure that only authorized people have access to your location. Using multiple solutions for device tracking can add unnecessary complexity."
      reference   : "800-171|3.1.20,800-171|3.1.21,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.01.20c.,800-171r3|03.01.20d.,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|AC-20(1),800-53|AC-20(2),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|AC-20(1),800-53r5|AC-20(2),800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|PM-17,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,800-53r5|SR-5,CSCv7|5.1,CSCv8|4.1,CSCv8|4.8,CSCv8|15.3,CSF|DE.AE-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-02,CSF2.0|ID.AM-04,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.5.14,ISO-27001-2022|A.7.9,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.20,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|AC-20(1),ITSG-33|AC-20(2),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.1,NESA|T1.2.2,NESA|T1.2.3,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>

    <report type:"WARNING">
      description : "2.1.2 Audit App Store Password Settings"
      info        : "With OS X 10.11, Apple added settings for password storage for the App Store in macOS. These settings parallel the settings in iOS. As with iOS, the choices are a requirement to provide a password after every purchase or to have a 15-minute grace period, and whether or not to require a password for free purchases. The response to this setting is stored in a cookie and processed by iCloud.

There is plenty of risk information on the wisdom of this setting for parents with children buying games on iPhones and iPads. The most relevant information here is the likelihood that users who are not authorized to download software may have physical access to an unlocked computer where someone who is authorized recently made a purchase. If that is a concern, a password should be required at all times for App Store access in the Password Settings controls.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to set App Store Passwords to your organization's requirements:

 - Open System Settings
 - Select Apple Account
 - Select Media & Purchases
 - Set Free Downloads to your organization's requirements
 - Set Purchases and In-App Purchases to your organization's requirements"
      reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSCv8|4.8,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.14.1 Audit Game Center Settings"
      info         : "With macOS 10.13, Apple has introduced a separate section for Game Center in System Settings. It is possible to log in with the Apple Account and use the iCloud-based Game Center services.

Game Center is a feature from Apple that allows users to engage in game-related activities with friends when playing multiplayer games online on the Game Center social network. User profile data such as nickname, contact discovery, and also nearby players may be shared through iCloud.

Apple collects information here, such as the games users play and when they play them, all scores and achievements, and the challenges users send and receive. This information is used to track users' high scores, achievements, and challenges and to improve Game Center.

The automatic sign in to Game Center with AppleID should be disabled if not aligned with organizational rules

Personal profile visibility, Finding by Friends, requests from Contacts, Nearby Player detection and Connecting with Friends are all visibility options that should be risk accepted through an organizational policy before use.

Users should not sign in to Game Center on organizational managed devices if not covered under acceptable use. For personal devices Game Center should not be signed in if the user is not using Apple's gaming service.

Ensure Game Center service is used consistently with organizational requirements."
      solution     : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowGameCenter
 - The key should be set <true/> to allow Game Center, or <false/> to disable it, based on your organization's requirements

Impact:

Game Center is designed as a social network to use Apple's gaming service and includes capabilities to discover players in the service as through local network discovery. If the Apple feature is not needed it should not be on, and should not be signed in."
      reference    : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06b.,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2M,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "@GAME_CENTER@"
      payload_key  : "allowGameCenter"
      payload_type : "com.apple.applicationaccess"
    </custom_item>

    <report type:"WARNING">
      description : "2.16.1 Audit Wallet & Apple Pay Settings"
      info        : "Touch ID is a prerequisite for using Apple Pay and Wallet on macOS. Apple Pay allows an Apple account holder to enroll their credit cards in Apple Pay and pay enrolled vendors without using the physical card or number. Apple's service eliminates the requirement to send the credit card number itself to the vendor. Apple Pay on a Mac allows the use of credit cards the user has already enrolled and reduces user risk for credit card purchases.

Some environments may have rules around purchases from organizationally managed computers and may want to discourage shopping from them. It is difficult to block access to websites that allow purchases, and Apple Pay has more controls for user protection than the manual entry of credit card information.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to set Wallet & Apple Pay to your organization's settings:

 - Open System Settings
 - Select Wallet & Apple Pay
 - Set the Wallet & Apple Pay settings to your organization's requirements"
      reference   : "800-171|3.4.2,800-171r3|03.04.02a.,800-53|CM-6b.,800-53r5|CM-6b.,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6b.,LEVEL|2M,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type         : MACOSX_OSASCRIPT
          description  : "legacySharingUIStatus"
          expect       : "^0$"
          payload_key  : "legacySharingUIStatus"
          payload_type : "com.apple.preferences.sharing.SharingPrefsExtension"
        </custom_item>

        <custom_item>
          type         : MACOSX_OSASCRIPT
          description  : "mediaSharingUIStatus"
          expect       : "^0$"
          payload_key  : "mediaSharingUIStatus"
          payload_type : "com.apple.preferences.sharing.SharingPrefsExtension"
        </custom_item>

        <custom_item>
          type         : MACOSX_OSASCRIPT
          description  : "homeSharingUIStatus"
          expect       : "^0$"
          payload_key  : "homeSharingUIStatus"
          payload_type : "com.apple.preferences.sharing.SharingPrefsExtension"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "2.3.3.10 Ensure Media Sharing Is Disabled"
          info        : "Starting with macOS 10.15, Apple has provided a control which permits a user to share Apple downloaded content on all Apple devices that are signed in with the same Apple Account. This allows users to share downloaded Movies, Music, or TV shows with other controlled macOS, iOS and iPadOS devices, as well as photos with Apple TVs.

With this capability, guest users can also use media downloaded on the computer.

The recommended best practice is not to use the computer as a server, but to utilize Apple's cloud storage in order to download and use content stored there if content stored with Apple is used on multiple devices.

https://support.apple.com/guide/mac-help/set-up-media-sharing-on-mac-mchlp13371337/mac

Note: In macOS 15.0 Sequoia, Apple added a supported profile key for Media Sharing that replaces the keys in the benchmarks in previous versions.

Disabling Media Sharing reduces the remote attack surface of the system."
          solution    : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowMediaSharing
 - The key must be set to <false/>
 - The key to also include is allowMediaSharingModification
 - The key must be set to <false/>

Impact:

Media Sharing allows for pre-downloaded content on a Mac to be available to other Apple devices on the same network. Leaving this disabled forces device users to stream or download content from each Apple authorized device. This sharing could even allow unauthorized devices on the same network media access."
          reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv7|9.2,CSCv8|4.1,CSCv8|4.8,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
          see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
          show_output : YES
        </report>
      </then>
    </if>

    <custom_item>
      type        : CMD_EXEC
      description : "2.3.3.12 Ensure Computer Name Does Not Contain PII or Protected Organizational Information"
      info        : "If the computer is used in an organization that assigns host names, it is a good idea to change the computer name to the host name. This is more of a best practice than a security measure. If the host name and the computer name are the same, computer support may be able to track problems down more easily.

For organizations or for users that self-administer their own computers, it is important to not use sensitive or personal information in computer names. The name of a computer that uses untrusted networks will be exposed at a minimum to the responsible network team of that network. For instance, having your name as your hostname can provide useful knowledge to an attacker monitoring the network you may be connected to.

Examples of possibly inappropriate content in computer names include:

 - User directory account names
 - Computer directory account names where machine accounts exist
 - Contact phone numbers
 - Physical locations of offices or residences
 - Personal information that can be augmented with Facebook data to assist social engineering attacks

Standard naming patterns avoid collisions and mitigate risk for computer users.

With mobile devices, using DHCP IP tracking has serious drawbacks. Hostname or computer name tracking makes much more sense for those organizations that can implement it. If the computer is using different names for the \"Computer Name\" DNS and Directory environments, it can be difficult to manage Macs in an Enterprise asset inventory.

Part of IT security is having visibility into all of the devices for which an organization is responsible. Without a complete inventory, it is impossible to ensure all security controls are met on all organizational devices.

Default macOS naming deconfliction controls can create issues for appropriate management and tracking as well as privacy exposure. By default, the name of a macOS computer is derived from the first user created. If the user has multiple computers or an image is used without an appropriate name change, there will be multiple computers with names derived from the same user for discovery deconfliction. How many \"Ron Colvin's MacBook Pro\" should there be, and are any missing?

Local network auto renaming to avoid collisions also allows for the enumeration of local computer names. Computers should not be named after their users, especially on untrusted networks. For social engineering purposes, the computer name should not provide a full name of the user or an identifiable name that might be used to assist in targeted user attacks.

A documented plan to better enable a complete device inventory without exposing user or organizational information is part of mature security.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to set the computer name:

 - Open System Settings
 - Select General
 - Select Sharing
 - Select Edit...
 - Set Hostname to your organization's parameters"
      reference   : "800-171|3.4.1,800-171r3|03.04.10,800-171r3|03.04.10c.,800-53|CM-8,800-53|CM-8(1),800-53|PM-5,800-53r5|CM-8,800-53r5|CM-8(1),800-53r5|PM-5,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSCv7|9.1,CSCv8|1.1,CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,CSF2.0|ID.AM-01,CSF2.0|ID.AM-02,CSF2.0|PR.PS-01,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.9,ISO-27001-2022|A.8.9,ITSG-33|CM-8,ITSG-33|CM-8(1),LEVEL|2M,NESA|T1.2.1,NESA|T1.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/sbin/scutil --get ComputerName"
      expect      : "^Manual Review Required$"
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.3.3.9 Ensure Content Caching Is Disabled"
      info         : "Starting with 10.13 (macOS High Sierra), Apple introduced a service to make it easier to deploy data from Apple, including software updates, where there are bandwidth constraints to the Internet and fewer constraints or greater bandwidth exist on the local subnet. This capability can be very valuable for organizations that have throttled and possibly metered Internet connections. In heterogeneous enterprise networks with multiple subnets, the effectiveness of this capability would be determined by how many Macs were on each subnet at the time new, large updates were made available upstream.This capability requires the use of mac OS clients as P2P nodes for updated Apple content. Unless there is a business requirement to manage operational Internet connectivity and bandwidth, user endpoints should not store content and act as a cluster to provision data.

Content types supported by Content Caching in macOS

The main use case for Mac computers is as mobile user endpoints. P2P sharing services should not be enabled on laptops that are using untrusted networks. Content Caching can allow a computer to be a server for local nodes on an untrusted network. While there are certainly logical controls that could be used to mitigate risk, they add to the management complexity. Since the value of the service is in specific use cases, organizations with the use case described above can accept risk as necessary."
      solution     : "Graphical Method:

Perform the following steps to disable Content Caching:

 - Open System Settings
 - Select General
 - Select Sharing
 - Set Content Caching to disabled

Terminal Method:

Run the following command to disable Content Caching:

% /usr/bin/sudo /usr/bin/AssetCacheManagerUtil deactivate

The output will include Content caching deactivated

Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowContentCaching
 - The key must be set to <false/>

Impact:

This setting will adversely affect bandwidth usage between local subnets and the Internet."
      reference    : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.02,800-171r3|03.04.06,800-53|CM-6,800-53|CM-7,800-53r5|CM-6,800-53r5|CM-7,CSCv7|9.2,CSCv8|4.8,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.9,ITSG-33|CM-6,ITSG-33|CM-7,LEVEL|2A,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "false"
      payload_key  : "Activated"
      payload_type : "com.apple.AssetCache"
    </custom_item>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.3.4.1 Ensure Backup Automatically is Enabled If Time Machine Is Enabled"
      info         : "Backup solutions are only effective if the backups run on a regular basis. The time to check for backups is before the hard drive fails or the computer goes missing. In order to simplify the user experience so that backups are more likely to occur, Time Machine should be on and set to Back Up Automatically whenever the target volume is available.

Operational staff should ensure that backups complete on a regular basis and the backups are tested to ensure that file restoration from backup is possible when needed.

Backup dates are available even when the target volume is not available in the Time Machine plist.

SnapshotDates = (\"2020-08-20 12:10:22 +0000\",\"2021-02-03 23:43:22 +0000\",\"2022-02-19 21:37:21 +0000\",\"2023-02-22 13:07:25 +0000\",\"2024-08-20 14:07:14 +0000\"

When the backup volume is connected to the computer, more extensive information is available through tmutil See man tmutil

Note: This recommendation needs to be set on devices where Time Machine is enabled. If Time Machine is disabled, the audit is passed by default.

Backups should automatically run whenever the backup drive is available."
      solution     : "Graphical Method:

Perform the following steps to enable Time Machine automatic backup:

 - Open System Settings
 - Select General
 - Select Time Machine
 - Select Options...
 - Set Back up frequency to Automatically <every hour/every day/every week>

Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.MCX.TimeMachine
 - The key to include is AutoBackup
 - The key must be set to <true/>

Note: In previous versions of the benchmark, the plist could be set in Terminal In macOS 15 Sequoia that plist is now protected and cannot be written to, so the command line remediation has been removed. Both the profile method and graphical method still configure Time Machine to the required state.

Impact:

The backup will run periodically in the background and could have user impact while running."
      reference    : "800-171|3.8.9,800-171r3|03.08.09,800-53|CP-9,800-53|CP-10,800-53r5|CP-9,800-53r5|CP-10,CSCv7|10.1,CSCv8|11.2,CSF|PR.IP-4,CSF|RC.RP-1,CSF|RS.RP-1,CSF2.0|PR.DS-01,CSF2.0|PR.DS-10,CSF2.0|PR.DS-11,CSF2.0|RC.RP,CSF2.0|RC.RP-01,CSF2.0|RC.RP-02,CSF2.0|RC.RP-03,CSF2.0|RC.RP-05,GDPR|32.1.b,GDPR|32.1.c,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(ii),ISO-27001-2022|A.5.29,ISO-27001-2022|A.5.33,ISO-27001-2022|A.8.13,ISO/IEC-27001|A.12.3.1,ITSG-33|CP-9,ITSG-33|CP-10,ITSG-33|CP-10a.,LEVEL|2A,NESA|M5.2.3,NESA|T2.2.4,QCSC-v1|5.2.3,QCSC-v1|10.2.1,QCSC-v1|11.2"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "true"
      required     : NO
      payload_key  : "AutoBackup"
      payload_type : "com.apple.TimeMachine"
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "LocationServicesEnabled"
          cmd         : "#!/bin/bash
{
/usr/bin/sudo -u _locationd /usr/bin/osascript -l JavaScript << EOS
$.NSUserDefaults.alloc.initWithSuiteName('com.apple.locationd')\
.objectForKey('LocationServicesEnabled').js
EOS
}"
          expect      : "true"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "launchctl"
          cmd         : "/bin/launchctl list | /usr/bin/grep -c com.apple.locationd"
          expect      : "^1$"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "2.6.1.1 Ensure Location Services Is Enabled"
          info        : "macOS uses location information gathered through local Wi-Fi networks to enable applications to supply relevant information to users. With the operating system verifying the location, users do not need to change the time or the time zone. The computer will change them based on the user's location. They do not need to specify their location for weather or travel times, and they will receive alerts on travel times to meetings and appointments where location information is supplied.

Location Services simplify some processes with mobile computers, such as asset management and time or log management.

There are some use cases where it is important that the computer not be able to report its exact location. While the general use case is to enable Location Services, it should not be allowed if the physical location of the computer and the user should not be public knowledge.

Location Services are helpful in most use cases and can simplify log and time management where computers change time zones."
          solution    : "Graphical Method:

Perform the following steps to enable Location Services:

 - Open System Settings
 - Select Privacy & Security
 - Select Location Services
 - Set Location Services to enabled

Terminal Method:

Run the following command to enable Location Services:

% /usr/bin/sudo /bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.locationd.plist

If the com.apple.locationd.plist outputs 0 run the following command to also ensure Location Services is running:

% /usr/bin/sudo /usr/bin/defaults write /var/db/locationd/Library/Preferences/ByHost/com.apple.locationd LocationServicesEnabled -bool true

% /usr/bin/sudo /usr/bin/killall locationd

Note: In some use cases, organizations may not want Location Services running. To disable Location Services, run the command: /usr/bin/sudo /usr/bin/defaults write /var/db/locationd/Library/Preferences/ByHost/com.apple.locationd LocationServicesEnabled -bool false"
          reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSCv8|4.8,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
          see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
          show_output : YES
        </report>
      </then>
    </if>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.6.1.2 Ensure 'Show Location Icon in Control Center when System Services Request Your Location' Is Enabled"
      info         : "This setting provides the user an understanding of the current status of Location Services and which applications are using it.

Apple has fully integrated location services into macOS. When user applications access location an arrow is displayed next to the Control Center in the menu bar to give users an indication when their location is being accessed. By default system services like time zones, weather, travel times, geolocation, \"Find my Mac,\" and advertising services do not indicate the location is accessed.

Enabling the \"Show location icon in the menu bar when System Services request your location\" setting will show an arrow in the control center when a system service accesses the location. Although an indication that location was accessed, Control Center will only say that it was accessed by \"System Services\" and not the individual service. Looking in System Settings > Location Services > System Services > Details... will expose exactly which system services have accessed Location Services in the last 24 hours. Third-party tools will be shown individually when they access location services."
      solution     : "Graphical Method:

Perform the following steps to set whether the location services icon is in the menu bar:

 - Open System Settings
 - Select Privacy & Security
 - Select Location Services
 - Select Details...
 - Set Show location icon in menu bar when System Services request your location to enabled

Terminal Method:

Run the following commands to set the option of the location services icon being in the menu bar:

% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.locationmenu.plist ShowSystemServices -bool true

Impact:

Users may be provided visibility to a setting they cannot control if organizations control Location Services globally by policy."
      reference    : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSCv8|4.8,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "true"
      payload_key  : "ShowSystemServices"
      payload_type : "com.apple.locationmenu"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.6.1.3 Audit Location Services Access"
      info        : "macOS uses location information gathered through local Wi-Fi networks to enable applications to supply relevant information to users. While Location Services may be very useful, it may not be desirable to allow all applications that can use Location Services to use your location for Internet queries in order to provide tailored content based on your current location.

Ensure applications that can use Location Services are authorized and provide that information where the application interacts with external systems. Apple offers feedback within System Preferences and may be enabled to supply information on the menu bar when Location Services are used.

Safari can deny access from websites or prompt for access.

Applications that support Location Services can be individually controlled in the Privacy tab in Security & Privacy under System Preferences.

Access should be evaluated to ensure that privacy controls are as expected.

Privacy controls should be monitored for appropriate settings.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to disable unnecessary applications from accessing Location Services:

 - Open System Settings
 - Select Privacy & Security
 - Select Location Services
 - Set any applications listed to your organization's requirements

Perform the following steps to set websites to ask for permission to access Location Services:

 - Open Safari
 - Select Safari from the menu bar
 - Select Settings
 - Select Websites
 - Select Location
 - Set When visiting other websites to your organization's requirements

Impact:

Many macOS features rely on Location Services for tailored information. Users expect their time zone and weather to be relevant to where they are without manual intervention. Find my Mac needs to know where your Mac is actually located. Where possible, the tolerance between location privacy and convenience may be best left to the user when the location itself is not sensitive. If facility locations are not public, location information should be tightly controlled."
      reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.4.9,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.04.10,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-7(2),800-53|CM-8(3),800-53|CM-9,800-53|CM-10,800-53|CM-11,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-7(2),800-53r5|CM-8(3),800-53r5|CM-9,800-53r5|CM-10,800-53r5|CM-11,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSCv7|2.6,CSCv7|5.1,CSCv8|2.3,CSCv8|4.1,CSF|DE.AE-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|ID.AM-01,CSF2.0|ID.AM-02,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-02,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.5.9,ISO-27001-2022|A.5.32,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.19,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ISO/IEC-27001|A.12.6.2,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-7(2),ITSG-33|CM-8(3),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/defaults read /var/db/locationd/clients.plist"
      expect      : "^Manual Review Required$"
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.6.2.1 Audit Full Disk Access for Applications"
      info        : "Starting with macOS 10.13, Apple enforces GUI access to the entire File System through System Preferences. Only Applications from known developers with mission requirements for Full Disk Access, such as security monitoring tools, should have Full Disk Access. Applications that have Full Disk Access can access restricted files and bypass macOS security controls. Any applications with that access should be organizationally authorized.

Any applications with Full Disk Access can bypass MacOS security controls and must be reviewed as organizationally accepted risk.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to set full disk access for applications that meet your organization's requirements:

 - Open System Settings
 - Select Privacy & Security
 - Select Full Disk Access
 - Set any listed applications to your organization's requirements
 - (Optional) Select the + to add applications to the list, or - to remove them"
      reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSCv8|16.7,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/sqlite3 /Library/Application\\ Support/com.apple.TCC/TCC.db 'select client from access where auth_value and service = \"kTCCServiceSystemPolicyAllFiles\"'"
      expect      : "^Manual Review Required$"
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "2.6.7 Audit Lockdown Mode"
      info         : "Apple introduced Lockdown Mode as a security feature in their 2022 OS releases that provides additional security protection Apple describes as

extreme

. Users and organizations that suspect some users are targets of advanced attacks must consider using this control.

When lockdown mode is enabled, specific trusted websites can be excluded from Lockdown protection if necessary.

Lockdown Mode was designed by Apple as an aggressive approach to commonly attacked OS features where additional controls could reduce the attack surface. IT systems and devices, including their users, are subject to continuous exploit attempts. Most of that activity is not from an advanced attacker and can be considered background noise to a patched, hardened device. Advanced attackers are of more concern and a risk review to understand organizational targets and use Lockdown Mode where appropriate is necessary."
      solution     : "Graphical Method:

Perform the following steps to set Lockdown Mode to your organization's requirements:

 - Open System Settings
 - Select Privacy & Security
 - Set Lockdown Mode to your organization's parameters

Impact:

Lockdown Mode must be tested appropriately for real-world impact on users prior to use. As a new feature there is not sufficient technical reporting on user impacts."
      reference    : "800-171|3.4.6,800-171|3.4.7,800-171|3.7.5,800-171r3|03.04.06,800-171r3|03.07.05,800-53|CM-7,800-53|MA-4,800-53r5|CM-7,800-53r5|MA-4,CSCv7|16.2,CSCv8|4.6,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,ITSG-33|MA-4,LEVEL|2M,NESA|T2.3.4,NESA|T5.4.4,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,TBA-FIISB|45.2.3"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      regex        : "1$"
      plist_item   : "LDMGlobalEnabled"
      plist_name   : ".GlobalPreferences.plist"
      plist_option : CANNOT_BE_NULL
      plist_user   : "all"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.7.1 Ensure Screen Saver Corners Are Secure"
      info        : "Hot Corners can be configured to disable the screen saver by moving the mouse cursor to a corner of the screen.

Setting a hot corner to disable the screen saver poses a potential security risk since an unauthorized person could use this to bypass the login screen and gain access to the system."
      solution    : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.dock
 - The key to include is Forced
 - The key must be set to the following:

<array>
	<dict>
		<key>mcx_preference_settings</key>
			<dict>
				<key>wvous-bl-corner</key>
				<integer><!=6></integer>
				<key>wvous-br-corner</key>
				<integer><!=6></integer>
				<key>wvous-tl-corner</key>
				<integer><!=6></integer>
				<key>wvous-tr-corner</key>
				<integer><!=6></integer>
			</dict>
		</dict>
</array>"
      reference   : "800-171|3.1.1,800-171|3.1.10,800-171|3.1.11,800-171r3|03.01.01h.,800-171r3|03.01.10,800-171r3|03.01.11,800-53|AC-2(5),800-53|AC-11,800-53|AC-11(1),800-53|AC-12,800-53r5|AC-2(5),800-53r5|AC-11,800-53r5|AC-11(1),800-53r5|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv7|16.11,CSCv8|4.3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iii),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.18,ISO-27001-2022|A.7.7,ISO-27001-2022|A.8.1,ISO-27001-2022|A.8.2,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-2(5),ITSG-33|AC-11,ITSG-33|AC-11(1),ITSG-33|AC-12,LEVEL|2A,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM28,NIAv2|NS5j,NIAv2|NS49,NIAv2|SS14e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.1,TBA-FIISB|37.1.4"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -Ec '\"wvous-bl-corner\" = 6|\"wvous-br-corner\" = 6|\"wvous-tl-corner\" = 6|\"wvous-tr-corner\" = 6'"
      expect      : "^0$"
    </custom_item>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "2.7.2 Audit iPhone Mirroring"
      info         : "iPhone Mirroring is a new feature offered in iOS 18 and macOS 15.0 Sequoia. It allows a macOS device to remotely access an iOS device connected to the same Apple Account. If a user has different Apple Accounts signed into iOS and macOS (ex. a managed Apple Account on macOS and a personal Apple Account on iOS), the feature is not available.

Enabling iPhone Mirroring may allow a macOS device to capture data from an iOS device (ex Image Capture). This would occur where the macOS device has not been approved to access that information by your organization's policies and the iOS device has been approved (or vice-versa).

If iPhone Mirroring is currently in use on an iOS device, the lock screen will have a notification that states iPhone in Use and state what device is using it. If iPhone Mirroring was in use on an iOS device but is no longer in use, the first time the user unlocks the iOS device it will notify the user that iPhone was used from Mac"
      solution     : "Perform the following to configure iPhone Mirroring:

Graphical Method:

 - Open System Settings
 - Select Desktop & Dock
 - Under the Widgets sub-header, verify iPhone is configured to your organization's requirements

Note: The iPhone setting will only show up if there are multiple iPhones being connected to the user's Apple Account and setup with iPhone mirroring.

Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.applicationaccess
 - The key to include is allowiPhoneMirroring
 - The key must be set to either <true/> or <false/> depending on your organization's requirements

Impact:

If iPhone Mirroring is disabled, it would stop a user from accessing information on their iOS device while using their macOS device."
      reference    : "800-171|3.4.6,800-171|3.4.7,800-171r3|03.04.06b.,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2M,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "@IPHONE_MIRRORING@"
      payload_key  : "allowiPhoneMirroring"
      payload_type : "com.apple.applicationaccess"
    </custom_item>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "Check for processor type"
          cmd         : "/usr/sbin/sysctl -n machdep.cpu.brand_string"
          expect      : "Intel"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "Check to see if system is a laptop"
          cmd         : "/usr/sbin/system_profiler SPHardwareDataType | /usr/bin/egrep MacBook"
          expect      : "MacBook"
        </custom_item>
      </condition>

      <then>
        <if>
          <condition auto:"FAILED" type:"AND">
            <custom_item>
              type        : CMD_EXEC
              description : "Intel highstandbythreshold"
              cmd         : "/usr/bin/pmset -g | /usr/bin/egrep highstandbythreshold"
              expect      : "highstandbythreshold[\\s]+(9[0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9])$"
            </custom_item>

            <custom_item>
              type        : CMD_EXEC
              description : "Intel hibernatemode"
              cmd         : "/usr/bin/pmset -g | /usr/bin/egrep hibernatemode"
              expect      : "hibernatemode[\\s]+25$"
            </custom_item>

            <custom_item>
              type        : CMD_EXEC
              description : "Intel standbydelayhigh"
              cmd         : "/usr/bin/pmset -g | /usr/bin/egrep standbydelayhigh"
              expect      : "standbydelayhigh[\\s]+([1-9]|[1-9][0-9]|[1-8][0-9]{2}|900)$"
            </custom_item>

            <custom_item>
              type        : CMD_EXEC
              description : "Intel standbydelaylow"
              cmd         : "/usr/bin/pmset -g | /usr/bin/egrep standbydelaylow"
              expect      : "standbydelaylow[\\s]+([1-9]|[1-9][0-9]|[1-8][0-9]{2}|900)$"
            </custom_item>
          </condition>

          <then>
            <report type:"PASSED">
              description : "2.9.1.1 Ensure the OS Is Not Active When Resuming from Standby (Intel)"
              info        : "In order to use a computer with Full Disk Encryption (FDE), macOS must keep encryption keys in memory to allow the use of the disk that has been FileVault protected. The storage volume has been unlocked and acts as if it were not encrypted. When the system is not in use, the volume is protected through encryption. When the system is sleeping and available to quickly resume, the encryption keys remain in memory.

https://www.helpnetsecurity.com/2018/08/20/laptop-sleep-security/

Mac systems should be set to hibernate after sleeping for a risk-acceptable time period. The default value for \"standbydelay\" is three hours (10800 seconds). This value is likely appropriate for most desktops. If Mac desktops are deployed in unmonitored, less physically secure areas with confidential data, this value might be adjusted. The desktop would have to retain power, however, so that the running OS or physical RAM could be attacked.

MacBooks should be set so that the standbydelay is 15 minutes (900 seconds) or less. This setting should allow laptop users in most cases to stay within physically secured areas while going to a conference room, auditorium, or other internal location without having to unlock the encryption. When the user goes home at night, the laptop will auto-hibernate after 15 minutes and require the FileVault password to unlock prior to logging back into the system when it resumes.

MacBooks should also be set to a hibernate mode that removes power from the RAM. This will stop the possibility of cold boot attacks on the system.

Macs running Apple silicon chips, rather than Intel chips, do not require the same configuration as Intel-based Macs.

To mitigate the risk of data loss, the system should power down and lock the encrypted drive after a specified time. Laptops should hibernate 15 minutes or less after sleeping."
              solution    : "Terminal Method:

Run the following command to set the hibernate delays and to ensure the FileVault keys are set to be destroyed on standby:

% /usr/bin/sudo /usr/bin/pmset -a standbydelaylow <value<=900>
% /usr/bin/sudo /usr/bin/pmset -a standbydelayhigh <value<=900>
% /usr/bin/sudo /usr/bin/pmset -a highstandbythreshold <value>=90>
% /usr/bin/sudo /usr/bin/pmset -a destroyfvkeyonstandby 1
% /usr/bin/sudo /usr/bin/pmset -a hibernatemode 25

example

:

% /usr/bin/sudo /usr/bin/pmset -a standbydelaylow 500
% /usr/bin/sudo /usr/bin/pmset -a standbydelayhigh 500
% /usr/bin/sudo /usr/bin/pmset -a highstandbythreshold 100
% /usr/bin/sudo /usr/bin/pmset -a destroyfvkeyonstandby 1
% /usr/bin/sudo /usr/bin/pmset -a hibernatemode 25

Impact:

The laptop will take additional time to resume normal operation if only sleeping rather than hibernating.

Setting hibernatemode to 25 will disable the \"always-on\" feature of the Apple Silicon Macs."
              reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|16.11,CSCv8|4.1,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
              see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
              show_output : YES
            </report>
          </then>
        </if>
      </then>

      <else>
        <report type:"PASSED">
          description : "2.9.1.1 Ensure the OS Is Not Active When Resuming from Standby (Intel)"
          info        : "In order to use a computer with Full Disk Encryption (FDE), macOS must keep encryption keys in memory to allow the use of the disk that has been FileVault protected. The storage volume has been unlocked and acts as if it were not encrypted. When the system is not in use, the volume is protected through encryption. When the system is sleeping and available to quickly resume, the encryption keys remain in memory.

https://www.helpnetsecurity.com/2018/08/20/laptop-sleep-security/

Mac systems should be set to hibernate after sleeping for a risk-acceptable time period. The default value for \"standbydelay\" is three hours (10800 seconds). This value is likely appropriate for most desktops. If Mac desktops are deployed in unmonitored, less physically secure areas with confidential data, this value might be adjusted. The desktop would have to retain power, however, so that the running OS or physical RAM could be attacked.

MacBooks should be set so that the standbydelay is 15 minutes (900 seconds) or less. This setting should allow laptop users in most cases to stay within physically secured areas while going to a conference room, auditorium, or other internal location without having to unlock the encryption. When the user goes home at night, the laptop will auto-hibernate after 15 minutes and require the FileVault password to unlock prior to logging back into the system when it resumes.

MacBooks should also be set to a hibernate mode that removes power from the RAM. This will stop the possibility of cold boot attacks on the system.

Macs running Apple silicon chips, rather than Intel chips, do not require the same configuration as Intel-based Macs.

To mitigate the risk of data loss, the system should power down and lock the encrypted drive after a specified time. Laptops should hibernate 15 minutes or less after sleeping."
          solution    : "Terminal Method:

Run the following command to set the hibernate delays and to ensure the FileVault keys are set to be destroyed on standby:

% /usr/bin/sudo /usr/bin/pmset -a standbydelaylow <value<=900>
% /usr/bin/sudo /usr/bin/pmset -a standbydelayhigh <value<=900>
% /usr/bin/sudo /usr/bin/pmset -a highstandbythreshold <value>=90>
% /usr/bin/sudo /usr/bin/pmset -a destroyfvkeyonstandby 1
% /usr/bin/sudo /usr/bin/pmset -a hibernatemode 25

example

:

% /usr/bin/sudo /usr/bin/pmset -a standbydelaylow 500
% /usr/bin/sudo /usr/bin/pmset -a standbydelayhigh 500
% /usr/bin/sudo /usr/bin/pmset -a highstandbythreshold 100
% /usr/bin/sudo /usr/bin/pmset -a destroyfvkeyonstandby 1
% /usr/bin/sudo /usr/bin/pmset -a hibernatemode 25

Impact:

The laptop will take additional time to resume normal operation if only sleeping rather than hibernating.

Setting hibernatemode to 25 will disable the \"always-on\" feature of the Apple Silicon Macs."
          reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|16.11,CSCv8|4.1,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2M,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
          see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
        </report>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "Check to see if system is a laptop"
          cmd         : "/usr/sbin/system_profiler SPHardwareDataType | /usr/bin/egrep MacBook"
          expect      : "MacBook"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "Check for processor type"
          cmd         : "/usr/sbin/sysctl -n machdep.cpu.brand_string"
          expect      : "Apple"
        </custom_item>
      </condition>

      <then>
        <if>
          <condition auto:"FAILED" type:"AND">
            <custom_item>
              type        : CMD_EXEC
              description : "Apple standby"
              cmd         : "/usr/bin/pmset -g | /usr/bin/grep -E \"^ sleep\""
              expect      : "sleep[\\s]+(1[0-5]|[1-9])([\\s]|$)"
            </custom_item>

            <custom_item>
              type        : CMD_EXEC
              description : "Apple DestroyFVKeyOnStandby"
              cmd         : "/usr/bin/pmset -g | /usr/bin/grep -E displaysleep"
              expect      : "displaysleep[\\s]+(10|[1-9])([\\s]|$)"
            </custom_item>
          </condition>

          <then>
            <report type:"PASSED">
              description : "2.9.1.2 Ensure Sleep and Display Sleep Is Enabled on Apple Silicon Devices"
              info        : "MacBooks should be set so that the sleep is 15 minutes or less and the display should sleep at 10 minutes or less. This setting should allow laptop users in most cases to stay within physically secured areas while going to a conference room, auditorium, or other internal location without having to unlock the encryption. When the user goes home at night, the laptop will auto-sleep after 15 minutes and log back into the system when it resumes.

Laptops should sleep 15 minutes or less after sleeping."
              solution    : "Terminal Method:

Run the following command to set the sleep time and hibernate mode:

% /usr/bin/sudo /usr/bin/pmset -a sleep <value<=15>
% /usr/bin/sudo /usr/bin/pmset -a displaysleep <value<=10 & < value of sleep>

example

:

% /usr/bin/sudo /usr/bin/pmset -a sleep 15
% /usr/bin/sudo /usr/bin/pmset -a displaysleep 10

Impact:

The laptop will take additional time to resume normal operation from sleep."
              reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|16.11,CSCv8|4.1,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
              see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
              show_output : YES
            </report>
          </then>
        </if>
      </then>

      <else>
        <report type:"PASSED">
          description : "2.9.1.2 Ensure Sleep and Display Sleep Is Enabled on Apple Silicon Devices"
          info        : "MacBooks should be set so that the sleep is 15 minutes or less and the display should sleep at 10 minutes or less. This setting should allow laptop users in most cases to stay within physically secured areas while going to a conference room, auditorium, or other internal location without having to unlock the encryption. When the user goes home at night, the laptop will auto-sleep after 15 minutes and log back into the system when it resumes.

Laptops should sleep 15 minutes or less after sleeping."
          solution    : "Terminal Method:

Run the following command to set the sleep time and hibernate mode:

% /usr/bin/sudo /usr/bin/pmset -a sleep <value<=15>
% /usr/bin/sudo /usr/bin/pmset -a displaysleep <value<=10 & < value of sleep>

example

:

% /usr/bin/sudo /usr/bin/pmset -a sleep 15
% /usr/bin/sudo /usr/bin/pmset -a displaysleep 10

Impact:

The laptop will take additional time to resume normal operation from sleep."
          reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|16.11,CSCv8|4.1,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
          see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
        </report>
      </else>
    </if>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.2 Ensure Security Auditing Flags For User-Attributable Events Are Configured Per Local Organizational Requirements"
      info        : "Auditing is the capture and maintenance of information about security-related events. Auditable events often depend on differing organizational requirements.

Maintaining an audit trail of system activity logs can help identify configuration errors, troubleshoot service disruptions, and analyze compromises or attacks that have occurred, have begun, or are about to begin. Audit logs are necessary to provide a trail of evidence in case the system or network is compromised.

Depending on the governing authority, organizations can have vastly different auditing requirements. In this control we have selected a minimal set of audit flags that should be a part of any organizational requirements. The flags selected below may not adequately meet organizational requirements for users of this benchmark. The auditing checks for the flags proposed here will not impact additional flags that are selected."
      solution    : "Terminal Method:

Perform the following to set the required Security Auditing Flags:

Edit the /etc/security/audit_control file and add -fm ad -ex aa -fr lo and -fw to flags You can also substitute -all for -fm -ex -fr and -fw"
      reference   : "800-171|3.1.7,800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171r3|03.01.07b.,800-171r3|03.03.01,800-171r3|03.03.02a.,800-171r3|03.03.02b.,800-171r3|03.03.03,800-171r3|03.03.06a.,800-53|AC-6(9),800-53|AU-2,800-53|AU-3,800-53|AU-3(1),800-53|AU-7,800-53|AU-12,800-53r5|AC-6(9),800-53r5|AU-2,800-53r5|AU-3,800-53r5|AU-3(1),800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.2.3(c),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|8.1.4.2(d),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(b),CN-L3|8.1.10.6(a),CSCv7|6.2,CSCv7|14.9,CSCv8|3.14,CSCv8|8.2,CSCv8|8.5,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-4,CSF|PR.PT-1,CSF|RS.AN-3,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.AA-05,CSF2.0|PR.PS-04,CSF2.0|RS.AN-03,CSF2.0|RS.AN-06,CSF2.0|RS.AN-07,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.28,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.15,ISO-27001-2022|A.8.18,ISO/IEC-27001|A.12.4.3,ITSG-33|AC-6,ITSG-33|AU-2,ITSG-33|AU-3,ITSG-33|AU-3(1),ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|2A,NESA|M1.2.2,NESA|M5.5.1,NESA|T3.6.2,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.5.4,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM23f,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,SWIFT-CSCv1|6.4,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      file        : "/etc/security/audit_control"
      regex       : "^flags:"
      expect      : "^flags:.*(?=.*aa)(?=.*ad)(?=.*lo).*((?=.*fm)(?=.*fr)(?=.*ex)(?=.*fw)|all).*$"
    </custom_item>

    <report type:"WARNING">
      description : "3.6 Audit Software Inventory"
      info        : "With the introduction of Mac OS X 10.6.6, Apple added a new application, App Store, which resides in the Applications directory. This application allows a user with admin privileges and an Apple Account to browse Apple's online App Store, purchase (including no-cost purchases), and install new applications, bypassing Enterprise software inventory controls. Any admin user can install software in the /Applications directory whether from internet downloads, thumb drives, optical media, cloud storage, or even binaries through email. Even standard users can run executables downloaded to their home folder by default. The source of the software is not nearly as important as a consistent audit of all installed software for patch compliance and appropriateness.

A single user desktop where the user, administrator, and the person approving software are all the same person probably does not need to audit software inventory to this extent. It is helpful in the case of stability problems or malware, however.

Scan systems on a monthly basis and determine the number of unauthorized pieces of software that are installed. Verify that if an unauthorized piece of software is found one month, it is removed from the system the next.

Export System Information through the built-in System Information Application or other third-party tools on an organizationally defined timetable.

Part of comprehensive IT security involves device management and ensuring that all software is authorized and patched. Checking for macOS updates and app updates are relatively simple for the end user, and can even be updated with minimal privileges from trusted sources, if enabled. Remote monitoring of the patch status for software maintained through Apple is very well supported by management applications. Neither Apple capabilities nor third-party patch management solutions will cover all mission-necessary software for most organizations. Full visibility into software present on the system enables vulnerability and risk management.

P.S. Don't forget about browser plugins/extensions for all installed software.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Delete any unnecessary applications from the system."
      reference   : "800-171|3.4.1,800-171|3.4.7,800-171|3.7.1,800-171|3.7.2,800-171r3|03.04.06,800-171r3|03.04.10,800-171r3|03.07.04,800-53|CM-7(1),800-53|CM-8,800-53|MA-3,800-53r5|CM-7(1),800-53r5|CM-8,800-53r5|MA-3,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSCv7|2.1,CSCv8|2.1,CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,CSF|PR.IP-1,CSF|PR.MA-1,CSF|PR.PT-3,CSF2.0|ID.AM-01,CSF2.0|ID.AM-02,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.9,ISO-27001-2022|A.8.9,ITSG-33|CM-7(1),ITSG-33|CM-8,ITSG-33|MA-3,ITSG-33|MA-3a.,LEVEL|2M,NESA|T1.2.1,NESA|T1.2.2,NESA|T2.3.4,NESA|T5.4.4,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>

    <custom_item>
      type         : MACOSX_OSASCRIPT
      description  : "4.1 Ensure Bonjour Advertising Services Is Disabled"
      info         : "Bonjour is an auto-discovery mechanism for TCP/IP devices which enumerates devices and services within a local subnet. DNS on macOS is integrated with Bonjour and should not be turned off, but the Bonjour advertising service can be disabled.

Bonjour can simplify device discovery from an internal rogue or compromised host. An attacker could use Bonjour's multicast DNS feature to discover a vulnerable or poorly-configured service or additional information to aid a targeted attack. Implementing this control disables the continuous broadcasting of \"I'm here!\" messages. Typical end-user endpoints should not have to advertise services to other computers. This setting does not stop the computer from sending out service discovery messages when looking for services on an internal subnet, if the computer is looking for a printer or server and using service discovery. To block all Bonjour traffic except to approved devices, the pf or other firewall would be needed."
      solution     : "Terminal Method:

Run the following command to disable Bonjour Advertising services:

% /usr/bin/sudo /usr/bin/defaults write /Library/Preferences/com.apple.mDNSResponder.plist NoMulticastAdvertisements -bool true

Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.mDNSResponder
 - The key to include is NoMulticastAdvertisements

Impact:

Some applications may not operate properly if Bonjour advertising (discoverable) is turned off. In AirDrop, having this discoverability feature disabled makes the system unavailable to receive files in AirDrop on the local network."
      reference    : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv7|9.2,CSCv8|4.1,CSCv8|4.8,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      expect       : "true"
      payload_key  : "NoMulticastAdvertisements"
      payload_type : "com.apple.mDNSResponder"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.1.7 Ensure No World Writable Folders Exist in the Library Folder"
      info        : "Software sometimes insists on being installed in the /System/Volumes/Data/Library Directory and has inappropriate world-writable permissions.

Folders in /System/Volumes/Data/Library should not be world-writable. The audit check excludes the /System/Volumes/Data/Library/Caches and /System/Volumes/Data/Library/Preferences/Audio/Data folders where the sticky bit is set."
      solution    : "Terminal Method:

Run the following command to set permissions so that folders are not world-writable in the /System/Volumes/Data/Library folder:

% /usr/bin/sudo IFS=$'\n'
for libPermissions in $( /usr/bin/find /System/Volumes/Data/Library -type d -perm -2 2>&1 | /usr/bin/grep -v Caches | /usr/bin/grep -v /Preferences/Audio/Data ); do
  /bin/chmod -R o-w \"$libPermissions\"
done"
      reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.01.02,800-171r3|03.01.04,800-171r3|03.01.05a.,800-171r3|03.08.02,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.3,ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.15,ISO-27001-2022|A.5.33,ISO-27001-2022|A.7.7,ISO-27001-2022|A.7.10,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.3,ISO-27001-2022|A.8.18,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|2A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/find /System/Volumes/Data/Library -type d -perm -2 -ls | /usr/bin/grep -v 'Caches' | /usr/bin/grep -v '/Preferences/Audio/Data' | /usr/bin/awk '{print} END {if (NR == 0) print \"none\"}'"
      expect      : "^none$"
      timeout     : "@FIND_TIMEOUT@"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.3 Ensure Complex Password Must Contain Alphabetic Characters Is Configured"
      info        : "Complex passwords contain one character from each of the following classes: English uppercase letters, English lowercase letters, Westernized Arabic numerals, and non-alphanumeric characters.

Ensure that an Alphabetic character is part of the password policy on the computer.

The more complex a password, the more resistant it will be against persons seeking unauthorized access to a system."
      solution    : "Terminal Method:

Run the following command to set that passwords must contain at least one letter:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy -setaccountpolicies \"requiresAlpha=<value>=1>\"

example

:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"requiresAlpha=1\"

Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.mobiledevice.passwordpolicy
 - The key to include is requireAlphanumeric
 - The key must be set to <true/>

Note: This profile sets a requirement of both an alphabetical and a numeric character.

Note: The profile method is the preferred method for setting password policy since -setglobalpolicy in pwpolicy is deprecated and will likely be removed in a future macOS release.

Impact:

Password policy should be in effect to reduce the risk of exposed services being compromised easily through dictionary attacks or other social engineering attempts."
      reference   : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|2M,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/pwpolicy -getaccountpolicies | /usr/bin/grep -A1 minimumLetters | /usr/bin/tail -1 | /usr/bin/cut -d'>' -f2 | /usr/bin/cut -d '<' -f1"
      expect      : "^@MINIMUM_ALPHABETIC_CHAR@$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.4 Ensure Complex Password Must Contain Numeric Character Is Configured"
      info        : "Complex passwords contain one character from each of the following classes: English uppercase letters, English lowercase letters, Westernized Arabic numerals, and non-alphanumeric characters.

Ensure that a number or numeric value is part of the password policy on the computer.

The more complex a password, the more resistant it will be against persons seeking unauthorized access to a system."
      solution    : "Terminal Method:

Run the following command to set passwords to require at least one number:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy -setaccountpolicies \"requiresNumeric=<value>=1>\"

example

:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"requiresNumeric=2\"

Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.mobiledevice.passwordpolicy
 - The key to include is requireAlphanumeric
 - The key must be set to <true/>

Note: This profile sets a requirement of both an alphabetical and a numeric character.

Note: The profile method is the preferred method for setting password policy since -setglobalpolicy in pwpolicy is deprecated and will likely be removed in a future macOS release.

Impact:

Password policy should be in effect to reduce the risk of exposed services being compromised easily through dictionary attacks or other social engineering attempts."
      reference   : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|2M,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/pwpolicy -getaccountpolicies | /usr/bin/grep -A1 minimumNumericCharacters | /usr/bin/tail -1 | /usr/bin/cut -d '>' -f2 | /usr/bin/cut -d '<' -f1"
      expect      : "^@MINIMUM_NUMERIC_CHAR@$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.5 Ensure Complex Password Must Contain Special Character Is Configured"
      info        : "Complex passwords contain one character from each of the following classes: English uppercase letters, English lowercase letters, Westernized Arabic numerals, and non-alphanumeric characters. Ensure that a special character is part of the password policy on the computer.

The more complex a password, the more resistant it will be against persons seeking unauthorized access to a system."
      solution    : "Terminal Method:

Run the following command to set passwords to require at least one special character:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy -setaccountpolicies \"requiresSymbol=<value>=1>\"

example

:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"requiresSymbol=1\"

Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.mobiledevice.passwordpolicy
 - The key to include is minComplexChars
 - The key must be set to <integer><value>=1></integer>

Note: The profile method is the preferred method for setting password policy since -setglobalpolicy in pwpolicy is deprecated and will likely be removed in a future macOS release.

Impact:

Password policy should be in effect to reduce the risk of exposed services being compromised easily through dictionary attacks or other social engineering attempts."
      reference   : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|2M,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/pwpolicy -getaccountpolicies  | /usr/bin/grep -A1 minimumSymbols | /usr/bin/tail -1 | /usr/bin/cut -d '>' -f2 | /usr/bin/cut -d '<' -f1"
      expect      : "^@MINIMUM_SPECIAL_CHAR@$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.6 Ensure Complex Password Must Contain Uppercase and Lowercase Characters Is Configured"
      info        : "Complex passwords contain one character from each of the following classes: English uppercase letters, English lowercase letters, Westernized Arabic numerals, and non-alphanumeric characters.

Ensure that both uppercase and lowercase letters are part of the password policy on the computer.

The more complex a password, the more resistant it will be against persons seeking unauthorized access to a system."
      solution    : "Terminal Method:

Run the following command to set passwords to require an upper and lower case letter:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"requiresMixedCase=<value>=1>\"

example

:

% /usr/bin/sudo /usr/bin/pwpolicy -n /Local/Default -setglobalpolicy \"requiresMixedCase=1\"

Impact:

Password policy should be in effect to reduce the risk of exposed services being compromised easily through dictionary attacks or other social engineering attempts."
      reference   : "800-171|3.5.2,800-171r3|03.05.07,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ITSG-33|IA-5(1),LEVEL|2M,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/bin/pwpolicy -getaccountpolicies | /usr/bin/grep -A1 minimumMixedCaseCharacters | /usr/bin/tail -1 | /usr/bin/cut -d'>' -f2 | /usr/bin/cut -d '<' -f1"
      expect      : "^@MINIMUM_MIXED_CASE_CHAR@$"
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type        : FILE_CHECK
          description : "permissions"
          file        : "/Library/Security/PolicyBanner.*"
          mask        : "003"
        </custom_item>

        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "text"
          file        : "/Library/Security/PolicyBanner.*"
          regex       : "@BANNER_TEXT@"
          expect      : "@BANNER_TEXT@"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "5.8 Ensure a Login Window Banner Exists"
          info        : "A Login window banner warning informs the user that the system is reserved for authorized use only. It enforces an acknowledgment by the user that they have been informed of the use policy in the banner if required. The system recognizes either thetxt and thertf formats.

An access warning may reduce a casual attacker's tendency to target the system. Access warnings may also aid in the prosecution of an attacker by evincing the attacker's knowledge of the system's private status, acceptable use policy, and authorization requirements."
          solution    : "Terminal Method:

Run the following commands to create or edit the login window text and set the proper permissions:

Edit (or create) a PolicyBanner.txt or PolicyBanner.rtf file, in the /Library/Security/ folder, to include the required login window banner text.

Perform the following to set permissions on the policy banner file:

% /usr/bin/sudo /bin/chmod o+r /Library/Security/PolicyBanner.txt

% /usr/bin/sudo /bin/chmod o+r /Library/Security/PolicyBanner.rtf

Note: If your organization uses anrtfd file to set the policy banner, run % /usr/bin/sudo /bin/chmod o+rx /Library/Security/PolicyBanner.rtfd to update the permissions.

Impact:

Users will have to click on the window with the Login text before logging into the computer."
          reference   : "800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171r3|03.04.01,800-171r3|03.04.02,800-171r3|03.04.06,800-171r3|03.16.01,800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|SA-3,800-53|SA-8,800-53|SA-10,800-53r5|CM-1,800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|SA-3,800-53r5|SA-8,800-53r5|SA-10,CSCv7|5.1,CSCv8|4.1,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-3,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|ID.RA-09,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-01,CSF2.0|PR.PS-06,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.2,ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.9,ISO-27001-2022|A.8.25,ISO-27001-2022|A.8.26,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ISO-27001-2022|A.8.30,ISO-27001-2022|A.8.31,ISO-27001-2022|A.8.32,ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|SA-3,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SA-10,LEVEL|2A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.2.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
          see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
          show_output : YES
        </report>
      </then>
    </if>

    <report type:"WARNING">
      description : "6.2.1 Ensure Protect Mail Activity in Mail Is Enabled"
      info        : "Apple provides privacy protection that should be enabled for the mail app on macOS to reduce information collection from a user that receives email.

Email is routinely abused by attackers, spammers and marketers. The \"Protect Mail Activity\" control reduces risk by hiding the current IP address of your Mac and privately downloading remote content.

The Protect Mail Activity function of privately downloading remote content is not applicable for those users that do not download any remote content. Typical Internet email is no longer plain text and will not render properly without remote content. Personal email or mailing list email may function without complaint by blocking remote content.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Graphical Method:

Perform the following steps to enabled protect mail activity:

 - Open Mail
 - Select Mail in the menu bar
 - Select Settings...
 - Select Privacy
 - Set Protect Mail Activity to enabled

Impact:

Some remote content may be access-controlled and refuse to download with this setting enabled."
      reference   : "800-171|3.13.1,800-171|3.13.13,800-171r3|03.13.01,800-171r3|03.13.13,800-53|CM-10,800-53|SC-7(3),800-53|SC-7(4),800-53|SC-18,800-53r5|CM-10,800-53r5|SC-7(3),800-53r5|SC-7(4),800-53r5|SC-18,CN-L3|8.1.10.6(j),CSCv7|7.1,CSCv7|7.4,CSCv8|9.1,CSCv8|9.3,CSF|DE.CM-3,CSF|DE.CM-5,CSF|PR.AC-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.32,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7(3),ITSG-33|SC-7(4),ITSG-33|SC-18,LEVEL|2M,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SU3,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|1.1,TBA-FIISB|43.1,TBA-FIISB|44.1.2"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>

    <custom_item>
      type        : CMD_EXEC
      description : "6.3.2 Audit History and Remove History Items"
      info        : "Organizational management of user web browsing history is a challenge affected by multiple facets. Organizations should decide whether to manage browser history and how much history should be maintained.

There are conflicting concerns in the retention of browser history.Unlimited retention:

 - Consumes disk space
 - Is preferred by on-disk forensics teams
 - Is user searchable for old visited pages
 - Raises some user privacy concerns
 - Has security concerns regarding retaining old links that may be stale or lead to compromised pages, or pages with changes or inappropriate content

Old browser history becomes stale and the use or misuse of the data can lead to unwanted outcomes. Search engine results are maintained and often provide much more relevant current information than old website visit information."
      solution    : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.Safari
 - The key to include is HistoryAgeInDaysLimit
 - The key must be set to: <integer><1,7,14,31,365,36500></integer>

Note: Setting the plist key to a value that is not represented by the GUI could cause issues.

Note: Since the profile method sets a system-wide setting and not a user-level one, the profile method is the preferred method. It is always better to set system-wide than per user.

Impact:

If old browsing history is not available, it will not be available to authorized or unauthorized users. Some users may find old and even stale information useful."
      reference   : "800-171|3.13.13,800-171r3|03.13.13,800-53|CM-10,800-53|SC-18,800-53r5|CM-10,800-53r5|SC-18,CSCv7|7.1,CSCv8|9.1,CSF|DE.CM-3,CSF|DE.CM-5,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.32,ITSG-33|SC-18,LEVEL|2M,NIAv2|SU3,QCSC-v1|3.2,QCSC-v1|8.2.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
      cmd         : "/usr/sbin/system_profiler SPConfigurationProfileDataType | /usr/bin/grep HistoryAgeInDaysLimit | /usr/bin/tr -d ' '"
      expect      : "^HistoryAgeInDaysLimit=@HISTORY_AGE@;$"
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "6.3.5 Audit Hide IP Address in Safari Setting"
      info         : "Public (Routable) IP addresses can be used to track people to their current location, including home and business addresses. While a valid IP address is necessary to load the site, the valid address does not need to be provided to known trackers and should be hidden.

Trackers can correlate your visits through various applications, including websites, and are a threat to your privacy."
      solution     : "Graphical Method:

Perform the following steps to set Safari whether or not to hide IP addresses from trackers:

 - Open Safari
 - Select Safari from the menu bar
 - Select Settings
 - Select Privacy
 - Set Hide IP address from trackers to your organization's requirements

Terminal Method:

Run the following command to enable or disable hiding IP addresses from trackers in Safari:

% /usr/bin/sudo -u <username> /usr/bin/defaults write /Users/<username>/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari WBSPrivacyProxyAvailabilityTraffic -int <130272/130276>

33422560 will set hide IP address from trackers to disabled. 33422564 will enable from Trackers Only, and 33422572 will enabled from Trackers and Websites.

example

:

% /usr/bin/sudo -u firstuser /usr/bin/defaults write /Users/firstuser/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari WBSPrivacyProxyAvailabilityTraffic -int 33422560

% /usr/bin/sudo -u seconduser /usr/bin/defaults write /Users/seconduser/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari WBSPrivacyProxyAvailabilityTraffic -int 33422564

% /usr/bin/sudo -u thirduser /usr/bin/defaults write /Users/thirduser/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari WBSPrivacyProxyAvailabilityTraffic -int 33422572

Note: To run the Terminal commands, Terminal must be granted Full Disk Access in the Security & Privacy pane in System Preferences.

Impact:

Website address blocking through iCloud Private Relay may prevent some wanted pages from loading that use IP geolocation access controls.

Some organizations use IP address access controls (ACLs). If your organization or partners are using IP address ACLs, there will be unreachable web services if Apple hides the IP address."
      reference    : "800-171|3.13.1,800-171|3.13.13,800-171r3|03.13.01,800-171r3|03.13.13,800-53|CM-10,800-53|SC-7(3),800-53|SC-7(4),800-53|SC-18,800-53r5|CM-10,800-53r5|SC-7(3),800-53r5|SC-7(4),800-53r5|SC-18,CN-L3|8.1.10.6(j),CSCv7|7.1,CSCv7|7.4,CSCv8|9.1,CSCv8|9.3,CSF|DE.CM-3,CSF|DE.CM-5,CSF|PR.AC-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.32,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7(3),ITSG-33|SC-7(4),ITSG-33|SC-18,LEVEL|2M,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SU3,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|1.1,TBA-FIISB|43.1,TBA-FIISB|44.1.2"
      see_also     : "https://workbench.cisecurity.org/benchmarks/18636"
      regex        : "= @SAFARI_TRACKER_SETTING@$"
      managed_path : "/Library/Containers/com.apple.Safari/Data/Library/Preferences/"
      plist_item   : "WBSPrivacyProxyAvailabilityTraffic"
      plist_name   : "com.apple.Safari"
      plist_option : CANNOT_BE_NULL
      plist_user   : "all"
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "AutoFillCreditCardData"
          cmd         : "/usr/sbin/system_profiler SPConfigurationProfileDataType | /usr/bin/grep AutoFillCreditCardData | /usr/bin/tr -d ' '"
          expect      : "^AutoFillCreditCardData=@AUTOFILL_CREDIT_CARD_DATA@;$"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "AutoFillFromAddressBook"
          cmd         : "/usr/sbin/system_profiler SPConfigurationProfileDataType | /usr/bin/grep AutoFillFromAddressBook | /usr/bin/tr -d ' '"
          expect      : "^AutoFillFromAddressBook=@AUTOFILL_ADDRESS_BOOK@;$"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "AutoFillPasswords"
          cmd         : "/usr/sbin/system_profiler SPConfigurationProfileDataType | /usr/bin/grep AutoFillPasswords | /usr/bin/tr -d ' '"
          expect      : "^AutoFillPasswords=@AUTOFILL_PASSWORDS@;$"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "AutoFillMiscellaneousForms"
          cmd         : "/usr/sbin/system_profiler SPConfigurationProfileDataType | /usr/bin/grep AutoFillMiscellaneousForms | /usr/bin/tr -d ' '"
          expect      : "^AutoFillMiscellaneousForms=@AUTOFILL_MISC_FORMS@;$"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "6.3.8 Audit AutoFill"
          info        : "AutoFill capabilities in a Web Browser are a feature to allow a user to avoid re-typing the same user information in every form that a user encounters. Part of the modern internet consists of vendors establishing a seemingly close relationship with as many users as possible to market to them, data-mine from them and sell their data to third-party data aggregators. AutoFill can be a method for a user to share too much information with untrusted website owners. Many security professionals advise disabling autofill to reduce the risk of over-sharing. These security professionals appear to believe that manual data entry is better, since completing the required forms are often the only method to connect to needed data. The best method for security is to ensure that the data ready to be auto-filled is an acceptable risk to sites a user interacts with. Users must review what data they accept the risk to share.

Auditing and accepting information a user is willing to share prior to loading the blank form is the best way to manage risk."
          solution    : "Profile Method:

Create or edit a configuration profile with the following information:

 - The PayloadType string is com.apple.Safari
 - The key to include is AutoFillFromAddressBook
 - The key must be set to: <<true/false>/>
 - The key to include is AutoFillPasswords
 - The key must be set to: <<true/false>/>
 - The key to include is AutoFillCreditCardData
 - The key must be set to: <<true/false>/>
 - The key to include is AutoFillMiscellaneousForms
 - The key must be set to: <<true/false>/>

Impact:

A user could overshare information based on trusting a site more than required."
          reference   : "800-171|3.13.13,800-171r3|03.13.13,800-53|CM-10,800-53|SC-18,800-53r5|CM-10,800-53r5|SC-18,CSCv7|7.1,CSCv8|9.1,CSF|DE.CM-3,CSF|DE.CM-5,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.32,ITSG-33|SC-18,LEVEL|2M,NIAv2|SU3,QCSC-v1|3.2,QCSC-v1|8.2.1"
          see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
          show_output : YES
        </report>
      </then>
    </if>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_Apple_macOS_15.0_Sequoia_v1.0.0_L2.audit from CIS Apple macOS 15.0 Sequoia Benchmark v1.0.0"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/benchmarks/18636"
    </report>
  </else>
</if>

</check_type>
