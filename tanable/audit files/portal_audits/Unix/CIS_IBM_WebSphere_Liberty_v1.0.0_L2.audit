#TRUSTED 4634b141140a4057c444a91d88177ff79021729339d813c76fcd92ab9acaafb62e3f4b803ad4993eb3b15b49e31d8ae00c89ab84c6d92b4b557dfb27a8aa7b2468b3c972e90899285649198f2ae1ccbb9b0fb1f1421459207a19e399f83c3d0d33d3068ad230e3f42b1fa4fdf71ba478c24ddbc7339f126be1e23e189c43b8492cfd8eeb06deae7484803b4578b7e8c8ce306301041bf58f551d563c6f3e2528e192717fa6f3164a866164a3d251dcac9f154d2923edd7ac0630b8beb22c3f3251b14515931a198ff0bd04ca160a5f5391d4850e630e66d2cd0a385a182f9ffe98739533b57050fb85e6eb14dd78353f80fa78ce491996ca1752ae290a30b0dabd59aa846dd72d9ae697f91d08f35374a7535046e49d141c420da963f59f9ea8166ee7dcbec0bcd75fc98c6e27d1fa055ef5715e2b73e6f47a1ada6726413739b6b2205f7deb6c8b7e5f6062fb6d34f49a722693797b9cb00ca408d32d0ce32d55f455c94c57a96a50c0e0a65215dad173179cbf8efdc98b3d31614e1dff3ef02531bd1f9a0c221e676f6e45d7d67ccf61a0005bb57529608884ffd89b83fa1834dbf63f955d1edf66cc3da68c8173306b0cb90e90d9ccbbfa9012848bb1b33a6e1f8eab1e14080d3f223b7383d0c905e6de7f0916e81194bf0ea940121da14af63420c12899943a07daf4e786c9eb1ab12bcfc941c88e2c9fa0f6903d53c28b
#TRUST-RSA-SHA256 480159f1c5890acd3990dd1190012712959f3f04c00550cdc0622ee81fbd8e0ab5270aa6dec15cc620779f2f8157381269c2893348d77b26bb0d59d829ea393725ff8e32b6837cf8a1f74e0463614f40a81d612225aca68a8b0f0b0999e941e54054ec03daeec136e309b1811a37886703d63f6e903785836a2792a8786497f0012337b28fe107ce0bc84561ca4f4eac5231ec51e0f71ba90c85baf9853dd9493ef5f4749cd4da51726c35968c4083440854efec3ea3f552fed4786445b9bd8e7c947633fda5296a2731f300f45f5c1b897d2607ceee34b6a87989377d29250cbe471e74f81269b138995af8292cf5718c01eeaddb06d483422a6bfd56dbb5ae990f7edccfcbbcfabd0beac202b7e556ad3b1e6a071377cc3a8ab8382ebf01f70d796ab0ac32dcd2531ac3cf995fafa6c00811c7b9e79f83aa47ce15171c3668968477ce20217fe4e72e9a92396383763da14c73e041c1c5d5032c87441dc4d271d4e725d260a676dcbbe2fbac0bdfeb39428d018aa322cc77c79247697472ed3e86b8c8b6a0d9db7532752a02191846a18a5fa8d181bf0bd9fc3da8dedf6b6ed6cf30349237364b26f87097dd06d02e8caaa873b7e9c2e7678d28b58cc0beba9704a0e9fb10dbd5832daf4fd3e360a5b7cfd920e6df988b688e4fe4157b62ea18f5e8fa2f4976e1ac9cc25b1c47503a6252523f216b2d8bf4efb49eb033de98
#
# This script is Copyright (C) 2004-2025 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2025/01/24 $
#
# description : This .audit is designed against the CIS IBM WebSphere Liberty Benchmark 1.0.0
#
#<ui_metadata>
#<display_name>CIS IBM WebSphere Liberty v1.0.0 L2</display_name>
#<spec>
#  <type>CIS</type>
#  <name>IBM WebSphere Liberty</name>
#  <profile>L2</profile>
#  <version>1.0.0</version>
#  <link>https://workbench.cisecurity.org/benchmarks/7724</link>
#</spec>
#<labels>unix,cis,ibm_websphere_liberty</labels>
#<benchmark_refs>CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#<application>
#  <app_name>IBM WebSphere Application Server</app_name>
#  <app_key>Install path</app_key>
#</application>
#<variables>
#  <variable>
#    <name>TRUSTED_HEADER</name>
#    <default>none</default>
#    <description>WebSphere Liberty Private HTTP Trusted Header</description>
#    <info>Private headers to provide information about the original request - 4.2.10</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>HW_CRYPTO_CFG_FILE</name>
#    <default>HWCrypto.cfg</default>
#    <description>hardware crypto configuration file</description>
#    <info>Site-specific hardware crypto configuration file - 4.2.13</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>WLP_JAVA_HOME</name>
#    <default>/opt/IBM/WebSphere/Liberty/java/8.0</default>
#    <description>WebSphere Liberty JAVA Home Directory</description>
#    <info>Indicates the location of the WebSphere Java Runtime Environment install directory</info>
#    <value_type>UNIX_FILE_PATH</value_type>
#  </variable>
#  <variable>
#    <name>CONSTRAINED_DELEGATION_VERSION</name>
#    <default>1.0</default>
#    <description>WebSphere Liberty Constrained Delegation Version</description>
#    <info>WebSphere Liberty constrained delegation version which is defined in 4.3.2.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>KEY_RINGHW</name>
#    <default>///myHWKeyring</default>
#    <description>WebSphere Liberty Server SAF Hardware Keyring</description>
#    <info>The SAF Hardware Keyrings to manage the SSL/TLS certificates. - 9.3</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>KEY_RING_HYBRID</name>
#    <default>///myHybridKeyring</default>
#    <description>WebSphere Liberty Server Hybrid Keyring</description>
#    <info>The Hybrid Keyrings to manage the SSL/TLS certificates. - 9.3</info>
#    <value_type>STRING</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : CMD_EXEC
      description : "WebSphere Liberty is installed"
      cmd         : "@APP_Install_path@/bin/productInfo version"
      expect      : "(?i)^[\\s]*Product[\\s]*name[\\s]*:[\\s]*WebSphere[\\s]*Application[\\s]*Server"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_IBM_WebSphere_Liberty_v1.0.0_L2.audit from CIS IBM WebSphere Liberty Benchmark v1.0.0"
      see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
    </report>

    <if>
      <condition auto:"WARNING" type:"AND">
        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "websphere.java.security property is configured"
          file        : "@APP_Config_catalogs@/bootstrap.properties"
          regex       : "[\\s]*websphere.java.security[\\s]*"
          expect      : "[\\s]*websphere.java.security[\\s]*"
        </custom_item>

        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "Review appropriate permissions are granted"
          file        : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt    : "<xsl:template match=\"/\">"
          xsl_stmt    : "<xsl:for-each select=\"server\">"
          xsl_stmt    : "<xsl:choose>"
          xsl_stmt    : "<xsl:when test=\"javaPermission/@actions and javaPermission/@restriction\">"
          xsl_stmt    : "<xsl:text>REVIEW - actions set to </xsl:text><xsl:value-of select=\"javaPermission/@actions\" /><xsl:text> and restrictions set to </xsl:text><xsl:value-of select=\"javaPermission/@restriction\" /><xsl:text>&#xa;</xsl:text>"
          xsl_stmt    : "</xsl:when>"
          xsl_stmt    : "<xsl:otherwise>"
          xsl_stmt    : "<xsl:text>REVIEW - No java permissions found.</xsl:text><xsl:text>&#xa;</xsl:text>"
          xsl_stmt    : "</xsl:otherwise>"
          xsl_stmt    : "</xsl:choose>"
          xsl_stmt    : "</xsl:for-each>"
          xsl_stmt    : "</xsl:template>"
          regex       : "REVIEW"
          expect      : "^Manual Review Required$"
          severity    : MEDIUM
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "3.2 Ensure JDK Security Manager is Enabled"
          info        : "The JDK's security manager allows applications to implement a security policy. It allows an application to permit or deny operations defined by the security policy.

In some situations there is a need to restrict applications from performing certain operations like read and writing to files, opening network connections etc. JDK's security manager provides a way to configure a security policy that can be applied to restrict the applications operations.

Note: The security manager is proposed to be deprecated and removed in future releases of JDK.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Enable the websphere.java.security property in ${server.config.dir}/bootstrap.properties file

websphere.java.security

and also confirm that the appropriate permissions are granted in the application's permission.xml file and/or in the javaPermission element specified in ${server.config.dir}/configDropins/overrides/*.xmlFor example,

<javaPermission className=\"java.security.PropertyPermission\" name=\"os.name\" actions=\"read\" restriction=\"true\" />

Impact:

Generally enabling the security manager can impact the performance because of the additional checks needed to restrict operations by applications. Applications can also fail to run with these additional checks in which case appropriate permissions have to configured for the application either in the server configuration files or the application specific permissions.xml file."
          reference   : "800-171|3.1.1,800-171|3.1.2,800-53|AC-17,800-53r5|AC-17,CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(i),CSF|PR.AC-3,CSF|PR.PT-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.6.7,ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17,LEVEL|2A,NESA|T5.4.5,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.6"
          see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
          show_output : YES
        </report>
      </then>
    </if>

    <custom_item>
      type              : FILE_CONTENT_CHECK
      description       : "4.2.1 Ensure 'trustDefaultCerts' is set to 'false'"
      info              : "The default certificates from the Java runtime are trusted by the server in addition to the certificates configured in the SSL/TLS configurations in the server.

Restricting the certificates trusted by the server to only the SSL/TLS configurations in the server in a production environment eliminates the risk of trusting other certificates when making outbound secure connections."
      solution          : "Add the trustDefaultCerts attribute to all ssl elements to ${server.config.dir}/configDropins/overrides/*.xml and set the value to false

<ssl trustDefaultCerts=\"false\" />"
      reference         : "800-171|3.1.13,800-171|3.5.2,800-171|3.13.8,800-53|AC-17(2),800-53|IA-5,800-53|IA-5(1),800-53|SC-8,800-53|SC-8(1),800-53r5|AC-17(2),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|SC-8,800-53r5|SC-8(1),CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSCv7|14.4,CSCv8|3.10,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO-27001-2022|A.5.33,ISO-27001-2022|A.6.7,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(1),LEVEL|2A,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.2.3,NESA|T5.4.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS5d,NIAv2|NS6b,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|29.1"
      see_also          : "https://workbench.cisecurity.org/benchmarks/7724"
      file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
      xsl_stmt          : "<xsl:template match=\"/\">"
      xsl_stmt          : "<xsl:for-each select=\"server\">"
      xsl_stmt          : "<xsl:choose>"
      xsl_stmt          : "<xsl:when test=\"ssl/@trustDefaultCerts!='false'\">"
      xsl_stmt          : "<xsl:text>FAIL - trustDefaultCerts set to </xsl:text><xsl:value-of select=\"ssl/@trustDefaultCerts\" /><xsl:text>&#xa;</xsl:text>"
      xsl_stmt          : "</xsl:when>"
      xsl_stmt          : "<xsl:when test=\"ssl/@trustDefaultCerts='false'\">"
      xsl_stmt          : "<xsl:text>PASS - trustDefaultCerts configured correctly</xsl:text><xsl:text>&#xa;</xsl:text>"
      xsl_stmt          : "</xsl:when>"
      xsl_stmt          : "</xsl:choose>"
      xsl_stmt          : "</xsl:for-each>"
      xsl_stmt          : "</xsl:template>"
      regex             : "PASS|FAIL"
      expect            : "PASS"
      file_supersedence : YES
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "Ensure the clientAuthentication attribute in the ssl element is set to true"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"ssl/@clientAuthentication='true'\">"
          xsl_stmt          : "<xsl:text>PASS - clientAuthentication set to </xsl:text><xsl:value-of select=\"ssl/@clientAuthentication\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "<xsl:when test=\"ssl/@clientAuthentication!='true'\">"
          xsl_stmt          : "<xsl:text>FAIL - clientAuthentication set to </xsl:text><xsl:value-of select=\"ssl/@clientAuthentication\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>

        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "Ensure the trustedHeaderOrigin attribute in httpDispatcher element is set to appropriate value"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"httpDispatcher/@trustedHeaderOrigin='@TRUSTED_HEADER@'\">"
          xsl_stmt          : "<xsl:text>PASS - trustedHeaderOrigin set to </xsl:text><xsl:value-of select=\"httpDispatcher/@trustedHeaderOrigin\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "<xsl:when test=\"httpDispatcher/@trustedHeaderOrigin!='@TRUSTED_HEADER@'\">"
          xsl_stmt          : "<xsl:text>FAIL - trustedHeaderOrigin set to </xsl:text><xsl:value-of select=\"httpDispatcher/@trustedHeaderOrigin\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "4.2.10 Ensure mutual TLS authentication is enabled"
          info        : "Mutual TLS authentication requires that both the server and the client authenticate to the other during SSL/TLS handshake.

Mutual authentication, also known as two-way authentication, is certificate-based authentication for clients. Use of mutual TLS authentication whenever possible is recommended."
          solution    : "Add these settings to ${server.config.dir}/configDropins/overrides/<any file name>.xml

for direct login to WebSphere Liberty.

<httpDispatcher ... trustedHeaderOrigin=\"none\"/>
<ssl ... clientAuthentication=\"true\" />

For login in conjunction with a proxy, add the following. Replace the ip addresses with your values.

<httpDispatcher ... trustedHeaderOrigin=\"10.20.30.40, 10.20.50.60\"/>
<ssl ... clientAuthentication=\"true\" />"
          reference   : "800-171|3.1.13,800-171|3.5.2,800-171|3.13.8,800-53|AC-17(2),800-53|IA-5,800-53|IA-5(1),800-53|SC-8,800-53|SC-8(1),800-53r5|AC-17(2),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|SC-8,800-53r5|SC-8(1),CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSCv7|14.4,CSCv8|3.10,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,CSF2.0|PR.AA-05,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO-27001-2022|A.5.10,ISO-27001-2022|A.5.14,ISO-27001-2022|A.5.16,ISO-27001-2022|A.5.17,ISO-27001-2022|A.5.33,ISO-27001-2022|A.6.7,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(1),LEVEL|2A,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.2.3,NESA|T5.4.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS5d,NIAv2|NS6b,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|29.1"
          see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
          show_output : YES
        </report>
      </then>
    </if>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "Ensure that the location attribute is set to the specific hardware crypto configuration file"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"keyStore/@location='@APP_Config_catalogs@/@HW_CRYPTO_CFG_FILE@'\">"
          xsl_stmt          : "<xsl:text>PASS - location set to </xsl:text><xsl:value-of select=\"keyStore/@location\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "<xsl:when test=\"keyStore/@location!='@APP_Config_catalogs@/@HW_CRYPTO_CFG_FILE@'\">"
          xsl_stmt          : "<xsl:text>FAIL - location set to </xsl:text><xsl:value-of select=\"keyStore/@location\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>

        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "Ensure that type attribute is set to PKCS11"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"keyStore/@type='PKCS11'\">"
          xsl_stmt          : "<xsl:text>PASS - type set to </xsl:text><xsl:value-of select=\"keyStore/@type\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "<xsl:when test=\"keyStore/@type!='PKCS11'\">"
          xsl_stmt          : "<xsl:text>FAIL - type set to </xsl:text><xsl:value-of select=\"keyStore/@type\"/><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "4.2.13 Ensure that hardware crypto cards/modules (HSM) are used to store SSL/TLS certificates"
          info        : "Hardware security modules (HSMs) are hardened, tamper-resistant hardware devices that secure cryptographic processes by generating, protecting, and managing keys used for encrypting and decrypting data and creating digital signatures and certificates.

Using hardware security modules (HSM) to store and use certificates for the SSL/TLS communication provides greater security."
          solution    : "Configure the location attribute to the specific hardware crypto card configuration file. In addition configure the type attribute to PKCS11 Both these attributes are in the keyStore element used by the SSL configuration in ${server.config.dir}/configDropins/overrides/*.xml.

In this example, the HWCryto.cfg contains the hardware crypto configuration information.

<keyStore id=\"hwKeyStore\"
          location=\"${server.config.dir}/HWCrypto.cfg\"
          type=\"PKCS11\"
          fileBased=\"false\"
          provider=\"IBMPKCS11Impl\"
	 ...
/>

Impact:

Hardware crypto cards/modules are external devices that can store certificates that can be used for the SSL/TLS communications. They store and protect the cryptographic keys throughout their lifecycles. The use of these devices have to be weighed against the security requirements and the additional expenses this would entail.

The specific configuration needed to support depends on the crypto card and JDK. The following applies when using the IBM JDK and when the keyStore type is PKCS11."
          reference   : "800-171|3.13.10,800-53|SC-12,800-53r5|SC-12,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.24,ISO/IEC-27001|A.10.1.2,ITSG-33|SC-12,ITSG-33|SC-12a.,LEVEL|2M,NESA|T7.4.1,NESA|T7.4.2,NIAv2|CY2,NIAv2|CY8,NIAv2|CY9,QCSC-v1|5.2.2,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
          show_output : YES
        </report>
      </then>
    </if>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.2.14 Ensure SP800-131a recommendation is used for stronger cryptographic keys and more robust algorithms."
      info        : "The National Institute of Standards and Technology (NIST) SP800-131a recommendation enforces stronger cryptographic keys and more robust algorithms.

The NIST recommendation (SP 800-131A) provides more specific guidance to the use of stronger cryptographic keys and more robust algorithms for SSL/TLS connections and is recommended to be used if it is appropriate for your environment."
      solution    : "Configure the system property -Dcom.ibm.jsse2.sp800-131 to strict in the jvm.options file. The link in reference section provides more information on how to customize the Liberty environment with system properties.

In the jvm.options file add the following

-Dcom.ibm.jsse2.sp800-131=strict
..."
      reference   : "800-171|3.13.10,800-53|SC-12,800-53r5|SC-12,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.24,ISO/IEC-27001|A.10.1.2,ITSG-33|SC-12,ITSG-33|SC-12a.,LEVEL|2M,NESA|T7.4.1,NESA|T7.4.2,NIAv2|CY2,NIAv2|CY8,NIAv2|CY9,QCSC-v1|5.2.2,QCSC-v1|6.2"
      see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
      file        : "@APP_Config_catalogs@/jvm.options"
      regex       : "^[\\s]*-Dcom.ibm.jsse2.sp800-131[\\s]*="
      expect      : "^[\\s]*-Dcom.ibm.jsse2.sp800-131[\\s]*=[\\s]*strict[\\s]*$"
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "IBMJCEPlusFIPS configured in java.security"
          file        : "@WLP_JAVA_HOME@/jre/lib/security/java.security"
          regex       : "^[\\s]*security.provider.1[\\s]*=[\\s]*com.ibm.crypto.plus.provider.IBMJCEPlusFIPS[\\s]*$"
          expect      : "^[\\s]*security.provider.1[\\s]*=[\\s]*com.ibm.crypto.plus.provider.IBMJCEPlusFIPS[\\s]*$"
        </custom_item>

        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "-Dcom.ibm.jsse2.usefipsprovider set to true"
          file        : "@APP_Config_catalogs@/jvm.options"
          regex       : "^[\\s]*-Dcom.ibm.jsse2.usefipsprovider[\\s]*="
          expect      : "^[\\s]*-Dcom.ibm.jsse2.usefipsprovider[\\s]*=[\\s]*true[\\s]*$"
        </custom_item>

        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "-Dcom.ibm.jsse2.usefipsProviderName set to IBMJCEPlusFIPS"
          file        : "@APP_Config_catalogs@/jvm.options"
          regex       : "^[\\s]*-Dcom.ibm.jsse2.usefipsProviderName[\\s]*="
          expect      : "^[\\s]*-Dcom.ibm.jsse2.usefipsProviderName[\\s]*=[\\s]*IBMJCEPlusFIPS[\\s]*$"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "4.2.15 Ensure that the Federal Information Processing Standards (FIPS) are used for the cryptographic modules"
          info        : "The National Institute of Standards and Technology (NIST) issues the FIPS 140 Publication Series to coordinate the requirements and standards for cryptography modules that include both hardware and software components. Protection of a cryptographic module within a security system is necessary to maintain the confidentiality and integrity of the information protected by the module. This standard specifies the security requirements that will be satisfied by a cryptographic module.

Federal Information Processing Standards (FIPS) are standards and guidelines that are issued by the National Institute of Standards and Technology (NIST) for federal government computer systems. You can set up Liberty to comply with FIPS requirements by setting system properties and specifying a FIPS-validated security provider."
          solution    : "Configure the system property -Dcom.ibm.jsse2.usefipsprovider to true and -Dcom.ibm.jsse2.usefipsProviderName to IBMJCEPlusFIPS in the jvm.options file. The link in reference section provides more information on how to customize the Liberty environment with system properties.

-Dcom.ibm.jsse2.usefipsprovider=true
-Dcom.ibm.jsse2.usefipsProviderName=`IBMJCEPlusFIPS`
...

In addition, configure the IBMJCEPlusFIPS provider in the $JAVA_HOME/jre/lib/security/java.security file.

security.provider.1=com.ibm.crypto.plus.provider.IBMJCEPlusFIPS
..."
          reference   : "800-171|3.13.10,800-53|SC-12,800-53r5|SC-12,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.8.24,ISO/IEC-27001|A.10.1.2,ITSG-33|SC-12,ITSG-33|SC-12a.,LEVEL|2M,NESA|T7.4.1,NESA|T7.4.2,NIAv2|CY2,NIAv2|CY8,NIAv2|CY9,QCSC-v1|5.2.2,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
          show_output : YES
        </report>
      </then>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "spnego is configured"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"spnego\">"
          xsl_stmt          : "<xsl:text>PASS - spnego configured on server</xsl:text><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "4.3.2 Ensure that constrained delegation is configured for SPNEGO  (Simple and Protected GSSAPI Negotiation Mechanism)"
          info              : "SPNEGO authentication supports both constrained and unconstrained delegation. Constrained delegation provides the ability to specify and enforce application trust boundaries on a user's behalf by limiting the flow of the SPENGO tokens only to trusted servers.

Constrained delegation gives service administrators the ability to specify and enforce application trust boundaries by limiting the scope where application services can act on behalf of a user."
          solution          : "In ${server.config.dir}/configDropins/overrides/<any file name>.xml add the constrainedDelegation-1.0 feature to the featureManager element:

<feature>constrainedDelegation-1.0</feature>

Impact:

Enabling constrained delegation requires additional configuration at the external KDC (Kerberos Distribution Center) server that is creating the SPNEGO token. The additional configuration depends on the KDC."
          reference         : "800-171|3.13.1,800-171|3.13.5,800-53|SC-7,800-53r5|SC-7,CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7,LEVEL|2M,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,TBA-FIISB|43.1"
          see_also          : "https://workbench.cisecurity.org/benchmarks/7724"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"feature='constrainedDelegation-@CONSTRAINED_DELEGATION_VERSION@'\">"
          xsl_stmt          : "<xsl:text>PASS - constrainedDelegation set to </xsl:text><xsl:value-of select=\"feature\" /><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "<xsl:when test=\"feature!='constrainedDelegation-@CONSTRAINED_DELEGATION_VERSION@'\">"
          xsl_stmt          : "<xsl:text>FAIL - constrainedDelegation set to </xsl:text><xsl:value-of select=\"feature\" /><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>
      </then>

      <else>
        <report type:"PASSED">
          description : "4.3.2 Ensure that constrained delegation is configured for SPNEGO  (Simple and Protected GSSAPI Negotiation Mechanism)"
          info        : "SPNEGO authentication supports both constrained and unconstrained delegation. Constrained delegation provides the ability to specify and enforce application trust boundaries on a user's behalf by limiting the flow of the SPENGO tokens only to trusted servers.

Constrained delegation gives service administrators the ability to specify and enforce application trust boundaries by limiting the scope where application services can act on behalf of a user."
          solution    : "In ${server.config.dir}/configDropins/overrides/<any file name>.xml add the constrainedDelegation-1.0 feature to the featureManager element:

<feature>constrainedDelegation-1.0</feature>

Impact:

Enabling constrained delegation requires additional configuration at the external KDC (Kerberos Distribution Center) server that is creating the SPNEGO token. The additional configuration depends on the KDC."
          reference   : "800-171|3.13.1,800-171|3.13.5,800-53|SC-7,800-53r5|SC-7,CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.16,ISO-27001-2022|A.8.20,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7,LEVEL|2M,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,TBA-FIISB|43.1"
          see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
        </report>
      </else>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "safkeyringhw is configured correctly"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server/keyStore\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"@location='safkeyringhw:@KEY_RINGHW@'\">"
          xsl_stmt          : "<xsl:text>PASS - safkeyringhw set to </xsl:text><xsl:value-of select=\"@location\" /><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "<xsl:when test=\"@location!='safkeyringhw:@KEY_RINGHW@'\">"
          xsl_stmt          : "<xsl:text>FAIL - safkeyringhw set to </xsl:text><xsl:value-of select=\"@location\" /><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>

        <custom_item>
          type              : FILE_CONTENT_CHECK
          description       : "Ensure that type attribute is set to JCECCARACFKS"
          file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
          xsl_stmt          : "<xsl:template match=\"/\">"
          xsl_stmt          : "<xsl:for-each select=\"server/keyStore\">"
          xsl_stmt          : "<xsl:choose>"
          xsl_stmt          : "<xsl:when test=\"@type='JCECCARACFKS'\">"
          xsl_stmt          : "<xsl:text>PASS - type set to </xsl:text><xsl:value-of select=\"@type\" /><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "<xsl:when test=\"@type!='JCECCARACFKS'\">"
          xsl_stmt          : "<xsl:text>FAIL - type set to </xsl:text><xsl:value-of select=\"@type\" /><xsl:text>&#xa;</xsl:text>"
          xsl_stmt          : "</xsl:when>"
          xsl_stmt          : "</xsl:choose>"
          xsl_stmt          : "</xsl:for-each>"
          xsl_stmt          : "</xsl:template>"
          regex             : "PASS|FAIL"
          expect            : "PASS"
          file_supersedence : YES
        </custom_item>

        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "com.ibm.crypto.hdwrCCA.provider.IBMJCECCA provider is configured"
          file        : "@APP_wlp.install.dir@/java/*/jre/lib/security/java.security"
          regex       : "^(?!#).*[\\s]*(?i)com.ibm.crypto.hdwrCCA.provider.IBMJCECCA[\\s]*$"
          expect      : "^(?!#).*[\\s]*(?i)com.ibm.crypto.hdwrCCA.provider.IBMJCECCA[\\s]*$"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "9.3 Ensure 'safkeyringhw:' is set to use a hardware crypto card"
          info        : "Use hardware crypto card to store to store cryptographic keys and certificates.

Using hardware crypto card to store and load cryptographic keys and certificates. Using hardware crypto cards can provide additional security guards against theft. The keys and certificates are used during cryptographic functions like encryption/decryption and also during the SSL/TLS communication."
          solution    : "For the crypto card configuration, configure the location attribute in the keyStore elements referenced by the SSL configurations to point to a valid hardware crypto keyring configuration and set the type attribute to JCECCARACFKS in ${server.config.dir}/configDropins/overrides/<any file name>.xml

<keyStore id=\"defaultKeyStore\"
location=\"safkeyringhw:///myHWKeyring\"
type=\"JCECCARACFKS\"
...
/>

In addition, make sure that the com.ibm.crypto.hdwrCCA.provider.IBMJCECCA provider is configured in the $JAVA_HOME/jre/lib/security/java.security file.

..
security.provider.3=com.ibm.crypto.hdwrCCA.provider.IBMJCECCA
...

For the hybrid crypto card configuration, configure the location attribute in the keyStore elements referenced by the SSL configurations to point to a valid hybrid hardware crypto keyring configuration and set the type attribute to JCEHYBRIDRACFKS in ${server.config.dir}/configDropins/overrides/<any file name>.xml

<keyStore id=\"defaultKeyStore\"
location=\"safkeyringhybrid:///myHybridKeyring\"
type=\"JCEHYBRIDRACFKS\"
.../>

In addition, configure the com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID and the com.ibm.crypto.hdwrCCA.provider.IBMJCECCA providers in the $JAVA_HOME/jre/lib/security/java.security file.

..
security.provider.2=com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID
security.provider.3=com.ibm.crypto.hdwrCCA.provider.IBMJCECCA
..."
          reference   : "800-171|3.1.16,800-171|3.13.15,800-53|AC-18,800-53|SC-23,800-53r5|AC-18,800-53r5|SC-23,CSCv7|11.5,CSCv8|12.6,CSF|PR.PT-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.20,ITSG-33|AC-18,ITSG-33|SC-23,ITSG-33|SC-23a.,LEVEL|2M,NESA|T4.5.1,QCSC-v1|5.2.1,SWIFT-CSCv1|2.3"
          see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
          show_output : YES
        </report>
      </then>

      <else>
        <if>
          <condition type:"AND">
            <custom_item>
              type              : FILE_CONTENT_CHECK
              description       : "safkeyringhybrid set correctly"
              file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
              xsl_stmt          : "<xsl:template match=\"/\">"
              xsl_stmt          : "<xsl:for-each select=\"server/keyStore\">"
              xsl_stmt          : "<xsl:choose>"
              xsl_stmt          : "<xsl:when test=\"@location='safkeyringhybrid:@KEY_RING_HYBRID@'\">"
              xsl_stmt          : "<xsl:text>PASS - safkeyringhybrid set to </xsl:text><xsl:value-of select=\"@location\" /><xsl:text>&#xa;</xsl:text>"
              xsl_stmt          : "</xsl:when>"
              xsl_stmt          : "<xsl:when test=\"@location!='safkeyringhybrid:@KEY_RING_HYBRID@'\">"
              xsl_stmt          : "<xsl:text>FAIL - safkeyringhybrid set to </xsl:text><xsl:value-of select=\"@location\" /><xsl:text>&#xa;</xsl:text>"
              xsl_stmt          : "</xsl:when>"
              xsl_stmt          : "</xsl:choose>"
              xsl_stmt          : "</xsl:for-each>"
              xsl_stmt          : "</xsl:template>"
              regex             : "PASS|FAIL"
              expect            : "PASS"
              file_supersedence : YES
            </custom_item>

            <custom_item>
              type              : FILE_CONTENT_CHECK
              description       : "Ensure that type attribute is set to JCEHYBRIDRACFKS"
              file              : "@APP_Config_catalogs@/configDropins/defaults/*.xml @APP_Config_files@ @APP_Config_catalogs@/configDropins/overrides/*.xml"
              xsl_stmt          : "<xsl:template match=\"/\">"
              xsl_stmt          : "<xsl:for-each select=\"server/keyStore\">"
              xsl_stmt          : "<xsl:choose>"
              xsl_stmt          : "<xsl:when test=\"@type='JCEHYBRIDRACFKS'\">"
              xsl_stmt          : "<xsl:text>PASS - type set to </xsl:text><xsl:value-of select=\"@type\" /><xsl:text>&#xa;</xsl:text>"
              xsl_stmt          : "</xsl:when>"
              xsl_stmt          : "<xsl:when test=\"@type!='JCEHYBRIDRACFKS'\">"
              xsl_stmt          : "<xsl:text>FAIL - type set to </xsl:text><xsl:value-of select=\"@type\" /><xsl:text>&#xa;</xsl:text>"
              xsl_stmt          : "</xsl:when>"
              xsl_stmt          : "</xsl:choose>"
              xsl_stmt          : "</xsl:for-each>"
              xsl_stmt          : "</xsl:template>"
              regex             : "PASS|FAIL"
              expect            : "PASS"
              file_supersedence : YES
            </custom_item>

            <custom_item>
              type        : FILE_CONTENT_CHECK
              description : "security.provider.2=com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID provider is configured"
              file        : "@APP_wlp.install.dir@/java/*/jre/lib/security/java.security"
              regex       : "^(?!#).*(?i)com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID[\\s]*$"
              expect      : "^(?!#).*(?i)com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID[\\s]*$"
            </custom_item>

            <custom_item>
              type        : FILE_CONTENT_CHECK
              description : "security.provider.3=com.ibm.crypto.hdwrCCA.provider.IBMJCECCA provider is configured"
              file        : "@APP_wlp.install.dir@/java/*/jre/lib/security/java.security"
              regex       : "^(?!#).*(?i)com.ibm.crypto.hdwrCCA.provider.IBMJCECCA[\\s]*$"
              expect      : "^(?!#).*(?i)com.ibm.crypto.hdwrCCA.provider.IBMJCECCA[\\s]*$"
            </custom_item>
          </condition>

          <then>
            <report type:"PASSED">
              description : "9.3 Ensure 'safkeyringhw:' is set to use a hardware crypto card"
              info        : "Use hardware crypto card to store to store cryptographic keys and certificates.

Using hardware crypto card to store and load cryptographic keys and certificates. Using hardware crypto cards can provide additional security guards against theft. The keys and certificates are used during cryptographic functions like encryption/decryption and also during the SSL/TLS communication."
              solution    : "For the crypto card configuration, configure the location attribute in the keyStore elements referenced by the SSL configurations to point to a valid hardware crypto keyring configuration and set the type attribute to JCECCARACFKS in ${server.config.dir}/configDropins/overrides/<any file name>.xml

<keyStore id=\"defaultKeyStore\"
location=\"safkeyringhw:///myHWKeyring\"
type=\"JCECCARACFKS\"
...
/>

In addition, make sure that the com.ibm.crypto.hdwrCCA.provider.IBMJCECCA provider is configured in the $JAVA_HOME/jre/lib/security/java.security file.

..
security.provider.3=com.ibm.crypto.hdwrCCA.provider.IBMJCECCA
...

For the hybrid crypto card configuration, configure the location attribute in the keyStore elements referenced by the SSL configurations to point to a valid hybrid hardware crypto keyring configuration and set the type attribute to JCEHYBRIDRACFKS in ${server.config.dir}/configDropins/overrides/<any file name>.xml

<keyStore id=\"defaultKeyStore\"
location=\"safkeyringhybrid:///myHybridKeyring\"
type=\"JCEHYBRIDRACFKS\"
.../>

In addition, configure the com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID and the com.ibm.crypto.hdwrCCA.provider.IBMJCECCA providers in the $JAVA_HOME/jre/lib/security/java.security file.

..
security.provider.2=com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID
security.provider.3=com.ibm.crypto.hdwrCCA.provider.IBMJCECCA
..."
              reference   : "800-171|3.1.16,800-171|3.13.15,800-53|AC-18,800-53|SC-23,800-53r5|AC-18,800-53r5|SC-23,CSCv7|11.5,CSCv8|12.6,CSF|PR.PT-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.20,ITSG-33|AC-18,ITSG-33|SC-23,ITSG-33|SC-23a.,LEVEL|2M,NESA|T4.5.1,QCSC-v1|5.2.1,SWIFT-CSCv1|2.3"
              see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
              show_output : YES
            </report>
          </then>

          <else>
            <report type:"FAILED">
              description : "9.3 Ensure 'safkeyringhw:' is set to use a hardware crypto card"
              info        : "Use hardware crypto card to store to store cryptographic keys and certificates.

Using hardware crypto card to store and load cryptographic keys and certificates. Using hardware crypto cards can provide additional security guards against theft. The keys and certificates are used during cryptographic functions like encryption/decryption and also during the SSL/TLS communication."
              solution    : "For the crypto card configuration, configure the location attribute in the keyStore elements referenced by the SSL configurations to point to a valid hardware crypto keyring configuration and set the type attribute to JCECCARACFKS in ${server.config.dir}/configDropins/overrides/<any file name>.xml

<keyStore id=\"defaultKeyStore\"
location=\"safkeyringhw:///myHWKeyring\"
type=\"JCECCARACFKS\"
...
/>

In addition, make sure that the com.ibm.crypto.hdwrCCA.provider.IBMJCECCA provider is configured in the $JAVA_HOME/jre/lib/security/java.security file.

..
security.provider.3=com.ibm.crypto.hdwrCCA.provider.IBMJCECCA
...

For the hybrid crypto card configuration, configure the location attribute in the keyStore elements referenced by the SSL configurations to point to a valid hybrid hardware crypto keyring configuration and set the type attribute to JCEHYBRIDRACFKS in ${server.config.dir}/configDropins/overrides/<any file name>.xml

<keyStore id=\"defaultKeyStore\"
location=\"safkeyringhybrid:///myHybridKeyring\"
type=\"JCEHYBRIDRACFKS\"
.../>

In addition, configure the com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID and the com.ibm.crypto.hdwrCCA.provider.IBMJCECCA providers in the $JAVA_HOME/jre/lib/security/java.security file.

..
security.provider.2=com.ibm.crypto.ibmjcehybrid.provider.IBMJCEHYBRID
security.provider.3=com.ibm.crypto.hdwrCCA.provider.IBMJCECCA
..."
              reference   : "800-171|3.1.16,800-171|3.13.15,800-53|AC-18,800-53|SC-23,800-53r5|AC-18,800-53r5|SC-23,CSCv7|11.5,CSCv8|12.6,CSF|PR.PT-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.14,ISO-27001-2022|A.8.20,ITSG-33|AC-18,ITSG-33|SC-23,ITSG-33|SC-23a.,LEVEL|2M,NESA|T4.5.1,QCSC-v1|5.2.1,SWIFT-CSCv1|2.3"
              see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
              show_output : YES
            </report>
          </else>
        </if>
      </else>
    </if>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_IBM_WebSphere_Liberty_v1.0.0_L2.audit from CIS IBM WebSphere Liberty Benchmark v1.0.0"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/benchmarks/7724"
    </report>
  </else>
</if>

</check_type>
