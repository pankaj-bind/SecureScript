#TRUSTED 2f20af8229ae8259cb51f188379739fb055add4b870091eb0049ad6744633b81c1c8d5ef3f278303cc643a17e70125c25e3e9ca87fe0319e022174fe55df72aa0cca31d75312de716bcc05a65d3814dae9221af90def8e57d7ad1011c5258bfc298cb17fb175a3a3e79d3beb5ad2e029b28b2df3365788a040626ff72d5c717412195d506e2928d42eaada883e58d5af7841da8b268fb4176dc8efc3a7443519c82c4ccb47aa396c3453425573eae5259e94cad35aaea52694d51eb13f9209ea18d7ac7911a3579678656dbbc4642531ee7dc41a3a0a0644f8875c5170b8297f42165bdf45c6f977d96293d9e1f21c654082501329d4792ae8a826dbb99ea25388b934e44cf8e8dbbe840e18a8da137f834db85aaf4e9158431e46c04826cc7507786333f1e66a07ee50a6d13bb96fd0b28d46d9b4a9f8aa336e4e7488055aa58e3b2bc8ccf5ffae7578b744d83617823840df0d2cda901341552b32641f00a20cf5c32b663d15545ca8c1e3cdcf8d850b44bc5ce5dcf1e30138d83487121c3289e3acfc0de315a692bc67afb5c19894f852db23334f3f930ede064a2aa29aa5ec3d33599ae16805d694e29a2ddbf6194684c46653f994664f5b0aa4784b485afe410ca2de6dbef801415666226afc34c73ce37a93554190c40c0b50c1df454f62034f6737c9b0d839285b8d38fd9e1a79fb206fc31937f93e61e3ea5f70cf5e
#TRUST-RSA-SHA256 8bbb035f0d0ea950b46eb89e49a7cdef024512569e97bbb99b32c55e1fe1009173a207a867be9206842a467f28d58de8545a449250df561bbf366e1546aa0efbb8d37d7c46391fcbaf0f810bdd8afbf47820ce2c594258022a2097d4521d068bd245b10ec0f812d2b455a3003a29c1fb2443f7d08508d39528129d72a2351de803ced29531a1785ad9f24258fd8252a8de3bd59b0473727fbc6958c8b533f40be016984f146e5a8f3671fea03fd7ceb1dd1907d27dc5cd58675b5e0d83bde9e1761cd7d761ed8f1b93ab1a27c50637cacbfec8a23bef797bf4bece98188b265aa67a95093c57dcb3e1c3f92bcecc08b59a1526abe3106098dad1932841aed6d90e8a0ec8f465134019195a8a45136a83bf5dae60a35cf0dc8528b711a0af932b02aeee78bac1447b8ef9ac3ef275e41b47bf7d95addf60773753dddb3831786fbb206c7e0446cef9b9bdca962a9da732f889558b514f94b3a30df893afadb8c61d4de132edb28b7a6e61cb0404a92cf5b652c8b8530aa2bc71890ce22c470bd803b83206a0b0b41dc18e8062d3e2d5d82e872fe737faa7adb846185eb9497332555a48e242f0e5fa2f92d2beb6c734c4e96652f873479c7bbed005686a061e62cc2307240411177a50bfae1bed0baaba646d317166b3c266786f1dda9ae3e71755abf8301ce0b792f3d0721441c33db9e40b755a189de78821ed43a7645c2212
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
#
# $Revision: 1.13 $
# $Date: 2024/06/17 $
#
# Description : This document implements the security configuration as recommended by the
#               CIS Apache Tomcat 8 Benchmark
#
#<ui_metadata>
#<display_name>CIS Apache Tomcat 8 L2 v1.1.0</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Apache Tomcat 8</name>
#  <profile>L2</profile>
#  <version>1.1.0</version>
#  <link>https://workbench.cisecurity.org/files/2506</link>
#</spec>
#<labels>cis,apache_tomcat_linux_8,agent,update_20230227</labels>
#<benchmark_refs>CCE,CIS_Recommendation,CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#<variables>
#  <variable>
#    <name>WEBSERVER_NAME</name>
#    <default>Apache Tomcat</default>
#    <description>Web server name string</description>
#    <info>The name given to Tomcat in your configuration information.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>CATALINA_HOME</name>
#    <default>/usr/share/tomcat8</default>
#    <description>Catalina home</description>
#    <info>The absolute path to your Tomcat installation directory. It should not end in a slash.</info>
#    <value_type>UNIX_FILE_PATH</value_type>
#  </variable>
#  <variable>
#    <name>CATALINA_BASE</name>
#    <default>/var/lib/tomcat8/webapps</default>
#    <description>Catalina base</description>
#    <info>The absolute path to your Tomcat base directory. If you are running multiple instances of Tomcat you should set CATALINA_BASE to the instance directory and CATALINA_HOME to the common Tomcat installation whose files will be shared between instances.</info>
#    <value_type>UNIX_FILE_PATH</value_type>
#  </variable>
#  <variable>
#    <name>CATALINA_CONF</name>
#    <default>/etc/tomcat8</default>
#    <description>Catalina configuration directory</description>
#    <info>The absolute path to the Tomcat configuration files directory. (This is used primarily by Ubuntu and Debian-based installations of Linux).</info>
#    <value_type>UNIX_FILE_PATH</value_type>
#  </variable>
#  <variable>
#    <name>SERVER_HEADER</name>
#    <default>I am a teapot</default>
#    <description>Server header text</description>
#    <info>The server header is a vanity header developed to help identify the underlying technology in a server for troubleshooting and identification.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>WEB_APP_DIR</name>
#    <default>yourappname</default>
#    <description>Web application directory</description>
#    <info>The path to your web application directory from within CATALINA_HOME.</info>
#    <value_type>UNIX_FILE_PATH</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : CMD_EXEC
      description : "Tomcat found"
      cmd         : "java -cp @CATALINA_HOME@/lib/catalina.jar org.apache.catalina.util.ServerInfo | /bin/egrep 'version'"
      expect      : "@WEBSERVER_NAME@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_Apache_Tomcat_8_L2_v1.1.0.audit from CIS Apache Tomcat 8 Benchmark"
      see_also    : "https://workbench.cisecurity.org/files/2506"
    </report>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/webapps/js-examples"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/js-examples"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/webapps/servlet-example"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/servlet-example"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/webapps/webdav"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/webdav"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/webapps/tomcat-docs"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/tomcat-docs"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/webapps/balancer"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/balancer"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/webapps/ROOT/admin"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/ROOT/admin"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/webapps/examples"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/examples"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/server/webapps/host-manager.xml"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/server/webapps/host-manager.xml"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_HOME/server/webapps/manager"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/server/webapps/manager"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_CONF/conf/Catalina/localhost/host-manager.xml"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/conf/Catalina/localhost/host-manager.xml"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.1 Remove extraneous files and directories - CATALINA_CONF/conf/Catalina/localhost/manager.xml"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use.

Rationale:

Removing sample resources is a defense in depth measure which reduces potential exposures introduced by these resources."
      solution    : "Perform the following to remove extraneous resources:

$ rm -rf $CATALINA_HOME/webapps/docs \
     $CATALINA_HOME/webapps/examples \
     $CATALINA_HOME/webapps/ROOT

If the Manager and HOST-Manager application are not utilized, also remove the following resources:

$ rm -rf $CATALINA_HOME/webapps/host-manager \
     $CATALINA_HOME/webapps/manager \

Default Value:

docs, examples, ROOT, manager and host-manager are default web applications shipped with Tomcat."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/conf/Catalina/localhost/manager.xml"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.2 Disable Unused Connectors"
      info        : "The default installation of Tomcat includes connectors with default settings. These are traditionally set up for convenience. It is best to remove these connectors and enable only what is needed.

Rationale:

Improperly configured or unnecessarily installed Connectors may lead to a security exposure.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Within the $CATALINA_HOME/conf/server.xml, remove, or comment out, every unused Connectors. For example, to disable an instance of the HTTPConnector, remove the following:

<Connector className='org.apache.catalina.connector.http.HttpConnector'
...
connectionTimeout='60000'/>

Default Value:

$CATALINA_HOME/conf/server.xml, has the following connectors defined by default:

A non-SSL HTTP Connector bound to port 8080

An AJP Connector bound to port 8009

References:

https://tomcat.apache.org/tomcat-8.0-doc/security-howto.html#Connectors

https://tomcat.apache.org/tomcat-8.5-doc/security-howto.html#Connectors"
      reference   : "800-171|3.14.6,800-171|3.14.7,800-53|SI-4,800-53r5|SI-4,CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv7|9.2,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|SI-4,LEVEL|2NS,NESA|M1.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      cmd         : "/bin/grep -w -n \"<Connector\" @CATALINA_CONF@/server.xml"
      expect      : ""
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "2.1 Alter the Advertised server.info String"
      info        : "The server.info attribute contains the name of the application service. This value is presented to Tomcat clients when clients connect to the tomcat server.

Rationale:

Altering the server.info attribute may increase the complexity for attackers to determine which vulnerabilities affect the server platform.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Perform the following to alter the server platform string that gets displayed when clients connect to the tomcat server.

Extract the ServerInfo.properties file from the catalina.jar file:

$ cd $CATALINA_HOME/lib
$ jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties

Navigate to the util directory which was created

cd org/apache/catalina/util

Open ServerInfo.properties in an editor

Update the server.info attribute in the ServerInfo.properties file.

server.info=<SomeWebServer>

Update the catalina.jar with the modified ServerInfo.properties file.

$ jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties

Default Value:

The default value for the server.info attribute is Apache Tomcat/<version>. For example, Apache Tomcat/8.5.11.

References:

https://tomcat.apache.org/tomcat-8.0-doc/security-howto.html

https://tomcat.apache.org/tomcat-8.5-doc/security-howto.html"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53r5|CM-7,CSCv7|13.2,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,LEVEL|2S,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      cmd         : "java -cp @CATALINA_HOME@/lib/catalina.jar org.apache.catalina.util.ServerInfo | /bin/egrep 'version'"
      expect      : ""
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "2.2 Alter the Advertised server.number String"
      info        : "The server.number attribute represents the specific version of Tomcat which is executing. This value is presented to Tomcat clients when connect.

Rationale:

Advertising a valid server version may provide attackers with information useful for locating vulnerabilities affecting the server platform. Altering the server version string may increase the complexity for attackers to determine which vulnerabilities affect the server platform.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Perform the following to alter the server version string that gets displayed when clients connect to the server.

Extract the ServerInfo.properties file from the catalina.jar file:

$ cd $CATALINA_HOME/lib
$ jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties

Navigate to the util directory that was created

$ cd org/apache/Catalina/util

Open ServerInfo.properties in an editor

Update the server.number attribute

server.number=<someversion>

Update the catalina.jar with the modified ServerInfo.properties file.

$ jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties

Default Value:

The default value for the server.number attribute is a four part version number, such as 8.5.11.0."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53r5|CM-7,CSCv7|13.2,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,LEVEL|2S,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      cmd         : "java -cp @CATALINA_HOME@/lib/catalina.jar org.apache.catalina.util.ServerInfo | /bin/egrep 'number'"
      expect      : ""
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "2.3 Alter the Advertised server.built Date"
      info        : "The server.built date represents the date which Tomcat was compiled and packaged. This value is presented to Tomcat clients when clients connect to the server.

Rationale:

Altering the server.built string may increase the complexity for attackers to determine which vulnerabilities affect the server platform.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Perform the following to alter the server version string which gets displayed when clients connect to the server.

Extract the ServerInfo.properties file from the catalina.jar file:

$ cd $CATALINA_HOME/lib
$ jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties

Navigate to the util directory that was created

$ cd org/apache/Catalina/util

Open ServerInfo.properties in an editor

Update the server.built attribute in the ServerInfo.properties file.

server.built=

Update the catalina.jar with the modified ServerInfo.properties file.

$ jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties

Default Value:

The default value for the server.built attribute is build date and time. For example, Jul 8 2008 11:40:35."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53r5|CM-7,CSCv7|13.2,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,LEVEL|2S,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      cmd         : "java -cp @CATALINA_HOME@/lib/catalina.jar org.apache.catalina.util.ServerInfo | /bin/egrep 'built'"
      expect      : ""
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "2.4 Disable X-Powered-By HTTP Header and Rename the Server Value for all Connectors"
      info        : "The xpoweredBy setting determines if Apache Tomcat will advertise its presence via the XPowered-By HTTP header. It is recommended that this value be set to false. The server attribute overrides the default value that is sent down in the HTTP header further masking Apache Tomcat.

Rationale:

Preventing Tomcat from advertising its presence in this manner may increase the complexity for attackers to determine which vulnerabilities affect the server platform."
      solution    : "Perform the following to prevent Tomcat from advertising its presence via the X-PoweredBy HTTP header.

Add the xpoweredBy attribute to each Connector specified in $CATALINA_HOME/conf/server.xml. Set the xpoweredBy attributes value to false.

<Connector
...
xpoweredBy='false' />

Alternatively, ensure the xpoweredBy attribute for each Connector specified in $CATALINA_HOME/conf/server.xml is absent.

Add the server attribute to each Connector specified in $CATALINA_HOME/conf/server.xml. Set the server attribute value to anything except a blank string.

Default Value:

The default value is false.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/http.html

https://tomcat.apache.org/tomcat-8.5-doc/config/http.html"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53r5|CM-7,CSCv7|13.2,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,LEVEL|2S,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Connector\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"@server = '' and @xPoweredBy = 'false'\">"
      xsl_stmt    : "<xsl:text>FAIL - server attribute is blank for port </xsl:text><xsl:value-of select=\"@port\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:when test=\"@server != '' and @xPoweredBy != 'false'\">"
      xsl_stmt    : "<xsl:text>FAIL - xPoweredBy is enabled for port </xsl:text><xsl:value-of select=\"@port\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:when test=\"@server != '' and @xPoweredBy = 'false'\">"
      xsl_stmt    : "<xsl:text>PASS - server attribute not blank and xPoweredBy is disabled for port </xsl:text><xsl:value-of select=\"@port\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>FAIL - xPoweredBy and server attributes not set for </xsl:text><xsl:value-of select=\"@port\" />"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      expect      : "PASS"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "2.7 Ensure Sever Header is Modified To Prevent Information Disclosure"
      info        : "The server header is a vanity header developed to help identify the underlying technology in a server for troubleshooting and identification. This header is unnessesary and could be used to target your website for exploitation. Tomcat does not provide the ability to remove the server header, however, it does provide the ability to modify the header.

Rationale:

The server header may specify the underlying technology used by an application. Attackers are able to conduct reconnaissance on a website using these response headers. This header could be used to target attacks for specific known vulnerabilities associated with the underlying technology. Removing this header will prevent targeting of your application for specific exploits by non-determined attackers.

While this is not the only way to fingerprint a site through the response headers, it makes it harder and prevents some potential attackers from targeting your website."
      solution    : "In $CATALINA_HOME/conf/server.xml, add the server directive to the connector as shown below replacing apache with the text of your choosing. This text should not help in identifying the server.

<Connector port='8443' server='I am a teapot' redirectPort='8080' />

Scripted:

If you do not have the header defined:

sed -ir 's/Connector/Connector server='I am a teapot'/g' $CATALINA_HOME/conf/server.xml

If you already have a header but it is still revealing

sed -ir 's/server='[^']*'/server='I Am A Teapot'/g' $CATALINA_HOME/conf/server.xml

Default Value:

The default value is Apache-Coyote/1.1.

References:

https://tomcat.apache.org/tomcat-8.0-doc/security-howto.html#server.xml

https://stackoverflow.com/questions/52637285/replacing-server-header-in-tomcat-with-sed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53r5|CM-7,CSCv7|13.2,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,LEVEL|2NS,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Connector\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"@server='@SERVER_HEADER@'\">"
      xsl_stmt    : "<xsl:text>PASS - server header set on port </xsl:text><xsl:value-of select=\"@port\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>FAIL - server header not set on port </xsl:text><xsl:value-of select=\"@port\" />"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      not_expect  : "FAIL"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "3.2 Disable the Shutdown port"
      info        : "Tomcat listens on TCP port 8005 to accept shutdown requests. By connecting to this port and sending the SHUTDOWN command, all applications within Tomcat are halted. The shutdown port is not exposed to the network as it is bound to the loopback interface. If this functionality is not used, it is recommended that the shutdown port be disabled.

Rationale:

Disabling the Shutdown port will eliminate the risk of malicious local entities using the shutdown command to disable the Tomcat server."
      solution    : "Set the port to -1 in the $CATALINA_HOME/conf/server.xml to disable the shutdown port

<Server port='-1' shutdown='SHUTDOWN'>

Default Value:

The shutdown port is enabled on TCP port 8005, bound to the loopback address.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/server.html"
      reference   : "800-171|3.14.6,800-171|3.14.7,800-53|SI-4,800-53r5|SI-4,CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv7|9.2,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|SI-4,LEVEL|2NS,NESA|M1.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:value-of select=\"Server/@port\" />"
      xsl_stmt    : "</xsl:template>"
      expect      : "-1"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "5.1 Use secure Realms"
      info        : "A realm is a database of usernames and passwords used to identify valid users of web applications. Review the Realms configuration to ensure Tomcat is not configured to use MemoryRealm, JDBCRealm, UserDatabaseRealm and JAASRealm.

Rationale:

According to the Tomcat documentation: the MemoryRealm and JDBCRealm are not designed for production usage and could result in reduced availability; the UserDatabaseRealm is not intended for large-scale installations; and the JAASRealm is not widely used and therefore the code is not as mature as the other realms."
      solution    : "Set the Realm className setting in $CATALINA_HOME/conf/server.xml to one of the appropriate realms.

References:

https://tomcat.apache.org/tomcat-8.0-doc/realm-howto.html

https://tomcat.apache.org/tomcat-8.0-doc/security-howto.html"
      reference   : "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|2S,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:variable name=\"realms\" select=\"'org.apache.catalina.realm.MemoryRealm,org.apache.catalina.realm.JDBCRealm,org.apache.catalina.realm.UserDatabaseRealm,org.apache.catalina.realm.JAASRealm'\" />"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Engine//Realm\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"contains($realms, @className)\">"
      xsl_stmt    : "<xsl:text>FAIL - </xsl:text><xsl:value-of select=\"@className\" /><xsl:text>found</xsl:text>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>PASS - No insecure realms found in config</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      not_expect  : "FAIL"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "5.2 Use LockOut Realms"
      info        : "A LockOut realm wraps around standard realms adding the ability to lock a user out after multiple failed logins.

Rationale:

Locking out a user after multiple failed logins slows down attackers from brute forcing logins."
      solution    : "Create a lockout realm wrapping the main realm similar to the example below:

<Realm className='org.apache.catalina.realm.LockOutRealm' failureCount='3' lockOutTime='600' acheSize='1000' cacheRemovalWarningTime='3600'>
    <Realm className='org.apache.catalina.realm.DataSourceRealm' dataSourceName=... />
</Realm>

References:

https://tomcat.apache.org/tomcat-8.0-doc/realm-howto.html

https://tomcat.apache.org/tomcat-8.0-doc/config/realm.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Engine/Realm\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"contains(@className, 'org.apache.catalina.realm.LockOutRealm')\">"
      xsl_stmt    : "<xsl:text>PASS - LockoutRealm found</xsl:text>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>FAIL - No LockoutRealm found</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      expect      : "PASS"
    </custom_item>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "Tomcat 8.5 found"
          cmd         : "java -cp @CATALINA_HOME@/lib/catalina.jar org.apache.catalina.util.ServerInfo | /bin/egrep 'version'"
          expect      : "Apache Tomcat/8.[5-9]"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : AUDIT_XML
          description : "6.1 Setup Client-cert Authentication"
          info        : "Client-cert authentication requires each client connecting to the server to have a certificate to authenticate. This is generally regarded as stronger authentication than a password as it requires the client to have the certificate and not just a password.

Rationale:

Certificate based authentication is more secure than password based authentication."
          solution    : "In the Connector element, set the clientAuth to true and, in Tomcat 8.5.x, set the certificateVerification to required

<Connector
     port='8443' minProcessors='5' maxProcessors='75'
     enableLookups='true' disableUploadTimeout='true'
     acceptCount='100' debug='0' scheme='https' secure='true';
     clientAuth='true' sslProtocol='TLS'/>
...
<Connector ...>
     <SSLHostConfig
      certificateVerification='required'
     />

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/http.html

https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html

https://tomcat.apache.org/tomcat-8.5-doc/ssl-howto.html

https://tomcat.apache.org/tomcat-8.5-doc/config/http.html#SSL_Support_-_SSLHostConfig"
          reference   : "800-171|3.5.2,800-53|IA-5,800-53|IA-5(1),800-53r5|IA-5,800-53r5|IA-5(1),CSCv7|16.4,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,ITSG-33|IA-5(1),LEVEL|2S,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
          see_also    : "https://workbench.cisecurity.org/files/2506"
          file        : "@CATALINA_CONF@/server.xml"
          xsl_stmt    : "<xsl:template match=\"/\">"
          xsl_stmt    : "<xsl:for-each select=\"Server/Service/Connector\">"
          xsl_stmt    : "<xsl:choose>"
          xsl_stmt    : "<xsl:when test=\"@secure='true' and @clientAuth='true' and SSLHostConfig/@certificateVerification='required'\">"
          xsl_stmt    : "<xsl:text>PASS - clientAuth and certificateVerification set for secure connector on port </xsl:text><xsl:value-of select=\"@port\" />"
          xsl_stmt    : "</xsl:when>"
          xsl_stmt    : "<xsl:when test=\"@secure='true' and (not(@clientAuth) or not(SSLHostConfig/@certificateVerification))\">"
          xsl_stmt    : "<xsl:text>FAIL - clientAuth and certificateVerification not set for secure connector on port </xsl:text><xsl:value-of select=\"@port\" />"
          xsl_stmt    : "</xsl:when>"
          xsl_stmt    : "<xsl:when test=\"@secure='true' and (@clientAuth!='true' or SSLHostConfig/@certificateVerification!='required')\">"
          xsl_stmt    : "<xsl:text>FAIL - clientAuth and certificateVerification not set for secure connector on port </xsl:text><xsl:value-of select=\"@port\" />"
          xsl_stmt    : "</xsl:when>"
          xsl_stmt    : "<xsl:otherwise>"
          xsl_stmt    : "<xsl:text>PASS - clientAuth and certificateVerification not required on port </xsl:text><xsl:value-of select=\"@port\" />"
          xsl_stmt    : "</xsl:otherwise>"
          xsl_stmt    : "</xsl:choose>"
          xsl_stmt    : "</xsl:for-each>"
          xsl_stmt    : "</xsl:template>"
          not_expect  : "FAIL"
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : AUDIT_XML
          description : "6.1 Setup Client-cert Authentication"
          info        : "Client-cert authentication requires each client connecting to the server to have a certificate to authenticate. This is generally regarded as stronger authentication than a password as it requires the client to have the certificate and not just a password.

Rationale:

Certificate based authentication is more secure than password based authentication."
          solution    : "In the Connector element, set the clientAuth to true and, in Tomcat 8.5.x, set the certificateVerification to required

<Connector
     port='8443' minProcessors='5' maxProcessors='75'
     enableLookups='true' disableUploadTimeout='true'
     acceptCount='100' debug='0' scheme='https' secure='true';
     clientAuth='true' sslProtocol='TLS'/>
...
<Connector ...>
     <SSLHostConfig
      certificateVerification='required'
     />

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/http.html

https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html

https://tomcat.apache.org/tomcat-8.5-doc/ssl-howto.html

https://tomcat.apache.org/tomcat-8.5-doc/config/http.html#SSL_Support_-_SSLHostConfig"
          reference   : "800-171|3.5.2,800-53|IA-5,800-53|IA-5(1),800-53r5|IA-5,800-53r5|IA-5(1),CSCv7|16.4,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,ITSG-33|IA-5(1),LEVEL|2S,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
          see_also    : "https://workbench.cisecurity.org/files/2506"
          file        : "@CATALINA_CONF@/server.xml"
          xsl_stmt    : "<xsl:template match=\"/\">"
          xsl_stmt    : "<xsl:for-each select=\"Server/Service/Connector\">"
          xsl_stmt    : "<xsl:choose>"
          xsl_stmt    : "<xsl:when test=\"@secure='true' and @clientAuth='true'\">"
          xsl_stmt    : "<xsl:text>PASS - clientAuth set for secure connector on port </xsl:text><xsl:value-of select=\"@port\" />"
          xsl_stmt    : "</xsl:when>"
          xsl_stmt    : "<xsl:when test=\"@secure='true' and @clientAuth='false'\">"
          xsl_stmt    : "<xsl:text>FAIL - clientAuth not set for secure connector on port </xsl:text><xsl:value-of select=\"@port\" />"
          xsl_stmt    : "</xsl:when>"
          xsl_stmt    : "<xsl:otherwise>"
          xsl_stmt    : "<xsl:text>PASS - http connector: clientAuth not required on port </xsl:text><xsl:value-of select=\"@port\" />"
          xsl_stmt    : "</xsl:otherwise>"
          xsl_stmt    : "</xsl:choose>"
          xsl_stmt    : "</xsl:for-each>"
          xsl_stmt    : "</xsl:template>"
          not_expect  : "FAIL"
        </custom_item>
      </else>
    </if>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK
      description : "7.1 Application specific logging"
      info        : "By default, java.util.logging does not provide the capabilities to configure per-web application settings, only per VM. In order to overcome this limitation Tomcat implements JULI as a wrapper for java.util.logging. JULI provides additional configuration functionality so you can set each web application to have unique logging specifications.

Rationale:

Establishing per application logging profiles will help ensure that each application's logging verbosity is set to an appropriate level in order to provide appropriate information when needed for security review."
      solution    : "Create a logging.properties file and place that into your application WEB-INF/classes directory.

Note: By default, installing Tomcat places a logging.properties file in $CATALINA_HOME/conf. This file can be used as base for an application specific logging properties file.

Default Value:

By default, per application logging is not configured."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,800-53r5|AU-12,CSCv6|3.1,CSCv7|6.3,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-12,LEVEL|2S,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_BASE@/@WEB_APP_DIR@/WEB-INF/classes/logging.properties"
    </custom_item>

    <report type:"WARNING">
      description : "7.3 Ensure className is set correctly in context.xml"
      info        : "Ensure the className attribute is set to AccessLogValve. The className attribute determines the access log valve to be used for logging.

Rationale:

Some log valves are not suited for production and should not be used. Apache recommends org.apache.catalina.valves.AccessLogValve

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Add the following statement into the $CATALINA_HOME/webapps/<app name>/META-INF/context.xml file if it does not already exist.

<Valve
className='org.apache.catalina.valves.AccessLogValve'
directory='$CATALINA_HOME/logs/'
prefix='access_log'
fileDateFormat='yyyy-MM-dd.HH'
suffix='.log'
pattern='%t %H cookie:%{SESSIONID}c request:%{SESSIONID}r %m %U %s %q %r'
/>

Default Value:

Does not exist by default.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/valve.html"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,800-53r5|AU-12,CSCv7|6.3,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-12,LEVEL|2S,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
      see_also    : "https://workbench.cisecurity.org/files/2506"
    </report>

    <custom_item>
      type        : AUDIT_XML
      description : "9.2 Disabling auto deployment of applications"
      info        : "Tomcat allows auto deployment of applications while Tomcat is running. It is recommended that this capability be disabled.

Rationale:

This could allow malicious or untested applications to be deployed and should be disabled."
      solution    : "In the $CATALINA_HOME/conf/server.xml file, change autoDeploy to false.

autoDeploy='false'

Default Value:

autoDeploy is set to true.

References:

https://tomcat.apache.org/tomcat-8.0-doc/deployer-howto.html#Deploying_on_a_running_Tomcat_server

https://tomcat.apache.org/tomcat-8.0-doc/config/host.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"Server/Service/Engine/Host/@autoDeploy='true'\">"
      xsl_stmt    : "<xsl:text>FAIL - AutoDeploy enabled for </xsl:text><xsl:value-of select=\"@name\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>PASS - AutoDeploy disabled or not present</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:template>"
      not_expect  : "FAIL"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "9.3 Disable deploy on startup of applications"
      info        : "Tomcat allows auto deployment of applications on startup. It is recommended that this capability be disabled.

Rationale:

This could allow malicious or untested applications to be deployed and should be disabled."
      solution    : "In the $CATALINA_HOME/conf/server.xml file, change deployOnStartup to false.

deployOnStartup='false'

Default Value:

deployOnStartup is set to true

References:

https://tomcat.apache.org/tomcat-8.0-doc/deployer-howto.html#Deployment_on_Tomcat_startup

https://tomcat.apache.org/tomcat-8.0-doc/config/host.html#Automatic_Application_Deployment

https://tomcat.apache.org/tomcat-8.0-doc/config/host.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Engine/Host\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"@deployOnStartup='true'\">"
      xsl_stmt    : "<xsl:text>FAIL - deployOnStartup enabled for </xsl:text><xsl:value-of select=\"@name\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>PASS - deployOnStartup disabled or not present</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      not_expect  : "FAIL"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "10.2 Restrict access to the web administration application"
      info        : "Limit access to the web administration application to only those with a justified need.

Rationale:

Limiting access to the least privilege will ensure only those people with a justified need will have access to a resource. The web administration application should be limited to only administrators."
      solution    : "For the administration application, edit $CATALINA_HOME/conf/server.xml and uncomment the following:

<Valve className='org.apache.catalina.valves.RemoteAddrValve' allow='127\.0\.0\.1'/>

Note: The RemoteAddrValve property expects a regular expression, therefore periods and other regular expression meta-characters must be escaped.

Default Value:

By default, this configuration is not present.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/valve.html"
      reference   : "800-171|3.1.7,800-53|AC-6(10),800-53r5|AC-6(10),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.7,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,LEVEL|2NS,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Engine/Host\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"Valve/@className='org.apache.catalina.valves.RemoteAddrValve' and Valve/@allow='127\\.0\\.0\\.1'\">"
      xsl_stmt    : "<xsl:text>PASS - RemoteAddrValve present for Engine </xsl:text><xsl:value-of select=\"@name\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>FAIL - RemoteAddrValve not present or commented out</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      expect      : "PASS"
    </custom_item>

    <report type:"WARNING">
      description : "10.3 Restrict manager application"
      info        : "Limit access to the manager application to only those with a justified need.

Rationale:

Limiting access to the least privilege will ensure only those people with a justified need will have access to a resource The manager application should be limited to only administrators.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "For the manager application, edit $CATALINA_HOME/conf/<enginename>/<hostname>/manager.xml, and add the bolded line:

<Context path='/manager' docBase='${catalina.home}/webapps/manager' debug='0' privileged='true'>
<Valve className='org.apache.catalina.valves.RemoteAddrValve' allow='127\.0\.0\.1'/>
<!-- Link to the user database we will get roles from -->
 <ResourceLink name='users' global='UserDatabase'
 type='org.apache.catalina.UserDatabase'/>
</Context>

Add hosts, comma separated, which are allowed to access the admin application.

Note: The RemoteAddrValve property expects a regular expression, therefore periods and other regular expression meta-characters must be escaped.

Default Value:

By default this setting is not present

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/valve.html

https://tomcat.apache.org/tomcat-8.0-doc/manager-howto.html"
      reference   : "800-171|3.1.7,800-53|AC-6(10),800-53r5|AC-6(10),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.7,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,LEVEL|2NS,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
    </report>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "10.5 Rename the manager application - localhost/manager.xml"
      info        : "The manager application allows administrators to manage Tomcat remotely via a web interface. The manager application should be renamed to make it harder for attackers or automated scripts to locate.

Rationale:

By relocating the manager applications, an attacker will need to guess its location rather than simply navigate to the standard location in order to carry out an attack."
      solution    : "Perform the following to rename the manager application:

Rename the manager application XML file:

# mv $CATALINA_HOME/webapps/host-manager/manager.xml \
$CATALINA_HOME/webapps/host-manager/<new-name>.xml

Update the docBase attribute within $CATALINA_HOME/webapps/host-manager/<new-name>.xml to $CATALINA_HOME/webapps/<new-name>

Move $CATALINA_HOME/webapps/manager to $CATALINA_HOME/webapps/<new-name>

# mv $CATALINA_HOME/webapps/manager $CATALINA_HOME/webapps/<new-name>

Default Value:

The default name of the manager application is manager and is located at:

$CATALINA_HOME/webapps/manager

References:

https://www.owasp.org/index.php/Securing_tomcat"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv6|9.1,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/Catalina/localhost/manager.xml"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "10.5 Rename the manager application - host-manager/manager.xml"
      info        : "The manager application allows administrators to manage Tomcat remotely via a web interface. The manager application should be renamed to make it harder for attackers or automated scripts to locate.

Rationale:

By relocating the manager applications, an attacker will need to guess its location rather than simply navigate to the standard location in order to carry out an attack."
      solution    : "Perform the following to rename the manager application:

Rename the manager application XML file:

# mv $CATALINA_HOME/webapps/host-manager/manager.xml \
$CATALINA_HOME/webapps/host-manager/<new-name>.xml

Update the docBase attribute within $CATALINA_HOME/webapps/host-manager/<new-name>.xml to $CATALINA_HOME/webapps/<new-name>

Move $CATALINA_HOME/webapps/manager to $CATALINA_HOME/webapps/<new-name>

# mv $CATALINA_HOME/webapps/manager $CATALINA_HOME/webapps/<new-name>

Default Value:

The default name of the manager application is manager and is located at:

$CATALINA_HOME/webapps/manager

References:

https://www.owasp.org/index.php/Securing_tomcat"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv6|9.1,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/host-manager/manager.xml"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "10.5 Rename the manager application - webapps/manager"
      info        : "The manager application allows administrators to manage Tomcat remotely via a web interface. The manager application should be renamed to make it harder for attackers or automated scripts to locate.

Rationale:

By relocating the manager applications, an attacker will need to guess its location rather than simply navigate to the standard location in order to carry out an attack."
      solution    : "Perform the following to rename the manager application:

Rename the manager application XML file:

# mv $CATALINA_HOME/webapps/host-manager/manager.xml \
$CATALINA_HOME/webapps/host-manager/<new-name>.xml

Update the docBase attribute within $CATALINA_HOME/webapps/host-manager/<new-name>.xml to $CATALINA_HOME/webapps/<new-name>

Move $CATALINA_HOME/webapps/manager to $CATALINA_HOME/webapps/<new-name>

# mv $CATALINA_HOME/webapps/manager $CATALINA_HOME/webapps/<new-name>

Default Value:

The default name of the manager application is manager and is located at:

$CATALINA_HOME/webapps/manager

References:

https://www.owasp.org/index.php/Securing_tomcat"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv6|9.1,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/webapps/manager"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "10.8 Do not allow additional path delimiters - ALLOW_BACKSLASH"
      info        : "Being able to specify different path-delimiters on Tomcat creates the possibility that an attacker can access applications that were previously blocked by a proxy like mod_proxy.

Rationale:

Allowing additional path-delimiters allows for an attacker to get to an application or area which was not previously visible."
      solution    : "To start Tomcat with ALLOW_BACKSLASH and ALLOW_ENCODED_SLASH set to false, add -Dorg.apache.catalina.connector.CoyoteAdapter.ALLOW_BACKSLASH=false and -Dorg.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=false to your startup script.

Default Value:

By default both parameters are set to false.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/systemprops.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/bin/catalina.sh"
      regex       : "-Dorg\.apache\.catalina\.connector\.CoyoteAdapter\.ALLOW_BACKSLASH[\\s]*=[\\s]*[Ff][Aa][Ll][Ss][Ee]"
      expect      : "-Dorg\.apache\.catalina\.connector\.CoyoteAdapter\.ALLOW_BACKSLASH[\\s]*=[\\s]*[Ff][Aa][Ll][Ss][Ee]"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "10.8 Do not allow additional path delimiters - ALLOW_ENCODED_SLASH"
      info        : "Being able to specify different path-delimiters on Tomcat creates the possibility that an attacker can access applications that were previously blocked by a proxy like mod_proxy.

Rationale:

Allowing additional path-delimiters allows for an attacker to get to an application or area which was not previously visible."
      solution    : "To start Tomcat with ALLOW_BACKSLASH and ALLOW_ENCODED_SLASH set to false, add -Dorg.apache.catalina.connector.CoyoteAdapter.ALLOW_BACKSLASH=false and -Dorg.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=false to your startup script.

Default Value:

By default both parameters are set to false.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/systemprops.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/bin/catalina.sh"
      regex       : "-Dorg\.apache\.catalina\.connector\.CoyoteAdapter\.ALLOW_ENCODED_SLASH[\\s]*=[\\s]*[Ff][Aa][Ll][Ss][Ee]"
      expect      : "-Dorg\.apache\.catalina\.connector\.CoyoteAdapter\.ALLOW_ENCODED_SLASH[\\s]*=[\\s]*[Ff][Aa][Ll][Ss][Ee]"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "10.9 Do not allow custom header status messages"
      info        : "The ability to specify custom status messages opens up the potential for additional headers to be injected. If custom header status messages are required make sure it is only in US-ASCII and does not include any user-supplied data.

Rationale:

Allowing user-supplied data into a header creates the potential for cross-site scripting (XSS)."
      solution    : "To start Tomcat with USE_CUSTOM_STATUS_MSG_IN_HEADER set to false, add -Dorg.apache.coyote.USE_CUSTOM_STATUS_MSG_IN_HEADER=false to your startup script.

Default Value:

By default this is set to false.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/systemprops.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_HOME@/bin/catalina.sh"
      regex       : "-Dorg\.apache\.coyote\.USE_CUSTOM_STATUS_MSG_IN_HEADER[\\s]*=[\\s]*[Ff][Aa][Ll][Ss][Ee]"
      expect      : "-Dorg\.apache\.coyote\.USE_CUSTOM_STATUS_MSG_IN_HEADER[\\s]*=[\\s]*[Ff][Aa][Ll][Ss][Ee]"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "10.10 Configure connectionTimeout"
      info        : "The connectionTimeout setting allows Tomcat to close idle sockets after a specific amount of time to save system resources.

Rationale:

Closing idle sockets reduces system resource usage which can provide better performance and help protect against Denial of Service (Dos) attacks."
      solution    : "Set the connectionTimeoutfor each connector in $CATALINA_HOME/conf/server.xml to optimal number of milliseconds based on hardware resources, load, and number of concurrent connections.

connectionTimeout='60000'

Impact:

This timeout will also apply when reading any request body when disableUploadTimeout is not set to false.

Default Value:

By default this is set to 60000 (i.e. 60 seconds) but the standard server.xml which ships with Tomcat sets this set to 20000 (i.e. 20 seconds).

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/http.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Connector\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"@connectionTimeout and @connectionTimeout>0\">"
      xsl_stmt    : "<xsl:text>PASS - Timeout set</xsl:text>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>FAIL - Timeout not set</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      expect      : "PASS"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "10.11 Configure maxHttpHeaderSize"
      info        : "The maxHttpHeaderSize limits the size of the request and response headers defined in bytes.

Rationale:

Limiting the size of the header request can help protect against Denial of Service (DoS) requests."
      solution    : "Set maxHttpHeaderSize for each connector in $CATALINA_HOME/conf/server.xml to the appropriate setting.

maxHttpHeaderSize='8192'

Default Value:

By default this is set to 8192.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/http.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Connector\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"@maxHttpHeaderSize and @maxHttpHeaderSize>0\">"
      xsl_stmt    : "<xsl:text>PASS - maxHttpHeaderSize set</xsl:text>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>FAIL - maxHttpHeaderSize not set for Connector </xsl:text><xsl:value-of select='@port' />"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      not_expect  : "FAIL"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "10.12 Force SSL for all applications"
      info        : "Use the transport-guarantee attribute to ensure SSL protection when accessing all applications. This can be overridden on a per application basis in the application configuration.

Rationale:

By default, when accessing applications SSL will be enforced to protect information sent over the network. By using the transport-guarantee attribute within web.xml, SSL is enforced.

Note: This requires SSL to be configured."
      solution    : "Set transport-guarantee to CONFIDENTIAL in $CATALINA_HOME/conf/web.xml:

<user-data-constraint>
  <transport-guarantee>CONFIDENTIAL</transport-guarantee>
<user-data-constraint>

Impact:

If the data protection level is set to INTEGRAL or CONFIDENTIAL, and the client is not already using SSL, then the client is redirected to the same URI, but using port 443 or the port defined for the redirectPort attribute in the <Connector> element in server.xml.

Default Value:

By default this configuration is not present.

References:

https://www.owasp.org/index.php/Securing_tomcat"
      reference   : "800-171|3.13.8,800-53|SC-8,800-53r5|SC-8,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSCv7|14.4,CSF|PR.DS-2,CSF|PR.DS-5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|SC-8,ITSG-33|SC-8a.,LEVEL|2S,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/web.xml"
      regex       : "<transport-guarantee>CONFIDENTIAL</transport-guarantee>"
      expect      : "<transport-guarantee>CONFIDENTIAL</transport-guarantee>"
    </custom_item>

    <custom_item>
      type        : AUDIT_XML
      description : "10.16 Do not resolve hosts on logging valves"
      info        : "Setting enableLookups to true on Connector will result in a DNS look-ups to obtain the host name of the remote client before logging any information. This uses additional resources when logging.

Rationale:

Allowing enableLookups adds additional overhead to resolve the host name of a remote client which is rarely needed."
      solution    : "In Connector elements, set the enableLookups attribute to false or remove it.

<Connector ... enableLookups='false' />

Default Value:

By default, DNS lookups are disabled.

References:

https://tomcat.apache.org/tomcat-8.0-doc/config/valve.html

https://tomcat.apache.org/tomcat-8.0-doc/config/http.html"
      reference   : "800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CSCv7|5.1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,LEVEL|2S,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/2506"
      file        : "@CATALINA_CONF@/server.xml"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"Server/Service/Connector\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"@enableLookups and @enableLookups = 'true'\">"
      xsl_stmt    : "<xsl:text>FAIL - Lookups enabled for port </xsl:text><xsl:value-of select=\"@port\" />"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:text>PASS - Lookups not enabled</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      not_expect  : "FAIL"
    </custom_item>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_Apache_Tomcat_8_L2_v1.1.0.audit from CIS Apache Tomcat 8 Benchmark"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/files/2506"
    </report>
  </else>
</if>

</check_type>
