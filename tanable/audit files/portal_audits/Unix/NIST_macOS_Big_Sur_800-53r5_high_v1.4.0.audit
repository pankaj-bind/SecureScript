#TRUSTED 3a6f0233834f15d0d42e8c6bb08920a7ba4766324300208219cb60de254aeddb36a51fcdce1dc86361712b1fd438e21ff4f0d66c97ec7aef633e05f50a6dde5a237dd14670c2a2151bcdd957b944a09b98065f7536259a3fd5f8fe322b26a36ace2f6f649f83341e9ca9d19c9b77f97c1910f906843fcdda59e8968bc2c5d93d93db7ac1c4ec73f4ad98513a5df79fcd68bf4fc89d90d248d52721a65c38766d1681b1a935667cf9f5fcdea4244ac9ab54e25f19238b2f62fa930f7baca78321660dd82087de5156adf637e765551c7cc06e3f97ae002d03239d8e0ae7c59cc9c0b6adfb51eb684aa42c86e959c509f7bded4df76ea92d7801c730be96385d215dbfe317ab3e0cd65bb2eb65070944953846437be1036b30f797822f2a289947285dee8180755f009db4c90912bc06ccd4991a4ddb1373aaaa4983a1fe0e3b85bc34b0f9bfde2126cf51a73b58a7a792e8e6facfb1731318acd9fb07c6c78e0a1bb930debf649b65596958be5b5671cd5db822645884e6861e2afc96fbffdad6af2946d34d049dd9676b65a98526544f0e030f805ac182579c9c802f012c43533a397da4933068e0895d3b58de9874f1ef7391b852c6aff78b61ff7118e3fd8e6e71dc303e1e4bdd5640e863b55050518fa4070e76ae645bce406777e78ffb37a3acec2ad82b445b4039f628200699bf5e8c4ddb7726a6135e4d1a80a63d6d09
#TRUST-RSA-SHA256 84da7d4f6d165294a318dec851cdf8172755d032e0d2878fee3ea5fffdfa2fa8e5c2a373483275c327f29aebe9855c37f75e32148f34cbec99ee372496ba283c10afb3ce484a0e4acdad4d2b1e381432cc36f33e4bf4172890c7031a2ecba25ae75dcd9e29d5bf5a3e15452f1a408606d64bee3ea2581a719c640894b27cecdc6c9e4422ab60062f4b316f88add2674e2ee9d35d1c37158ffbe2bf894515d81d7f95aacfd2d3095c4246c87e42cc3424d513da9a2eec1869ea841dce6efe37752df7d18a54179ea2c3e30468e53dc5c705bed176c26bb6d53ce2ac7455e385ad2536d81db556b359679c4430b269b01e0b4d887a9b12c4f1d15f657d49310d07e779cfdfdc6dc66435f845c8744865ee334a5e84031e38a0c360e1e76b39b556538636e35a4729010071dd353026ce018eb765ddfd2a4d7832607def86d2846e2ff455cb5a2fdb04cbeaec09dc74f377350b73be5a215f7bd9fb8f7d2803e1743d5442c4fe85fa96efa67e5cc7637894b274ad09702db7226b29151e16b1cf7f33ffd8768aa2b56ce26e81c8421922c86010242921769501ba72e438af3aa45e5a79ab5df9418f61a2868654e5ac2b485bd540dc4048ee909d9642c6b4c8059781813455adbeffa8ef44a3a46c148c6c88ad370d117117b28c84cdec05498c61e3c03d1ff819fe66aff0dcb35b57169e7672675c958eddcee4d77c35c15b324a
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.5 $
# $Date: 2024/06/17 $
#
# Description : This document implements the security configuration as recommended by the
#               NIST macOS Security Compliance Project.
#               https://github.com/usnistgov/macos_security
#
#<ui_metadata>
#<display_name>NIST macOS Big Sur v1.4.0 - 800-53r5 High</display_name>
#<spec>
#  <type>TNS</type>
#  <name>NIST macOS</name>
#  <profile>Big Sur - 800-53r5 High</profile>
#  <version>1.4.0</version>
#  <link>https://github.com/usnistgov/macos_security</link>
#</spec>
#<labels>unix,nist,macos,macos_11,agent,update_20230227</labels>
#<benchmark_refs>800-171,800-53r5,CCE,CCI,CSCv8,DISA_Benchmark,STIG-ID</benchmark_refs>
#<variables>
#  <variable>
#    <name>PLATFORM_VERSION</name>
#    <default>11</default>
#    <description>MacOS Version</description>
#    <info>MacOS Version</info>
#    <value_type>INTEGER</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : CMD_EXEC
      description : "MacOS 11 is installed"
      cmd         : "/usr/bin/sw_vers | /usr/bin/grep 'ProductVersion'"
      expect      : "^ProductVersion[\\s]*:[\\s]*@PLATFORM_VERSION@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "NIST_macOS_Big_Sur_800-53r5_high_v1.4.0.audit from NIST macOS Big Sur v1.4.0"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Files to Not Contain Access Control Lists"
      info        : "The audit log files _MUST_ not contain access control lists (ACLs).

This rule ensures that audit information and audit files are configured to be readable and writable only by system administrators, thereby preventing unauthorized access, modification, and deletion of files."
      solution    : "[source,bash]
----
/bin/chmod -RN $(/usr/bin/awk -F: '/^dir/{print $2}' /etc/security/audit_control)
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53|SI-11,800-53|SI-11b.,800-53r5|AU-9,800-53r5|SI-11,800-53r5|SI-11b.,CCE|CCE-85251-7,CCI|CCI-000162,CCI|CCI-001314,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,ITSG-33|SI-11,ITSG-33|SI-11c.,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-000030"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -le $(/usr/bin/awk -F: '/^dir/{print $2}' /etc/security/audit_control) | /usr/bin/awk '{print $1}' | /usr/bin/grep -c \":\""
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Folder to Not Contain Access Control Lists"
      info        : "The audit log folder _MUST_ not contain access control lists (ACLs).

Audit logs contain sensitive data about the system and users. This rule ensures that the audit service is configured to create log folders that are readable and writable only by system administrators in order to prevent normal users from reading audit logs."
      solution    : "[source,bash]
----
/bin/chmod -N $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}')
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CCE|CCE-85252-5,CCI|CCI-000162,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-000031"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -lde $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '{print $1}' | /usr/bin/grep -c \":\""
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Security Auditing"
      info        : "The information system _MUST_ be configured to generate audit records.

Audit records establish what types of events have occurred, when they occurred, and which users were involved. These records aid an organization in their efforts to establish, correlate, and investigate the events leading up to an outage or attack.

The content required to be captured in an audit record varies based on the impact level of an organization's system. Content that may be necessary to satisfy this requirement includes, for example, time stamps, source addresses, destination addresses, user identifiers, event descriptions, success/fail indications, filenames involved, and access or flow control rules invoked.

The information system initiates session audits at system start-up.

NOTE: Security auditing is enabled by default on macOS."
      solution    : "[source,bash]
----
/bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.auditd.plist
----"
      reference   : "800-171|3.1.1,800-171|3.3.1,800-171|3.3.2,800-171|3.3.7,800-171|3.4.5,800-171|3.7.5,800-53|AC-2(4),800-53|AU-3,800-53|AU-3(1),800-53|AU-8,800-53|AU-8a.,800-53|AU-8b.,800-53|AU-12,800-53|AU-12(1),800-53|AU-12(3),800-53|AU-14(1),800-53|CM-5(1),800-53|MA-4(1),800-53r5|AC-2(4),800-53r5|AU-3,800-53r5|AU-3(1),800-53r5|AU-8,800-53r5|AU-8a.,800-53r5|AU-8b.,800-53r5|AU-12,800-53r5|AU-12(1),800-53r5|AU-12(3),800-53r5|AU-14(1),800-53r5|CM-5(1),800-53r5|MA-4(1),CCE|CCE-85254-1,CCI|CCI-000130,CCI|CCI-000131,CCI|CCI-000132,CCI|CCI-000133,CCI|CCI-000134,CCI|CCI-000135,CCI|CCI-000159,CCI|CCI-001464,CCI|CCI-001487,CCI|CCI-001889,CCI|CCI-001890,CCI|CCI-001914,CCI|CCI-002130,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|8.1.4.3(b),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(4),ITSG-33|AU-3,ITSG-33|AU-3(1),ITSG-33|AU-8,ITSG-33|AU-8a.,ITSG-33|AU-12,ITSG-33|AU-12(1),ITSG-33|AU-14,ITSG-33|CM-5(1),ITSG-33|MA-4(1),NESA|T2.3.4,NESA|T3.6.2,NESA|T3.6.7,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM9a,NIAv2|AM9b,NIAv2|AM9c,NIAv2|AM9d,NIAv2|AM9e,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001003,SWIFT-CSCv1|6.4,TBA-FIISB|36.2.3,TBA-FIISB|37.4,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl list | /usr/bin/grep -c com.apple.auditd"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Capacity Warning"
      info        : "The audit service _MUST_ be configured to notify the system administrator when the amount of free disk space remaining reaches an organization defined value.

This rule ensures that the system administrator is notified in advance that action is required to free up more disk space for audit logs."
      solution    : "[source,bash]
----
/usr/bin/sed -i.bak 's/.*minfree.*/minfree:25/' /etc/security/audit_control; /usr/sbin/audit -s
----"
      reference   : "800-171|3.3.4,800-53|AU-5(1),800-53r5|AU-5(1),CCE|CCE-85255-8,CCI|CCI-001855,CN-L3|7.1.3.7(e),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5(1),NESA|T3.3.1,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001030,TBA-FIISB|37.3.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -c \"^minfree:25\" /etc/security/audit_control"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Shut Down Upon Audit Failure"
      info        : "The audit service _MUST_ be configured to shut down the computer if it is unable to audit system events.

Once audit failure occurs, user and system activity are no longer recorded, and malicious activity could go undetected. Audit processing failures can occur due to software/hardware errors, failures in the audit capturing mechanisms, and audit storage capacity being reached or exceeded."
      solution    : "[source,bash]
----
/usr/bin/sed -i.bak 's/^policy.*/policy: ahlt,argv/' /etc/security/audit_control; /usr/sbin/audit -s
----"
      reference   : "800-171|3.3.4,800-53|AU-5,800-53|AU-5b.,800-53r5|AU-5,800-53r5|AU-5b.,CCE|CCE-85257-4,CCI|CCI-000140,CN-L3|7.1.3.3(e),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5,ITSG-33|AU-5b.,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001010"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^policy/ {print $NF}' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec 'ahlt'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Files Group to Wheel"
      info        : "Audit log files _MUST_ have the group set to wheel.

The audit service _MUST_ be configured to create log files with the correct group ownership to prevent normal users from reading audit logs.

Audit logs contain sensitive data about the system and users. If log files are set to be readable and writable only by system administrators, the risk is mitigated."
      solution    : "[source,bash]
----
/usr/bin/chgrp -R wheel $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}')/*
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CCE|CCE-85258-2,CCI|CCI-000162,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001014"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -n $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '{s+=$4} END {print s}'"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Files to Mode 440 or Less Permissive"
      info        : "The audit service _MUST_ be configured to create log files that are readable only by the root user and group wheel. To achieve this, audit log files _MUST_ be configured to mode 440 or less permissive; thereby preventing normal users from reading, modifying or deleting audit logs."
      solution    : "[source,bash]
----
/bin/chmod 440 $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}')/*
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CCE|CCE-85259-0,CCI|CCI-000162,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001016"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -l $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '!/-r--r-----|current|total/{print $1}' | /usr/bin/wc -l | /usr/bin/tr -d ' '"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Files to be Owned by Root"
      info        : "Audit log files _MUST_ be owned by root.

The audit service _MUST_ be configured to create log files with the correct ownership to prevent normal users from reading audit logs.

Audit logs contain sensitive data about the system and users. If log files are set to only be readable and writable by system administrators, the risk is mitigated."
      solution    : "[source,bash]
----
/usr/sbin/chown -R root $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}')/*
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CCE|CCE-85260-8,CCI|CCI-000162,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001012"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -n $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '{s+=$3} END {print s}'"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Authorization and Authentication Events"
      info        : "The auditing system _MUST_ be configured to flag authorization and authentication (aa) events.

Authentication events contain information about the identity of a user, server, or client. Authorization events contain information about permissions, rights, and rules. If audit records do not include aa events, it is difficult to identify incidents and to correlate incidents to subsequent events.

Audit records can be generated from various components within the information system (e.g., via a module or policy filter)."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*[^-]aa\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,aa/' /etc/security/audit_control; /usr/sbin/audit -s
----"
      reference   : "800-171|3.1.2,800-171|3.3.1,800-171|3.3.2,800-171|3.4.5,800-171|3.7.5,800-53|AC-2(12),800-53|AU-2,800-53|AU-12,800-53|AU-12c.,800-53|CM-5(1),800-53|MA-4(1),800-53r5|AC-2(12),800-53r5|AU-2,800-53r5|AU-12,800-53r5|AU-12c.,800-53r5|CM-5(1),800-53r5|MA-4(1),CCE|CCE-85261-6,CCI|CCI-000172,CN-L3|7.1.3.2(d),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.12.4.1,ITSG-33|AC-2,ITSG-33|AU-2,ITSG-33|AU-12,ITSG-33|AU-12c.,ITSG-33|CM-5(1),ITSG-33|MA-4(1),NESA|M1.2.2,NESA|M5.3.1,NESA|M5.5.1,NESA|T2.3.4,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SM8,NIAv2|SS14e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001044,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec 'aa'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Administrative Action Events"
      info        : "The auditing system _MUST_ be configured to flag administrative action (ad) events.

Administrative action events include changes made to the system (e.g. modifying authentication policies). If audit records do not include ad events, it is difficult to identify incidents and to correlate incidents to subsequent events.

Audit records can be generated from various components within the information system (e.g., via a module or policy filter).

The information system audits the execution of privileged functions.

NOTE: We recommend changing the line \"43127:AUE_MAC_SYSCALL:mac_syscall(2):ad\" to \"43127:AUE_MAC_SYSCALL:mac_syscall(2):zz\" in the file /etc/security/audit_event. This will prevent sandbox violations from being audited by the ad flag."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*[^-]ad\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,ad/' /etc/security/audit_control; /usr/sbin/audit -s
----"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.1.7,800-171|3.3.1,800-171|3.3.2,800-171|3.4.5,800-171|3.7.5,800-53|AC-2(4),800-53|AC-2(12),800-53|AC-6(9),800-53|AU-2,800-53|AU-12,800-53|AU-12c.,800-53|CM-5(1),800-53|MA-4(1),800-53|MA-4(1)(a),800-53r5|AC-2(4),800-53r5|AC-2(12),800-53r5|AC-6(9),800-53r5|AU-2,800-53r5|AU-12,800-53r5|AU-12c.,800-53r5|CM-5(1),800-53r5|MA-4(1),800-53r5|MA-4(1)(a),CCE|CCE-85262-4,CCI|CCI-000018,CCI|CCI-000172,CCI|CCI-001403,CCI|CCI-001404,CCI|CCI-001405,CCI|CCI-002234,CCI|CCI-002884,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(d),CN-L3|7.1.3.2(g),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.2(d),CN-L3|8.1.4.3(a),CN-L3|8.1.10.6(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.12.4.1,ISO/IEC-27001|A.12.4.3,ITSG-33|AC-2,ITSG-33|AC-2(4),ITSG-33|AC-6,ITSG-33|AU-2,ITSG-33|AU-12,ITSG-33|AU-12c.,ITSG-33|CM-5(1),ITSG-33|MA-4(1),NESA|M1.2.2,NESA|M5.3.1,NESA|M5.5.1,NESA|T2.3.4,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM7,NIAv2|AM9a,NIAv2|AM9b,NIAv2|AM9c,NIAv2|AM9d,NIAv2|AM9e,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM23f,NIAv2|AM28,NIAv2|NS5j,NIAv2|SM8,NIAv2|SS13c,NIAv2|SS14e,NIAv2|SS15c,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.1,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001001,SWIFT-CSCv1|5.1,SWIFT-CSCv1|6.4,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,TBA-FIISB|36.2.3,TBA-FIISB|45.1.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec 'ad'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Failed Program Execution on the System"
      info        : "The audit system _MUST_ be configured to record enforcement actions of access restrictions, including failed program execute (-ex) attempts.

Enforcement actions are the methods or mechanisms used to prevent unauthorized access and/or changes to configuration settings. One common and effective enforcement action method is using program execution restrictions (e.g., denying users access to execute certain processes).

This configuration ensures that audit lists include events in which program execution has failed.
Without auditing the enforcement of program execution, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*-ex\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,-ex/' /etc/security/audit_control; /usr/sbin/audit -s
----"
      reference   : "800-171|3.1.2,800-171|3.3.1,800-171|3.3.2,800-171|3.4.5,800-53|AC-2(12),800-53|AU-2,800-53|AU-12,800-53|CM-5(1),800-53r5|AC-2(12),800-53r5|AU-2,800-53r5|AU-12,800-53r5|CM-5(1),CCE|CCE-85263-2,CN-L3|7.1.3.2(d),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,ITSG-33|AU-2,ITSG-33|AU-12,ITSG-33|CM-5(1),NESA|M1.2.2,NESA|M5.3.1,NESA|M5.5.1,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|6.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec '\\-ex'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Deletions of Object Attributes"
      info        : "The audit system _MUST_ be configured to record enforcement actions of attempts to delete file attributes (fd).

***Enforcement actions are the methods or mechanisms used to prevent unauthorized changes to configuration settings. One common and effective enforcement action method is using access restrictions (i.e., denying modifications to a file by applying file permissions).

This configuration ensures that audit lists include events in which enforcement actions prevent attempts to delete a file.

Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*-fd\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,-fd/' /etc/security/audit_control;/usr/sbin/audit -s
----"
      reference   : "800-171|3.1.2,800-171|3.3.1,800-171|3.3.2,800-171|3.3.8,800-171|3.4.5,800-171|3.7.5,800-53|AC-2(12),800-53|AU-2,800-53|AU-9,800-53|AU-12,800-53|AU-12c.,800-53|CM-5(1),800-53|MA-4(1),800-53r5|AC-2(12),800-53r5|AU-2,800-53r5|AU-9,800-53r5|AU-12,800-53r5|AU-12c.,800-53r5|CM-5(1),800-53r5|MA-4(1),CCE|CCE-85264-0,CCI|CCI-000172,CCI|CCI-001814,CN-L3|7.1.2.3(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(c),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.12.4.1,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AU-2,ITSG-33|AU-9,ITSG-33|AU-12,ITSG-33|AU-12c.,ITSG-33|CM-5(1),ITSG-33|MA-4(1),NESA|M1.2.2,NESA|M5.2.3,NESA|M5.3.1,NESA|M5.5.1,NESA|M5.5.2,NESA|T2.3.4,NESA|T3.6.2,NESA|T3.6.4,NESA|T3.6.5,NESA|T3.6.6,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,NESA|T8.2.9,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SM8,NIAv2|SS14e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001020,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec '\\-fd'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Failed Change of Object Attributes"
      info        : "The audit system _MUST_ be configured to record enforcement actions of failed attempts to modify file attributes (fm).

Enforcement actions are the methods or mechanisms used to prevent unauthorized changes to configuration settings. One common and effective enforcement action method is using access restrictions (i.e., denying modifications to a file by applying file permissions).

This configuration ensures that audit lists include events in which enforcement actions prevent attempts to modify a file.

Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*-fm\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,-fm/' /etc/security/audit_control;/usr/sbin/audit -s
----"
      reference   : "800-171|3.1.2,800-171|3.3.1,800-171|3.3.2,800-171|3.3.8,800-171|3.4.5,800-171|3.7.5,800-53|AC-2(12),800-53|AU-2,800-53|AU-9,800-53|AU-12,800-53|AU-12c.,800-53|CM-5(1),800-53|MA-4(1),800-53r5|AC-2(12),800-53r5|AU-2,800-53r5|AU-9,800-53r5|AU-12,800-53r5|AU-12c.,800-53r5|CM-5(1),800-53r5|MA-4(1),CCE|CCE-85264-0,CCI|CCI-000172,CCI|CCI-001814,CN-L3|7.1.2.3(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(c),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.12.4.1,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AU-2,ITSG-33|AU-9,ITSG-33|AU-12,ITSG-33|AU-12c.,ITSG-33|CM-5(1),ITSG-33|MA-4(1),NESA|M1.2.2,NESA|M5.2.3,NESA|M5.3.1,NESA|M5.5.1,NESA|M5.5.2,NESA|T2.3.4,NESA|T3.6.2,NESA|T3.6.4,NESA|T3.6.5,NESA|T3.6.6,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,NESA|T8.2.9,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SM8,NIAv2|SS14e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001020,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec '\\-fm'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Failed Read Actions on the System"
      info        : "The audit system _MUST_ be configured to record enforcement actions of access restrictions, including failed file read (-fr) attempts.

Enforcement actions are the methods or mechanisms used to prevent unauthorized access and/or changes to configuration settings. One common and effective enforcement action method is using access restrictions (e.g., denying access to a file by applying file permissions).

This configuration ensures that audit lists include events in which enforcement actions prevent attempts to read a file.

Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*-fr\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,-fr/' /etc/security/audit_control;/usr/sbin/audit -s
----"
      reference   : "800-171|3.1.2,800-171|3.3.1,800-171|3.3.2,800-171|3.3.8,800-171|3.4.5,800-171|3.7.5,800-53|AC-2(12),800-53|AU-2,800-53|AU-9,800-53|AU-12,800-53|AU-12c.,800-53|CM-5(1),800-53|MA-4(1),800-53r5|AC-2(12),800-53r5|AU-2,800-53r5|AU-9,800-53r5|AU-12,800-53r5|AU-12c.,800-53r5|CM-5(1),800-53r5|MA-4(1),CCE|CCE-85265-7,CCI|CCI-000172,CCI|CCI-001814,CN-L3|7.1.2.3(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(c),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.12.4.1,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AU-2,ITSG-33|AU-9,ITSG-33|AU-12,ITSG-33|AU-12c.,ITSG-33|CM-5(1),ITSG-33|MA-4(1),NESA|M1.2.2,NESA|M5.2.3,NESA|M5.3.1,NESA|M5.5.1,NESA|M5.5.2,NESA|T2.3.4,NESA|T3.6.2,NESA|T3.6.4,NESA|T3.6.5,NESA|T3.6.6,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,NESA|T8.2.9,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SM8,NIAv2|SS14e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001020,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec '\\-fr'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Failed Write Actions on the System"
      info        : "The audit system _MUST_ be configured to record enforcement actions of access restrictions, including failed file write (-fw) attempts.

Enforcement actions are the methods or mechanisms used to prevent unauthorized access and/or changes to configuration settings. One common and effective enforcement action method is using access restrictions (e.g., denying users access to edit a file by applying file permissions).

This configuration ensures that audit lists include events in which enforcement actions prevent attempts to change a file.

Without auditing the enforcement of access restrictions, it is difficult to identify attempted attacks, as there is no audit trail available for forensic investigation."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*-fw\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,-fw/' /etc/security/audit_control;/usr/sbin/audit -s
----"
      reference   : "800-171|3.1.2,800-171|3.3.1,800-171|3.3.2,800-171|3.3.8,800-171|3.4.5,800-171|3.7.5,800-53|AC-2(12),800-53|AU-2,800-53|AU-9,800-53|AU-12,800-53|CM-5(1),800-53|MA-4(1),800-53r5|AC-2(12),800-53r5|AU-2,800-53r5|AU-9,800-53r5|AU-12,800-53r5|CM-5(1),800-53r5|MA-4(1),CCE|CCE-85266-5,CCI|CCI-000162,CN-L3|7.1.2.3(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(c),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-2,ITSG-33|AU-2,ITSG-33|AU-9,ITSG-33|AU-12,ITSG-33|CM-5(1),ITSG-33|MA-4(1),NESA|M1.2.2,NESA|M5.2.3,NESA|M5.3.1,NESA|M5.5.1,NESA|M5.5.2,NESA|T2.3.4,NESA|T3.6.4,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,NESA|T8.2.9,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SM5,NIAv2|SM6,NIAv2|SS14e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001020,SWIFT-CSCv1|6.4,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec '\\-fw'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System to Audit All Log In and Log Out Events"
      info        : "The audit system _MUST_ be configured to record all attempts to log in and out of the system (lo).

Frequently, an attacker that successfully gains access to a system has only gained access to an account with limited privileges, such as a guest account or a service account. The attacker must attempt to change to another user account with normal or elevated privileges in order to proceed. Auditing both successful and unsuccessful attempts to switch to another user account (by way of monitoring login and logout events) mitigates this risk.

The information system monitors login and logout events."
      solution    : "[source,bash]
----
/usr/bin/grep -qE \"^flags.*[^-]lo\" /etc/security/audit_control || /usr/bin/sed -i.bak '/^flags/ s/$/,lo/' /etc/security/audit_control; /usr/sbin/audit -s
----"
      reference   : "800-171|3.1.2,800-171|3.1.12,800-171|3.3.1,800-171|3.3.2,800-171|3.7.5,800-53|AC-2(12),800-53|AC-17(1),800-53|AU-2,800-53|AU-12,800-53|AU-12c.,800-53|MA-4(1),800-53r5|AC-2(12),800-53r5|AC-17(1),800-53r5|AU-2,800-53r5|AU-12,800-53r5|AU-12c.,800-53r5|MA-4(1),CCE|CCE-85267-3,CCI|CCI-000067,CCI|CCI-000172,CN-L3|7.1.3.2(d),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(i),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.MA-2,CSF|PR.PT-1,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.12.4.1,ITSG-33|AC-2,ITSG-33|AC-17(1),ITSG-33|AU-2,ITSG-33|AU-12,ITSG-33|AU-12c.,ITSG-33|MA-4(1),NESA|M1.2.2,NESA|M5.3.1,NESA|M5.5.1,NESA|T2.3.4,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NESA|T5.4.4,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM28,NIAv2|NS5j,NIAv2|SM8,NIAv2|SS14e,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-001002,SWIFT-CSCv1|2.6,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F':' '/^flags/ { print $NF }' /etc/security/audit_control | /usr/bin/tr ',' '\\n' | /usr/bin/grep -Ec 'lo'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Folders to Mode 700 or Less Permissive"
      info        : "The audit log folder _MUST_ be configured to mode 700 or less permissive so that only the root user is able to read, write, and execute changes to folders.

Because audit logs contain sensitive data about the system and users, the audit service _MUST_ be configured to mode 700 or less permissive; thereby preventing normal users from reading, modifying or deleting audit logs."
      solution    : "[source,bash]
----
/bin/chmod 700 $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}')
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CCE|CCE-85270-7,CCI|CCI-000162,CCI|CCI-000163,CCI|CCI-000164,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001017"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/stat -f %A $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}')"
      expect      : "700"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Folders Group to Wheel"
      info        : "Audit log files _MUST_ have the group set to wheel.

The audit service _MUST_ be configured to create log files with the correct group ownership to prevent normal users from reading audit logs.

Audit logs contain sensitive data about the system and users. If log files are set to be readable and writable only by system administrators, the risk is mitigated."
      solution    : "[source,bash]
----
/usr/bin/chgrp wheel $(/usr/bin/awk -F : '/^dir/{print $2}' /etc/security/audit_control)
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CCE|CCE-85268-1,CCI|CCI-000162,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001015"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -dn $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '{print $4}'"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Log Folders to be Owned by Root"
      info        : "Audit log files _MUST_ be owned by root.

The audit service _MUST_ be configured to create log files with the correct ownership to prevent normal users from reading audit logs.

Audit logs contain sensitive data about the system and users. If log files are set to only be readable and writable by system administrators, the risk is mitigated."
      solution    : "[source,bash]
----
/usr/sbin/chown root $(/usr/bin/awk -F : '/^dir/{print $2}' /etc/security/audit_control)
----"
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9,CCE|CCE-85269-9,CCI|CCI-000162,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001013"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -dn $(/usr/bin/grep '^dir' /etc/security/audit_control | /usr/bin/awk -F: '{print $2}') | /usr/bin/awk '{print $3}'"
      expect      : "0"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Audit Record Reduction and Report Generation - processing"
      info        : "The macOS should be configured to provide and implement the capability to process, sort, and search audit records for events of interest based on organizationally defined fields.

Events of interest can be identified by the content of audit records, including system resources involved, information objects accessed, identities of individuals, event types, event locations, event dates and times, Internet Protocol addresses involved, or event success or failure. Organizations may define event criteria to any degree of granularity required, such as locations selectable by a general networking location or by specific system component.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-171|3.3.6,800-53|AU-7(1),800-53r5|AU-7(1),CCE|CCE-85462-0,CN-L3|7.1.2.3(c),CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-7(1),QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Audit Record Reduction and Report Generation - reduction"
      info        : "The system _IS_ configured with the ability provide and implement an audit record reduction and report generation capability.

Audit record reduction is a process that manipulates collected audit log information and organizes it into a summary format that is more meaningful to analysts. Audit record reduction and report generation capabilities do not always emanate from the same system or from the same organizational entities that conduct audit logging activities. The audit record reduction capability includes modern data mining techniques with advanced data filters to identify anomalous behavior in audit records. The report generation capability provided by the system can generate customizable reports. Time ordering of audit records can be an issue if the granularity of the timestamp in the record is insufficient.

Audit record reduction and report generation can be done with tools built into macOS such as auditreduce and praudit. These tools are protected by System Integrity Protection (SIP)."
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.3.6,800-53|AU-7,800-53r5|AU-7,CCE|CCE-85461-2,CN-L3|7.1.2.3(c),CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-7,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Retention to a Minimum of Seven Days"
      info        : "The audit service _MUST_ be configured to require records be kept for seven days or longer before deletion, unless the system uses a central audit record storage facility.

When \"expire-after\" is set to \"7d\", the audit service will not delete audit logs until the log data is at least seven days old."
      solution    : "[source,bash]
----
/usr/bin/sed -i.bak 's/^expire-after.*/expire-after:7d/' /etc/security/audit_control; /usr/sbin/audit -s
----"
      reference   : "800-53|AU-4,800-53|AU-11,800-53r5|AU-4,800-53r5|AU-11,CCE|CCE-85272-3,CCI|CCI-001849,CSF|PR.DS-4,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-4,ITSG-33|AU-11,NESA|M5.2.3,NESA|T3.3.1,NESA|T3.6.2,NIAv2|SM7,PCI-DSSv3.2.1|10.7,PCI-DSSv4.0|10.5.1,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001029"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/awk -F: '/expire-after/{print $2}' /etc/security/audit_control"
      expect      : "7d"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Audit Failure Notification"
      info        : "The audit service _MUST_ be configured to immediately print messages to the console or email administrator users when an auditing failure occurs.

It is critical for the appropriate personnel to be made aware immediately if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of a potentially harmful failure in the auditing system's capability, and system operation may be adversely affected."
      solution    : "[source,bash]
----
/usr/bin/sed -i.bak 's/logger -p/logger -s -p/' /etc/security/audit_warn; /usr/sbin/audit -s
----"
      reference   : "800-171|3.3.4,800-53|AU-5,800-53|AU-5(2),800-53r5|AU-5,800-53r5|AU-5(2),CCE|CCE-85273-1,CCI|CCI-001858,CN-L3|7.1.3.3(e),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5,ITSG-33|AU-5(2),NESA|T3.6.2,NIAv2|GS7f,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-001031"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -c \"logger -s -p\" /etc/security/audit_warn"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Multifactor Authentication for Login"
      info        : "The system _MUST_ be configured to enforce multifactor authentication.

All users _MUST_ go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

NOTE: /etc/pam.d/login will be automatically modified to its original state following any update or major upgrade to the operating system."
      solution    : "[source,bash]
----
/bin/cat > /etc/pam.d/login << LOGIN_END
# login: auth account password session
auth        sufficient    pam_smartcard.so
auth        optional      pam_krb5.so use_kcminit
auth        optional      pam_ntlm.so try_first_pass
auth        optional      pam_mount.so try_first_pass
auth        required      pam_opendirectory.so try_first_pass
auth        required      pam_deny.so
account     required      pam_nologin.so
account     required      pam_opendirectory.so
password    required      pam_opendirectory.so
session     required      pam_launchd.so
session     required      pam_uwtmp.so
session     optional      pam_mount.so
LOGIN_END


/bin/chmod 644 /etc/pam.d/login
/usr/sbin/chown root:wheel /etc/pam.d/login
----"
      reference   : "800-171|3.4.2,800-171|3.5.3,800-171|3.5.4,800-53|CM-6b.,800-53|IA-2(1),800-53|IA-2(2),800-53|IA-2(8),800-53r5|CM-6b.,800-53r5|IA-2(1),800-53r5|IA-2(2),800-53r5|IA-2(3),800-53r5|IA-2(4),800-53r5|IA-2(8),800-53r5|IA-5(11),CCE|CCE-85274-9,CCI|CCI-000366,CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.1.10.6(d),CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|CM-6b.,ITSG-33|IA-2(1),ITSG-33|IA-2(2),ITSG-33|IA-2(8),NESA|T2.3.8,NESA|T3.2.1,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM18,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003050,SWIFT-CSCv1|1.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|4.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -Ec '^(auth\\s+sufficient\\s+pam_smartcard.so|auth\\s+required\\s+pam_deny.so)' /etc/pam.d/login"
      expect      : "2"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Multifactor Authentication for Privilege Escalation Through the sudo Command"
      info        : "The system _MUST_ be configured to enforce multifactor authentication when the sudo command is used to elevate privilege.

All users _MUST_ go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

NOTE: /etc/pam.d/sudo will be automatically modified to its original state following any update or major upgrade to the operating system."
      solution    : "[source,bash]
----

/bin/cat > /etc/pam.d/sudo << SUDO_END
# sudo: auth account password session
auth        sufficient    pam_smartcard.so
auth        required      pam_opendirectory.so
auth        required      pam_deny.so
account     required      pam_permit.so
password    required      pam_deny.so
session     required      pam_permit.so
SUDO_END

/bin/chmod 444 /etc/pam.d/sudo
/usr/sbin/chown root:wheel /etc/pam.d/sudo
----"
      reference   : "800-171|3.4.2,800-171|3.5.3,800-171|3.5.4,800-53|CM-6b.,800-53|IA-2(1),800-53|IA-2(2),800-53|IA-2(8),800-53r5|CM-6b.,800-53r5|IA-2(1),800-53r5|IA-2(2),800-53r5|IA-2(3),800-53r5|IA-2(4),800-53r5|IA-2(8),800-53r5|IA-5(11),CCE|CCE-85276-4,CCI|CCI-000366,CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.1.10.6(d),CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|CM-6b.,ITSG-33|IA-2(1),ITSG-33|IA-2(2),ITSG-33|IA-2(8),NESA|T2.3.8,NESA|T3.2.1,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM18,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003052,SWIFT-CSCv1|1.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|4.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -Ec '^(auth\\s+sufficient\\s+pam_smartcard.so|auth\\s+required\\s+pam_deny.so)' /etc/pam.d/sudo"
      expect      : "2"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Multifactor Authentication for the su Command"
      info        : "The system _MUST_ be configured such that, when the su command is used, multifactor authentication is enforced.

All users _MUST_ go through multifactor authentication to prevent unauthenticated access and potential compromise to the system.

NOTE: /etc/pam.d/su will be automatically modified to its original state following any update or major upgrade to the operating system."
      solution    : "[source,bash]
----
/bin/cat > /etc/pam.d/su << SU_END
# su: auth account password session
auth        sufficient    pam_smartcard.so
auth        required      pam_rootok.so
auth        required      pam_group.so no_warn group=admin,wheel ruser root_only fail_safe
account     required      pam_permit.so
account     required      pam_opendirectory.so no_check_shell
password    required      pam_opendirectory.so
session     required      pam_launchd.so
SU_END

# Fix new file ownership and permissions
/bin/chmod 644 /etc/pam.d/su
/usr/sbin/chown root:wheel /etc/pam.d/su
----"
      reference   : "800-171|3.4.2,800-171|3.5.3,800-171|3.5.4,800-53|CM-6b.,800-53|IA-2(1),800-53|IA-2(2),800-53|IA-2(8),800-53r5|CM-6b.,800-53r5|IA-2(1),800-53r5|IA-2(2),800-53r5|IA-2(3),800-53r5|IA-2(4),800-53r5|IA-2(8),800-53r5|IA-5(11),CCE|CCE-85275-6,CCI|CCI-000366,CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.1.10.6(d),CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|CM-6b.,ITSG-33|IA-2(1),ITSG-33|IA-2(2),ITSG-33|IA-2(8),NESA|T2.3.8,NESA|T3.2.1,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM18,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003051,SWIFT-CSCv1|1.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|4.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -Ec '^(auth\\s+sufficient\\s+pam_smartcard.so|auth\\s+required\\s+pam_rootok.so)' /etc/pam.d/su"
      expect      : "2"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Allow Smartcard Authentication"
      info        : "Smartcard authentication _MUST_ be allowed.

The use of smartcard credentials facilitates standardization and reduces the risk of unauthorized access.

When enabled, the smartcard can be used for login, authorization, and screen saver unlocking."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.security.smartcard:
  allowSmartCard:
    True"
      reference   : "800-171|3.5.1,800-171|3.5.3,800-53|IA-2(1),800-53|IA-2(2),800-53|IA-2(12),800-53r5|IA-2(1),800-53r5|IA-2(2),800-53r5|IA-2(12),800-53r5|IA-5(11),CCE|CCE-85277-2,CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2,ITSG-33|IA-2a.,ITSG-33|IA-2(1),ITSG-33|IA-2(2),NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|1.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowSmartCard = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Set Smartcard Certificate Trust to High"
      info        : "The macOS system _MUST_ be configured to block access to users who are no longer authorized (i.e., users with revoked certificates).

To prevent the use of untrusted certificates, the certificates on a smartcard card _MUST_ meet the following criteria: its issuer has a system-trusted certificate, the certificate is not expired, its \"valid-after\" date is in the past, and it passes Certificate Revocation List (CRL) and Online Certificate Status Protocol (OCSP) checking.

By setting the smartcard certificate trust level to high, the system will execute a hard revocation, i.e., a network connection is required. A verified positive response from the OSCP/CRL server is required for authentication to succeed.

NOTE: Before applying this setting, please see the smartcard supplemental guidance."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.security.smartcard:
  checkCertificateTrust:
    3"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-53|IA-2(12),800-53|IA-5(2),800-53|SC-17,800-53r5|IA-2(12),800-53r5|IA-5(2),800-53r5|SC-17,CCE|CCE-85278-0,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2,ITSG-33|IA-2a.,ITSG-33|IA-5(2),ITSG-33|SC-17,ITSG-33|SC-17a.,NESA|T2.3.8,NESA|T5.2.3,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NESA|T7.4.2,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|CY5a,NIAv2|CY10,NIAv2|CY12,NIAv2|SS25,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/awk '/checkCertificateTrust/{print substr($3, 1, length($3)-1)}'"
      expect      : "3"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Smartcard Authentication"
      info        : "Smartcard authentication _MUST_ be enforced.

The use of smartcard credentials facilitates standardization and reduces the risk of unauthorized access.

When enforceSmartCard is set to \"true\", the smartcard must be used for login, authorization, and unlocking the screensaver.

CAUTION: enforceSmartCard will apply to the whole system. No users will be able to login with their password unless the profile is removed or a user is exempt from smartcard enforcement.

NOTE: enforceSmartcard requires allowSmartcard to be set to true in order to work."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.security.smartcard:
  enforceSmartCard:
    True"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.3,800-171|3.5.4,800-53|IA-2,800-53|IA-2(1),800-53|IA-2(2),800-53|IA-2(3),800-53|IA-2(4),800-53|IA-2(6),800-53|IA-2(8),800-53|IA-2(12),800-53|IA-5(2),800-53|IA-5(2)(c),800-53r5|IA-2,800-53r5|IA-2(1),800-53r5|IA-2(2),800-53r5|IA-2(3),800-53r5|IA-2(4),800-53r5|IA-2(6),800-53r5|IA-2(8),800-53r5|IA-2(11),800-53r5|IA-2(12),800-53r5|IA-5(2),800-53r5|IA-5(2)(c),800-53r5|IA-5(11),CCE|CCE-85280-6,CCI|CCI-000187,CCI|CCI-000767,CCI|CCI-000768,CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2,ITSG-33|IA-2a.,ITSG-33|IA-2(1),ITSG-33|IA-2(2),ITSG-33|IA-2(3),ITSG-33|IA-2(4),ITSG-33|IA-2(6),ITSG-33|IA-2(8),ITSG-33|IA-5(2),ITSG-33|IA-5(2)(c),NESA|T2.3.8,NESA|T5.2.3,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,NIAv2|AM18,NIAv2|AM36,NIAv2|VL3c,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003020,SWIFT-CSCv1|1.2,SWIFT-CSCv1|4.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'enforceSmartCard = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Address Book"
      info        : "The macOS built-in Contacts.app connection to Apple's iCloud service _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data, and, therefore, automated contact synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudAddressBook:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85282-2,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002014,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudAddressBook = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable the System Preference Pane for Apple ID"
      info        : "The system preference pane for Apple ID _MUST_ be disabled.

Disabling the system preference pane prevents login to Apple ID and iCloud."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.systempreferences:
  DisabledPreferencePanes:
    com.apple.preferences.AppleIDPrefPane"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7(1),800-53|CM-7(5)(b),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),CCE|CCE-85283-0,CCI|CCI-001774,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002031,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'com.apple.preferences.AppleID'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Bookmarks"
      info        : "The macOS built-in Safari.app bookmark synchronization via the iCloud service _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated bookmark synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudBookmarks:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85284-8,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002042,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudBookmarks = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable the iCloud Calendar Services"
      info        : "The macOS built-in Calendar.app connection to Apple's iCloud service _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated calendar synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudCalendar:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85285-5,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002012,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudCalendar = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Document Sync"
      info        : "The macOS built-in iCloud document synchronization service _MUST_ be disabled to prevent organizational data from being synchronized to personal or non-approved storage.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated document synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudDocumentSync:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85286-3,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002041,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudDocumentSync = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Keychain Sync"
      info        : "The macOS system's ability to automatically synchronize a user's passwords to their iCloud account _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, password management and synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudKeychainSync:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85287-1,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002040,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudKeychainSync = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Mail"
      info        : "The macOS built-in Mail.app connection to Apple's iCloud service _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated mail synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudMail:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85288-9,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002015,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudMail = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Notes"
      info        : "The macOS built-in Notes.app connection to Apple's iCloud service _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated Notes synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudNotes:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85289-7,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002016,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudNotes = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Photo Library"
      info        : "The macOS built-in Photos.app connection to Apple's iCloud service _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated photo synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudPhotoLibrary:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85290-5,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002043,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudPhotoLibrary = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Reminders"
      info        : "The macOS built-in Reminders.app connection to Apple's iCloud service _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated reminders synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudReminders:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85291-3,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002013,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudReminders = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Desktop and Document Folder Sync"
      info        : "The macOS system's ability to automatically synchronize a user's desktop and documents folder to their iCloud Drive _MUST_ be disabled.

Apple's iCloud service does not provide an organization with enough control over the storage and access of data and, therefore, automated file synchronization _MUST_ be controlled by an organization approved service."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowCloudDesktopAndDocuments:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-53|AC-20,800-53|AC-20(1),800-53|CM-7,800-53|CM-7(1),800-53|SC-7(10),800-53r5|AC-20,800-53r5|AC-20(1),800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|SC-7(10),CCE|CCE-85292-1,CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|AC-20(1),ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|M4.2.2,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowCloudDesktopAndDocuments = 0'"
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Access Control for Mobile Devices"
      info        : "A mobile device is a computing device that has a small form factor such that it can easily be carried by a single individual; is designed to operate without a physical connection; possesses local, non-removable or removable data storage; and includes a self-contained power source. Mobile device functionality may also include voice communication capabilities, on-board sensors that allow the device to capture information, and/or built-in features for synchronizing local data with remote locations. Examples include smart phones and tablets. Mobile devices are typically associated with a single individual. The processing, storage, and transmission capability of the mobile device may be comparable to or merely a subset of notebook/desktop systems, depending on the nature and intended purpose of the device. Protection and control of mobile devices is behavior or policy-based and requires users to take physical action to protect and control such devices when outside of controlled areas. Controlled areas are spaces for which organizations provide physical or procedural controls to meet the requirements established for protecting information and systems.

Due to the large variety of mobile devices with different characteristics and capabilities, organizational restrictions may vary for the different classes or types of such devices. Usage restrictions and specific implementation guidance for mobile devices include configuration management, device identification and authentication, implementation of mandatory protective software, scanning devices for malicious code, updating virus protection software, scanning for critical software updates and patches, conducting primary operating system (and possibly other resident software) integrity checks, and disabling unnecessary hardware.

Usage restrictions and authorization to connect may vary among organizational systems. For example, the organization may authorize the connection of mobile devices to its network and impose a set of usage restrictions, while a system owner may withhold authorization for mobile device connection to specific applications or impose additional usage restrictions before allowing mobile device connections to a system.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-171|3.1.18,800-53|AC-19,800-53r5|AC-19,CCE|CCE-85464-6,CSF|PR.AC-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.6.2.1,ITSG-33|AC-19,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable AirDrop"
      info        : "AirDrop _MUST_ be disabled to prevent file transfers to or from unauthorized devices.
AirDrop allows users to share and receive files from other nearby Apple devices."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowAirDrop:
    False"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.1.16,800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-20,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53r5|AC-3,800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),CCE|CCE-85293-9,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(a),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002009,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowAirDrop = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Apple ID Setup during Setup Assistant"
      info        : "The prompt for Apple ID setup during Setup Assistant _MUST_ be disabled.

macOS will automatically prompt new users to set up an Apple ID while they are going through Setup Assistant if this is not disabled, misleading new users to think they need to create Apple ID accounts upon their first login."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.SetupAssistant.managed:
  SkipCloudSetup:
    True"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-20,800-53|CM-7a.,800-53r5|AC-20,800-53r5|CM-7a.,CCE|CCE-85296-2,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-20,ITSG-33|CM-7a.,NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002035,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'SkipCloudSetup = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Apple Mobile File Integrity"
      info        : "Apple Mobile File Integrity (AMFI) is a macOS kernel module that enforces the code-signing validation within Gatekeeper and library validation. AMFI checks the signatures of every app that is run.

NOTE: AMFI is enabled by default on macOS systems."
      solution    : "[source,bash]
----
/usr/sbin/nvram boot-args=\"\"
----"
      reference   : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53|SI-7(1),800-53r5|SI-3,800-53r5|SI-7(1),CCE|CCE-85461-2,CN-L3|7.1.3.5(b),CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSF|DE.CM-4,CSF|DE.DP-3,CSF|PR.DS-6,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,ITSG-33|SI-7(1),NESA|T7.3.3,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv3.2.1|10.5.5,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,SWIFT-CSCv1|6.2,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/sbin/nvram -p | /usr/bin/grep -c \"amfi_get_out_of_my_way=1\""
      expect      : "0"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Ensure Seperate Execution Domain for Processes"
      info        : "The inherent configuration of the macOS _IS_ in compliance as Apple has implemented multiple features Mandatory access controls (MAC), System Integrity Protection (SIP), and application sandboxing.

link:https://support.apple.com/guide/security/system-integrity-protection-secb7ea06b49/web[]

link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AppSandboxDesignGuide/AboutAppSandbox/AboutAppSandbox.html[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-53|SC-39,800-53r5|SC-39,CCE|CCE-85474-5,GDPR|32.1.b,HIPAA|164.306(a)(1),QCSC-v1|5.2.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Apple System Log Files Owned by Root and Group to Wheel"
      info        : "The Apple System Logs (ASL) _MUST_ be owned by root.

ASL logs contain sensitive data about the system and users. If ASL log files are set to only be readable and writable by system administrators, the risk is mitigated."
      solution    : "[source,bash]
----
/usr/sbin/chown root:wheel $(/usr/bin/stat -f '%Su:%Sg:%N' $(/usr/bin/grep -e '^>' /etc/asl.conf /etc/asl/* | /usr/bin/awk '{ print $2 }') 2> /dev/null | /usr/bin/awk '!/^root:wheel:/{print $1}' | /usr/bin/awk -F\":\" '!/^root:wheel:/{print $3}')
----"
      reference   : "800-53|SI-11,800-53|SI-11b.,800-53r5|SI-11,800-53r5|SI-11b.,CCE|CCE-85463-8,CCI|CCI-001314,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11,ITSG-33|SI-11c.,STIG-ID|APPL-11-004001"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/stat -f '%Su:%Sg:%N' $(/usr/bin/grep -e '^>' /etc/asl.conf /etc/asl/* | /usr/bin/awk '{ print $2 }') 2> /dev/null | /usr/bin/awk '!/^root:wheel:/{print $1}' | /usr/bin/wc -l | /usr/bin/tr -d ' '"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Apple System Log Files To Mode 640 or Less Permissive"
      info        : "The Apple System Logs (ASL) _MUST_ be configured to be writable by root and readable only by the root user and group wheel. To achieve this, ASL log files _MUST_ be configured to mode 640 permissive or less; thereby preventing normal users from reading, modifying or deleting audit logs. System logs frequently contain sensitive information that could be used by an attacker. Setting the correct permissions mitigates this risk."
      solution    : "[source,bash]
----
/bin/chmod 640 $(/usr/bin/stat -f '%A:%N' $(/usr/bin/grep -e '^>' /etc/asl.conf /etc/asl/* | /usr/bin/awk '{ print $2 }') 2> /dev/null | /usr/bin/awk -F\":\" '!/640/{print $2}')
----"
      reference   : "800-53|SI-11,800-53|SI-11b.,800-53r5|SI-11,800-53r5|SI-11b.,CCE|CCE-85465-3,CCI|CCI-001314,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11,ITSG-33|SI-11c.,STIG-ID|APPL-11-004002"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/stat -f '%A:%N' $(/usr/bin/grep -e '^>' /etc/asl.conf /etc/asl/* | /usr/bin/awk '{ print $2 }') 2> /dev/null | /usr/bin/awk '!/640/{print $1}' | /usr/bin/wc -l | /usr/bin/tr -d ' '"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Authenticated Root"
      info        : "Authenticated Root _MUST_ be enabled.

When Authenticated Root is enabled the macOS is booted from a signed volume that is cryptographically protected to prevent tampering with the system volume.

NOTE: Authenticated Root is enabled by default on macOS systems."
      solution    : "[source,bash]
----
/usr/bin/csrutil authenticated-root enable
----
NOTE: To re-enable \"Authenticated Root\", boot the affected system into \"Recovery\" mode, launch \"Terminal\" from the \"Utilities\" menu, and run the command."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.5,800-171|3.7.5,800-53|AC-3,800-53|CM-5,800-53|MA-4(1),800-53|SC-34,800-53|SI-7,800-53|SI-7(6),800-53r5|AC-3,800-53r5|CM-5,800-53r5|MA-4(1),800-53r5|SC-34,800-53r5|SI-7,800-53r5|SI-7(6),CCE|CCE-85298-8,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.DS-6,CSF|PR.IP-1,CSF|PR.MA-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|CM-5,ITSG-33|MA-4(1),ITSG-33|SC-34,ITSG-33|SI-7,ITSG-33|SI-7a.,NESA|T2.3.4,NESA|T3.2.3,NESA|T3.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.3.2,NESA|T7.3.3,NESA|T7.5.1,NESA|T7.5.2,NESA|T7.5.3,NESA|T7.6.3,NIAv2|AM3,NIAv2|SS29,PCI-DSSv3.2.1|10.5.5,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|7.2,QCSC-v1|13.2,SWIFT-CSCv1|6.2,SWIFT-CSCv1|6.4,TBA-FIISB|31.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/csrutil authenticated-root | /usr/bin/grep -c 'enabled'"
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Must authenticate peripherals before establishing a connection"
      info        : "Organizational devices requiring unique device-to-device identification and authentication may be defined by type, by device, or by a combination of type/device. Information systems typically use either shared known information (e.g., Media Access Control [MAC] or Transmission Control Protocol/Internet Protocol [TCP/IP] addresses) for device identification or organizational authentication solutions (e.g., IEEE 802.1x and Extensible Authentication Protocol [EAP], Radius server with EAP-Transport Layer Security [TLS] authentication, Kerberos) to identify/authenticate devices on local and/or wide area networks. Organizations determine the required strength of authentication mechanisms by the security categories of information systems. Because of the challenges of applying this control on large scale, organizations are encouraged to only apply the control to those limited number (and type) of devices that truly need to support this capability.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and can be fixed by implementing a third party solution."
      reference   : "800-171|3.5.1,800-171|3.5.2,800-53|IA-3,800-53r5|IA-3,CCE|CCE-85297-0,CCI|CCI-001958,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3,ITSG-33|IA-3a.,NESA|T5.4.3,QCSC-v1|13.2,TBA-FIISB|27.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Bonjour Multicast"
      info        : "Bonjour multicast advertising _MUST_ be disabled to prevent the system from broadcasting its presence and available services over network interfaces."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mDNSResponder:
  NoMulticastAdvertisements:
    True"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),CCE|CCE-85299-6,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,STIG-ID|APPL-11-002005,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'NoMulticastAdvertisements = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Calendar.app"
      info        : "The macOS built-in Calendar.app _MUST_ be disabled as this application can establish a connection to non-approved services. This rule is in place to prevent inadvertent data transfers.

[IMPORTANT]
====
Some organizations allow the use of the built-in Calendar.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the macOS built-in Mail.app to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.
===="
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess.new:
  familyControlsEnabled:
    True
  pathBlackList:
    /Applications/Calendar.app"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-20,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),CCE|CCE-85300-2,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002023,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -A 20 familyControlsEnabled | /usr/bin/grep -c \"/Applications/Calendar.app\""
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Issue or Obtain Public Key Certificates from an Approved Service Provider"
      info        : "The organization _MUST_ issue or obtain public key certificates from an organization-approved service provider and ensure only approved trust anchors are in the System Keychain.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Obtain the approved certificates from the appropriate authority and install them to the System Keychain."
      reference   : "800-171|3.5.2,800-171|3.13.11,800-53|IA-5(2)(a),800-53|SC-13,800-53|SC-17,800-53r5|IA-5(2)(a),800-53r5|SC-13,800-53r5|SC-17,CCE|CCE-85302-8,CCI|CCI-000185,CCI|CCI-002450,CSF|PR.AC-1,CSF|PR.DS-5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|IA-5(2)(a),ITSG-33|SC-13,ITSG-33|SC-13a.,ITSG-33|SC-17,ITSG-33|SC-17a.,NESA|M5.2.6,NESA|T5.2.3,NESA|T7.4.1,NESA|T7.4.2,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5a,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|CY10,NIAv2|CY12,NIAv2|NS5e,NIAv2|SS25,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,STIG-ID|APPL-11-003001"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Installation of XProtect, MRT, and Gatekeeper Updates Automatically"
      info        : "Software Update _MUST_ be configured to update XProtect, MRT, and Gatekeepr automatically.

This setting enforces definition updates for XProtect, MRT, and Gatekeeper; with this setting in place, new malware and adware that Apple has added to the list of malware or untrusted software will not execute. These updates do not require the computer to be restarted.

link:https://support.apple.com/en-us/HT207005[]

NOTE: Software update will automatically update XProtect, MRT, and Gatekeeper by default in the macOS."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.SoftwareUpdate:
  ConfigDataInstall:
    True"
      reference   : "800-171|3.14.1,800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-2(5),800-53|SI-3,800-53r5|SI-2(5),800-53r5|SI-3,CCE|CCE-85466-1,CN-L3|7.1.3.6(b),CN-L3|8.1.4.4(e),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|DE.CM-4,CSF|DE.DP-3,CSF|ID.RA-1,CSF|PR.IP-12,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-2,ITSG-33|SI-3,NESA|T7.6.2,NESA|T7.7.1,NIAv2|GS8a,NIAv2|NS26b,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|5.2.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.2,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'ConfigDataInstall = 1'"
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Configure Automated Flaw Remediation"
      info        : "The macOS system _MUST_ be configured to determine the state of system components with regard to flaw remediation.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-171|3.14.1,800-53|SI-2(2),800-53r5|SI-2(2),CCE|CCE-85304-4,CCI|CCI-001233,CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|ID.RA-1,CSF|PR.IP-12,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-2(2),NESA|T7.6.2,NESA|T7.7.1,NIAv2|PR9,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,QCSC-v1|11.2,STIG-ID|APPL-11-000015,SWIFT-CSCv1|2.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Protect Audit Integrity with Cryptographic Mechanisms"
      info        : "The information system _IS_ configured to implement cryptographic mechanisms to protect the integrity of audit information and audit tools.

The Apple T2 Security Chip includes a dedicated Advanced Encryption Standard (AES) crypto engine built into the direct memory access (DMA) path between the flash storage and main system memory, which powers line-speed encrypted storage with FileVault and makes internal volume highly efficient.

link:https://www.apple.com/euro/mac/shared/docs/Apple_T2_Security_Chip_Overview.pdf[]

NOTE: This will only apply to a Mac that includes a T2 security chip."
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.3.8,800-53|AU-9(3),800-53r5|AU-9(3),CCE|CCE-85305-1,CCI|CCI-001496,CN-L3|8.1.4.3(d),CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9(3),NESA|M5.2.3,NESA|M5.5.2,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,TBA-FIISB|37.3.3"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Enforce Access Restrictions"
      info        : "The information system _IS_ configured to enforce access restrictions and support auditing of the enforcement actions.

The inherent configuration of a macOS provides users with the ability to set their own permission settings to control who can view and alter files on the computer.

link:https://support.apple.com/guide/mac-help/change-permissions-for-files-folders-or-disks-mchlp1203/mac[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.4.5,800-53|CM-5(1),800-53r5|CM-5(1),CCE|CCE-85306-9,CCI|CCI-001813,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(1),NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,QCSC-v1|7.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable FaceTime.app"
      info        : "The macOS built-in FaceTime.app _MUST_ be disabled.

The FaceTime.app establishes a connection to Apple's iCloud service, even when security controls have been put in place to disable iCloud access."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess.new:
  familyControlsEnabled:
    True
  pathBlackList:
    /Applications/FaceTime.app"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-53|AC-20,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),CCE|CCE-85308-5,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002010,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -A 20 familyControlsEnabled | /usr/bin/grep -c \"/Applications/FaceTime.app\""
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Configure System to Fail to a Known Safe State if System Initialization, Shutdown, or Abort Fails"
      info        : "The information system _IS_ configured to fail to a known safe state in the event of a failed system initialization, shutdown, or abort.

Failure to a known safe state helps prevent systems from failing to a state that may cause loss of data or unauthorized access to system resources.

Apple File System (APFS) is the default file system for Mac computers using macOS 10.13 and all later versions. APFS includes native encryption, safe document saves, stable snapshots, and crash protection; these features ensure that the macOS fails to safe state.

link:https://developer.apple.com/videos/play/wwdc2017/715/[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-53|SC-24,800-53r5|SC-24,CCE|CCE-85309-3,CCI|CCI-001190,CCI|CCI-001665,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-24,ITSG-33|SC-24a.,QCSC-v1|5.2.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - FileVault Authorized Users"
      info        : "macOS _MUST_ be configured to only allow authorized users to unlock FileVault upon startup.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Remove the user that is not authorized to unlock FileVault using the fdesetup command.

[source,bash]
----
/usr/bin/fdesetup remove -user NOT_AUTHORIZED_USERNAME
----"
      reference   : "800-171|3.1.1,800-53|AC-2(11),800-53r5|AC-2(11),CCE|CCE-85311-9,CCI|CCI-002143,CN-L3|8.1.4.1(b),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-000032"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable FileVault Automatic Login"
      info        : "If FileVault is enabled, automatic login _MUST_ be disabled, so that both FileVault and login window authentication are required.

The default behavior of macOS when FileVault is enabled is to automatically log in to the computer once successfully passing your FileVault credentials.

NOTE: DisableFDEAutoLogin does not have to be set on Apple Silicon based macOS systems that are smartcard enforced as smartcards are available at pre-boot."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.loginwindow:
  DisableFDEAutoLogin:
    True"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.5.2,800-53|AC-2(11),800-53|AC-3,800-53|IA-5(13),800-53r5|AC-2(11),800-53r5|AC-3,800-53r5|IA-5(13),CCE|CCE-85310-1,CCI|CCI-002143,CN-L3|8.1.4.1(b),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-2,ITSG-33|AC-3,ITSG-33|IA-5,NESA|T4.2.1,NESA|T5.2.3,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-000033,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'DisableFDEAutoLogin = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Control Connections to Other Systems via a Deny-All and Allow-by-Exception Firewall Policy"
      info        : "A deny-all and allow-by-exception firewall policy _MUST_ be employed for managing connections to other systems.

Organizations _MUST_ ensure the built-in packet filter firewall is configured correctly to employ the default deny rule.

Failure to restrict network connectivity to authorized systems permits inbound connections from malicious systems. It also permits outbound connections that may facilitate the exfiltration of data.

If you are using a third-party firewall solution, this setting does not apply.

[IMPORTANT]
====
Configuring the built-in packet filter firewall to employ the default deny rule has the potential to interfere with applications on the system in an unpredictable manner. Information System Security Officers (ISSOs) may make the risk-based decision not to configure the built-in packet filter firewall to employ the default deny rule to avoid losing functionality, but they are advised to first fully weigh the potential risks posed to their organization.
===="
      solution    : "NOTE: See the firewall supplemental which includes a script that has an example policy to implement this rule."
      reference   : "800-171|3.1.3,800-171|3.13.1,800-171|3.13.6,800-53|AC-4,800-53|SC-7(5),800-53r5|AC-4,800-53r5|SC-7(5),CCE|CCE-85312-7,CN-L3|7.1.2.2(c),CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|AC-4,ITSG-33|SC-7(5),NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS7b,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|NS25,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,TBA-FIISB|43.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/sbin/pfctl -a '*' -sr &> /dev/null | /usr/bin/grep -c \"block drop in all\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Firewall Logging"
      info        : "Firewall logging _MUST_ be enabled.

Firewall logging ensures that malicious network activity will be logged to the system.

NOTE: The firewall data is logged to Apple's Unified Logging with the subsystem com.apple.alf and the data is marked as private."
      solution    : "[source,bash]
----
/usr/libexec/ApplicationFirewall/socketfilterfw --setloggingmode on
----"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-53|AU-12,800-53|SC-7,800-53r5|AU-12,800-53r5|SC-7,CCE|CCE-85313-5,CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-1,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.13.1.3,ITSG-33|AU-12,ITSG-33|SC-7,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|10.1,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4,TBA-FIISB|43.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/libexec/ApplicationFirewall/socketfilterfw --getloggingmode | /usr/bin/grep -c \"Log mode is on\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Firmware Password"
      info        : "A firmware password _MUST_ be enabled and set.

Single user mode, recovery mode, the Startup Manager, and several other tools are available on macOS by holding the \"Option\" key down during startup. Setting a firmware password restricts access to these tools.

To set a firmware passcode use the following command:

[source,bash]
----
/usr/sbin/firmwarepasswd -setpasswd
----

NOTE: If firmware password or passcode is forgotten, the only way to reset the forgotten password is through the use of a machine specific binary generated and provided by Apple. Schedule a support call, and provide proof of purchase before the firmware binary will be generated.

NOTE: Firmware passwords are not supported on Apple Silicon devices. This rule is only applicable to Intel devices."
      solution    : "NOTE: See discussion on remediation and how to enable firmware password."
      reference   : "800-171|3.1.5,800-171|3.4.2,800-53|AC-6,800-53|CM-6b.,800-53r5|AC-6,800-53r5|CM-6b.,CCE|CCE-85314-3,CCI|CCI-000366,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(d),CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,ITSG-33|CM-6b.,NESA|T3.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,STIG-ID|APPL-11-003013,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/sbin/firmwarepasswd -check | /usr/bin/grep -c \"Password Enabled: Yes\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Gatekeeper"
      info        : "Gatekeeper _MUST_ be enabled.

Gatekeeper is a security feature that ensures that applications are digitally signed by an Apple-issued certificate before they are permitted to run. Digital signatures allow the macOS host to verify that the application has not been modified by a malicious third party.

Administrator users will still have the option to override these settings on a case-by-case basis."
      solution    : "[source,bash]
----
/usr/sbin/spctl --master-enable
----

mobileconfig profile info:

com.apple.systempolicy.control:
  EnableAssessment:
    True"
      reference   : "800-171|3.4.5,800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|CM-5,800-53|CM-5(3),800-53|SI-3,800-53|SI-7(1),800-53|SI-7(15),800-53r5|CM-5,800-53r5|CM-5(3),800-53r5|CM-14,800-53r5|SI-3,800-53r5|SI-7(1),800-53r5|SI-7(15),CCE|CCE-85315-0,CCI|CCI-001749,CN-L3|7.1.3.5(b),CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSF|DE.CM-4,CSF|DE.DP-3,CSF|PR.DS-6,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.12.2.1,ITSG-33|CM-5,ITSG-33|CM-5(3),ITSG-33|SI-3,ITSG-33|SI-7,ITSG-33|SI-7a.,ITSG-33|SI-7(1),NESA|T3.2.3,NESA|T3.4.1,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.3.2,NESA|T7.3.3,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv3.2.1|10.5.5,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|7.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002064,SWIFT-CSCv1|6.2,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/sbin/spctl --status | /usr/bin/grep -c \"assessments enabled\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Gatekeeper 30 Day Automatic Rearm"
      info        : "Gatekeeper _MUST_ be configured to automatically rearm after 30 days if disabled."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.ManagedClient.preferences:
  com.apple.security:
    GKAutoRearm
      True"
      reference   : "800-171|3.4.5,800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|CM-5,800-53|SI-3,800-53r5|CM-5,800-53r5|SI-3,CCE|CCE-85316-8,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSF|DE.CM-4,CSF|DE.DP-3,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|CM-5,ITSG-33|SI-3,NESA|T3.2.3,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|7.2,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'GKAutoRearm = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Handoff"
      info        : "Handoff _MUST_ be disabled.

Handoff allows you to continue working on a document or project when the user switches from one Apple device to another. Disabling Handoff prevents data transfers to unauthorized devices."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowActivityContinuation:
    False"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-20,800-53|CM-7,800-53|CM-7(1),800-53r5|AC-3,800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7(1),CCE|CCE-85321-8,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowActivityContinuation = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Secure User's Home Folders"
      info        : "The system _MUST_ be configured to prevent access to other users' home folders.

The default behavior of macOS is to allow all valid users access to the the top level of every other user's home folder while restricting access only to the Apple default folders within."
      solution    : "[source,bash]
----
IFS=$'\n'
for userDirs in $( /usr/bin/find /System/Volumes/Data/Users -mindepth 1 -maxdepth 1 -type d -perm -1 | /usr/bin/grep -v \"Shared\" | /usr/bin/grep -v \"Guest\" ); do
  /bin/chmod og-rwx \"$userDirs\"
done
unset IFS
----"
      reference   : "800-171|3.1.5,800-171|3.4.2,800-53|AC-6,800-53|CM-6b.,800-53r5|AC-6,800-53r5|CM-6b.,CCE|CCE-85322-6,CCI|CCI-000366,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(d),CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,ITSG-33|CM-6b.,NESA|T3.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,STIG-ID|APPL-11-002068,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/find /System/Volumes/Data/Users -mindepth 1 -maxdepth 1 -type d -perm -1 | /usr/bin/grep -v \"Shared\" | /usr/bin/grep -v \"Guest\" | /usr/bin/wc -l | /usr/bin/xargs"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable the Built-in Web Server"
      info        : "The built-in web server is a non-essential service built into macOS and _MUST_ be disabled.

NOTE: The built in web server service is disabled at startup by default macOS."
      solution    : "[source,bash]
----
/bin/launchctl disable system/org.apache.httpd
----"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-17,800-53|CM-7a.,800-53r5|AC-3,800-53r5|AC-17,800-53r5|CM-7a.,CCE|CCE-85323-4,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(a),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|CM-7a.,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002008,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"org.apache.httpd\" => true'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable iCloud Storage Setup during Setup Assistant"
      info        : "The prompt to set up iCloud storage services during Setup Assistant _MUST_ be disabled.

The default behavior of macOS is to prompt new users to set up storage in iCloud. Disabling the iCloud storage setup prompt provides organizations more control over the storage of their data."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.SetupAssistant.managed:
  SkipiCloudStorageSetup:
    True"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-20,800-53|CM-7a.,800-53r5|AC-20,800-53r5|CM-7a.,CCE|CCE-85324-2,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-20,ITSG-33|CM-7a.,NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002037,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'SkipiCloudStorageSetup = 1'"
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Configure the System to Uniquely Identify and Authenticate Non-Organizational Users"
      info        : "The information system uniquely identifies and authenticates non-organizational users (or processes acting on behalf of non-organizational users).

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "The requirement is NA. No fix is required."
      reference   : "800-53|IA-8,800-53r5|IA-8,CCE|CCE-85325-9,CCI|CCI-000804,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-8,ITSG-33|IA-8a.,NESA|T4.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|2.8"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Configure the System to Implement Approved Cryptography to Protect Information"
      info        : "The information system _IS_ configured to implement approved cryptography to protect information.

Use of weak or untested encryption algorithms undermines the purposes of utilizing encryption to protect data. The operating system must implement cryptographic modules that adhere to the higher standards that have been tested, validated, and approved by the federal government.

macOS Big Sur has been submitted to the National Institute of Standards and Technology (NIST) and is in review for the cryptographic module for FIPS 140-3 validation.

link:https://csrc.nist.gov/Projects/cryptographic-module-validation-program/modules-in-process/Modules-In-Process-List[]

link:https://support.apple.com/en-us/HT201159[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.13.11,800-53|SC-13,800-53r5|SC-13,CCE|CCE-85326-7,CCI|CCI-002450,CSF|PR.DS-5,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,ITSG-33|SC-13a.,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,QCSC-v1|6.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Configure the System to Protect Memory from Unauthorized Code Execution"
      info        : "The information system _IS_ configured to implement non-executable data to protect memory from code execution.

Some adversaries launch attacks with the intent of executing code in non-executable regions of memory or in memory locations that are prohibited (e.g., buffer overflow attacks). Security safeguards (e.g., data execution prevention and address space layout randomization) can be employed to protect non-executable regions of memory. Data execution prevention safeguards can either be hardware-enforced or software-enforced; hardware-enforced methods provide the greater strength of mechanism.

macOS supports address space layout randomization (ASLR), position-independent executable (PIE), Stack Canaries, and NX stack and heap protection.

link:https://developer.apple.com/library/archive/documentation/Darwin/Conceptual/64bitPorting/transition/transition.html[]

link:https://developer.apple.com/library/archive/qa/qa1788/_index.html[]

link:https://www.apple.com/macos/security/[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-53|SI-16,800-53r5|SI-16,CCE|CCE-85327-5,CCI|CCI-002824,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-16"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Information Input Validation"
      info        : "Check the validity of the following information inputs: organization-defined information inputs to the systems.

Checking the valid syntax and semantics of system inputs-including character set, length, numerical range, and acceptable values-verifies that inputs match specified definitions for format and content. For example, if the organization specifies that numerical values between 1-100 are the only acceptable inputs for a field in a given application, inputs of \"387,\" \"abc,\" or \"%K%\" are invalid inputs and are not accepted as input to the system. Valid inputs are likely to vary from field to field within a software application. Applications typically follow well-defined protocols that use structured messages (i.e., commands or queries) to communicate between software modules or system components. Structured messages can contain raw or unstructured data interspersed with metadata or control information. If software applications use attacker-supplied inputs to construct structured messages without properly encoding such messages, then the attacker could insert malicious commands or special characters that can cause the data to be interpreted as control information or metadata. Consequently, the module or component that receives the corrupted output will perform the wrong operations or otherwise interpret the data incorrectly. Prescreening inputs prior to passing them to interpreters prevents the content from being unintentionally interpreted as commands. Input validation ensures accurate and correct inputs and prevents attacks such as cross-site scripting and a variety of injection attacks.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "The requirement is NA. No fix is required."
      reference   : "800-53|SI-10,800-53r5|SI-10,CCE|CCE-85476-0,CN-L3|8.1.4.4(d),GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-10,ITSG-33|SI-10a.,NESA|T7.3.1,NESA|T7.3.2,NIAv2|SS6e"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable the Internet Accounts System Preference Pane"
      info        : "The Internet Accounts System Preference pane _MUST_ be disabled to prevent the addition of unauthorized internet accounts.

[IMPORTANT]
====
Some organizations may allow the use and configuration of the built-in Mail.app, Calendar.app, and Contacts.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the Internet Accounts System Preference pane to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.
===="
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.systempreferences:
  DisabledPreferencePanes:
    com.apple.preferences.internetaccounts"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-53|AC-20,800-53|CM-7a.,800-53|CM-7(5),800-53|CM-7(5)(b),800-53r5|AC-20,800-53r5|CM-7a.,800-53r5|CM-7(5),800-53r5|CM-7(5)(b),CCE|CCE-85328-3,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002032,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'com.apple.preferences.internetaccounts'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Infrared (IR) support"
      info        : "Infrared (IR) support _MUST_ be disabled to prevent users from controlling the system with IR devices.

By default, if IR is enabled, the system will accept IR control from any remote device.

NOTE: This is applicable only to models of Mac Mini systems earlier than Mac Mini8,1."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.ManagedClient.preferences:
  com.apple.driver.AppleIRController:
    DeviceEnabled
      False"
      reference   : "800-171|3.1.16,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-18,800-53|CM-6b.,800-53|CM-7,800-53|CM-7(1),800-53r5|AC-18,800-53r5|CM-6b.,800-53r5|CM-7,800-53r5|CM-7(1),CCE|CCE-85329-1,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,ITSG-33|CM-6b.,ITSG-33|CM-7,ITSG-33|CM-7(1),NESA|T3.2.1,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'DeviceEnabled = 0'"
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Configure the System to Separate User and System Functionality - isolate"
      info        : "The information system _IS_ configured to isolate security functions from non-security functions.

link:https://support.apple.com/guide/security/welcome/web[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-53|SC-3,800-53r5|SC-3,CCE|CCE-85330-9,CCI|CCI-001084,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-3,ITSG-33|SC-3a.,NESA|T3.4.1,NESA|T4.3.1,NESA|T4.3.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Limit Concurrent GUI Sessions to 10 for all Accounts"
      info        : "The information system _IS_ configured to limit the number of concurrent graphical user interface (GUI) sessions to a maximum of ten for all users.

Operating system management includes the ability to control the number of users and user sessions that utilize an operating system. Limiting the number of allowed users and sessions per user helps reduce the risks related to Denial-of-Service (DoS) attacks. This requirement addresses concurrent sessions for information system accounts and does not address concurrent sessions by single users via multiple system accounts. The maximum number of concurrent sessions should be defined based upon mission needs and the operational environment for each system."
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-53|AC-10,800-53r5|AC-10,CCE|CCE-85333-3,CCI|CCI-000054,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Enforce Approved Authorization for Logical Access"
      info        : "The information system _IS_ configured to enforce an approved authorization process before granting users logical access.

The inherent configuration of the macOS does not grant users logical access without authorization. Authorization is achieved on the macOS through permissions, which are controlled at many levels, from the Mach and BSD components of the kernel, through higher levels of the operating system and, for networked applications, through the networking protocols. Permissions can be granted at the level of directories, subdirectories, files or applications, or specific data within files or functions within applications.

link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Permissions/Permissions.html[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-53|AC-3,800-53r5|AC-3,CCE|CCE-85334-1,CCI|CCI-000213,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Mail App"
      info        : "The macOS built-in Mail.app _MUST_ be disabled.

The Mail.app contains functionality that can establish connections to Apple's iCloud, even when security controls to disable iCloud access have been put in place.

[IMPORTANT]
====
Some organizations allow the use of the built-in Mail.app for organizational communication. Information System Security Officers (ISSOs) may make the risk-based decision not to disable the macOS built-in Mail.app to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.
===="
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess.new:
  familyControlsEnabled:
    True
  pathBlackList:
    /Applications/Mail.app"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-20,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),CCE|CCE-85336-6,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002019,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -A 20 familyControlsEnabled | /usr/bin/grep -c \"/Applications/Mail.app\""
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Ensure the System Implements Malicious Code Protection Mechanisms"
      info        : "The inherent configuration of the macOS _IS_ in compliance as Apple has designed the system with three layers of protection against malware. Each layer of protection is comprised of one or more malicious code protection mechanisms, which are automatically implemented and which, collectively, meet the requirements of all applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance for malicious code prevention.

1. This  first layer of defense targets the distribution of malware; the aim is to prevent malware from ever launching.
The following mechanisms are inherent to the macOS design and constitute the first layer of protection against malicious code:
*	The Apple App Store: the safest way to add new applications to a Mac is by downloading them from the App Store; all apps available for download from the App Store have been reviewed for signs of tampering and signed by Apple to indicate that the app meets security requirements and does not contain malware.
*	XProtect: a built-in, signature-based, anti-virus, anti-malware technology inherent to all Macs. XProtect automatically detects and blocks the execution of known malware.
  *	In macOS 10.15 and all subsequent releases, XProtect checks for known malicious content when:
    *	an app is first launched,
    *	an app has been changed (in the file system), and
    *	XProtect signatures are updated.
*	YARA: another built-in tool (inherent to all Macs), which conducts signature-based detection of malware. Apple updates YARA rules regularly.
*	Gatekeeper: a security feature inherent to all Macs; Gatekeeper scans apps to detect malware and/or revocations of a developer's signing certificate and prevents unsafe apps from running.
*	Notarization: Apple performs regular, automated scans to detect signs of malicious content and to verify developer ID-signed software; when no issues are found, Apple notarizes the software and delivers the results of scans to the system owner.

2. The second layer of defense targets malware that manages to appear on a Mac before it runs; the aim is to quickly identify and block any malware present on a Mac in order to prevent the malware from running and further spreading.
The following mechanisms are inherent to the macOS design and constitute the second layer of protection against malicious code:
*	XProtect (defined above).
*	Gatekeeper (defined above).
*	Notarization (defined above).

3.  The third layer of defense targets infected Mac system(s); the aim is to remediate Macs on which malware has managed to successfully execute.
The following mechanism is inherent to the macOS design and constitutes the third layer of protection against malicious code:
*	Apple's Malware Removal Tool (MRT): a technology included on all macOS systems. MRT is an agent that remediates based on automatic updates delivered from Apple. MRT will remove the malware upon receiving updated information and check for malware on restart and login.

link:https://support.apple.com/guide/security/protecting-against-malware-sec469d47bd8/1/web/1[]

link:https://support.apple.com/guide/security/app-security-overview-sec35dd877d0/web[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53r5|SI-3,CCE|CCE-85468-7,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSF|DE.CM-4,CSF|DE.DP-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Managed Access Control Points"
      info        : "Route remote accesses through authorized and managed network access control points.

Organizations consider the Trusted Internet Connections (TIC) initiative requirements for external network connections since limiting the number of access control points for remote access reduces attack surfaces.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "The requirement is NA. No fix is required."
      reference   : "800-171|3.1.14,800-53|AC-17(3),800-53r5|AC-17(3),CCE|CCE-85477-8,CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(i),CSF|PR.AC-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17(3),NESA|T5.4.6,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Enrollment in Mobile Device Management"
      info        : "You _MUST_ enroll your Mac in a Mobile Device Management (MDM) software.

User Approved MDM (UAMDM) enrollment or enrollment via Apple Business Manager (ABM)/Apple School Manager (ASM) is required to manage certain security settings. Currently these include:

* Allowed Kernel Extensions
* Allowed Approved System Extensions
* Privacy Preferences Policy Control Payload
* ExtensibleSingleSignOn
* FDEFileVault

In macOS 11, UAMDM grants Supervised status on a Mac, unlocking the following MDM features, which were previously locked behind ABM:

* Activation Lock Bypass
* Access to Bootstrap Tokens
* Scheduling Software Updates
* Query list and delete local users"
      solution    : "Ensure that system is enrolled via UAMDM."
      reference   : "800-171|3.4.1,800-171|3.4.2,800-53|CM-2,800-53|CM-6,800-53r5|CM-2,800-53r5|CM-6,CCE|CCE-85338-2,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-2,ITSG-33|CM-6,NESA|T3.2.5,NESA|T7.5.1,NIAv2|SS16,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles status -type enrollment | /usr/bin/awk -F: '/MDM enrollment/ {print $2}' | /usr/bin/grep -c \"Yes (User Approved)\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Messages App"
      info        : "The macOS built-in Messages.app _MUST_ be disabled.

The Messages.app establishes a connection to Apple's iCloud service, even when security controls to disable iCloud access have been put in place."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess.new:
  familyControlsEnabled:
    True
  pathBlackList:
    /Applications/Messages.app"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-53|AC-20,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),CCE|CCE-85339-0,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002011,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -A 20 familyControlsEnabled | /usr/bin/grep -c \"/Applications/Messages.app\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System Log Files Owned by Root and Group to Wheel"
      info        : "The system log files _MUST_ be owned by root.

System logs contain sensitive data about the system and users. If log files are set to only be readable and writable by system administrators, the risk is mitigated."
      solution    : "[source,bash]
----
/usr/sbin/chown root:wheel $(/usr/bin/stat -f '%Su:%Sg:%N' $(/usr/bin/grep -v '^#' /etc/newsyslog.conf | /usr/bin/awk '{ print $1 }') 2> /dev/null | /usr/bin/awk -F\":\" '!/^root:wheel:/{print $3}')
----"
      reference   : "800-53|SI-11,800-53|SI-11b.,800-53r5|SI-11,800-53r5|SI-11b.,CCE|CCE-85469-5,CCI|CCI-001314,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11,ITSG-33|SI-11c.,STIG-ID|APPL-11-004001"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/stat -f '%Su:%Sg:%N' $(/usr/bin/grep -v '^#' /etc/newsyslog.conf | /usr/bin/awk '{ print $1 }') 2> /dev/null | /usr/bin/awk '!/^root:wheel:/{print $1}' | /usr/bin/wc -l | /usr/bin/tr -d ' '"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure System Log Files to Mode 640 or Less Permissive"
      info        : "The system logs _MUST_ be configured to be writable by root and readable only by the root user and group wheel. To achieve this, system log files _MUST_ be configured to mode 640 permissive or less; thereby preventing normal users from reading, modifying or deleting audit logs. System logs frequently contain sensitive information that could be used by an attacker. Setting the correct permissions mitigates this risk."
      solution    : "[source,bash]
----
/bin/chmod 640 $(/usr/bin/stat -f '%A:%N' $(/usr/bin/grep -v '^#' /etc/newsyslog.conf | /usr/bin/awk '{ print $1 }') 2> /dev/null | /usr/bin/awk '!/640/{print $1}' | awk -F\":\" '!/640/{print $2}')
----"
      reference   : "800-53|SI-11,800-53|SI-11b.,800-53r5|SI-11,800-53r5|SI-11b.,CCE|CCE-85470-3,CCI|CCI-001314,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11,ITSG-33|SI-11c.,STIG-ID|APPL-11-004002"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/stat -f '%A:%N' $(/usr/bin/grep -v '^#' /etc/newsyslog.conf | /usr/bin/awk '{ print $1 }') 2> /dev/null | /usr/bin/awk '!/640/{print $1}' | /usr/bin/wc -l | /usr/bin/tr -d ' '"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Network File System Service"
      info        : "Support for Network File Systems (NFS) services is non-essential and, therefore, _MUST_ be disabled."
      solution    : "[source,bash]
----
/bin/launchctl disable system/com.apple.nfsd
----
The system may need to be restarted for the update to take effect."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-17,800-53|CM-7a.,800-53r5|AC-3,800-53r5|AC-17,800-53r5|CM-7a.,CCE|CCE-85342-4,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(a),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|CM-7a.,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002003,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"com.apple.nfsd\" => true'"
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Configure the System for Nonlocal Maintenance"
      info        : "Nonlocal maintenance and diagnostic activities are those activities conducted by individuals communicating through a network, either an external network or an internal network.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "The requirement is NA. No fix is required."
      reference   : "800-171|3.7.5,800-53|MA-4,800-53r5|MA-4,CCE|CCE-85458-8,CSF|PR.MA-2,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|MA-4,NESA|T2.3.4,NESA|T5.4.4,QCSC-v1|5.2.2,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Non-Repudiation"
      info        : "Provide irrefutable evidence that an individual (or process acting on behalf of an individual) has performed organization-defined actions to be covered by non-repudiation.

Types of individual actions covered by non-repudiation include creating information, sending and receiving messages, and approving information. Non-repudiation protects against claims by authors of not having authored certain documents, senders of not having transmitted messages, receivers of not having received messages, and signatories of not having signed documents. Non-repudiation services can be used to determine if information originated from an individual or if an individual took specific actions (e.g., sending an email, signing a contract, approving a procurement request, or receiving specific information). Organizations obtain non-repudiation services by employing various techniques or mechanisms, including digital signatures and digital message receipts.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "The requirement is NA. No fix is required."
      reference   : "800-53|AU-10,800-53r5|AU-10,CCE|CCE-85481-0,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-10,NESA|T4.3.1,NESA|T7.3.3,QCSC-v1|8.2.1,QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Obscure Passwords"
      info        : "The information system _IS_ configured to obscure feedback of authentication information during the authentication process to protect the information from possible exploitation by unauthorized individuals.

The inherent configuration of a macOS uses NSSecureTextField for any text field that receives a password, which automatically obscures text which is entered.

link:https://developer.apple.com/documentation/appkit/nssecuretextfield[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.11,800-53|IA-5,800-53|IA-6,800-53r5|IA-5,800-53r5|IA-6,CCE|CCE-85349-9,CCI|CCI-000206,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,ITSG-33|IA-6,ITSG-33|IA-6a.,NESA|T5.2.3,NESA|T5.5.1,QCSC-v1|5.2.2,QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Parental Controls"
      info        : "Parental Controls _MUST_ be enabled.

Control of program execution is a mechanism used to prevent program execution of unauthorized programs, which is critical to maintaining a secure system baseline.

Parental Controls on the macOS consist of many different payloads, which are set individually depending on the type of control required. Enabling parental controls allows for further configuration of these restrictions."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess.new:
  familyControlsEnabled:
    True"
      reference   : "800-171|3.4.7,800-171|3.4.9,800-53|CM-7(2),800-53|CM-11(2),800-53r5|CM-7(2),800-53r5|CM-11(2),CCE|CCE-85350-7,CCI|CCI-001764,CCI|CCI-001812,CSF|DE.CM-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.2,ITSG-33|CM-7(2),NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'familyControlsEnabled = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Password Autofill"
      info        : "Password Autofill _MUST_ be disabled.

macOS allows users to save passwords and use the Password Autofill feature in Safari and compatible apps. To protect against malicious users gaining access to the system, this feature _MUST_ be disabled to prevent users from being prompted to save passwords in applications."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowPasswordAutoFill:
    False"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-171|3.5.1,800-171|3.5.2,800-53|CM-7,800-53|CM-7(1),800-53|IA-5,800-53|IA-5(13),800-53|IA-11,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|IA-5,800-53r5|IA-5(13),800-53r5|IA-11,CCE|CCE-85351-5,CSF|PR.AC-1,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|IA-5,NESA|T5.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowPasswordAutoFill = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Proximity Based Password Sharing Requests"
      info        : "Proximity based password sharing requests _MUST_ be disabled.

The default behavior of macOS is to allow users to request passwords from other known devices (macOS and iOS). This feature _MUST_ be disabled to prevent passwords from being shared."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowPasswordProximityRequests:
    False"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-53|IA-5,800-53r5|IA-5,CCE|CCE-85352-3,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowPasswordProximityRequests = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Password Sharing"
      info        : "Password Sharing _MUST_ be disabled.

The default behavior of macOS is to allow users to share a password over Airdrop between other macOS and iOS devices. This feature _MUST_ be disabled to prevent passwords from being shared."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowPasswordSharing:
    False"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-53|IA-5,800-53r5|IA-5,CCE|CCE-85353-1,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowPasswordSharing = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Display Policy Banner at Login Window"
      info        : "Displaying a standardized and approved use notification before granting access to the operating system ensures that users are provided with privacy and security notification verbiage that is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

System use notifications are required only for access via login interfaces with human users and are not required when such human interfaces do not exist.

The policy banner will show if a \"PolicyBanner.rtf\" or \"PolicyBanner.rtfd\" exists in the \"/Library/Security\" folder.
NOTE:
  The banner text of the document _MUST_ read:

  \"You are accessing a U.S. Government information system, which includes: 1) this computer, 2) this computer network, 3) all Government-furnished computers connected to this network, and 4) all Government-furnished devices and storage media attached to this network or to a computer on this network. You understand and consent to the following: you may access this information system for authorized use only; unauthorized use of the system is prohibited and subject to criminal and civil penalties; you have no reasonable expectation of privacy regarding any communication or data transiting or stored on this information system at any time and for any lawful Government purpose, the Government may monitor, intercept, audit, and search and seize any communication or data transiting or stored on this information system; and any communications or data transiting or stored on this information system may be disclosed or used for any lawful Government purpose. This information system may contain Controlled Unclassified Information (CUI) that is subject to safeguarding or dissemination controls in accordance with law, regulation, or Government-wide policy. Accessing and using this system indicates your understanding of this warning.\""
      solution    : "[source,bash]
----
bannerText=\"You are accessing a U.S. Government information system, which includes: 1) this computer, 2) this computer network, 3) all Government-furnished computers connected to this network, and 4) all Government-furnished devices and storage media attached to this network or to a computer on this network. You understand and consent to the following: you may access this information system for authorized use only; unauthorized use of the system is prohibited and subject to criminal and civil penalties; you have no reasonable expectation of privacy regarding any communication or data transiting or stored on this information system at any time and for any lawful Government purpose, the Government may monitor, intercept, audit, and search and seize any communication or data transiting or stored on this information system; and any communications or data transiting or stored on this information system may be disclosed or used for any lawful Government purpose. This information system may contain Controlled Unclassified Information (CUI) that is subject to safeguarding or dissemination controls in accordance with law, regulation, or Government-wide policy. Accessing and using this system indicates your understanding of this warning.\"
/bin/mkdir /Library/Security/PolicyBanner.rtf
/usr/bin/textutil -convert rtf -output /Library/Security/PolicyBanner.rtf/TXT.rtf -stdin <<EOF
$bannerText
EOF
----"
      reference   : "800-171|3.1.9,800-53|AC-8,800-53|AC-8a.,800-53|AC-8b.,800-53|AC-8c.1.,800-53|AC-8c.2.,800-53|AC-8c.3.,800-53r5|AC-8,800-53r5|AC-8a.,800-53r5|AC-8b.,800-53r5|AC-8c.1.,800-53r5|AC-8c.2.,800-53r5|AC-8c.3.,CCE|CCE-85355-6,CCI|CCI-000048,CCI|CCI-000050,CCI|CCI-001384,CCI|CCI-001385,CCI|CCI-001386,CCI|CCI-001387,CCI|CCI-001388,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-8,ITSG-33|AC-8a.,ITSG-33|AC-8b.,ITSG-33|AC-8c.a.,ITSG-33|AC-8c.b.,ITSG-33|AC-8c.c.,NESA|M1.3.6,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,NIAv2|AM10f,STIG-ID|APPL-11-000025,TBA-FIISB|45.2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/ls -ld /Library/Security/PolicyBanner.rtf* | /usr/bin/wc -l | /usr/bin/tr -d ' '"
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Configure the System to Block Non-Privileged Users from Executing Privileged Functions"
      info        : "The information system _IS_ configured to block standard users from executing privileged functions.

Privileged functions include disabling, circumventing, or altering implemented security safeguards and countermeasures.

The inherent configuration of the macOS does not allow for non-privileged users to be able to execute functions requiring privilege.

link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Introduction/Introduction.html[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.1.7,800-53|AC-6(10),800-53r5|AC-6(10),CCE|CCE-85360-6,CCI|CCI-002235,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Configure the System to Prevent the Unauthorized Disclosure of Data via Shared Resources"
      info        : "The information system _IS_ configured to ensure that the unauthorized disclosure of data does not occur when resources are shared.

The inherent configuration of the macOS does not allow for resources to be shared between users without authorization.

link:https://developer.apple.com/library/archive/documentation/Security/Conceptual/AuthenticationAndAuthorizationGuide/Permissions/Permissions.html[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.13.4,800-53|SC-4,800-53r5|SC-4,CCE|CCE-85361-4,CCI|CCI-001090,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-4,ITSG-33|SC-4a."
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Prohibit Remote Activation of Collaborative Computing Devices"
      info        : "The inherent configuration of the macOS _IS_ in partial compliance as Apple has implemented a green light physically next to your camera that will glow when the camera is activated.

There are no indicators when the system's microphone is listening or activated. This requires additional software to be installed.

The macOS has built into the system, the ability to grant or deny access to the camera and microphone which requires the application to have an entitlement to use the device.

link:https://support.apple.com/guide/mac-help/use-the-built-in-camera-mchlp2980/mac[]

link:https://support.apple.com/guide/mac-help/control-access-to-your-camera-mchlf6d108da/mac[]

link:https://support.apple.com/guide/mac-help/control-access-to-your-microphone-on-mac-mchla1b1e1fe/11.0/mac/11.0[]

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "The technology partially meets this requirement. An appropriate mitigation for the system must be implemented for full compliance."
      reference   : "800-171|3.13.12,800-53|SC-15,800-53r5|SC-15,CCE|CCE-85480-2,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-15,QCSC-v1|3.2,QCSC-v1|5.2.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Protect Against Denial of Service Attacks by Ensuring Rate-Limiting Measures on Network Interfaces"
      info        : "The macOS should be configured to prevent Denial of Service (DoS) attacks by enforcing rate-limiting measures on network interfaces.

DoS attacks leave authorized users unable to access information systems, devices, or other network resources due to the actions of a malicious cyber threat actor. When this occurs, the organization must operate at degraded capacity; often resulting in an inability to accomplish its mission.

To prevent DoS attacks by ensuring rate-limiting measures on network interfaces, many operating systems can be integrated with enterprise-level firewalls and networking equipment that meet or exceed this requirement.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-53|SC-5,800-53r5|SC-5,CCE|CCE-85363-0,CCI|CCI-002385,CSF|DE.CM-1,CSF|PR.DS-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5,ITSG-33|SC-5a.,NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Employ Automated Mechanisms for Account Management Functions"
      info        : "The organization should employ automated mechanisms to support the management of information system accounts.

The use of automated mechanisms prevents against human error and provide a faster and more efficient means of relaying time-sensitive information and account management.

To employ automated mechanisms for account management functions, many operating systems can be integrated with an enterprise-level directory service that meets or exceeds this requirement.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-171|3.1.1,800-53|AC-2(1),800-53r5|AC-2(1),CCE|CCE-85364-8,CCI|CCI-000015,CN-L3|7.1.3.2(d),CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(1),NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Require Devices to Reauthenticate when Changing Authenticators"
      info        : "The macOS should be configured to require users to reauthenticate when the device authenticator is changed.

Without reauthentication, users may access resources or perform tasks for which they are not authorization. When operating systems provide the capability to change device authenticators, it is critical the device reauthenticate.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-53|IA-11,800-53r5|IA-11,CCE|CCE-85366-3,CCI|CCI-002039,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Require users to reauthenticate when changing authenticators"
      info        : "Without reauthentication, users may access resources or perform tasks for which they do not have authorization. When operating systems provide the capability to change user authenticators, it is critical the user reauthenticate."
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-53|IA-11,800-53r5|IA-11,CCE|CCE-85368-9,CCI|CCI-002038,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Recovery Lock"
      info        : "A recovery lock password _MUST_ be enabled and set.

Single user mode, recovery mode, the Startup Manager, and several other tools are available on macOS by holding down specific key combinations during startup. Setting a recovery lock restricts access to these tools.

NOTE: Recovery lock passwords are not supported on Intel devices. This rule is only applicable to Apple Silicon devices.

NOTE: This feature was added in macOS Big Sur version 11.5."
      solution    : "NOTE: The SetRecoveryLock command can be used to set a Recovery Lock password."
      reference   : "800-171|3.1.5,800-53|AC-6,800-53r5|AC-6,CCE|CCE-85483-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-4,CSF|PR.DS-5,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/libexec/mdmclient QuerySecurityInfo | /usr/bin/grep -c \"IsRecoveryLockedEnabled = 1\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Removable Storage Devices"
      info        : "Removable media, such as USB connected external hard drives, thumb drives, and optical media, _MUST_ be disabled for users.

Disabling removable storage devices reduces the risks and known vulnerabilities of such devices (e.g., malicious code insertion)

[IMPORTANT]
====
Some organizations rely on the use of removable media for storing and sharing data. Information System Security Officers (ISSOs) may make the risk-based decision not to disable external hard drives to avoid losing this functionality, but they are advised to first fully weigh the potential risks posed to their organization.
===="
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.systemuiserver:
  mount-controls:
    harddisk-external
      alert
      eject"
      reference   : "800-171|3.8.7,800-171|3.8.8,800-53|MP-7,800-53r5|MP-7,800-53r5|MP-7(1),CCE|CCE-85370-5,CN-L3|8.5.4.1(c),CSF|PR.PT-2,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.8.3.1,ISO/IEC-27001|A.8.3.3,NESA|T1.4.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep 'harddisk-external' -A3 | /usr/bin/grep -Ec \"eject|alert\""
      expect      : "2"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Ensure all Federal Laws, Executive Orders, Directives, Policies, Regulations, Standards, and Guidance for Authentication to a Cryptographic Module are Met"
      info        : "The inherent configuration of the macOS _IS_ in compliance by implementing mechanisms for authentication to a cryptographic module that meet the requirements of all applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance for such authentication

macOS contains many open source projects that may use their own cryptographic libraries typically for the purposes of maintaining platform independence. These services are not covered by the Apple FIPS Validation of the CoreCrypto and CoreCrypto Kernel modules.

macOS Big Sur is in process of testing from an accredited laboratory to submit the National Institute of Standards and Technology (NIST) for FIPS validation.

link:https://csrc.nist.gov/Projects/cryptographic-module-validation-program/modules-in-process/IUT-List[]

link:https://support.apple.com/en-us/HT201159[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-53|IA-7,800-53r5|IA-7,CCE|CCE-85373-9,CCI|CCI-000803,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),ITSG-33|IA-7,ITSG-33|IA-7a.,NESA|M5.2.1,NESA|M5.2.6,NESA|M5.3.1,NESA|T7.4.1,QCSC-v1|13.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Root Login"
      info        : "To assure individual accountability and prevent unauthorized access, logging in as root at the login window _MUST_ be disabled.

The macOS system _MUST_ require individuals to be authenticated with an individual authenticator prior to using a group authenticator, and administrator users _MUST_ never log in directly as root."
      solution    : "[source,bash]
----
/usr/bin/dscl . -create /Users/root UserShell /usr/bin/false
----"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-53|IA-2,800-53|IA-2(5),800-53|IA-5,800-53r5|IA-2,800-53r5|IA-2(5),800-53r5|IA-5,CCE|CCE-85374-7,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2,ITSG-33|IA-2a.,ITSG-33|IA-2(5),ITSG-33|IA-2(5)(a),ITSG-33|IA-2(5)(b),ITSG-33|IA-5,NESA|T2.3.8,NESA|T5.2.3,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/dscl . -read /Users/root UserShell 2>&1 | /usr/bin/grep -c \"/usr/bin/false\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Screen Saver at Login Window"
      info        : "A default screen saver _MUST_ be configured to display at the login window and _MUST_ not display any sensitive information."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.screensaver:
  loginWindowModulePath:
    /System/Library/Screen Savers/Flurry.saver"
      reference   : "800-171|3.1.10,800-53|AC-11(1),800-53r5|AC-11(1),CCE|CCE-85375-4,CCI|CCI-000060,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11(1),NIAv2|AM23c,NIAv2|AM23d,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,STIG-ID|APPL-11-000006"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout  | /usr/bin/grep -c loginWindowModulePath"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Ensure Secure Boot Level Set to Full"
      info        : "The Secure Boot security setting _MUST_ be set to full.

Full security is the default Secure Boot setting in macOS. During startup, when Secure Boot is set to full security, the Mac will verify the integrity of the operating system before allowing the operating system to boot.

NOTE: This will only return a proper result on a T2 or Apple Silicon Macs."
      solution    : "NOTE: Boot into Recovery Mode and enable Full Secure Boot"
      reference   : "800-53|SI-6,800-53|SI-7,800-53|SI-7(1),800-53|SI-7(5),800-53r5|SI-6,800-53r5|SI-7,800-53r5|SI-7(1),800-53r5|SI-7(5),CCE|CCE-85376-2,CN-L3|7.1.3.5(b),CSF|PR.DS-6,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ITSG-33|SI-6,ITSG-33|SI-7,ITSG-33|SI-7a.,ITSG-33|SI-7(1),NESA|T3.4.1,NESA|T7.3.2,NESA|T7.3.3,PCI-DSSv3.2.1|10.5.5,QCSC-v1|3.2,SWIFT-CSCv1|6.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/libexec/mdmclient QuerySecurityInfo | /usr/bin/grep -c \"SecureBootLevel = full\""
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Secure Name Address Resolution Service"
      info        : "The information system requests and performs data origin authentication and data integrity verification on the name/address resolution responses the system receives from authoritative sources.

NOTE: macOS supports encrypted DNS settings with the com.apple.dnsSettings.managed payload, however, the system must be integrated with a DNS server that supports encrypted DNS. link:https://developer.apple.com/documentation/devicemanagement/dnssettings[]

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-53|SC-21,800-53r5|SC-21,CCE|CCE-85372-1,CCI|CCI-002465,CCI|CCI-002466,CCI|CCI-002467,CCI|CCI-002468,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-21,ITSG-33|SC-21a.,NESA|T4.5.1,QCSC-v1|5.2.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Configure the System to Separate User and System Functionality - separate"
      info        : "The information system _IS_ configured to separate user and system functionality.

Operating system management functionality includes functions necessary for administration and requires privileged user access. Allowing non-privileged users to access operating system management functionality capabilities increases the risk that non-privileged users may obtain elevated privileges. Operating system management functionality includes functions necessary to administer console, network components, workstations, or servers and typically requires privileged user access.

The inherent configuration of the macOS allows only privileged users to access operating system management functionalities.

link:https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/DesigningDaemons.html[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.7.5,800-171|3.13.3,800-53|MA-4(1),800-53|SC-2,800-53r5|MA-4(1),800-53r5|SC-2,CCE|CCE-85377-0,CCI|CCI-001082,CSF|PR.MA-2,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|MA-4(1),ITSG-33|SC-2,ITSG-33|SC-2a.,NESA|T2.3.4,NESA|T3.4.1,NIAv2|SS15b,QCSC-v1|5.2.2,SWIFT-CSCv1|6.4,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Ensure System Integrity Protection is Enabled"
      info        : "System Integrity Protection (SIP) _MUST_ be enabled.

SIP is vital to protecting the integrity of the system as it prevents malicious users and software from making unauthorized and/or unintended modifications to protected files and folders; ensures the presence of an audit record generation capability for defined auditable events for all operating system components; protects audit tools from unauthorized access, modification, and deletion; restricts the root user account and limits the actions that the root user can perform on protected parts of the macOS; and prevents non-privileged users from granting other users direct access to the contents of their home directories and folders.

NOTE: SIP is enabled by default in macOS."
      solution    : "[source,bash]
----
/usr/bin/csrutil enable
----
NOTE: To reenable \"System Integrity Protection\", boot the affected system into \"Recovery\" mode, launch \"Terminal\" from the \"Utilities\" menu, and run the command."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-171|3.3.8,800-171|3.4.5,800-171|3.13.4,800-171|3.14.1,800-53|AC-3,800-53|AU-6(4),800-53|AU-7,800-53|AU-7a.,800-53|AU-7b.,800-53|AU-7(1),800-53|AU-9,800-53|AU-9(3),800-53|AU-12a.,800-53|CM-5,800-53|CM-5(6),800-53|SC-4,800-53|SI-2,800-53|SI-7,800-53r5|AC-3,800-53r5|AU-6(4),800-53r5|AU-7,800-53r5|AU-7a.,800-53r5|AU-7b.,800-53r5|AU-7(1),800-53r5|AU-9,800-53r5|AU-9(3),800-53r5|AU-12a.,800-53r5|CM-5,800-53r5|CM-5(6),800-53r5|SC-4,800-53r5|SI-2,800-53r5|SI-7,CCE|CCE-85378-8,CCI|CCI-000154,CCI|CCI-000158,CCI|CCI-000169,CCI|CCI-001493,CCI|CCI-001494,CCI|CCI-001495,CCI|CCI-001499,CCI|CCI-001875,CCI|CCI-001876,CCI|CCI-001877,CCI|CCI-001878,CCI|CCI-001879,CCI|CCI-001880,CCI|CCI-001881,CCI|CCI-001882,CN-L3|7.1.2.3(c),CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.2(f),CN-L3|8.1.4.3(c),CN-L3|8.1.4.3(d),CN-L3|8.1.4.4(e),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|DE.DP-4,CSF|ID.RA-1,CSF|PR.AC-4,CSF|PR.DS-6,CSF|PR.IP-1,CSF|PR.IP-12,CSF|PR.PT-1,CSF|PR.PT-3,CSF|RS.AN-1,CSF|RS.AN-3,CSF|RS.CO-2,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.12.4.2,ITSG-33|AC-3,ITSG-33|AU-6(4),ITSG-33|AU-7,ITSG-33|AU-7(1),ITSG-33|AU-9,ITSG-33|AU-9(3),ITSG-33|AU-12a.,ITSG-33|CM-5,ITSG-33|CM-5(6),ITSG-33|SC-4,ITSG-33|SC-4a.,ITSG-33|SI-2,ITSG-33|SI-7,ITSG-33|SI-7a.,NESA|M5.2.3,NESA|M5.2.5,NESA|M5.5.2,NESA|T3.2.3,NESA|T3.4.1,NESA|T3.6.3,NESA|T3.6.4,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.3.2,NESA|T7.3.3,NESA|T7.5.1,NESA|T7.5.2,NESA|T7.5.3,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.7.1,NESA|T8.2.9,NIAv2|AM3,NIAv2|PR9,NIAv2|SM5,NIAv2|SM6,NIAv2|SS29,PCI-DSSv3.2.1|6.2,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv3.2.1|10.5.5,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,PCI-DSSv4.0|10.3.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,STIG-ID|APPL-11-005001,SWIFT-CSCv1|2.2,SWIFT-CSCv1|6.4,TBA-FIISB|31.1,TBA-FIISB|37.3.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/csrutil status | /usr/bin/grep -c 'System Integrity Protection status: enabled.'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Siri Setup during Setup Assistant"
      info        : "The prompt for Siri during Setup Assistant _MUST_ be disabled.

Organizations _MUST_ apply organization-wide configuration settings. The macOS Siri Assistant Setup prompt guides new users through enabling their own specific Siri settings; this is not essential and, therefore, _MUST_ be disabled to prevent against the risk of individuals electing Siri settings with the potential to override organization-wide settings."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.SetupAssistant.managed:
  SkipSiriSetup:
    True"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-53|AC-20,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),CCE|CCE-85379-6,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.2,STIG-ID|APPL-11-002039,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'SkipSiriSetup = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Limit SSH to FIPS 140 Validated Ciphers"
      info        : "SSH _MUST_ be configured to limit the ciphers to algorithms that are FIPS 140 validated.

FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules utilize authentication that meet federal requirements.

Operating systems utilizing encryption _MUST_ use FIPS validated mechanisms for authenticating to cryptographic modules.

NOTE: /etc/ssh/ssh_config will be automatically modified to its original state following any update or major upgrade to the operating system."
      solution    : "[source,bash]
----
/usr/bin/grep -q '^Ciphers' /etc/ssh/ssh_config && /usr/bin/sed -i.bak  's/.^Ciphers.*/Ciphers aes256-ctr,aes192-ctr,aes128-ctr/' /etc/ssh/ssh_config || /bin/echo 'Ciphers aes256-ctr,aes192-ctr,aes128-ctr' >> /etc/ssh/ssh_config
----"
      reference   : "800-171|3.1.13,800-171|3.13.8,800-171|3.13.11,800-53|AC-17(2),800-53|IA-7,800-53|SC-8(1),800-53|SC-13,800-53r5|AC-17(2),800-53r5|IA-7,800-53r5|SC-8(1),800-53r5|SC-13,CCE|CCE-85382-0,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|IA-7,ITSG-33|IA-7a.,ITSG-33|SC-8(1),ITSG-33|SC-13,ITSG-33|SC-13a.,NESA|M5.2.1,NESA|M5.2.6,NESA|M5.3.1,NESA|T5.4.2,NESA|T7.4.1,NIAv2|AM37,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5d,NIAv2|NS5e,NIAv2|NS6b,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,TBA-FIISB|29.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -c \"^Ciphers aes256-ctr,aes192-ctr,aes128-ctr\" /etc/ssh/ssh_config"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Limit SSH to FIPS 140 Validated Message Authentication Code Algorithms"
      info        : "SSH _MUST_ be configured to limit the Message Authentication Codes (MACs) to algorithms that are FIPS 140 validated.

FIPS 140-2 is the current standard for validating that mechanisms used to access cryptographic modules utilize authentication that meets federal requirements.

Operating systems utilizing encryption _MUST_ use FIPS validated mechanisms for authenticating to cryptographic modules.

NOTE: /etc/ssh/ssh_config will be automatically modified to its original state following any update or major upgrade to the operating system."
      solution    : "[source,bash]
----
/usr/bin/grep -q '^MACs' /etc/ssh/ssh_config && /usr/bin/sed -i.bak  's/.*MACs.*/MACs hmac-sha2-256,hmac-sha2-512/' /etc/ssh/ssh_config || /bin/echo 'MACs hmac-sha2-256,hmac-sha2-512' >> /etc/ssh/ssh_config
----"
      reference   : "800-171|3.1.13,800-171|3.1.18,800-171|3.7.5,800-171|3.13.8,800-171|3.13.11,800-53|AC-17(2),800-53|AC-19b.,800-53|IA-7,800-53|MA-4(6),800-53|SC-8(1),800-53|SC-13,800-53r5|AC-17(2),800-53r5|AC-19b.,800-53r5|IA-7,800-53r5|MA-4(6),800-53r5|SC-8(1),800-53r5|SC-13,CCE|CCE-85383-8,CCI|CCI-000068,CCI|CCI-000087,CCI|CCI-000803,CCI|CCI-002890,CCI|CCI-003123,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.MA-2,CSF|PR.PT-4,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),HIPAA|164.312(e)(2)(ii),ISO/IEC-27001|A.6.2.1,ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|AC-19b.,ITSG-33|IA-7,ITSG-33|IA-7a.,ITSG-33|MA-4(6),ITSG-33|SC-8(1),ITSG-33|SC-13,ITSG-33|SC-13a.,NESA|M5.2.1,NESA|M5.2.6,NESA|M5.3.1,NESA|T2.3.4,NESA|T5.1.1,NESA|T5.4.2,NESA|T5.4.3,NESA|T5.4.4,NESA|T5.7.1,NESA|T7.4.1,NIAv2|AM37,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5d,NIAv2|NS5e,NIAv2|NS6b,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,STIG-ID|APPL-11-000055,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,TBA-FIISB|29.1,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -c \"^MACs hmac-sha2-256,hmac-sha2-512\" /etc/ssh/ssh_config"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Set SSH Active Server Alive Maximum to Zero"
      info        : "SSH _MUST_ be configured with an Active Server Alive Maximum Count set to zero. Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session or an incomplete login attempt will also free up resources committed by the managed network element.

NOTE: /etc/ssh/ssh_config will be automatically modified to its original state following any update or major upgrade to the operating system."
      solution    : "[source,bash]
----
/usr/bin/grep -q '^ServerAliveCountMax' /etc/ssh/ssh_config && /usr/bin/sed -i.bak  's/.*ServerAliveCountMax.*/ServerAliveCountMax 0/' /etc/ssh/ssh_config || /bin/echo 'ServerAliveCountMax 0' >> /etc/ssh/ssh_config
----"
      reference   : "800-171|3.13.9,800-53|SC-10,800-53r5|SC-10,CCE|CCE-85380-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-10,ITSG-33|SC-10a.,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,SWIFT-CSCv1|2.6"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -c \"^ServerAliveCountMax 0\" /etc/ssh/ssh_config"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure SSH ServerAliveInterval option set to 900 or less"
      info        : "SSH _MUST_ be configured with an Active Server Alive Maximum Count set to 900 or less.

Setting the Active Server Alive Maximum Count to 900 (second) will log users out after a 15-minute interval of inactivity.

NOTE: /etc/ssh/ssh_config will be automatically modified to its original state following any update or major upgrade to the operating system."
      solution    : "[source,bash]
----
/usr/bin/grep -q '^ServerAliveInterval' /etc/ssh/ssh_config && /usr/bin/sed -i.bak  's/.*ServerAliveInterval.*/ServerAliveInterval 900/' /etc/ssh/ssh_config || /bin/echo 'ServerAliveInterval 900' >> /etc/ssh/ssh_config
----"
      reference   : "800-171|3.1.11,800-171|3.13.9,800-53|AC-12,800-53|SC-10,800-53r5|AC-12,800-53r5|SC-10,CCE|CCE-85381-2,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,ITSG-33|SC-10,ITSG-33|SC-10a.,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,NIAv2|NS49,SWIFT-CSCv1|2.6"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -c \"^ServerAliveInterval 900\" /etc/ssh/ssh_config"
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Encrypt Stored Passwords"
      info        : "The information system _IS_ configured to encrypt stored passwords.

Passwords need to be protected at all times, and encryption is the standard method for protecting passwords. If passwords are not encrypted, they can be plainly read (i.e., clear text) and easily compromised.

link:https://developer.apple.com/documentation/opendirectory/kodattributetypeauthenticationauthority[]"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5(1),800-53|IA-5(1)(c),800-53r5|IA-5(1),800-53r5|IA-5(1)(c),CCE|CCE-85386-1,CCI|CCI-000196,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(1),ITSG-33|IA-5(1)(c),NESA|T5.2.3,NIAv2|CY6,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|26.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Sudoers to Authenticate Users on a Per -tty Basis"
      info        : "The file /etc/sudoers _MUST_ be configured to include tty_tickets.

This rule ensures that the \"sudo\" command will prompt for the administrator's password at least once in each newly opened terminal window. This prevents a malicious user from taking advantage of an unlocked computer or an abandoned logon session by bypassing the normal password prompt requirement. Without the \"tty_tickets\" option, all open local and remote logon sessions would be authenticated to use sudo without a password for the duration of the configured password timeout window."
      solution    : "[source,bash]
----
/bin/cp /etc/sudoers /etc/sudoers.bk; /bin/echo \"Defaults tty_tickets\" >> /etc/sudoers
----"
      reference   : "800-171|3.4.2,800-171|3.4.5,800-53|CM-5(1),800-53|CM-6b.,800-53|IA-11,800-53r5|CM-5(1),800-53r5|CM-6b.,800-53r5|IA-11,CCE|CCE-85387-9,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.AC-1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),ITSG-33|CM-5(1),ITSG-33|CM-6b.,NESA|T3.2.1,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,QCSC-v1|7.2,QCSC-v1|13.2,STIG-ID|APPL-11-004021,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/grep -Ec \"^Defaults tty_tickets\" /etc/sudoers"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Ensure System Volume is Read Only"
      info        : "The System volume _MUST_ be mounted as read-only in order to ensure that configurations critical to the integrity of the macOS have not been compromised. System Integrity Protection (SIP) will prevent the system volume from being mounted as writable.

NOTE: The system volume is read only by default in macOS."
      solution    : "NOTE: To remount the System volume as Read Only, rebooting the computer will mount it as Read Only."
      reference   : "800-171|3.7.5,800-53|MA-4(1),800-53|SC-34,800-53|SI-7,800-53r5|MA-4(1),800-53r5|SC-34,800-53r5|SI-7,CCE|CCE-85388-7,CSF|PR.DS-6,CSF|PR.MA-2,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ITSG-33|MA-4(1),ITSG-33|SC-34,ITSG-33|SI-7,ITSG-33|SI-7a.,NESA|T2.3.4,NESA|T3.4.1,NESA|T7.3.2,NESA|T7.3.3,PCI-DSSv3.2.1|10.5.5,QCSC-v1|3.2,QCSC-v1|5.2.2,SWIFT-CSCv1|6.4,TBA-FIISB|45.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/sbin/system_profiler SPStorageDataType | /usr/bin/awk '/Mount Point: \\/$/{x=NR+2}(NR==x){print $2}'"
      expect      : "No"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Trivial File Tansfer Protocol Service"
      info        : "If the system does not require Trivial File Tansfer Protocol (TFTP), support it is non-essential and _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities. Disabling TFTP helps prevent the unauthorized connection of devices and the unauthorized transfer of information.

NOTE: TFTP service is disabled at startup by default macOS."
      solution    : "[source,bash]
----
/bin/launchctl disable system/com.apple.tftpd
----
The system may need to be restarted for the update to take effect."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.5.2,800-171|3.5.10,800-53|AC-3,800-53|AC-17,800-53|IA-5(1),800-53|IA-5(1)(c),800-53r5|AC-3,800-53r5|AC-17,800-53r5|IA-5(1),800-53r5|IA-5(1)(c),CCE|CCE-85391-1,CCI|CCI-000197,CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(c),NESA|T4.2.1,NESA|T5.2.3,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|CY6,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002038,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|26.1,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"com.apple.tftpd\" => true'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Time Synchronization Daemon"
      info        : "The macOS time synchronization daemon (timed) _MUST_ be enabled for proper time synchronization to an authorized time server.

NOTE: The time synchronization daemon is enabled by default on macOS."
      solution    : "[source,bash]
----
/bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.timed.plist
----"
      reference   : "800-171|3.3.1,800-171|3.3.7,800-53|AU-8(1)(a),800-53|AU-8(1)(b),800-53|AU-12(1),800-53r5|AU-8(1),800-53r5|AU-12(1),800-53r5|SC-45(1),CCE|CCE-85392-9,CCI|CCI-001891,CCI|CCI-002046,CN-L3|8.1.4.3(b),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),ITSG-33|AU-12(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.4,PCI-DSSv3.2.1|10.4.1,PCI-DSSv3.2.1|10.4.3,PCI-DSSv4.0|10.6,PCI-DSSv4.0|10.6.1,PCI-DSSv4.0|10.6.2,PCI-DSSv4.0|10.6.3,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-000014,SWIFT-CSCv1|6.4,TBA-FIISB|37.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl list | /usr/bin/grep -c com.apple.timed"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable TouchID Prompt during Setup Assistant"
      info        : "The prompt for TouchID during Setup Assistant _MUST_ be disabled.

macOS prompts new users through enabling TouchID during Setup Assistant; this is not essential and, therefore, _MUST_ be disabled to prevent against the risk of individuals electing to enable TouchID to override organization-wide settings."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.SetupAssistant.managed:
  SkipTouchIDSetup:
    True"
      reference   : "800-171|3.4.1,800-171|3.4.2,800-53|CM-6,800-53r5|CM-6,CCE|CCE-85393-7,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'SkipTouchIDSetup = 1'"
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Uniquely Identify Users and Processes"
      info        : "The macOS is a UNIX 03-compliant operating system. The system uniquely identifies and authenticates organizational users or processes."
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.5.1,800-171|3.5.5,800-171|3.5.6,800-53|IA-2,800-53|IA-4,800-53r5|IA-2,800-53r5|IA-4,CCE|CCE-85394-5,CCI|CCI-000764,CN-L3|7.1.2.7(b),CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2,ITSG-33|IA-2a.,ITSG-33|IA-4,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|5,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Login to Other User's Active and Locked Sessions"
      info        : "The ability to log in to another user's active or locked session _MUST_ be disabled.

macOS has a privilege that can be granted to any user that will allow that user to unlock active user's sessions. Disabling the admins and/or user's ability to log into another user's active andlocked session prevents unauthorized persons from viewing potentially sensitive and/or personal information."
      solution    : "[source,bash]
----
/usr/bin/security authorizationdb write system.login.screensaver \"use-login-window-ui\"
----"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-53|IA-2,800-53|IA-2(5),800-53r5|IA-2,800-53r5|IA-2(5),CCE|CCE-85395-2,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2,ITSG-33|IA-2a.,ITSG-33|IA-2(5),ITSG-33|IA-2(5)(a),ITSG-33|IA-2(5)(b),NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/security authorizationdb read system.login.screensaver 2>&1 | /usr/bin/grep -c 'use-login-window-ui'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Unix-to-Unix Copy Protocol Service"
      info        : "The system _MUST_ not have the Unix-to-Unix Copy Protocol (UUCP) service active.

UUCP, a set of programs that enable the sending of files between different UNIX systems as well as sending commands to be executed on another system, is not essential and _MUST_ be disabled in order to prevent the unauthorized connection of devices, transfer of information, and tunneling.

NOTE: UUCP service is disabled at startup by default macOS."
      solution    : "[source,bash]
----
/bin/launchctl disable system/com.apple.uucp
----
The system may need to be restarted for the update to take effect."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-17,800-53|CM-7a.,800-53r5|AC-3,800-53r5|AC-17,800-53r5|CM-7a.,CCE|CCE-85397-8,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(a),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|CM-7a.,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002006,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"com.apple.uucp\" => true'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Restrict Maximum Password Lifetime to 60 Days"
      info        : "The macOS _MUST_ be configured to enforce a maximum password lifetime limit of at least 60 days.

This rule ensures that users are forced to change their passwords frequently enough to prevent malicious users from gaining and maintaining access to the system.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  maxPINAgeInDays:
    60"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53|IA-5(1)(d),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|IA-5(1)(d),CCE|CCE-85400-0,CCI|CCI-000199,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(d),NESA|T5.2.3,NIAv2|AM20,NIAv2|AM21,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003008,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/awk -F \" = \" '/maxPINAgeInDays/{sub(/;.*/,\"\");print $2}'"
      expect      : "60"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Accounts after 35 Days of Inactivity"
      info        : "The macOS _MUST_ be configured to disable accounts after 35 days of inactivity.

This rule prevents malicious users from making use of unused accounts to gain access to the system while avoiding detection."
      solution    : "This setting may be enforced using local policy or by a directory service.

To set local policy to disable an inactive user after 35 days, edit the current password policy to contain the following <dict> within the \"policyCategoryAuthentication\":

[source,xml]
----
<dict>
<key>policyContent</key>
<string>policyAttributeLastAuthenticationTime &gt; policyAttributeCurrentTime - (policyAttributeInactiveDays * 24 * 60 * 60)</string>
<key>policyIdentifier</key>
<string>Inactive Account</string>
<key>policyParameters</key>
<dict>
<key>policyAttributeInactiveDays<key>
<integer>35</integer>
</dict>
</dict>
----
After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the path to the file in place of \"$pwpolicy_file\".

[source,bash]
----
/usr/bin/pwpolicy setaccountpolicies $pwpolicy_file
----
NOTE: See the password policy supplemental on more information on how to implement password policies on macOS."
      reference   : "800-171|3.1.1,800-171|3.5.5,800-171|3.5.6,800-53|AC-2(3),800-53|IA-4,800-53|IA-4e.,800-53r5|AC-2(3),800-53r5|IA-4,800-53r5|IA-4e.,CCE|CCE-85401-8,CCI|CCI-000795,CN-L3|7.1.2.7(b),CN-L3|7.1.3.2(e),CN-L3|8.1.4.2(c),CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.2.1,ISO/IEC-27001|A.9.2.6,ITSG-33|AC-2(3),ITSG-33|IA-4,ITSG-33|IA-4e.,NIAv2|AM26,PCI-DSSv3.2.1|8.1.4,PCI-DSSv4.0|8.2.6,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,SWIFT-CSCv1|5,TBA-FIISB|36.2.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/pwpolicy getaccountpolicies | /usr/bin/grep -v \"Getting global account policies\" | /usr/bin/xmllint --xpath '/plist/dict/array/dict/dict[key=\"policyAttributeInactiveDays\"]/integer' - | /usr/bin/awk -F '[<>]' '{print $3}'"
      expect      : "35"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Limit Consecutive Failed Login Attempts to Three"
      info        : "The macOS _MUST_ be configured to limit the number of failed login attempts to a maximum of three. When the maximum number of failed attempts is reached, the account _MUST_ be locked for a period of time after.

This rule protects against malicious users attempting to gain access to the system via brute-force hacking methods."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  maxFailedAttempts:
    3"
      reference   : "800-171|3.1.8,800-53|AC-7,800-53|AC-7b.,800-53r5|AC-7,800-53r5|AC-7b.,CCE|CCE-85402-6,CCI|CCI-002238,CN-L3|7.1.2.7(f),CN-L3|7.1.3.1(c),CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-7,ITSG-33|AC-7b.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.7,PCI-DSSv4.0|8.3.4,STIG-ID|APPL-11-000022,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'maxFailedAttempts = 3'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Set Account Lockout Time to 15 Minutes"
      info        : "The macOS _MUST_ be configured to enforce a lockout time period of at least 15 minutes when the maximum number of failed logon attempts is reached.

This rule protects against malicious users attempting to gain access to the system via brute-force hacking methods."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  minutesUntilFailedLoginReset:
    15"
      reference   : "800-171|3.1.8,800-53|AC-7,800-53|AC-7b.,800-53r5|AC-7,800-53r5|AC-7b.,CCE|CCE-85403-4,CCI|CCI-002238,CN-L3|7.1.2.7(f),CN-L3|7.1.3.1(c),CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-7,ITSG-33|AC-7b.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.7,PCI-DSSv4.0|8.3.4,STIG-ID|APPL-11-000022,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'minutesUntilFailedLoginReset = 15'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Require Passwords Contain a Minimum of One Numeric Character"
      info        : "The macOS _MUST_ be configured to require at least one numeric character be used when a password is created.

This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  requireAlphanumeric:
    True"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53|IA-5(1)(a),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|IA-5(1)(a),CCE|CCE-85404-2,CCI|CCI-000194,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003007,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c \"requireAlphanumeric = 1;\""
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Automatically Remove or Disable Emergency Accounts within 72 Hours"
      info        : "The macOS is able to be configured to automatically remove or disable emergency accounts within 72 hours or less.

Emergency administrator accounts are privileged accounts established in response to crisis situations where the need for rapid account activation is required. Therefore, emergency account activation may bypass normal account authorization processes. If these accounts are disabled, system maintenance during emergencies may not be possible, thus adversely affecting system availability.

Although the ability to create and use emergency administrator accounts is necessary for performing system maintenance during emergencies, these accounts present vulnerabilities to the system if they are not disabled and removed when they are no longer needed. Configuring the macOS to automatically remove or disable emergency accounts within 72 hours of creation mitigates the risks posed if one were to be created and accidentally left active once the crisis is resolved.

Emergency administrator accounts are different from infrequently used accounts (i.e., local logon accounts used by system administrators when network or normal logon is not available). Infrequently used accounts also remain available and are not subject to automatic termination dates. However, an emergency administrator account is normally a different account created for use by vendors or system maintainers.

To address access requirements, many operating systems can be integrated with enterprise-level authentication/access mechanisms that meet or exceed access control policy requirements."
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.1.1,800-53|AC-2(2),800-53r5|AC-2(2),CCE|CCE-85405-9,CN-L3|7.1.3.2(e),CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(2),NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"PASSED">
      description : "Big Sur - Force Password Change at Next Logon"
      info        : "The macOS is able to be configured to force users to change their password at next logon.

Temporary passwords are often used for new users when accounts are created. However, once logged in to the system, users must be immediately prompted to change to a permanent password of their creation.

For a user to change their password at next logon, run the following command:
[source,bash]
----
/usr/bin/pwpolicy -u [USER] -setpolicy \"newPasswordRequired=1\"
----
NOTE: Replace [USER] with the username that must change the password at next logon"
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53|IA-5(1)(f),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|IA-5(1)(f),CCE|CCE-85406-7,CCI|CCI-002041,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,ITSG-33|IA-5(1),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.6"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Prohibit Password Reuse for a Minimum of Five Generations"
      info        : "The macOS _MUST_ be configured to enforce a password history of at least five previous passwords when a password is created.

This rule ensures that users are  not allowed to re-use a password that was used in any of the five previous password generations.

Limiting password reuse protects against malicious users attempting to gain access to the system via brute-force hacking methods.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  pinHistory:
    5"
      reference   : "800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5(1),800-53|IA-5(1)(e),800-53r5|IA-5(1),800-53r5|IA-5(1)(e),CCE|CCE-85407-5,CCI|CCI-000200,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(e),NESA|T5.2.3,NIAv2|AM22c,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003009,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/awk '/pinHistory/{sub(/;.*/,\"\");print $3}'"
      expect      : "5"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Require Passwords Contain a Minimum of One Lowercase Character"
      info        : "The macOS _MUST_ be configured to require at least one lower-case character be used when a password is created.

This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This setting may be enforced using local policy or by a directory service.

To set local policy to require at least 1 lowercase letter, edit the current password policy to contain the following <dict> within the \"policyCategoryPasswordContent\":

[source,xml]
----
<dict>
<key>policyContent</key>
<string>policyAttributePassword matches &apos;(.*[a-z].*){1,}+&apos;</string>
<key>policyIdentifier</key>
<string>Must have at least 1 lowercase letter</string>
<key>policyParameters</key>
<dict>
<key>minimumAlphaCharactersLowerCase</key>
<integer>1</integer>
</dict>
</dict>
----
After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the path to the file in place of \"$pwpolicy_file\".

[source,bash]
----
/usr/bin/pwpolicy setaccountpolicies $pwpolicy_file
----
NOTE: See the password policy supplemental on more information on how to implement password policies on macOS."
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53|IA-5(1)(a),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|IA-5(1)(a),CCE|CCE-85408-3,CCI|CCI-000193,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/pwpolicy getaccountpolicies | /usr/bin/grep -v \"Getting global account policies\" | /usr/bin/xmllint --xpath '/plist/dict/array/dict/dict[key=\"minimumAlphaCharactersLowerCase\"]/integer' - | /usr/bin/awk -F '[<>]' '{print $3}'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Require a Minimum Password Length of 15 Characters"
      info        : "The macOS _MUST_ be configured to require a minimum of 15 characters be used when a password is created.

This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  minLength:
    15"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53|IA-5(1)(a),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|IA-5(1)(a),CCE|CCE-85409-1,CCI|CCI-000205,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003010,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'minLength = 15'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Set Minimum Password Lifetime to 24 Hours"
      info        : "The macOS _MUST_ be configured to enforce a minimum password lifetime limit of 24 hours.

This rule discourages users from cycling through their previous passwords to get back to a preferred one.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This setting may be enforced using local policy or by a directory service.

To set local policy to require a minimum password lifetime, edit the current password policy to contain the following <dict> within the \"policyCategoryPasswordContent\":

[source,xml]
----
<dict>
<key>policyContent</key>
<string>policyAttributeLastPasswordChangeTime &lt; policyAttributeCurrentTime - (policyAttributeMinimumLifetimeHours * 60 * 60)</string>
<key>policyIdentifier</key>
<string>Minimum Password Lifetime</string>
<key>policyParameters</key>
<dict>
<key>policyAttributeMinimumLifetimeHours</key>
<integer>24</integer>
</dict>
</dict>
----
After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the path to the file in place of \"$pwpolicy_file\".

[source,bash]
----
/usr/bin/pwpolicy setaccountpolicies $pwpolicy_file
----
NOTE: See the password policy supplemental on more information on how to implement password policies on macOS."
      reference   : "800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53r5|IA-5,800-53r5|IA-5(1),CCE|CCE-85410-9,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,ITSG-33|IA-5(1),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/pwpolicy getaccountpolicies | /usr/bin/grep -v \"Getting global account policies\" | /usr/bin/xmllint --xpath '/plist/dict/array/dict/dict[key=\"policyAttributeMinimumLifetimeHours\"]/integer' - | /usr/bin/awk -F '[<>]' '{print $3}'"
      expect      : "24"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Prohibit Repeating, Ascending, and Descending Character Sequences"
      info        : "The macOS _MUST_ be configured to prohibit the use of repeating, ascending, and descending character sequences when a password is created.

This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  allowSimple:
    False"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53r5|IA-5,800-53r5|IA-5(1),CCE|CCE-85412-5,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,ITSG-33|IA-5(1),NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowSimple = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Require Passwords Contain a Minimum of One Special Character"
      info        : "The macOS _MUST_ be configured to require at least one special character be used when a password is created.

Special characters are those characters that are not alphanumeric. Examples include: ~ ! @ # $ % ^ *.

This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.mobiledevice.passwordpolicy:
  minComplexChars:
    1"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53|IA-5(1)(a),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|IA-5(1)(a),CCE|CCE-85413-3,CCI|CCI-001619,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-003011,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/awk '/minComplexChars/{sub(/;.*/,\"\");print $3}'"
      expect      : "1"
    </custom_item>

    <report type:"PASSED">
      description : "Big Sur - Automatically Remove or Disable Temporary User Accounts within 72 Hours"
      info        : "The macOS is able to be configured to set an automated termination for 72 hours or less for all temporary accounts upon account creation.

If temporary user accounts remain active when no longer needed or for an excessive period, these accounts may be targeted by attackers to gain unauthorized access. To mitigate this risk, automated termination of all temporary accounts _MUST_ be set to 72 hours (or less) when the temporary account is created.

If no policy is enforced by a directory service, a password policy can be set with the \"pwpolicy\" utility. The variable names may vary depending on how the policy was set.

If there are no temporary accounts defined on the system, this is Not Applicable."
      solution    : "The technology inherently meets this requirement. No fix is required."
      reference   : "800-171|3.1.1,800-53|AC-2(2),800-53r5|AC-2(2),CCE|CCE-85414-1,CN-L3|7.1.3.2(e),CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(2),NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Automatically Remove or Disable Temporary or Emergency User Accounts within 72 Hours"
      info        : "The macOS is able to be configured to set an automated termination for 72 hours or less for all temporary or emergency accounts upon account creation.

Emergency administrator accounts are privileged accounts established in response to crisis situations where the need for rapid account activation is required. Therefore, emergency account activation may bypass normal account authorization processes. If these accounts are disabled, system maintenance during emergencies may not be possible, thus adversely affecting system availability.

Although the ability to create and use emergency administrator accounts is necessary for performing system maintenance during emergencies, these accounts present vulnerabilities to the system if they are not disabled and removed when they are no longer needed. Configuring the macOS to automatically remove or disable emergency accounts within 72 hours of creation mitigates the risks posed if one were to be created and accidentally left active once the crisis is resolved.

Emergency administrator accounts are different from infrequently used accounts (i.e., local logon accounts used by system administrators when network or normal logon is not available). Infrequently used accounts also remain available and are not subject to automatic termination dates. However, an emergency administrator account is normally a different account created for use by vendors or system maintainers.

To address access requirements, many operating systems can be integrated with enterprise-level authentication/access mechanisms that meet or exceed access control policy requirements.

If temporary or emergency user accounts remain active when no longer needed or for an excessive period, these accounts may be targeted by attackers to gain unauthorized access. To mitigate this risk, automated termination of all temporary or emergency accounts _MUST_ be set to 72 hours (or less) when the temporary or emergency account is created.

If no policy is enforced by a directory service, a password policy can be set with the \"pwpolicy\" utility. The variable names may vary depending on how the policy was set.

If there are no temporary or emergency accounts defined on the system, this is Not Applicable.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This setting may be enforced using local policy or by a directory service.

To set local policy to disable a temporary or emergency user, create a plain text file containing the following:

<dict>
<key>policyCategoryAuthentication</key>
<array>
<dict>
<key>policyContent</key>
<string>policyAttributeCurrentTime < policyAttributeCreationTime+259299</string>
<key>policyIdentifier</key>
<string>Disable Tmp Accounts </string>
</dict>
</array>
</dict>

After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the correct user name in place of \"username\" and the path to the file in place of \"/path/to/file\".

/usr/bin/pwpolicy -u username setaccountpolicies /path/to/file"
      reference   : "800-171|3.1.1,800-53|AC-2(2),800-53r5|AC-2(2),CCE|CCE-85414-1,CCI|CCI-000016,CCI|CCI-001682,CN-L3|7.1.3.2(e),CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(2),NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-000012"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Require Passwords Contain a Minimum of One Uppercase Character"
      info        : "The macOS _MUST_ be configured to require at least one uppercase character be used when a password is created.

This rule enforces password complexity by requiring users to set passwords that are less vulnerable to malicious users.

NOTE: The guidance for password based authentication in NIST 800-53 (Rev 5) and NIST 800-63B state that complexity rules should be organizationally defined. The values defined are based off of common complexity values. But your organization may define its own password complexity rules."
      solution    : "This setting may be enforced using local policy or by a directory service.

To set local policy to require at least 1 lowercase letter, edit the current password policy to contain the following <dict> within the \"policyCategoryPasswordContent\":

[source,xml]
----
<dict>
<key>policyContent</key>
<string>policyAttributePassword matches &apos;(.*[A-Z].*){1,}+&apos;</string>
<key>policyIdentifier</key>
<string>Must have at least 1 uppercase letter</string>
<key>policyParameters</key>
<dict>
<key>minimumAlphaCharactersUpperCase</key>
<integer>1</integer>
</dict>
</dict>
----
After saving the file and exiting to the command prompt, run the following command to load the new policy file, substituting the path to the file in place of \"$pwpolicy_file\".

[source,bash]
----
/usr/bin/pwpolicy setaccountpolicies $pwpolicy_file
----
NOTE: See the password policy supplemental on more information on how to implement password policies on macOS."
      reference   : "800-171|3.5.1,800-171|3.5.2,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-171|3.5.10,800-53|IA-5,800-53|IA-5(1),800-53|IA-5(1)(a),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|IA-5(1)(a),CCE|CCE-85415-8,CCI|CCI-000192,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/pwpolicy getaccountpolicies | /usr/bin/grep -v \"Getting global account policies\" | /usr/bin/xmllint --xpath '/plist/dict/array/dict/dict[key=\"minimumAlphaCharactersUpperCase\"]/integer' - | /usr/bin/awk -F '[<>]' '{print $3}'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Prevent Apple Watch from Terminating a Session Lock"
      info        : "Apple Watches are not an approved authenticator and their use _MUST_ be disabled.

Disabling Apple watches is a necessary step to ensuring that the information system retains a session lock until the user reestablishes access using an authorized identification and authentication procedures."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowAutoUnlock:
    False"
      reference   : "800-171|3.1.10,800-53|AC-11,800-53|AC-11b.,800-53r5|AC-11,800-53r5|AC-11b.,CCE|CCE-85418-2,CCI|CCI-000056,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,ITSG-33|AC-11b.,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM23e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,STIG-ID|APPL-11-000001"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowAutoUnlock = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Unattended or Automatic Logon to the System"
      info        : "Automatic logon _MUST_ be disabled.

When automatic logons are enabled, the default user account is automatically logged on at boot time without prompting the user for a password. Even if the screen is later locked, a malicious user would be able to reboot the computer and find it already logged in. Disabling automatic logons mitigates this risk."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.loginwindow:
  com.apple.login.mcx.DisableAutoLoginClient:
    True"
      reference   : "800-171|3.4.2,800-171|3.5.1,800-171|3.5.2,800-53|CM-6b.,800-53|IA-2,800-53|IA-5(13),800-53r5|CM-6b.,800-53r5|IA-2,800-53r5|IA-5(13),CCE|CCE-85419-0,CCI|CCI-000366,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.1.10.6(d),CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|CM-6b.,ITSG-33|IA-2,ITSG-33|IA-2a.,ITSG-33|IA-5,NESA|T2.3.8,NESA|T3.2.1,NESA|T5.2.3,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002066,SWIFT-CSCv1|2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c '\"com.apple.login.mcx.DisableAutoLoginClient\" = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Auto Logout After 24 Hours of Inactivity"
      info        : "Auto logout _MUST_ be configured to automatically terminate a user session and log out the after 86400 seconds (24 hours) of inactivity.

NOTE:The maximum that macOS can be configured for autologoff is 86400 seconds (24 hours).

[IMPORTANT]
====
The 24-hour automatic logout may cause disruptions to an organization's workflow and/or loss of data. Information System Security Officers (ISSOs) are advised to first fully weigh the potential risks posed to their organization before opting to disable the 24-hour automatic logout setting.
===="
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

.GlobalPreferences:
  com.apple.autologout.AutoLogOutDelay:
    86400"
      reference   : "800-171|3.1.1,800-171|3.1.11,800-53|AC-2(5),800-53|AC-12,800-53r5|AC-2(5),800-53r5|AC-12,CCE|CCE-85424-0,CCI|CCI-002361,CN-L3|7.1.2.2(d),CN-L3|7.1.3.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(5),ITSG-33|AC-12,NIAv2|AM28,NIAv2|NS5j,NIAv2|NS49,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,TBA-FIISB|36.2.1,TBA-FIISB|37.1.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c '\"com.apple.autologout.AutoLogOutDelay\" = 86400'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Bluetooth When no Approved Device is Connected"
      info        : "The macOS system _MUST_ be configured to disable Bluetooth unless there is an approved device connected.

[IMPORTANT]
====
Information System Security Officers (ISSOs) may make the risk-based decision not to disable Bluetooth, so as to maintain necessary functionality, but they are advised to first fully weigh the potential risks posed to their organization.
===="
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.ManagedClient.preferences:
  com.apple.MCXBluetooth:
    DisableBluetooth
      True"
      reference   : "800-171|3.1.16,800-171|3.13.8,800-53|AC-18,800-53|AC-18(3),800-53|SC-8,800-53r5|AC-18,800-53r5|AC-18(3),800-53r5|SC-8,CCE|CCE-85420-8,CCI|CCI-002418,CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ITSG-33|AC-18,ITSG-33|AC-18(3),ITSG-33|SC-8,ITSG-33|SC-8a.,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,STIG-ID|APPL-11-002062,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'DisableBluetooth = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      type        : MACOSX_DEFAULTS_READ
      description : "Big Sur - Disable Bluetooth Sharing"
      info        : "Bluetooth Sharing _MUST_ be disabled.

Bluetooth Sharing allows users to wirelessly transmit files between the macOS and Bluetooth-enabled devices, including personally owned cellphones and tablets. A malicious user might introduce viruses or malware onto the system or extract sensitive files via Bluetooth Sharing. When Bluetooth Sharing is disabled, this risk is mitigated.

[NOTE]
====
The check and fix are for the currently logged in user. To get the currently logged in user, run the following.
[source,bash]
----
CURRENT_USER=$( scutil <<< \"show State:/Users/ConsoleUser\" | awk '/Name :/ && ! /loginwindow/ { print $3 }' )
----
===="
      solution    : "[source,bash]
----
/usr/bin/sudo -u \"$CURRENT_USER\" /usr/bin/defaults -currentHost write com.apple.Bluetooth PrefKeyServicesEnabled -bool false
----"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.1.16,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-18(4),800-53|CM-7,800-53|CM-7(1),800-53r5|AC-3,800-53r5|AC-18(4),800-53r5|CM-7,800-53r5|CM-7(1),CCE|CCE-85421-6,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-18(4),ITSG-33|CM-7,ITSG-33|CM-7(1),NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|2.3,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      regex       : "0"
      byhost      : YES
      plist_item  : "PrefKeyServicesEnabled"
      plist_name  : "com.apple.Bluetooth"
      plist_user  : "all"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Content Caching Service"
      info        : "Content caching _MUST_ be disabled.

Content caching is a macOS service that helps reduce Internet data usage and speed up software installation on Mac computers. It is not recommended for devices furnished to employees to act as a caching server."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowContentCaching:
    False"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53|CM-7(1),800-53r5|CM-7,800-53r5|CM-7(1),CCE|CCE-85422-4,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,ITSG-33|CM-7(1),NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowContentCaching = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Critical Security Updates to be Installed"
      info        : "Ensure that security updates are installed as soon as they are available from Apple."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.SoftwareUpdate:
  CriticalUpdateInstall:
    True"
      reference   : "800-171|3.14.1,800-53|SI-2,800-53r5|SI-2,CCE|CCE-85459-6,CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|ID.RA-1,CSF|PR.IP-12,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-2,NESA|T7.6.2,NESA|T7.7.1,NIAv2|PR9,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,QCSC-v1|11.2,SWIFT-CSCv1|2.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'CriticalUpdateInstall = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Sending Diagnostic and Usage Data to Apple"
      info        : "The ability to submit diagnostic data to Apple _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities. Disabling the submission of diagnostic and usage information will mitigate the risk of unwanted data being sent to Apple."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.SubmitDiagInfo:
  AutoSubmit:
    False
com.apple.applicationaccess:
  allowDiagnosticSubmission:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-53|AC-20,800-53|CM-7b.,800-53|SC-7(10),800-53|SI-11,800-53r5|AC-20,800-53r5|CM-7b.,800-53r5|SC-7(10),800-53r5|SI-11,CCE|CCE-85423-2,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|CM-7a.,ITSG-33|SC-7(10),ITSG-33|SI-11,NESA|M1.3.5,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002021,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -Ec '(allowDiagnosticSubmission = 0|AutoSubmit = 0)'"
      expect      : "2"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce FileVault"
      info        : "FileVault _MUST_ be enforced.

The information system implements cryptographic mechanisms to protect the confidentiality and integrity of information stored on digital media during transport outside of controlled areas."
      solution    : "NOTE: See the FileVault supplemental to implement this rule."
      reference   : "800-171|3.13.16,800-53|SC-28,800-53|SC-28(1),800-53r5|SC-28,800-53r5|SC-28(1),CCE|CCE-85425-7,CCI|CCI-001199,CCI|CCI-002475,CCI|CCI-002476,CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSF|PR.DS-1,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ITSG-33|SC-28,ITSG-33|SC-28a.,ITSG-33|SC-28(1),PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,STIG-ID|APPL-11-005020,TBA-FIISB|28.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/fdesetup status | /usr/bin/grep -c \"FileVault is On.\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Find My Service"
      info        : "The Find My service _MUST_ be disabled.

A Mobile Device Management (MDM) solution _MUST_ be used to carry out remote locking and wiping instead of Apple's Find My service.

Apple's Find My service uses a personal AppleID for authentication. Organizations should rely on MDM solutions, which have much more secure authentication requirements, to perform remote lock and remote wipe."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowFindMyDevice:
    False
  allowFindMyFriends:
    False
com.apple.icloud.managed:
  DisableFMMiCloudSetting:
    True"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-20,800-53|CM-7,800-53|CM-7(1),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7(1),CCE|CCE-85426-5,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7(1),NESA|M1.3.5,NESA|T1.2.3,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -Ec '(allowFindMyDevice = 0|allowFindMyFriends = 0|DisableFMMiCloudSetting = 1)'"
      expect      : "3"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable macOS Application Firewall"
      info        : "The macOS Application Firewall is the built-in firewall that comes with macOS, and it _MUST_ be enabled.

When the macOS Application Firewall is enabled, the flow of information within the information system and between interconnected systems will be controlled by approved authorizations."
      solution    : "[source,bash]
----
/usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
----"
      reference   : "800-171|3.1.3,800-171|3.1.5,800-171|3.1.18,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-53|AC-4,800-53|AC-6(1),800-53|AC-19,800-53|CM-6b.,800-53|CM-7,800-53|CM-7(1),800-53|SC-7,800-53|SC-7(12),800-53r5|AC-4,800-53r5|AC-6(1),800-53r5|AC-19,800-53r5|CM-6b.,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|SC-7,800-53r5|SC-7(12),CCE|CCE-85427-3,CCI|CCI-000366,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(d),CN-L3|8.1.10.6(j),CSF|DE.AE-1,CSF|DE.CM-1,CSF|ID.AM-3,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.1,ISO/IEC-27001|A.9.4.4,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-4,ITSG-33|AC-6(1),ITSG-33|AC-19,ITSG-33|CM-6b.,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|SC-7,ITSG-33|SC-7(12),NESA|T3.2.1,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.1.1,NESA|T5.4.4,NESA|T5.4.6,NESA|T5.5.4,NESA|T5.6.1,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.5.3,NESA|T7.6.4,NIAv2|AM31,NIAv2|AM38,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS13d,NIAv2|SS15a,NIAv2|SS23,NIAv2|SS26,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,NIAv2|VL3b,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|1.4,PCI-DSSv3.2.1|2.2.2,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,PCI-DSSv4.0|1.5.1,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-005050,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.4,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,TBA-FIISB|43.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate | /usr/bin/grep -c \"Firewall is enabled\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable Firewall Stealth Mode"
      info        : "Firewall Stealth Mode _MUST_ be enabled.

When stealth mode is enabled, the Mac will not respond to any probing requests, and only requests from authorized applications will still be authorized.

[IMPORTANT]
====
Enabling firewall stealth mode may prevent certain remote mechanisms used for maintenance and compliance scanning from properly functioning. Information System Security Officers (ISSOs) are advised to first fully weigh the potential risks posed to their organization before opting not to enable stealth mode.
===="
      solution    : "[source,bash]
----
/usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on
----"
      reference   : "800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-53|CM-6b.,800-53|CM-7,800-53|CM-7(1),800-53|SC-7,800-53|SC-7(16),800-53r5|CM-6b.,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|SC-7,800-53r5|SC-7(16),CCE|CCE-85428-1,CCI|CCI-000366,CN-L3|8.1.10.6(d),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|CM-6b.,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|SC-7,ITSG-33|SC-7(16),NESA|T3.2.1,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|GS8d,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|1.3.7,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,PCI-DSSv4.0|1.4.5,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-005050,SWIFT-CSCv1|2.3,TBA-FIISB|43.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/libexec/ApplicationFirewall/socketfilterfw --getstealthmode | /usr/bin/grep -c \"Stealth mode enabled\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Apply Gatekeeper Settings to Block Applications from Unidentified Developers"
      info        : "The information system implements cryptographic mechanisms to authenticate software prior to installation.

Gatekeeper settings must be configured correctly to only allow the system to run applications downloaded from the Mac App Store or applications signed with a valid Apple Developer ID code. Administrator users will still have the option to override these settings on a per-app basis. Gatekeeper is a security feature that ensures that applications must be digitally signed by an Apple-issued certificate in order to run. Digital signatures allow the macOS to verify that the application has not been modified by a malicious third party."
      solution    : "[source,bash]
----
/usr/sbin/spctl --master-enable; /usr/sbin/spctl --enable
----

mobileconfig profile info:

com.apple.systempolicy.control:
  AllowIdentifiedDevelopers:
    True
  EnableAssessment:
    True"
      reference   : "800-171|3.4.2,800-171|3.4.5,800-53|CM-5,800-53|CM-6b.,800-53|SI-7(1),800-53|SI-7(15),800-53r5|CM-5,800-53r5|CM-5(3),800-53r5|CM-6b.,800-53r5|CM-14,800-53r5|SI-7(1),800-53r5|SI-7(15),CCE|CCE-85429-9,CCI|CCI-000366,CN-L3|7.1.3.5(b),CN-L3|8.1.10.6(d),CSF|PR.DS-6,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ITSG-33|CM-5,ITSG-33|CM-6b.,ITSG-33|SI-7,ITSG-33|SI-7a.,ITSG-33|SI-7(1),NESA|T3.2.1,NESA|T3.2.3,NESA|T3.4.1,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.3.2,NESA|T7.3.3,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,PCI-DSSv3.2.1|10.5.5,QCSC-v1|3.2,QCSC-v1|7.2,STIG-ID|APPL-11-002060,SWIFT-CSCv1|2.3,SWIFT-CSCv1|6.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/sbin/spctl --status --verbose | /usr/bin/grep -c \"developer id enabled\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Gatekeeper to Disallow End User Override"
      info        : "Gatekeeper _MUST_ be configured with a configuration profile to prevent normal users from overriding its settings.

If users are allowed to disable Gatekeeper or set it to a less restrictive setting, malware could be introduced into the system."
      solution    : "To implement the prescribed state with a Configuration Profile, create a configuration profile (com.apple.systempolicy.managed) with the following key DisableOverride set to true
[source,xml]
----
<key>DisableOverride</key>
<true/>
----
NOTE - This will apply to the whole system

mobileconfig profile info:

com.apple.systempolicy.managed:
  DisableOverride:
    True"
      reference   : "800-171|3.4.5,800-53|CM-5,800-53|SI-7(15),800-53r5|CM-5,800-53r5|SI-7(15),CCE|CCE-85430-7,CSF|PR.DS-6,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ITSG-33|CM-5,ITSG-33|SI-7,ITSG-33|SI-7a.,NESA|T3.2.3,NESA|T3.4.1,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.3.2,NESA|T7.3.3,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,PCI-DSSv3.2.1|10.5.5,QCSC-v1|3.2,QCSC-v1|7.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'DisableOverride = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Guest Access to Shared SMB Folders"
      info        : "Guest access to shared Server Message Block (SMB) folders _MUST_ be disabled.

Turning off guest access prevents anonymous users from accessing files shared via SMB."
      solution    : "[source,bash]
----
/usr/sbin/sysadminctl -smbGuestAccess off
----"
      reference   : "800-171|3.1.1,800-171|3.5.1,800-171|3.5.2,800-53|AC-2,800-53|AC-2(9),800-53r5|AC-2,800-53r5|AC-2(9),CCE|CCE-85319-2,CN-L3|7.1.3.2(d),CN-L3|8.1.4.2(c),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,NIAv2|AM16,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,PCI-DSSv3.2.1|8.5,PCI-DSSv4.0|8.2.2,PCI-DSSv4.0|8.2.3,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/defaults read /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable the Guest Account"
      info        : "Guest access _MUST_ be disabled.

Turning off guest access prevents anonymous users from accessing files."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.MCX:
  DisableGuestAccount:
    True"
      reference   : "800-171|3.1.1,800-171|3.4.5,800-171|3.5.1,800-171|3.5.2,800-53|AC-2,800-53|AC-2(9),800-53|CM-5(1),800-53r5|AC-2,800-53r5|AC-2(9),800-53r5|CM-5(1),CCE|CCE-85320-0,CCI|CCI-001813,CN-L3|7.1.3.2(d),CN-L3|8.1.4.2(c),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,ITSG-33|CM-5(1),NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM16,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,PCI-DSSv3.2.1|8.5,PCI-DSSv4.0|8.2.2,PCI-DSSv4.0|8.2.3,QCSC-v1|5.2.2,QCSC-v1|7.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,STIG-ID|APPL-11-002063"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'DisableGuestAccount = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Hot Corners"
      info        : "Hot corners _MUST_ be disabled.

The information system conceals, via the session lock, information previously visible on the display with a publicly viewable image. Although hot comers can be used to initiate a session lock or to launch useful applications, they can also be configured to disable an automatic session lock from initiating. Such a configuration introduces the risk that a user might forget to manually lock the screen before stepping away from the computer."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.ManagedClient.preferences:
  com.apple.dock:
    wvous-bl-corner
      0
    wvous-br-corner
      0
    wvous-tr-corner
      0
    wvous-tl-corner
      0"
      reference   : "800-171|3.1.10,800-53|AC-11(1),800-53r5|AC-11(1),CCE|CCE-85431-5,CCI|CCI-000060,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11(1),NIAv2|AM23c,NIAv2|AM23d,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,STIG-ID|APPL-11-000007"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -Ec '\"wvous-bl-corner\" = 0|\"wvous-br-corner\" = 0|\"wvous-tl-corner\" = 0|\"wvous-tr-corner\" = 0'"
      expect      : "4"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Sending Siri and Dictation Information to Apple"
      info        : "The ability for Apple to store and review audio of your Siri and Dictation interactions _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities. Disabling the submission of Siri and Dictation information will mitigate the risk of unwanted data being sent to Apple."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.assistant.support:
  Siri Data Sharing Opt-In Status:
    2"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-53|AC-20,800-53|CM-7,800-53|CM-7(1),800-53|SC-7(10),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|SC-7(10),CCE|CCE-85432-3,CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c '\"Siri Data Sharing Opt-In Status\" = 2;'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Internet Sharing"
      info        : "If the system does not require Internet sharing, support for it is non-essential and _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities. Disabling Internet sharing helps prevent the unauthorized connection of devices, unauthorized transfer of information, and unauthorized tunneling."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.MCX:
  forceInternetSharingOff:
    True"
      reference   : "800-171|3.1.3,800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-53|AC-4,800-53|AC-20,800-53|CM-7a.,800-53r5|AC-4,800-53r5|AC-20,800-53r5|CM-7a.,CCE|CCE-85433-1,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,ITSG-33|AC-20,ITSG-33|CM-7a.,NESA|M1.3.5,NESA|T1.2.3,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS15a,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,STIG-ID|APPL-11-002007,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.4,SWIFT-CSCv1|2.5"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'forceInternetSharingOff = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Location Services"
      info        : "Location Services _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities.  Disabling Location Services helps prevent the unauthorized connection of devices, unauthorized transfer of information, and unauthorized tunneling."
      solution    : "[source,bash]
----
/usr/bin/defaults write /var/db/locationd/Library/Preferences/ByHost/com.apple.locationd LocationServicesEnabled -bool false; /bin/launchctl kickstart -k system/com.apple.locationd
----"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|SC-7(10),800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|SC-7(10),CCE|CCE-85434-9,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002004,SWIFT-CSCv1|2.3,TBA-FIISB|33.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/defaults read /var/db/locationd/Library/Preferences/ByHost/com.apple.locationd.plist LocationServicesEnabled"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure Login Window to Prompt for Username and Password"
      info        : "The login window _MUST_ be configured to prompt all users for both a username and a password.

By default, the system displays a list of known users on the login window, which can make it easier for a malicious user to gain access to someone else's account. Requiring users to type in both their username and password mitigates the risk of unauthorized users gaining access to the information system."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.loginwindow:
  SHOWFULLNAME:
    True"
      reference   : "800-171|3.5.1,800-171|3.5.2,800-53|IA-2,800-53r5|IA-2,CCE|CCE-85435-6,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2,ITSG-33|IA-2a.,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM2,NIAv2|AM8,NIAv2|AM14b,QCSC-v1|5.2.2,QCSC-v1|13.2,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'SHOWFULLNAME = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Media Sharing"
      info        : "Media sharing _MUST_ be disabled.

When Media Sharing is enabled, the computer starts a network listening service that shares the contents of the user's music collection with other users in the same subnet.

The information system _MUST_ be configured to provide only essential capabilities. Disabling Media Sharing helps prevent the unauthorized connection of devices and the unauthorized transfer of information. Disabling Media Sharing mitigates this risk.

NOTE: The Media Sharing preference panel will still allow \"Home Sharing\" and \"Share media with guests\" to be checked but the service will not be enabled."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.preferences.sharing.SharingPrefsExtension:
  homeSharingUIStatus:
    0
  legacySharingUIStatus:
    0
  mediaSharingUIStatus:
    0"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-53|AC-3,800-53|AC-17,800-53r5|AC-3,800-53r5|AC-17,CCE|CCE-85436-4,CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|2.6,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -Ec '(homeSharingUIStatus = 0|legacySharingUIStatus = 0|mediaSharingUIStatus = 0)'"
      expect      : "3"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Password Hints"
      info        : "Password hints _MUST_ be disabled.

Password hints leak information about passwords that are currently in use and can lead to loss of confidentiality."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.loginwindow:
  RetriesUntilHint:
    0"
      reference   : "800-171|3.4.2,800-171|3.5.11,800-53|CM-6b.,800-53|IA-6,800-53r5|CM-6b.,800-53r5|IA-6,CCE|CCE-85437-2,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),ITSG-33|CM-6b.,ITSG-33|IA-6,ITSG-33|IA-6a.,NESA|T3.2.1,NESA|T5.5.1,QCSC-v1|13.2,STIG-ID|APPL-11-003012,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'RetriesUntilHint = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Personalized Advertising"
      info        : "Ad tracking and targeted ads _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities. Disabling ad tracking ensures that applications and advertisers are unable to track users' interests and deliver targeted advertisements."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.AdLib:
  allowApplePersonalizedAdvertising:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-53|AC-20,800-53|CM-7,800-53|CM-7(1),800-53|SC-7(10),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|SC-7(10),CCE|CCE-85438-0,CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowApplePersonalizedAdvertising = 0;'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Power Nap"
      info        : "Power Nap _MUST_ be disabled.

Power Nap allows your Mac to perform actions while a Mac is asleep. This can interfere with USB power and may cause devices to stop functioning until a reboot and must therefore be disabled on all applicable systems.

The following Macs support Power Nap:

* MacBook (Early 2015 and later)
* MacBook Air (Late 2010 and later)
* MacBook Pro (all models with Retina display)
* Mac mini (Late 2012 and later)
* iMac (Late 2012 and later)
* Mac Pro (Late 2013 and later)"
      solution    : "[source,bash]
----
/usr/bin/pmset -a powernap 0
----"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,800-53|CM-7(1),800-53r5|CM-7,800-53r5|CM-7(1),CCE|CCE-85439-8,CSF|PR.IP-1,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7,ITSG-33|CM-7(1),NIAv2|SS15a,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,SWIFT-CSCv1|2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/pmset -g custom | /usr/bin/awk '/powernap/ { sum+=$2 } END {print sum}'"
      expect      : "0"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Remote Apple Events"
      info        : "If the system does not require Remote Apple Events, support for Apple Remote Events is non-essential and _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities. Disabling Remote Apple Events helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling."
      solution    : "[source,bash]
----
/usr/sbin/systemsetup -setremoteappleevents off
/bin/launchctl disable system/com.apple.AEServer
----
NOTE: Systemsetup with -setremoteappleevents flag will fail unless you grant Full Disk Access to systemsetup or it's parent process. Requires UAMDM."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-17,800-53|CM-7b.,800-53r5|AC-3,800-53r5|AC-17,800-53r5|CM-7b.,CCE|CCE-85440-6,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(b),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|CM-7a.,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS29,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002022,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"com.apple.AEServer\" => true'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Session Lock After Screen Saver is Started"
      info        : "A screen saver _MUST_ be enabled and the system _MUST_ be configured to require a password to unlock once the screensaver has been on for a maximum of five seconds.

An unattended system with an excessive grace period is vulnerable to a malicious user."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.screensaver:
  askForPasswordDelay:
    5"
      reference   : "800-171|3.1.10,800-53|AC-11,800-53|AC-11b.,800-53r5|AC-11,800-53r5|AC-11b.,CCE|CCE-85442-2,CCI|CCI-000056,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,ITSG-33|AC-11b.,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM23e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,STIG-ID|APPL-11-000003"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'askForPasswordDelay = 5'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Screen Saver Password"
      info        : "Users _MUST_ authenticate when unlocking the screen saver.

The screen saver acts as a session lock and prevents unauthorized users from accessing the current user's account."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.screensaver:
  askForPassword:
    True"
      reference   : "800-171|3.1.10,800-53|AC-11,800-53|AC-11b.,800-53r5|AC-11,800-53r5|AC-11b.,CCE|CCE-85443-0,CCI|CCI-000056,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,ITSG-33|AC-11b.,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM23e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,STIG-ID|APPL-11-000002"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'askForPassword = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enforce Screen Saver Timeout"
      info        : "The screen saver timeout _MUST_ be set to 15 minutes or a shorter length of time.

This rule ensures that a full session lock is triggered within no more than 15 minutes of inactivity."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.screensaver:
  idleTime:
    900"
      reference   : "800-171|3.1.10,800-53|AC-11,800-53|AC-11a.,800-53|IA-11,800-53r5|AC-11,800-53r5|AC-11a.,800-53r5|IA-11,CCE|CCE-85444-8,CCI|CCI-000057,CN-L3|8.1.4.1(b),CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),HIPAA|164.312(d),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,ITSG-33|AC-11a.,NESA|T2.3.8,NESA|T2.3.9,NIAv2|AM23a,NIAv2|AM23b,NIAv2|AM23c,NIAv2|AM23d,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,QCSC-v1|13.2,STIG-ID|APPL-11-000004"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/egrep -o -e \"idleTime\\s=\\s([^;]+)\" | /usr/bin/awk '{ if ($3 <= 900) {print \"Yes\"} else {print \"No\"}}'"
      expect      : "Yes"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Screen Sharing and Apple Remote Desktop"
      info        : "Support for both Screen Sharing and Apple Remote Desktop (ARD) is non-essential and _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities. Disabling screen sharing and ARD helps prevent the unauthorized connection of devices, the unauthorized transfer of information, and unauthorized tunneling."
      solution    : "[source,bash]
----
/bin/launchctl disable system/com.apple.screensharing
----
NOTE - This will apply to the whole system"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.2,800-53|AC-3,800-53|AC-17,800-53|CM-6b.,800-53r5|AC-3,800-53r5|AC-17,800-53r5|CM-6b.,CCE|CCE-85441-4,CCI|CCI-000366,CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(d),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|CM-6b.,NESA|T3.2.1,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002050,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"com.apple.screensharing\" => true'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Siri"
      info        : "Support for Siri is non-essential and _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.ironwood.support:
  Ironwood Allowed:
    False"
      reference   : "800-171|3.1.20,800-171|3.4.6,800-171|3.4.7,800-171|3.4.8,800-171|3.13.1,800-53|AC-20,800-53|CM-7,800-53|CM-7a.,800-53|CM-7(1),800-53|CM-7(5)(b),800-53|SC-7(10),800-53r5|AC-20,800-53r5|CM-7,800-53r5|CM-7a.,800-53r5|CM-7(1),800-53r5|CM-7(5)(b),800-53r5|SC-7(10),CCE|CCE-85445-5,CCI|CCI-000381,CCI|CCI-001774,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|ID.AM-4,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.5.1,ISO/IEC-27001|A.12.6.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-20,ITSG-33|CM-7,ITSG-33|CM-7a.,ITSG-33|CM-7(1),ITSG-33|SC-7(10),NESA|M1.3.5,NESA|T1.2.3,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.1,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.3.2,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,STIG-ID|APPL-11-002020,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.5,TBA-FIISB|33.1,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c '\"Ironwood Allowed\" = 0'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable Server Message Block Sharing"
      info        : "Support for Server Message Block (SMB) file sharing is non-essential and _MUST_ be disabled.

The information system _MUST_ be configured to provide only essential capabilities."
      solution    : "[source,bash]
----
/bin/launchctl disable system/com.apple.smbd
----
The system may need to be restarted for the update to take effect."
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-3,800-53|AC-17,800-53|CM-7a.,800-53r5|AC-3,800-53r5|AC-17,800-53r5|CM-7a.,CCE|CCE-85446-3,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(a),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|CM-7a.,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-002001,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,TBA-FIISB|31.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"com.apple.smbd\" => true'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable SSH Server for Remote Access Sessions"
      info        : "SSH service _MUST_ be disabled for remote access.

Remote access sessions _MUST_ use FIPS validated encrypted methods to protect unauthorized individuals from gaining access."
      solution    : "[source,bash]
----
/bin/launchctl disable system/com.openssh.sshd
----"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.4.6,800-171|3.4.7,800-171|3.5.4,800-53|AC-3,800-53|AC-17,800-53|CM-7,800-53|CM-7(1),800-53|IA-2(8),800-53r5|AC-3,800-53r5|AC-17,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|IA-2(8),800-53r5|IA-2(9),CCE|CCE-85447-1,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.1.4.2(f),CN-L3|8.1.4.4(c),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(i),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-17,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|IA-2(8),NESA|T2.3.8,NESA|T4.2.1,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|AM18,NIAv2|SS15a,NIAv2|SS29,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|13.2,STIG-ID|APPL-11-000011,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.2,TBA-FIISB|31.1,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/bin/launchctl print-disabled system | /usr/bin/grep -c '\"com.openssh.sshd\" => true'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Require Administrator Password to Modify System-Wide Preferences"
      info        : "The system _MUST_ be configured to require an administrator password in order to modify the system-wide preferences in System Preferences.

Some Preference Panes in System Preferences contain settings that affect the entire system. Requiring a password to unlock these system-wide settings reduces the risk of a non-authorized user modifying system configurations."
      solution    : "[source,bash]
----
/usr/bin/security authorizationdb read system.preferences > /tmp/system.preferences.plist
/usr/libexec/PlistBuddy -c \"Set :shared false\" /tmp/system.preferences.plist
/usr/bin/security authorizationdb write system.preferences < /tmp/system.preferences.plist
----"
      reference   : "800-171|3.1.5,800-171|3.1.6,800-53|AC-6,800-53|AC-6(1),800-53|AC-6(2),800-53|IA-3,800-53r5|AC-6,800-53r5|AC-6(1),800-53r5|AC-6(2),800-53r5|IA-3,CCE|CCE-85389-5,CCI|CCI-001958,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-1,CSF|PR.AC-4,CSF|PR.DS-5,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6,ITSG-33|AC-6(1),ITSG-33|AC-6(2),ITSG-33|IA-3,ITSG-33|IA-3a.,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.3,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3b,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,STIG-ID|APPL-11-002069,SWIFT-CSCv1|5.1,TBA-FIISB|27.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/security authorizationdb read system.preferences 2> /dev/null |  /usr/bin/grep -A 1 \"<key>shared</key>\" | /usr/bin/grep -c \"<false/>\""
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure macOS to Use an Authorized Time Server"
      info        : "Approved time servers _MUST_ be the only servers configured for use.

This rule ensures the uniformity of time stamps for information systems with multiple system clocks and systems connected over a network."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.MCX:
  timeServer:
    time-a.nist.gov,time-b.nist.gov"
      reference   : "800-171|3.3.1,800-171|3.3.7,800-53|AU-8(1)(a),800-53|AU-8(1)(b),800-53|AU-12(1),800-53r5|AU-8(1),800-53r5|AU-12(1),800-53r5|SC-45(1),CCE|CCE-85448-9,CCI|CCI-001891,CCI|CCI-002046,CN-L3|8.1.4.3(b),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),ITSG-33|AU-12(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.4,PCI-DSSv3.2.1|10.4.1,PCI-DSSv3.2.1|10.4.3,PCI-DSSv4.0|10.6,PCI-DSSv4.0|10.6.1,PCI-DSSv4.0|10.6.2,PCI-DSSv4.0|10.6.3,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-000014,SWIFT-CSCv1|6.4,TBA-FIISB|37.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/awk -F \"= \" '/timeServer/{print $2}' | /usr/bin/tr -d ';' | /usr/bin/tr -d '\"'"
      expect      : "time-a.nist.gov,time-b.nist.gov"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Enable macOS Time Synchronization Daemon (timed)"
      info        : "The timed service _MUST_ be enabled on all networked systems and configured to set time automatically from the approved time server.

This rule ensures the uniformity of time stamps for information systems with multiple system clocks and systems connected over a network."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.ManagedClient.preferences:
  com.apple.timed:
    TMAutomaticTimeOnlyEnabled
      True"
      reference   : "800-171|3.3.1,800-171|3.3.7,800-53|AU-8(1)(a),800-53|AU-8(1)(b),800-53|AU-12(1),800-53r5|AU-8(1),800-53r5|AU-12(1),800-53r5|SC-45(1),CCE|CCE-85449-7,CCI|CCI-001891,CCI|CCI-002046,CN-L3|8.1.4.3(b),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),ITSG-33|AU-12(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.4,PCI-DSSv3.2.1|10.4.1,PCI-DSSv3.2.1|10.4.3,PCI-DSSv4.0|10.6,PCI-DSSv4.0|10.6.1,PCI-DSSv4.0|10.6.2,PCI-DSSv4.0|10.6.3,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,STIG-ID|APPL-11-000014,SWIFT-CSCv1|6.4,TBA-FIISB|37.4"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'TMAutomaticTimeOnlyEnabled = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Configure User Session Lock When a Smart Token is Removed"
      info        : "The screen lock _MUST_ be configured to initiate automatically when the smart token is removed from the system.

Session locks are temporary actions taken when users stop work and move away from the immediate vicinity of the information system but do not want to log out because of the temporary nature of their absences. While a session lock is not an acceptable substitute for logging out of an information system for longer periods of time, they prevent a malicious user from accessing the information system when a user has removed their smart token.

[IMPORTANT]
====
Information System Security Officers (ISSOs) may make the risk-based decision not to enforce a session lock when a smart token is removed, so as to maintain necessary workflow capabilities, but they are advised to first fully weigh the potential risks posed to their organization.
===="
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.security.smartcard:
  tokenRemovalAction:
    1"
      reference   : "800-171|3.1.10,800-53|AC-11,800-53|AC-11a.,800-53r5|AC-11,800-53r5|AC-11a.,CCE|CCE-85450-5,CCI|CCI-000058,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,ITSG-33|AC-11a.,NESA|T2.3.8,NESA|T2.3.9,NIAv2|AM23a,NIAv2|AM23b,NIAv2|AM23c,NIAv2|AM23d,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8,STIG-ID|APPL-11-000005"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'tokenRemovalAction = 1'"
      expect      : "1"
    </custom_item>

    <custom_item>
      system      : "Darwin"
      type        : CMD_EXEC
      description : "Big Sur - Disable TouchID for Unlocking the Device"
      info        : "TouchID enables the ability to unlock a Mac system with a user's fingerprint.

TouchID _MUST_ be disabled for \"Unlocking your Mac\" on all macOS devices that are capable of using Touch ID.

The system _MUST_ remain locked until the user establishes access using an authorized identification and authentication method."
      solution    : "This is implemented by a Configuration Profile.

mobileconfig profile info:

com.apple.applicationaccess:
  allowFingerprintForUnlock:
    False"
      reference   : "800-171|3.1.10,800-53|AC-11,800-53|AC-11b.,800-53r5|AC-11,800-53r5|AC-11b.,CCE|CCE-85451-3,CCI|CCI-000056,CN-L3|8.1.4.1(b),GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,ITSG-33|AC-11b.,NIAv2|AM23c,NIAv2|AM23d,NIAv2|AM23e,PCI-DSSv3.2.1|8.1.8,PCI-DSSv4.0|8.2.8"
      see_also    : "https://github.com/usnistgov/macos_security"
      cmd         : "/usr/bin/profiles -P -o stdout | /usr/bin/grep -c 'allowFingerprintForUnlock = 0'"
      expect      : "1"
    </custom_item>

    <report type:"WARNING">
      description : "Big Sur - Disable Wi-Fi Interface"
      info        : "The macOS system must be configured with Wi-Fi support software disabled if not connected to an authorized trusted network.

Allowing devices and users to connect to or from the system without first authenticating them allows untrusted access and can lead to a compromise or attack. Since wireless communications can be intercepted  it is necessary to use encryption to protect the confidentiality of information in transit.Wireless technologies include  for example  microwave  packet radio (UHF/VHF)  802.11x  and Bluetooth. Wireless networks use authentication protocols (e.g.  EAP/TLS  PEAP)  which provide credential protection and mutual authentication.

NOTE: If the system requires Wi-Fi to connect to an authorized network, this is not applicable.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "To disable Wi-Fi on a macOS system, run the following command.
[source,bash]
----
/usr/sbin/networksetup -setnetworkserviceenabled \"Wi-Fi\" off
----"
      reference   : "800-171|3.1.3,800-171|3.1.16,800-171|3.1.17,800-53|AC-4,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53r5|AC-4,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),CCE|CCE-85473-7,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.2,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,STIG-ID|APPL-11-000008,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>

    <report type:"WARNING">
      description : "Big Sur - Disable Wi-Fi When Connected to Ethernet"
      info        : "The macOS should be configured to automatically disable Wi-Fi when connected to ethernet.

The use of Wi-Fi to connect to unauthorized networks may facilitate the exfiltration of mission data. Therefore, wireless networking capabilities internally embedded within information system components should be disabled when not intended to be used.

NOTE: If the system requires Wi-Fi to connect to an authorized network, this is not applicable.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "This requirement is a permanent finding and cannot be fixed. An appropriate mitigation for the system must be implemented, but this finding cannot be considered fixed."
      reference   : "800-171|3.1.3,800-171|3.1.16,800-171|3.1.17,800-53|AC-4,800-53|AC-18(1),800-53|AC-18(3),800-53r5|AC-4,800-53r5|AC-18(1),800-53r5|AC-18(3),CCE|CCE-85452-1,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,ITSG-33|AC-18(1),ITSG-33|AC-18(3),NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.2,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.4"
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>
  </then>

  <else>
    <report type:"WARNING">
      description : "NIST_macOS_Big_Sur_800-53r5_high_v1.4.0.audit from NIST macOS Big Sur v1.4.0"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://github.com/usnistgov/macos_security"
    </report>
  </else>
</if>

</check_type>
