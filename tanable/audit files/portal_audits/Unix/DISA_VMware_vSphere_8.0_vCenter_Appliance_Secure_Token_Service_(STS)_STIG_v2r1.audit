#TRUSTED 6144f25a1a08c3460e1b388c6645c487a4a7f5f5e1f499cdb210585dff6b02c924a7282b137567e87c529ca47d65a4656031633b71f21cb492a2692f6c37f47b118ac4fc6aed0649b98d25ffa23ba48712ac41058b963db945157a852ad06ce98c55ea337c4a88e2ef1391ff843996fb5bde3d9ee37f37be4ce03c7143fe2fc4c24c42c2a1812c1007b624b2d7e703b30d2da7576ef26465c21371df91063f66d4319467b9dd54762d506a3b2f5ac0067a27abd93b644f44eecdbc6fc60f6f35ea1eefc36ff587642f46a511e6c0ab5b77210a5f53939c96dfb08d6d2ab39f18e46268dacf4aab98b693302c9f30565ed14692691dc0a3569166c48621428eca198012681a80e0bc488ed8271b346c37c4a322673d8146dc9820671f13178ccb36094bba7248b83dd3eadde42294aafa177d23ce5598e3e565d792701d9158a103300cebaeec607fdae3691a73dda16b804054489501c52eb2b62fb7e20088650cce768f9d9ffd5897f4b5f05f609280c6ad845c03d76facf030c27041e923dacf6883cfd486d37850e83262384d20c89582b9fe959f83d8b54a1add2c5faf6b006a8d362f097c28d98e869b1a4af9a70188c0f927cb78ba1aad9c5abb5e0168551e0ea007a380fd7c73007fb12e14d88a4d177e22d50452bd7906a68fde24a2cdc546f53a193cd9c37e507a1780e8b6b41a84ae6d749917d92d301d647a0db8
#TRUST-RSA-SHA256 4981688c41e4ad3a20fd6d625238741613c06dd5db59c50e778eaae3308584064d6a6be58e48e3315ed279e8d1685e9267053603cd1940f59b2e27c836a4a191261aee88d9e617891713edc26196a3096db97cc08635e26f767715e20f5b2427fbf4315a2f201a2f66602b717ec8fcf2e85cece55affa5ad127732992c8ff59d43490848f3f06b362d422909df84e2917cc33565a79b2d11d89f3f5b4c26596fbaadaeb946f14342db498ddfd677cff24924a28eb4e327e8c2e0936cfb264a2191182c3741685a06244812be7d736468cbdd7a36b30838fa424880111650ceb6394fc25719e49a5e73537cef37f800d2ec8cc8a5df24f232ba8e9551c3e2d1e50f092eee6fda7c15aaf0f09b028d613fded8e13206665ad66632675eaec159c654b796c20c05c039ffa56d57999abbf2585929e84bf1c578f83850eb90b544bc2487c673681ddace1dce8ca1ccd7ea2bde9f124a725d2b271c8d0ad904fe4c016a084e16d0ed71353702239592ae335818ba81dcc29b6b2ea77bbb45a9511601b0cb726842d21c6991d620d12c1e9626e06aae7d5d52f12b04ea8ba16133b5b6c3214f988cb40d4852f45634553be09d3f1dd6d37f30f053d94130cf9f1a819ffe4b75fa52bf1b15e91a09eb414d946ad947901746900a923d3a1f58fcf8b8de9f196d2a1f0152de9b621ea25d3e76771f6a5607caf9c02b37ea7197ad22b7f0
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2024/10/22 $
#
# description : This .audit is designed against the DISA VMware vSphere 8.0 vCenter Appliance Secure Token Service (STS) STIG v2r1
#
#<ui_metadata>
#<display_name>DISA VMware vSphere 8.0 vCenter Appliance Secure Token Service (STS) STIG v2r1</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>VMware vSphere 8.0</name>
#  <profile>vCenter Appliance Secure Token Service</profile>
#  <version>2.1.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip</link>
#</spec>
#<labels>unix,disa,vmware_sts_tomcat,agent</labels>
#<benchmark_refs>CAT,CCE,CCI,DISA_Benchmark,Group-ID,Rule-ID,STIG-ID,STIG-Legacy,Vuln-ID</benchmark_refs>
#<variables>
#  <variable>
#    <name>FIND_TIMEOUT</name>
#    <default>7200</default>
#    <description>Timeout for checks that search for files</description>
#    <info>Timeout, in seconds, for checks that search for files. Range of 1-7200.</info>
#    <value_type>INTEGER</value_type>
#  </variable>
#  <variable>
#    <name>LOG_FILE</name>
#    <default>%VMWARE_LOG_DIR%/vmware/sso/sts-runtime.log</default>
#    <description>Path to log file</description>
#    <info>The path to the log file for session logging</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>SESSION_TIMEOUT</name>
#    <default>([1-9]|[12][0-9]|30)</default>
#    <description>EAM session timeout</description>
#    <info>Amount of time to allow for session timeouts on ESX Agent Manager.</info>
#    <value_type>STRING</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : FILE_CHECK
      description : "STS Tomcat config exists"
      file        : "/usr/lib/vmware-sso/vmware-sts/conf/server.xml"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "DISA_VMware_vSphere_8.0_vCenter_Appliance_Secure_Token_Service_(STS)_STIG_v2r1.audit from DISA VMware vSphere 8.0 vCenter Appliance Secure Token Service (STS) STIG v2r1"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
    </report>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000001 The vCenter STS service must limit the number of maximum concurrent connections permitted."
      info        : "Resource exhaustion can occur when an unlimited number of concurrent requests are allowed on a website, facilitating a denial-of-service attack. Unless the number of requests is controlled, the web server can consume enough system resources to cause a system crash.

Mitigating this kind of attack will include limiting the number of concurrent HTTP/HTTPS requests. In Tomcat, each incoming request requires a thread for the duration of that request. If more simultaneous requests are received than can be handled by the currently available request processing threads, additional threads will be created up to the value of the maxThreads attribute.

Satisfies: SRG-APP-000001-AS-000001, SRG-APP-000435-AS-000163"
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Navigate to the <Executor> node with the name of tomcatThreadPool and configure with the value \"maxThreads=\"150\"\".

Note: The <Executor> node should be configured similar to the following:

<Executor maxThreads=\"150\"
                minSpareThreads=\"50\"
                name=\"tomcatThreadPool\"
                namePrefix=\"tomcat-http--\"/>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-53|AC-10,800-53|SC-5,800-53r5|AC-10,800-53r5|SC-5a.,CAT|II,CCI|CCI-000054,CCI|CCI-002385,CSF|DE.CM-1,CSF|PR.DS-4,CSF2.0|DE.CM-01,CSF2.0|PR.AA-05,CSF2.0|PR.IR-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,ITSG-33|SC-5,ITSG-33|SC-5a.,NESA|T3.3.1,NESA|T5.5.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|8.2.1,Rule-ID|SV-258970r960735_rule,STIG-ID|VCST-80-000001,Vuln-ID|V-258970"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath '/Server/Service/Executor[@name=\"tomcatThreadPool\"]/@maxThreads' /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*maxThreads[\\s]*=[\\s]*[\"']150[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000005 The vCenter STS service cookies must have secure flag set."
      info        : "The secure flag is an option that can be set by the application server when sending a new cookie to the user within an HTTP Response. The purpose of the secure flag is to prevent cookies from being observed by unauthorized parties due to the transmission of a cookie in clear text.

By setting the secure flag, the browser will prevent the transmission of a cookie over an unencrypted channel."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/web.xml

Navigate to the <session-config> node and configure the <secure> setting as follows:

<session-config>
  <session-timeout>30</session-timeout>
  <cookie-config>
      <http-only>true</http-only>
      <secure>true</secure>
  </cookie-config>
</session-config>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CAT|II,CCI|CCI-000213,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-258972r960792_rule,STIG-ID|VCST-80-000005,TBA-FIISB|31.1,Vuln-ID|V-258972"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --format /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/sed 's/xmlns=\".*\"//g' | /bin/xmllint --xpath '/web-app/session-config/cookie-config/secure' -"
      expect      : "^[\\s]*<secure>true</secure>[\\s]*$"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "VCST-80-000013 The vCenter STS service must initiate session logging upon startup."
      info        : "Logging must be started as soon as possible when a service starts and as late as possible when a service is stopped. Many forms of suspicious actions can be detected by analyzing logs for unexpected service starts and stops. Also, by starting to log immediately after a service starts, it becomes more difficult for suspicious activity to go unlogged."
      solution    : "Navigate to and open:

/etc/vmware/vmware-vmon/svcCfgfiles/sts-lin.json

Below the last line of the \"PreStartCommandArg\" block, add the following line:

\"StreamRedirectFile\" : \"%VMWARE_LOG_DIR%/vmware/sso/sts-runtime.log\",

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-53|AU-14(1),800-53r5|AU-14(1),CAT|II,CCI|CCI-001464,CSF|PR.PT-1,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-14,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-258973r960888_rule,STIG-ID|VCST-80-000013,SWIFT-CSCv1|6.4,Vuln-ID|V-258973"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/etc/vmware/vmware-vmon/svcCfgfiles/sts-lin.json"
      regex       : "^[\\s]*[\"']StreamRedirectFile[\"'][\\s]*:"
      expect      : "^[\\s]*[\"']StreamRedirectFile[\"'][\\s]*:[\\s]*[\"']@LOG_FILE@[\"'],?[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000014 The vCenter STS service must produce log records containing sufficient information regarding event details."
      info        : "Remote access can be exploited by an attacker to compromise the server. By recording all remote access activities, it will be possible to determine the attacker's location, intent, and degree of success.

Tomcat can be configured with an \"AccessLogValve\", a component that can be inserted into the request processing pipeline to provide robust access logging. The \"AccessLogValve\" creates log files in the same format as those created by standard web servers. When \"AccessLogValve\" is properly configured, log files will contain all the forensic information necessary in the case of a security incident.

Satisfies: SRG-APP-000095-AS-000056, SRG-APP-000016-AS-000013, SRG-APP-000096-AS-000059, SRG-APP-000097-AS-000060, SRG-APP-000098-AS-000061, SRG-APP-000099-AS-000062, SRG-APP-000100-AS-000063, SRG-APP-000080-AS-000045, SRG-APP-000089-AS-000050, SRG-APP-000090-AS-000051, SRG-APP-000091-AS-000052, SRG-APP-000343-AS-000030, SRG-APP-000375-AS-000211, SRG-APP-000495-AS-000220, SRG-APP-000499-AS-000224, SRG-APP-000503-AS-000228"
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Inside the <Host> node, find the \"AccessLogValve\" <Valve> node and replace the \"pattern\" element as follows:

pattern=\"%t %I [Request] &quot;%{User-Agent}i&quot; %{X-Forwarded-For}i/%h:%{remote}p %l %u to local %{local}p - &quot;%r&quot; %H %m %U%q [Response] %s - %b bytes [Perf] process %Dms / commit %Fms / conn [%X]\"

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.1.7,800-171|3.1.12,800-171|3.3.1,800-171|3.3.2,800-171|3.3.7,800-53|AC-6(9),800-53|AC-17(1),800-53|AU-3,800-53|AU-8b.,800-53|AU-10,800-53|AU-12a.,800-53|AU-12b.,800-53|AU-12c.,800-53r5|AC-6(9),800-53r5|AC-17(1),800-53r5|AU-3a.,800-53r5|AU-3b.,800-53r5|AU-3c.,800-53r5|AU-3d.,800-53r5|AU-3e.,800-53r5|AU-3f.,800-53r5|AU-8b.,800-53r5|AU-10,800-53r5|AU-12a.,800-53r5|AU-12b.,800-53r5|AU-12c.,CAT|II,CCI|CCI-000067,CCI|CCI-000130,CCI|CCI-000131,CCI|CCI-000132,CCI|CCI-000133,CCI|CCI-000134,CCI|CCI-000166,CCI|CCI-000169,CCI|CCI-000171,CCI|CCI-000172,CCI|CCI-001487,CCI|CCI-001889,CCI|CCI-002234,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.2(d),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(b),CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(i),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.PT-1,CSF|PR.PT-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.AA-05,CSF2.0|PR.PS-04,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.12.4.1,ISO/IEC-27001|A.12.4.3,ITSG-33|AC-6,ITSG-33|AC-17(1),ITSG-33|AU-3,ITSG-33|AU-8,ITSG-33|AU-10,ITSG-33|AU-12a.,ITSG-33|AU-12b.,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NESA|T3.6.7,NESA|T4.3.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.4,NESA|T5.5.4,NESA|T7.3.3,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,NIAv2|SM8,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,PCI-DSSv4.0|10.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-258974r960891_rule,STIG-ID|VCST-80-000014,SWIFT-CSCv1|2.6,SWIFT-CSCv1|5.1,SWIFT-CSCv1|6.4,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,TBA-FIISB|37.4,TBA-FIISB|45.1.1,Vuln-ID|V-258974"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath '/Server/Service/Engine/Host/Valve[@className=\"org.apache.catalina.valves.AccessLogValve\"]'/@pattern /usr/lib/vmware-sso/vmware-sts/conf/server.xml | /bin/awk '/%h/ &&/%\{X-Forwarded-For\}i/ &&/%l/ &&/%t/ &&/%u/ &&/\&quot;%r\&quot;/ &&/%s/ &&/%b/' | /bin/awk '{print} END {if (NR == 1) print \"pass\"; else print \"fail\"}'"
      expect      : "(?i)^[\\s]*\\**[\\s]*pass:?[\\s]*\\**$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000025 The vCenter STS service logs folder permissions must be set correctly."
      info        : "Log data is essential in the investigation of events. The accuracy of the information is always pertinent. One of the first steps an attacker will take is the modification or deletion of log records to cover tracks and prolong discovery. The web server must protect the log data from unauthorized modification.

Satisfies: SRG-APP-000118-AS-000078, SRG-APP-000119-AS-000079, SRG-APP-000120-AS-000080"
      solution    : "At the command prompt, run the following commands:

# chmod o-w <file>
# chown sts:lwis <file>

Note: Substitute <file> with the listed file."
      reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9a.,CAT|II,CCI|CCI-000162,CCI|CCI-000163,CCI|CCI-000164,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,CSF2.0|PR.DS-10,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-258975r960930_rule,STIG-ID|VCST-80-000025,Vuln-ID|V-258975"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/find /var/log/vmware/sso/ -xdev ! -name lookupsvc-init.log ! -name sts-prestart.log -type f -a '(' -perm -o+w -o -not -user sts -o -not -group lwis ')' -exec ls -ld {} \\; | /bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "(?i)^[\\s]*\\**[\\s]*pass:?[\\s]*\\**$"
      timeout     : "@FIND_TIMEOUT@"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "VCST-80-000034 The vCenter STS service must limit privileges for creating or modifying hosted application shared files."
      info        : "Application servers have the ability to specify that the hosted applications use shared libraries. The application server must have a capability to divide roles based upon duties wherein one project user (such as a developer) cannot modify the shared library code of another project user. The application server must also be able to specify that nonprivileged users cannot modify any shared library code at all.

Ensuring the Security Lifecycle Listener element is uncommented and sets a minimum Umask value will allow the server to perform a number of security checks when starting and prevent the service from starting if they fail."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Navigate to the <Server> node and add or update the \"org.apache.catalina.security.SecurityListener\" as follows:

<Listener className=\"org.apache.catalina.security.SecurityListener\"/>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.5,800-53|CM-5(6),800-53r5|CM-5(6),CAT|II,CCI|CCI-001499,CSF|PR.IP-1,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(6),NESA|T3.2.3,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,QCSC-v1|7.2,Rule-ID|SV-258976r960960_rule,STIG-ID|VCST-80-000034,Vuln-ID|V-258976"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      regex       : "<Listener[\\s]+className=[\"']org.apache.catalina.security.SecurityListener[\"'][\\s]*"
      expect      : "<Listener[\\s]+className=[\"']org.apache.catalina.security.SecurityListener[\"'](?:[\\s]+minimumUmask=[\"']0007[\"'])?[\\s]*\/>[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000036 The vCenter STS service must disable stack tracing."
      info        : "Stack tracing provides debugging information from the application call stacks when a runtime error is encountered. If stack tracing is left enabled, Tomcat will provide this call stack information to the requestor, which could result in the loss of sensitive information or data that could be used to compromise the system."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Navigate to and locate:

'allowTrace=\"true\"'

Remove the 'allowTrace=\"true\"' setting.

Note: If \"allowTrace\" is not present, it defaults to false.

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258977r960963_rule,STIG-ID|VCST-80-000036,SWIFT-CSCv1|2.3,Vuln-ID|V-258977"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Connector[@allowTrace = 'true']\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*XPath[\\s]+set[\\s]+is[\\s]+empty[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000037 The vCenter STS service must be configured to use a specified IP address and port."
      info        : "The server must be configured to listen on a specified IP address and port. Without specifying an IP address and port for server to use, the server will listen on all IP addresses available.

Accessing the hosted application through an IP address normally used for nonapplication functions opens the possibility of user access to resources, utilities, files, ports, and protocols that are protected on the desired application IP address."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

The STS service has 2 connectors with the below pairs of ports and addresses.

Navigate to the target <Connector> node and configure the port and address as follows.

port=\"${bio-custom.http.port}\"
address=\"localhost\"

port=\"${bio-ssl-localhost.https.port}\"
address=\"localhost\"

Restart the service with the following command:

# vmon-cli --restart sts

Note: The connector with port=\"${bio-ssl-clientauth.https.port}\" should not have address set."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|II,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-258978r960966_rule,STIG-ID|VCST-80-000037,SWIFT-CSCv1|2.3,Vuln-ID|V-258978"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Connector[not(@port = \"${bio-ssl-clientauth.https.port}\") and (@port = \"0\" or not(@address))]\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*XPath[\\s]+set[\\s]+is[\\s]+empty[\\s]*$"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "VCST-80-000057 The vCenter STS service must be configured to limit data exposure between applications."
      info        : "If RECYCLE_FACADES is true or if a security manager is in use, a new facade object will be created for each request. This reduces the chances that a bug in an application might expose data from one request to another."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties

Update or remove the following line:

org.apache.catalina.connector.RECYCLE_FACADES=true

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.13.15,800-53|SC-23(3),800-53r5|SC-23(3),CAT|II,CCI|CCI-001664,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-23(3),NESA|T4.5.1,QCSC-v1|5.2.1,Rule-ID|SV-258979r961116_rule,STIG-ID|VCST-80-000057,Vuln-ID|V-258979"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties"
      regex       : "^[\\s]*org.apache.catalina.connector.RECYCLE_FACADES[\\s]*=[\\s]*"
      expect      : "^[\\s]*org.apache.catalina.connector.RECYCLE_FACADES[\\s]*=[\\s]*true[\\s]*$"
      required    : NO
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "VCST-80-000062 The vCenter STS service must be configured to fail to a known safe state if system initialization fails."
      info        : "Determining a safe state for failure and weighing that against a potential denial of service for users depends on what type of application the web server is hosting. It is preferable that the service abort startup on any initialization failure rather than continuing in a degraded, and potentially insecure, state."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties

Add or change the following line:

org.apache.catalina.startup.EXIT_ON_INIT_FAILURE=true

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-53|SC-24,800-53r5|SC-24,CAT|II,CCI|CCI-001190,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-24,ITSG-33|SC-24a.,QCSC-v1|5.2.1,Rule-ID|SV-258980r961122_rule,STIG-ID|VCST-80-000062,Vuln-ID|V-258980"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties"
      regex       : "^[\\s]*org.apache.catalina.startup.EXIT_ON_INIT_FAILURE[\\s]*=[\\s]*"
      expect      : "^[\\s]*org.apache.catalina.startup.EXIT_ON_INIT_FAILURE[\\s]*=[\\s]*true[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000065 The vCenter STS service must set URIEncoding to UTF-8."
      info        : "Invalid user input occurs when a user inserts data or characters into a hosted application's data entry field and the hosted application is unprepared to process that data. This results in unanticipated application behavior, potentially leading to an application compromise. Invalid user input is one of the primary methods employed when attempting to compromise an application.

An attacker can also enter Unicode characters into hosted applications in an effort to break out of the document home or root home directory or bypass security checks."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Configure the <Connector> node with the value:

URIEncoding=\"UTF-8\"

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-53|SI-10,800-53r5|SI-10,CAT|II,CCI|CCI-001310,CN-L3|8.1.4.4(d),CSF2.0|PR.DS-10,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-10,ITSG-33|SI-10a.,NESA|T7.3.1,NESA|T7.3.2,NIAv2|SS6e,Rule-ID|SV-258981r961158_rule,STIG-ID|VCST-80-000065,Vuln-ID|V-258981"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Connector[@URIEncoding != 'UTF-8'] | //Connector[not(@URIEncoding)]\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*XPath[\\s]+set[\\s]+is[\\s]+empty[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000067 The vCenter STS service 'ErrorReportValve showServerInfo' must be set to 'false'."
      info        : "The Error Report Valve is a simple error handler for HTTP status codes that will generate and return HTML error pages. It can also be configured to return predefined static HTML pages for specific status codes and/or exception types. Disabling 'showServerInfo' will only return the HTTP status code and remove all CSS from the default nonerror-related HTTP responses."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Locate the following Host block:

<Host ...>
...
</Host>

Inside this block, add or update the following on a new line:

<Valve className=\"org.apache.catalina.valves.ErrorReportValve\" showServerInfo=\"false\" showReport=\"false\"/>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-53|SI-11a.,800-53r5|SI-11a.,CAT|II,CCI|CCI-001312,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-11b.,Rule-ID|SV-258982r961167_rule,STIG-ID|VCST-80-000067,Vuln-ID|V-258982"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath '/Server/Service/Engine/Host/Valve[@className=\"org.apache.catalina.valves.ErrorReportValve\"]' /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "<Valve[\\s]+className=[\"']org.apache.catalina.valves.ErrorReportValve[\"'][\\s\\S]*showServerInfo=[\"']false[\"'][\\s\\S]*\\/>"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000070 The vCenter STS service must set an inactive timeout for sessions."
      info        : "Leaving sessions open indefinitely is a major security risk. An attacker can easily use an already authenticated session to access the hosted application as the previously authenticated user. By closing sessions after a set period of inactivity, the web server can make certain that those sessions that are not closed through the user logging out of an application are eventually closed.

Satisfies: SRG-APP-000295-AS-000263, SRG-APP-000389-AS-000253"
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/web.xml

Navigate to the <session-config> node and configure the <session-timeout> as follows:

<session-config>
  <session-timeout>30</session-timeout>
  <cookie-config>
      <http-only>true</http-only>
      <secure>true</secure>
  </cookie-config>
</session-config>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.1.11,800-53|AC-12,800-53r5|AC-12,800-53r5|SC-11b.,CAT|II,CCI|CCI-002361,CCI|CCI-004895,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSF2.0|PR.AA-03,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,Rule-ID|SV-258983r1003673_rule,STIG-ID|VCST-80-000070,Vuln-ID|V-258983"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --format /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/sed 's/xmlns=\".*\"//g' | /bin/xmllint --xpath '/web-app/session-config/session-timeout' -"
      expect      : "^[\\s]*<session-timeout>@SESSION_TIMEOUT@</session-timeout>[\\s]*$"
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "check for vmidentity logs - activedirectory"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/activedirectoryservice.log\"[\\s]+Tag=\"activedirectoryservice\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\}T\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}.\\[\\[:digit:\\]\\]\\{0,3\\}Z\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for vmidentity logs - ssolookupsvc-init"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/lookupsvc-init.log\"[\\s]+Tag=\"ssolookupsvc-init\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\}T\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}.\\[\\[:digit:\\]\\]\\{0,3\\}Z\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for vmidentity logs - openidconnect"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/openidconnect.log\"[\\s]+Tag=\"openidconnect\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\}T\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}.\\[\\[:digit:\\]\\]\\{0,3\\}Z\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for vmidentity logs - ssoadminserver"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/ssoAdminServer.log\"[\\s]+Tag=\"ssoadminserver\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\}T\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}.\\[\\[:digit:\\]\\]\\{0,3\\}Z\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for vmidentity logs - svcaccountmgmt"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/svcaccountmgmt.log\"[\\s]+Tag=\"svcaccountmgmt\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\}T\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}.\\[\\[:digit:\\]\\]\\{0,3\\}Z\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for vmidentity logs - tokenservice"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/tokenservice.log\"[\\s]+Tag=\"tokenservice\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\}T\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}.\\[\\[:digit:\\]\\]\\{0,3\\}Z\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for sts health log"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/sts-health-status.log\"[\\s]+Tag=\"sts-health-status\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\} \\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\},\\[\\[:digit:\\]\\]\\{0,4\\}\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for sts runtime log stdout"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/sts-runtime.log.stdout\"[\\s]+Tag=\"sts-runtime-stdout\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for sts runtime log stderr"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/sts-runtime.log.stderr\"[\\s]+Tag=\"sts-runtime-stderr\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for gclogFile.0.current log"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/gclogFile.\\*.current\"[\\s]+Tag=\"gclog\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+startmsg.regex=\"\\^\\[\\[:digit:\\]\\]\\{4\\}-\\[\\[:digit:\\]\\]\\{1,2\\}-\\[\\[:digit:\\]\\]\\{1,2\\}T\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}:\\[\\[:digit:\\]\\]\\{1,2\\}.\\[\\[:digit:\\]\\]\\{0,3\\}\\+\\[\\[:digit:\\]\\]\\{0,4\\}\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for identity sts default"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/vmware-identity-sts-default.log\"[\\s]+Tag=\"sso-identity-sts-default\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for identity sts"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/vmware-identity-sts.log\"[\\s]+Tag=\"sso-identity-sts\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for identity perf"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/vmware-identity-sts-perf.log\"[\\s]+Tag=\"sso-identity-perf\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for identity prestart"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/sts-prestart.log\"[\\s]+Tag=\"sso-identity-prestart\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for rest idm"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/vmware-rest-idm.log\"[\\s]+Tag=\"sso-rest-idm\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for rest vmdir"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/vmware-rest-vmdir.log\"[\\s]+Tag=\"sso-rest-vmdir\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for rest afd"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/vmware-rest-afd.log\"[\\s]+Tag=\"sso-rest-afd\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for websso"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/websso.log\"[\\s]+Tag=\"sso-websso\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for tomcat catalina"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/tomcat/catalina.\\*.log\"[\\s]+Tag=\"sso-tomcat-catalina\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for tomcat localhost"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/tomcat/localhost.\\*.log\"[\\s]+Tag=\"sso-tomcat-localhost\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for tomcat localhost access"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/sso/tomcat/localhost_access.log\"[\\s]+Tag=\"sso-tomcat-localhost-access\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for vmdir log"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/vmdir/\\*.log\"[\\s]+Tag=\"vmdir\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for vmafd log"
          cmd         : "/bin/echo $(/bin/cat /etc/vmware-syslog/vmware-services-sso-services.conf)"
          expect      : "[\\s]*input\\(type=\"imfile\"[\\s]+File=\"/var/log/vmware/vmafd/\\*.log\"[\\s]+Tag=\"vmafd\"[\\s]+PersistStateInterval=\"200\"[\\s]+Severity=\"info\"[\\s]+Facility=\"local0\"\\)[\\s]*"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "VCST-80-000081 The vCenter STS service must offload log records onto a different system or media from the system being logged."
          info        : "Information system logging capability is critical for accurate forensic analysis. Log record content that may be necessary to satisfy the requirement of this control includes, but is not limited to, time stamps, source and destination IP addresses, user/process identifiers, event descriptions, application-specific events, success/fail indications, filenames involved, and access control or flow control rules invoked.

Offloading is a common process in information systems with limited log storage capacity.

Centralized management of log records provides for efficiency in maintenance and management of records, as well as the backup and archiving of those records. Application servers and their related components are required to offload log records onto a different system or media than the system being logged."
          solution    : "Navigate to and open:

/etc/vmware-syslog/vmware-services-sso-services.conf

Create the file if it does not exist.

Set the contents of the file as follows:

#vmidentity logs
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/activedirectoryservice.log\"
      Tag=\"activedirectoryservice\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2}T[[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2}.[[:digit:]]{0,3}Z\"
      Facility=\"local0\")
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/lookupsvc-init.log\"
      Tag=\"ssolookupsvc-init\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2}T[[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2}.[[:digit:]]{0,3}Z\"
      Facility=\"local0\")
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/openidconnect.log\"
      Tag=\"openidconnect\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2}T[[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2}.[[:digit:]]{0,3}Z\"
      Facility=\"local0\")
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/ssoAdminServer.log\"
      Tag=\"ssoadminserver\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2}T[[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2}.[[:digit:]]{0,3}Z\"
      Facility=\"local0\")
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/svcaccountmgmt.log\"
      Tag=\"svcaccountmgmt\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2}T[[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2}.[[:digit:]]{0,3}Z\"
      Facility=\"local0\")
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/tokenservice.log\"
      Tag=\"tokenservice\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2}T[[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2}.[[:digit:]]{0,3}Z\"
      Facility=\"local0\")
#sts health log
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/sts-health-status.log\"
      Tag=\"sts-health-status\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2} [[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2},[[:digit:]]{0,4}\"
      Facility=\"local0\")
#sts runtime log stdout
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/sts-runtime.log.stdout\"
      Tag=\"sts-runtime-stdout\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#sts runtime log stderr
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/sts-runtime.log.stderr\"
      Tag=\"sts-runtime-stderr\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#gclogFile.0.current log
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/gclogFile.*.current\"
      Tag=\"gclog\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      startmsg.regex=\"^[[:digit:]]{4}-[[:digit:]]{1,2}-[[:digit:]]{1,2}T[[:digit:]]{1,2}:[[:digit:]]{1,2}:[[:digit:]]{1,2}.[[:digit:]]{0,3}+[[:digit:]]{0,4}\"
      Facility=\"local0\")
#identity sts default
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/vmware-identity-sts-default.log\"
      Tag=\"sso-identity-sts-default\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#identity sts
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/vmware-identity-sts.log\"
      Tag=\"sso-identity-sts\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#identity perf
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/vmware-identity-sts-perf.log\"
      Tag=\"sso-identity-perf\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#identity prestart
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/sts-prestart.log\"
      Tag=\"sso-identity-prestart\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#rest idm
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/vmware-rest-idm.log\"
      Tag=\"sso-rest-idm\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#rest vmdir
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/vmware-rest-vmdir.log\"
      Tag=\"sso-rest-vmdir\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#rest afd
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/vmware-rest-afd.log\"
      Tag=\"sso-rest-afd\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#websso
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/websso.log\"
      Tag=\"sso-websso\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#tomcat catalina
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/tomcat/catalina.*.log\"
      Tag=\"sso-tomcat-catalina\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#tomcat localhost
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/tomcat/localhost.*.log\"
      Tag=\"sso-tomcat-localhost\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#tomcat localhost access
input(type=\"imfile\"
      File=\"/var/log/vmware/sso/tomcat/localhost_access.log\"
      Tag=\"sso-tomcat-localhost-access\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#vmdir log
input(type=\"imfile\"
      File=\"/var/log/vmware/vmdir/*.log\"
      Tag=\"vmdir\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")
#vmafd log
input(type=\"imfile\"
      File=\"/var/log/vmware/vmafd/*.log\"
      Tag=\"vmafd\"
      PersistStateInterval=\"200\"
      Severity=\"info\"
      Facility=\"local0\")"
          reference   : "800-53|AU-4(1),800-53r5|AU-4(1),CAT|II,CCI|CCI-001851,CSF|PR.DS-4,CSF|PR.PT-1,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-258984r961395_rule,STIG-ID|VCST-80-000081,Vuln-ID|V-258984"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
          show_output : YES
        </report>
      </then>
    </if>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000125 The vCenter STS service must limit the amount of time that each Transmission Control Protocol (TCP) connection is kept alive."
      info        : "Denial of service (DoS) is one threat against web servers. Many DoS attacks attempt to consume web server resources in such a way that no more resources are available to satisfy legitimate requests.

In Tomcat, the \"connectionTimeout\" attribute sets the number of milliseconds the server will wait after accepting a connection for the request Uniform Resource Identifier (URI) line to be presented. This timeout will also be used when reading the request body (if any). This prevents idle sockets that are not sending HTTP requests from consuming system resources and potentially denying new connections."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Configure the <Connector> node with the value:

connectionTimeout=\"60000\"

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-53|AC-10,800-53r5|AC-10,CAT|II,CCI|CCI-000054,CSF2.0|PR.AA-05,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,Rule-ID|SV-258985r960735_rule,STIG-ID|VCST-80-000125,Vuln-ID|V-258985"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Connector[@connectionTimeout = '-1']\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*XPath[\\s]+set[\\s]+is[\\s]+empty[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000126 The vCenter STS service must limit the number of times that each Transmission Control Protocol (TCP) connection is kept alive."
      info        : "KeepAlive provides long lived HTTP sessions that allow multiple requests to be sent over the same connection. Enabling KeepAlive mitigates the effects of several types of denial-of-service attacks.

An advantage of KeepAlive is the reduced latency in subsequent requests (no handshaking). However, a disadvantage is that server resources are not available to handle other requests while a connection is maintained between the server and the client.

Tomcat can be configured to limit the number of subsequent requests that one client can submit to the server over an established connection. This limit helps provide a balance between the advantages of KeepAlive, while not allowing any one connection being held too long by any one client."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Configure the <Connector> node with the value:

maxKeepAliveRequests=\"100\"

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-53|AC-10,800-53r5|AC-10,CAT|II,CCI|CCI-000054,CSF2.0|PR.AA-05,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,Rule-ID|SV-258986r960735_rule,STIG-ID|VCST-80-000126,Vuln-ID|V-258986"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Connector[@maxKeepAliveRequests = '-1']\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*XPath[\\s]+set[\\s]+is[\\s]+empty[\\s]*$"
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "VCST-80-000127 The vCenter STS service must configure the 'setCharacterEncodingFilter' filter."
          cmd         : "/bin/echo $(/bin/xmllint --format /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/sed 's/xmlns=\".*\"//g' | /bin/xmllint --xpath '/web-app/filter-mapping/filter-name[text()=\"setCharacterEncodingFilter\"]/parent::filter-mapping' -)"
          expect      : "^[\\s]*<filter-mapping>[\\s]*<filter-name>setCharacterEncodingFilter</filter-name>[\\s]*<url-pattern>/\\*</url-pattern>[\\s]*</filter-mapping>[\\s]*$"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "VCST-80-000127 The vCenter STS service must configure the 'setCharacterEncodingFilter' filter."
          cmd         : "/bin/echo $(/bin/xmllint --format /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/sed 's/xmlns=\".*\"//g' | /bin/xmllint --xpath '/web-app/filter/filter-name[text()=\"setCharacterEncodingFilter\"]/parent::filter' -)"
          expect      : "^[\\s]*<filter>[\\s]*<filter-name>setCharacterEncodingFilter</filter-name>[\\s]*<filter-class>org.apache.catalina.filters.SetCharacterEncodingFilter</filter-class>[\\s]*<async-supported>true</async-supported>[\\s]*<init-param>[\\s]*<param-name>encoding</param-name>[\\s]*<param-value>UTF-8</param-value>[\\s]*</init-param>[\\s]*<init-param>[\\s]*<param-name>ignore</param-name>[\\s]*<param-value>true</param-value>[\\s]*</init-param>[\\s]*</filter>[\\s]*$"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "VCST-80-000127 The vCenter STS service must configure the 'setCharacterEncodingFilter' filter."
          info        : "Invalid user input occurs when a user inserts data or characters into a hosted application's data entry field and the hosted application is unprepared to process that data. This results in unanticipated application behavior, potentially leading to an application compromise. Invalid user input is one of the primary methods employed when attempting to compromise an application.

An attacker can also enter Unicode characters into hosted applications in an effort to break out of the document home or root home directory or to bypass security checks. VMware uses the standard Tomcat \"SetCharacterEncodingFilter\" to provide a layer of defense against character encoding attacks. Filters are Java objects that perform filtering tasks on the request to a resource (a servlet or static content), on the response from a resource, or both."
          solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/web.xml

Configure the <web-app> node with the child nodes listed below:

<filter-mapping>
  <filter-name>setCharacterEncodingFilter</filter-name>
  <url-pattern>/*</url-pattern>
</filter-mapping>

<filter>
  <filter-name>setCharacterEncodingFilter</filter-name>
  <filter-class>org.apache.catalina.filters.SetCharacterEncodingFilter</filter-class>
  <async-supported>true</async-supported>
  <init-param>
    <param-name>encoding</param-name>
    <param-value>UTF-8</param-value>
  </init-param>
  <init-param>
    <param-name>ignore</param-name>
    <param-value>true</param-value>
  </init-param>
</filter>

Restart the service with the following command:

# vmon-cli --restart sts"
          reference   : "800-53|SI-10,800-53r5|SI-10,CAT|II,CCI|CCI-001310,CN-L3|8.1.4.4(d),CSF2.0|PR.DS-10,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SI-10,ITSG-33|SI-10a.,NESA|T7.3.1,NESA|T7.3.2,NIAv2|SS6e,Rule-ID|SV-258987r961158_rule,STIG-ID|VCST-80-000127,Vuln-ID|V-258987"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
          show_output : YES
        </report>
      </then>
    </if>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000129 The vCenter STS service cookies must have 'http-only' flag set."
      info        : "Cookies are a common way to save session state over the HTTP(S) protocol. If attackers can compromise session data stored in a cookie, they are better able to launch an attack against the server and its applications. When a cookie is tagged with the 'HttpOnly' flag, it tells the browser this particular cookie should only be accessed by the originating server. Any attempt to access the cookie from client script is strictly forbidden."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/web.xml

Navigate to the <session-config> node and configure the <http-only> as follows:

<session-config>
  <session-timeout>30</session-timeout>
  <cookie-config>
      <http-only>true</http-only>
      <secure>true</secure>
  </cookie-config>
</session-config>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CAT|II,CCI|CCI-000213,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-258988r960792_rule,STIG-ID|VCST-80-000129,TBA-FIISB|31.1,Vuln-ID|V-258988"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --format /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/sed 's/xmlns=\".*\"//g' | /bin/xmllint --xpath '/web-app/session-config/cookie-config/http-only' -"
      expect      : "^[\\s]*<http-only>true</http-only>[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000130 The vCenter STS service DefaultServlet must be set to 'readonly' for 'PUT' and 'DELETE' commands."
      info        : "The default servlet (or DefaultServlet) is a special servlet provided with Tomcat that is called when no other suitable page is found in a particular folder. The DefaultServlet serves static resources as well as directory listings. The DefaultServlet is configured by default with the 'readonly' parameter set to 'true' where HTTP commands such as 'PUT' and 'DELETE' are rejected.

Changing this to \"false\" allows clients to delete or modify static resources on the server and to upload new resources. DefaultServlet \"readonly\" must be set to \"true\", either literally or by absence (default)."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/web.xml

Navigate to the /<web-apps>/<servlet>/<servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>/ node and remove the following node:

<init-param>
      <param-name>readonly</param-name>
      <param-value>false</param-value>
</init-param>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CAT|II,CCI|CCI-000213,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-258989r960792_rule,STIG-ID|VCST-80-000130,TBA-FIISB|31.1,Vuln-ID|V-258989"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//*[contains(text(), 'DefaultServlet')]/parent::*\" /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/xmllint --xpath 'servlet/init-param[param-name[text()=\"readonly\"]]/param-value' -"
      expect      : "^[\\s]*(XPath[\\s]+set[\\s]+is[\\s]+empty|<param-value>true</param-value>)[\\s]*$"
    </custom_item>

    <if>
      <condition auto:"FAILED" type:"AND">
        <custom_item>
          type        : FILE_CONTENT_CHECK
          description : "VCST-80-000134 The vCenter STS service shutdown port must be disabled."
          file        : "/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties"
          regex       : "^[\\s]*base.shutdown.port[\\s]*=[\\s]*"
          expect      : "^[\\s]*base.shutdown.port[\\s]*=[\\s]*-1[\\s]*$"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "VCST-80-000134 The vCenter STS service shutdown port must be disabled."
          cmd         : "/bin/xmllint --xpath '//Server/@port' /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
          expect      : "^[\\s]*port[\\s]*=[\\s]*[\"']\\$\\{base.shutdown.port\\}[\"'][\\s]*$"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "VCST-80-000134 The vCenter STS service shutdown port must be disabled."
          info        : "Tomcat by default listens on TCP port 8005 to accept shutdown requests. By connecting to this port and sending the SHUTDOWN command, all applications within Tomcat are halted. The shutdown port is not exposed to the network as it is bound to the loopback interface. Setting the port to '-1' in $CATALINA_BASE/conf/server.xml instructs Tomcat to not listen for the shutdown command."
          solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties

Add or modify the setting \"base.shutdown.port=-1\" in the \"catalina.properties\" file.

Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Configure the <Server> node with the value:

port=\"${base.shutdown.port}\"

Restart the service with the following command:

# vmon-cli --restart sts"
          reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258990r960963_rule,STIG-ID|VCST-80-000134,SWIFT-CSCv1|2.3,Vuln-ID|V-258990"
          see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
          show_output : YES
        </report>
      </then>
    </if>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000136 The vCenter STS service debug parameter must be disabled."
      info        : "Information needed by an attacker to begin looking for possible vulnerabilities in a web server includes any information about the web server and plug-ins or modules being used. When debugging or trace information is enabled in a production web server, information about the web server, such as web server type, version, patches installed, plug-ins and modules installed, type of code being used by the hosted application, and any backends being used for data storage may be displayed.

Because this information may be placed in logs and general messages during normal operation of the web server, an attacker does not need to cause an error condition to gain this information."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/web.xml

Navigate to all <debug> nodes that are not set to \"0\".

Set the <param-value> to \"0\" in all <param-name>debug</param-name> nodes.

Note: The debug setting should look like the following:

<init-param>
      <param-name>debug</param-name>
      <param-value>0</param-value>
</init-param>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258991r960963_rule,STIG-ID|VCST-80-000136,SWIFT-CSCv1|2.3,Vuln-ID|V-258991"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/echo $(/bin/xmllint --format /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/sed 's/xmlns=\".*\"//g' | /bin/xmllint --xpath '//param-name[text()=\"debug\"]/parent::init-param' -)"
      expect      : "^[\\s]*(XPath[\\s]+set[\\s]+is[\\s]+empty|<init-param>[\\s]*<param-name>debug</param-name>[\\s]*<param-value>0</param-value>[\\s]*</init-param>)[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000137 The vCenter STS service directory listings parameter must be disabled."
      info        : "Enumeration techniques, such as URL parameter manipulation, rely on being able to obtain information about the web server's directory structure by locating directories without default pages. In this scenario, the web server will display to the user a listing of the files in the directory being accessed. Ensuring that directory listing is disabled is one approach to mitigating the vulnerability.

In Tomcat, directory listing is disabled by default but can be enabled via the \"listings\" parameter. Ensure this node is not present to have the default effect."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/web.xml

Find and remove the entire block returned in the check.

Example:

<init-param>
      <param-name>listings</param-name>
      <param-value>true</param-value>
</init-param>

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258992r960963_rule,STIG-ID|VCST-80-000137,SWIFT-CSCv1|2.3,Vuln-ID|V-258992"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/echo $(/bin/xmllint --format /usr/lib/vmware-sso/vmware-sts/conf/web.xml | /bin/sed 's/xmlns=\".*\"//g' | /bin/xmllint --xpath '//param-name[text()=\"listings\"]/parent::init-param' -)"
      expect      : "^[\\s]*(XPath[\\s]+set[\\s]+is[\\s]+empty|<init-param>[\\s]*<param-name>listings</param-name>[\\s]*<param-value>false</param-value>[\\s]*</init-param>)[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000138 The vCenter STS service deployXML attribute must be disabled."
      info        : "The Host element controls deployment. Automatic deployment allows for simpler management but also makes it easier for an attacker to deploy a malicious application. Automatic deployment is controlled by the autoDeploy and deployOnStartup attributes. If both are false, only Contexts defined in server.xml will be deployed, and any changes will require a Tomcat restart.

In a hosted environment where web applications may not be trusted, set the deployXML attribute to \"false\" to ignore any context.xml packaged with the web application that may try to assign increased privileges to the web application. Note that if the security manager is enabled, the deployXML attribute will default to false."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Navigate to the <Host> node and configure with the value \"deployXML=\"false\"\".

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-266136r1003677_rule,STIG-ID|VCST-80-000138,SWIFT-CSCv1|2.3,Vuln-ID|V-266136"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Host/@deployXML\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*deployXML[\\s]*=[\\s]*[\"']false[\"'][\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000139 The vCenter STS service must have Autodeploy disabled."
      info        : "Tomcat allows auto-deployment of applications while it is running. This can allow untested or malicious applications to be automatically loaded into production. Autodeploy must be disabled in production."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Navigate to the <Host> node and configure with the value \"autoDeploy=\"false\"\".

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258993r960963_rule,STIG-ID|VCST-80-000139,SWIFT-CSCv1|2.3,Vuln-ID|V-258993"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Host/@autoDeploy\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*autoDeploy[\\s]*=[\\s]*[\"\']false[\"\'][\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000140 The vCenter STS service xpoweredBy attribute must be disabled."
      info        : "Individual connectors can be configured to display the Tomcat information to clients. This information can be used to identify server versions that can be useful to attackers for identifying vulnerable versions of Tomcat. Individual connectors must be checked for the xpoweredBy attribute to ensure they do not pass server information to clients. The default value for xpoweredBy is 'false'."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/server.xml

Navigate to the <Connector> node and remove the \"xpoweredBy\" attribute.

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258994r960963_rule,STIG-ID|VCST-80-000140,SWIFT-CSCv1|2.3,Vuln-ID|V-258994"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/xmllint --xpath \"//Connector/@xpoweredBy\" /usr/lib/vmware-sso/vmware-sts/conf/server.xml"
      expect      : "^[\\s]*(XPath[\\s]+set[\\s]+is[\\s]+empty|xpoweredBy[\\s]*=[\\s]*\"false\")[\\s]*$"
    </custom_item>

    <custom_item>
      type        : FILE_CHECK_NOT
      description : "VCST-80-000141 The vCenter STS service example applications must be removed."
      info        : "Tomcat provides example applications, documentation, and other directories in the default installation that do not serve a production use. These files must be deleted."
      solution    : "At the command prompt, run the following command:

# rm -rf /var/opt/apache-tomcat/webapps/examples"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258995r960963_rule,STIG-ID|VCST-80-000141,SWIFT-CSCv1|2.3,Vuln-ID|V-258995"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/var/opt/apache-tomcat/webapps/examples"
    </custom_item>

    <custom_item>
      type        : FILE_CHECK_NOT
      description : "VCST-80-000142 The vCenter STS service default ROOT web application must be removed."
      info        : "The default ROOT web application includes the version of Tomcat being used, links to Tomcat documentation, examples, FAQs, and mailing lists. The default ROOT web application must be removed from a publicly accessible instance and a more appropriate default page shown to users."
      solution    : "At the command prompt, run the following command:

# rm -rf /var/opt/apache-tomcat/webapps/ROOT/*"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258996r960963_rule,STIG-ID|VCST-80-000142,SWIFT-CSCv1|2.3,Vuln-ID|V-258996"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/var/opt/apache-tomcat/webapps/ROOT"
    </custom_item>

    <custom_item>
      type        : FILE_CHECK_NOT
      description : "VCST-80-000143 The vCenter STS service default documentation must be removed."
      info        : "Tomcat provides documentation and other directories in the default installation that do not serve a production use. These files must be deleted."
      solution    : "At the command prompt, run the following command:

# rm -rf /var/opt/apache-tomcat/webapps/docs"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-258997r960963_rule,STIG-ID|VCST-80-000143,SWIFT-CSCv1|2.3,Vuln-ID|V-258997"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/var/opt/apache-tomcat/webapps/docs"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "VCST-80-000144 The vCenter STS service files must have permissions in an out-of-the-box state."
      info        : "As a rule, accounts on a web server are to be kept to a minimum. Only administrators, web managers, developers, auditors, and web authors require accounts on the machine hosting the web server. The resources to which these accounts have access must also be closely monitored and controlled."
      solution    : "At the command prompt, run the following commands:

# chmod o-w <file>
# chown root:root <file>

Note: Substitute <file> with the listed file."
      reference   : "800-171|3.4.5,800-53|CM-5(1),800-53r5|CM-5(1)(a),CAT|II,CCI|CCI-001813,CSF|PR.IP-1,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(1),NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,QCSC-v1|7.2,Rule-ID|SV-258998r961461_rule,STIG-ID|VCST-80-000144,Vuln-ID|V-258998"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      cmd         : "/bin/find /usr/lib/vmware-sso/ -xdev -type f -a '(' -perm -o+w -o -not -user root -o -not -group root ')' -exec ls -ld {} \\; | /bin/awk '{print} END {if (NR == 0) print \"pass\"; else print \"fail\"}'"
      expect      : "(?i)^[\\s]*\\**[\\s]*pass:?[\\s]*\\**$"
      timeout     : "@FIND_TIMEOUT@"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "VCST-80-000151 The vCenter STS service must disable 'ALLOW_BACKSLASH'."
      info        : "When Tomcat is installed behind a proxy configured to only allow access to certain contexts (web applications), an HTTP request containing '/\../' may allow attackers to work around the proxy restrictions using directory traversal attack methods. If 'allow_backslash' is 'true', the '\' character will be permitted as a path delimiter. The default value for the setting is 'false', but Tomcat must always be configured as if no proxy restricting context access was used, and 'allow_backslash' should be set to 'false' to prevent directory-traversal-style attacks. This setting can create operability issues with noncompliant clients."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties

Update or remove the following line:

org.apache.catalina.connector.ALLOW_BACKSLASH=false

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-258999r961863_rule,STIG-ID|VCST-80-000151,SWIFT-CSCv1|2.3,Vuln-ID|V-258999"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties"
      regex       : "^org.apache.catalina.connector.ALLOW_BACKSLASH[\\s]*=[\\s]*"
      expect      : "^org.apache.catalina.connector.ALLOW_BACKSLASH[\\s]*=[\\s]*false[\\s]*$"
      required    : NO
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "VCST-80-000152 The vCenter STS service must enable 'ENFORCE_ENCODING_IN_GET_WRITER'."
      info        : "Some clients try to guess the character encoding of text media when the mandated default of ISO-8859-1 should be used. Some browsers will interpret as UTF-7 when the characters are safe for ISO-8859-1. This can create the potential for a XSS attack. To defend against this, enforce_encoding_in_get_writer must be set to true."
      solution    : "Navigate to and open:

/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties

Update or remove the following line:

org.apache.catalina.connector.response.ENFORCE_ENCODING_IN_GET_WRITER=true

Restart the service with the following command:

# vmon-cli --restart sts"
      reference   : "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-259000r961863_rule,STIG-ID|VCST-80-000152,SWIFT-CSCv1|2.3,Vuln-ID|V-259000"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/usr/lib/vmware-sso/vmware-sts/conf/catalina.properties"
      regex       : "^org.apache.catalina.connector.response.ENFORCE_ENCODING_IN_GET_WRITER[\\s]*=[\\s]*"
      expect      : "^org.apache.catalina.connector.response.ENFORCE_ENCODING_IN_GET_WRITER[\\s]*=[\\s]*true[\\s]*$"
      required    : NO
    </custom_item>

    <custom_item>
      type        : FILE_CHECK_NOT
      description : "VCST-80-000154 The vCenter STS service manager webapp must be removed."
      info        : "Tomcat provides management functionality through either a default manager webapp or through local editing of the configuration files. The manager webapp files must be deleted, and administration must be performed through the local editing of the configuration files."
      solution    : "At the command prompt, run the following command:

# rm -rf /var/opt/apache-tomcat/webapps/manager"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-259001r960963_rule,STIG-ID|VCST-80-000154,SWIFT-CSCv1|2.3,Vuln-ID|V-259001"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/var/opt/apache-tomcat/webapps/manager"
    </custom_item>

    <custom_item>
      type        : FILE_CHECK_NOT
      description : "VCST-80-000155 The vCenter STS service host-manager webapp must be removed."
      info        : "Tomcat provides host management functionality through either a default host-manager webapp or through local editing of the configuration files. The host-manager webapp files must be deleted, and administration must be performed through the local editing of the configuration files."
      solution    : "At the command prompt, run the following command:

# rm -rf /var/opt/apache-tomcat/webapps/host-manager"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7a.,800-53r5|CM-7a.,CAT|II,CCI|CCI-000381,CN-L3|7.1.3.5(c),CN-L3|8.1.4.4(a),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|VMW_vSphere_8-0_VCSA_STS_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS15a,PCI-DSSv3.2.1|2.2.1,PCI-DSSv4.0|2.2.3,QCSC-v1|3.2,Rule-ID|SV-259002r1003674_rule,STIG-ID|VCST-80-000155,SWIFT-CSCv1|2.3,Vuln-ID|V-259002"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
      file        : "/var/opt/apache-tomcat/webapps/host-manager"
    </custom_item>
  </then>

  <else>
    <report type:"WARNING">
      description : "DISA_VMware_vSphere_8.0_vCenter_Appliance_Secure_Token_Service_(STS)_STIG_v2r1.audit from DISA VMware vSphere 8.0 vCenter Appliance Secure Token Service (STS) STIG v2r1"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_VMW_vSphere_8-0_Y24M08_STIG.zip"
    </report>
  </else>
</if>

</check_type>
