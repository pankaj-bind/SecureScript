#TRUSTED 36689ab3f93d560d8afc0c6bdf0be712d9063d2a9dd3a185fcca9f62816996bc0e5f0dacbc1e83afb6669459a4c18763b91844f5b5107d22f193eef237a74129bd36e64ffe8fde784caab9b0173d4268a772406a66717597977310d2a692967932879f49aaaf21255ec1853318a40ed40f3f1a1f02bae3e752f2f0353f4f188b0b96623d1e98544da084bc4e1f681fded9e496cbadccfa4529b81d0823a1abd3a2fa3a7059e059e19e0644dd337732f52a6f1331bf7f5f2db6e6303b0e154b380f22550eed93cd238348b6ef8fef5a002b0b0643b3271407d09a071ccee91de2ff4155d20b0985f40c2a3b8df729abaa81ea1f619653e02b88a4f0340b7429feaee72ba2c9fba1207f4a937c09832ce79e89010f206a51b98d46d63c92daba9cda1f48392795ba3b80b0f6fd905780cfb92fd3ccfff3682a295f8086e6b6d480a5db58477fe2264703a4b9dada325ff5b196e217080fee4cd5b3762f93779aabbe353acb4f1799e75c4de80becd3a2aeafcdaa2b686e232bf4d65e26c2eb373c58375c9e879633e4ee789d78db738dd0ad89f61fbdea4d3c65c1e75e30406b7ef6aede145a0f06f8d1a1054872ea34d70815f8becfc35e474cc35b00b328ef0d7b7da108e0aa1998392f5de785fbb6d210a71f18a49f568e7ef06c7fa16e6e7fd1c5876965a0cdd3b31dac6b0b1e17ce2e201c868eb24fe2a60370a8f49c1eaf
#TRUST-RSA-SHA256 1749a43dfd0a90ee52f0b14e393b1502cefa7888145db6fad57881df07b14a29110ec15368362589f9fbc1d5e1c6a39f09f23c69641315582bb6ae7224f8e1cf5d2242df81626ab738206ce425ef5477d299e435f69c45fc5b8eb7d17e3e46b7045e44380d0275e9e122d140f8bf0bbbcfebe91638d59a0475572f37462016793be5969e09c49e3f742fb1c489eae50351272dcca7727d9b9da82f7097f68276a8b7aa872b8bdb627f3ad4e68e20c7c598f95057e099c322f603513421fe4e6ae202ea33e63461fc2738428a04945476247c3bcdf0b31ed00d5054b2c24307307fac2d3c5968f9a5f09357fa5a7b80d3f2027842abece5046febaa03e357e45c5bc20e03310c31fcbfa9e8a3ff9a33814df520b6a15d8ff09a2dff0281f0ad065d242e061890b7e846bcdf29c7b8cfc634641d22ef6f3d51dc67010b1092d115c710789a0d3ed2799f88b2ef7a4a1e37cdc9dde603c2e8f0ae7cdf2bebbed3e165e33e14ab9a980d9919e8055084d5f94e69082357dca893e1279e2f1cd8344f4cb3ace4f1c0ce78194ed6d2c844183fdb002dc95b537858aeb01898ee27ae8bcef0c848977c413e77828678ba8e209b4551de120fc14b731d569be3c8804812e936f0f66e0a02127ba7c02641fd6d45af9fdd610824d839378a1e39240437137d768e568824196886892e3ceef47428b6ba32a4c39bd149f73d375ad41a8424
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2024/12/11 $
#
# Description : This document implements the security configuration as recommended by the
#               DISA Juniper EX Series Switches Network Device Management v2r2 STIG.
#
#<ui_metadata>
#<display_name>DISA Juniper EX Series Network Device Management v2r2</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>Juniper EX Series NDM</name>
#  <version>2.2.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip</link>
#</spec>
#<labels>juniper,disa,junos,router,ndm</labels>
#<benchmark_refs>CAT,CCE,CCI,DISA_Benchmark,Group-ID,Rule-ID,STIG-ID,STIG-Legacy,Vuln-ID</benchmark_refs>
#<variables>
#  <variable>
#    <name>SSH_CONNECTION_LIMIT</name>
#    <default>10</default>
#    <description>SSH Connection Limit</description>
#    <info>Concurrent sessions for administrative access</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>SSH_RATE_LIMIT</name>
#    <default>2</default>
#    <description>SSH Rate Limit</description>
#    <info>Number of connectiopns per one minute interval</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>BANNER_MESSAGE</name>
#    <default>You are accessing a U.S. Government (USG) Information System (IS) that is provided\nfor USG-authorized use only.\n\nBy using this IS (which includes any device attached to this IS), you consent to the\nfollowing conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes\nincluding, but not limited to, penetration testing, COMSEC monitoring, network\noperations and defense, personnel misconduct (PM), law enforcement (LE), and\ncounterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine\nmonitoring, interception, and search, and may be disclosed or used for any USG-\nauthorized purpose.\n\n-This IS includes security measures (e.g., authentication and access controls) to protect\nUSG interests--not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI\ninvestigative searching or monitoring of the content of privileged communications, or\nwork product, related to personal representation or services by attorneys,\npsychotherapists, or clergy, and their assistants.  Such communications and work product\nare private and confidential.  See User Agreement for details.</default>
#    <description>Login Banner Message</description>
#    <info>The DoD-approved system use notification banner.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PRIMARY_SYSLOG_SERVER</name>
#    <default>10.10.14.1</default>
#    <description>Primary Syslog Server</description>
#    <info>The primary or preferred syslog server used for forwarding alerts to the administrators.</info>
#    <value_type>HOSTNAME_IP_ADDRESS</value_type>
#  </variable>
#  <variable>
#    <name>SECONDARY_SYSLOG_SERVER</name>
#    <default>10.10.15.1</default>
#    <description>Secondary Syslog Server</description>
#    <info>The secondary syslog server used for forwarding alerts to the administrators.</info>
#    <value_type>HOSTNAME_IP_ADDRESS</value_type>
#  </variable>
#  <variable>
#    <name>PRIMARY_NTP_SERVER</name>
#    <default>10.10.10.1</default>
#    <description>Primary/Preferred NTP Server</description>
#    <info>The primary or preferred NTP server in the redundant NTP configuration.</info>
#    <value_type>HOSTNAME_IP_ADDRESS</value_type>
#  </variable>
#  <variable>
#    <name>SECONDARY_NTP_SERVER</name>
#    <default>10.10.11.1</default>
#    <description>Secondary NTP Server</description>
#    <info>The secondary NTP server in the redundant NTP configuration.</info>
#    <value_type>HOSTNAME_IP_ADDRESS</value_type>
#  </variable>
#  <variable>
#    <name>PRIMARY_RADIUS_SERVER</name>
#    <default>10.10.12.1</default>
#    <description>Primary Radius Server</description>
#    <info>The primary or preferred authentication server used for the primary source of authentication.</info>
#    <value_type>HOSTNAME_IP_ADDRESS</value_type>
#  </variable>
#  <variable>
#    <name>SECONDARY_RADIUS_SERVER</name>
#    <default>10.10.13.1</default>
#    <description>Secondary Radius Server</description>
#    <info>The secondary authentication server used for the source of authentication.</info>
#    <value_type>HOSTNAME_IP_ADDRESS</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Juniper">

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh connection-limit"
      regex       : "set system services ssh connection-limit"
      expect      : "set system services ssh connection-limit @SSH_CONNECTION_LIMIT@[\s]*$"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh rate-limit"
      regex       : "set system services ssh rate-limit"
      expect      : "set system services ssh rate-limit @SSH_RATE_LIMIT@[\s]*$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000010 - The Juniper EX switch must be configured to limit the number of concurrent management sessions to 10 or an organization-defined value."
      info        : "Device management includes the ability to control the number of administrators and management sessions that manage a device. Limiting the number of allowed administrators and sessions per administrator based on account type, role, or access type is helpful in limiting risks related to denial-of-service (DoS) attacks.

This requirement addresses concurrent sessions for administrative accounts and does not address concurrent sessions by a single administrator via multiple administrative accounts. The maximum number of concurrent sessions must be defined based upon mission needs and the operational environment for each system. At a minimum, limits must be set for SSH, HTTPS, account of last resort, and root account sessions.

Juniper switches apply session limits per access method (e.g., web management, SSH), which means the limit is applicable to local, remote, and root account sessions.

Unconfigured management access methods are disabled. For instance, if there is no [edit system services ssh] stanza, that service is unavailable and a connection-limit should not be configured because that will enable the service."
      solution    : "Enter the CLI configuration mode and enter the following commands to set the connection-limit to 1 or an organization defined number. If, based on operational needs, an organization defined number other than 1 is used, document the value in the SSP.

SSH example limiting connections to 1:
user@host> configure
user@host# set system services ssh connection-limit 1
user@host# commit"
      reference   : "800-53|AC-10,800-53r5|AC-10,CAT|II,CCI|CCI-000054,CSF2.0|PR.AA-05,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-10,NESA|T5.5.1,QCSC-v1|5.2.1,QCSC-v1|5.2.2,Rule-ID|SV-253878r1028864_rule,STIG-ID|JUEX-NM-000010,Vuln-ID|V-253878"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "syslog host change-log and interactive-commands"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ (change-log|interactive-commands) info"
      number_of_lines : "^4$"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "syslog host any"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ any info"
      number_of_lines : "^2$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000020 - The Juniper EX switch must be configured to automatically audit account creation."
      info        : "Upon gaining access to a network device, an attacker will often first attempt to create a persistent method of reestablishing access. One way to accomplish this is to create a new account. Notification of account creation helps to mitigate this risk. Auditing account creation provides the necessary reconciliation that account management procedures are being followed. Without this audit trail, personnel without the proper authorization may gain access to critical network nodes."
      solution    : "Configure the network device or its associated authentication server to automatically audit the creation of accounts.

set system syslog host <IPv4 or IPv6 syslog address> change-log info
set system syslog host <IPv4 or IPv6 syslog address> interactive-commands info
-or-
set system syslog host <IPv4 or IPv6 syslog address> any info

Also set the syslog file configuration as follows:

set system syslog file <file name> change-log info
set system syslog file <file name> interactive-commands info
-or-
set system syslog file <file name> any info"
      reference   : "800-171|3.1.1,800-53|AC-2(4),800-53r5|AC-2(4),CAT|II,CCI|CCI-000018,CN-L3|7.1.3.2(d),CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2(4),NESA|T5.2.2,NIAv2|AM9a,NIAv2|AM9b,NIAv2|AM9c,NIAv2|AM9d,NIAv2|AM9e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,Rule-ID|SV-253879r960777_rule,STIG-ID|JUEX-NM-000020,TBA-FIISB|36.2.3,Vuln-ID|V-253879"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000060 - The Juniper EX switch must be configured to assign appropriate user roles or access levels to authenticated users."
  info        : "Successful identification and authentication must not automatically give an entity full access to a network device or security domain. The lack of authorization-based access control could result in the immediate compromise and unauthorized access to sensitive information. All DoD systems must be properly configured to incorporate access control methods that do not rely solely on authentication for authorized access.

Authorization is the process of determining whether an entity, once authenticated, is permitted to access a specific asset or set of resources. Information systems use access control policies and enforcement mechanisms to implement this requirement. Authorization procedures and controls must be implemented to ensure each authenticated entity also has a validated and current authorization.

Some network devices are pre-configured with security groups. Other network devices enable operators to create custom security groups with custom permissions. For example, an ISSM may require read-only access to audit the network device. Operators may create an audit security group, define permissions and access levels for members of the group, and then assign the ISSM's user persona to the audit security group. This is still considered privileged access, but the ISSM's security group is more restrictive than the network administrator's security group.

Network devices that rely on AAA brokers for authentication and authorization services may need to identify the available security groups or access levels available on the network devices and convey that information to the AAA operator. Once the AAA broker identifies the user persona on the centralized directory service, the user's security group memberships can be retrieved. The AAA operator may need to create a mapping that links target security groups from the directory service to the appropriate security groups or access levels on the network device. Once these mappings are configured, authorizations can happen dynamically, based on each user's directory service group membership.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to assign appropriate user roles or access levels to authenticated users, or configure the network device to leverage an AAA solution that will satisfy this objective.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.1.1,800-53|AC-3,800-53r5|AC-3,CAT|I,CCI|CCI-000213,CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253883r960792_rule,STIG-ID|JUEX-NM-000060,TBA-FIISB|31.1,Vuln-ID|V-253883"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000070 - The Juniper EX switch must be configured to enforce approved authorizations for controlling the flow of management information within the network device based on information flow control policies."
  info        : "A mechanism to detect and prevent unauthorized communication flow must be configured or provided as part of the system design. If management information flow is not enforced based on approved authorizations, the network device may become compromised. Information flow control regulates where management information is allowed to travel within a network device. The flow of all management information must be monitored and controlled so it does not introduce any unacceptable risk to the network device or data.

Application-specific examples of enforcement occur in systems that employ rule sets or establish configuration settings that restrict information system services or message-filtering capability based on message content (e.g., implementing key word searches or using document characteristics).

Applications providing information flow control must be able to enforce approved authorizations for controlling the flow of management information within the system in accordance with applicable policy.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to enforce approved authorizations for controlling the flow of management information within the network device based on information flow control policies.

Example MGT networks:
set policy-options prefix-list ipv4-management <IPv4 MGT subnet/mask>
set policy-options prefix-list ipv6-management <IPv6 MGT subnet/prefix>

Example firewall filters:
set firewall family inet filter permit-management-ipv4 term 1 from destination-address  <OOBM IPv4 address>
set firewall family inet filter permit-management-ipv4 term 1 from source-prefix-list ipv4-management
set firewall family inet filter permit-management-ipv4 term 1 from protocol tcp
set firewall family inet filter permit-management-ipv4 term 1 from destination-port 22
set firewall family inet filter permit-management-ipv4 term 1 then syslog
set firewall family inet filter permit-management-ipv4 term 1 then accept
set firewall family inet filter permit-management-ipv4 term 2 then syslog
set firewall family inet filter permit-management-ipv4 term 2 then discard
set firewall family inet6 filter permit-management-ipv6 term 1 from destination-address  <OOBM IPv6 address>
set firewall family inet6 filter permit-management-ipv6 term 1 from source-prefix-list ipv6-management
set firewall family inet6 filter permit-management-ipv6 term 1 from next-header tcp
set firewall family inet6 filter permit-management-ipv6 term 1 from destination-port 22
set firewall family inet6 filter permit-management-ipv6 term 1 then syslog
set firewall family inet6 filter permit-management-ipv6 term 1 then accept
set firewall family inet6 filter permit-management-ipv6 term 2 then syslog
set firewall family inet6 filter permit-management-ipv6 term 2 then discard

Example interface configuration:
set interfaces fxp0 unit 0 family inet filter input permit-management-ipv4
set interfaces fxp0 unit 0 family inet address  <OOBM IPv4 address>/<mask>
set interfaces fxp0 unit 0 family inet6 filter input permit-management-ipv6
set interfaces fxp0 unit 0 family inet6 address  <OOBM IPv6 address>/<prefix>"
  reference   : "800-171|3.1.3,800-53|AC-4,800-53r5|AC-4,800-53r5|MA-4(4)(b)(2),CAT|II,CCI|CCI-001368,CCI|CCI-004192,CN-L3|8.1.10.2(c),CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,CSF2.0|DE.CM-09,CSF2.0|ID.AM-03,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-4,NESA|T4.2.1,NESA|T4.5.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.6,NESA|T5.7.2,NESA|T7.5.2,NESA|T7.6.4,NIAv2|GS11a,NIAv2|GS12a,NIAv2|GS14a,NIAv2|GS15a,NIAv2|GS16a,NIAv2|NS13a,NIAv2|NS13b,NIAv2|NS13c,NIAv2|NS14,NIAv2|SS23,NIAv2|SS27a,NIAv2|SS27b,NIAv2|SS32,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,Rule-ID|SV-253884r997739_rule,STIG-ID|JUEX-NM-000070,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.4,Vuln-ID|V-253884"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set firewall family inet6? filter .+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "tries-before-disconnect"
      regex       : "set system login retry-options .+"
      expect      : "set system login retry-options tries-before-disconnect 3$"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "lockout-period"
      regex       : "set system login retry-options .+"
      expect      : "set system login retry-options lockout-period 15$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000080 - The Juniper EX switch must be configured to enforce the limit of three consecutive invalid logon attempts for any given user, after which time it must block any login attempt for that user for 15 minutes."
      info        : "By limiting the number of failed login attempts, the risk of unauthorized system access via user password guessing, otherwise known as brute-forcing, is reduced. Introducing a lockout period significantly increases the time required for each brute-force attack and increases the likelihood that security personnel will identify (and can respond to) an ongoing attack and/or that the authorized owner will recognize and report the unauthorized activity."
      solution    : "Configure the network device to enforce the limit of three consecutive invalid logon attempts and to block subsequent login attempts for 15 minutes.

set system login retry-options tries-before-disconnect 3
set system login retry-options lockout-period 15"
      reference   : "800-171|3.1.8,800-53|AC-7a.,800-53r5|AC-7a.,CAT|II,CCI|CCI-000044,CN-L3|8.1.4.1(b),CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-7a.,NESA|T5.5.1,NIAv2|AM24,PCI-DSSv3.2.1|8.1.6,PCI-DSSv4.0|8.3.4,Rule-ID|SV-253885r960840_rule,STIG-ID|JUEX-NM-000080,TBA-FIISB|45.1.2,TBA-FIISB|45.2.1,TBA-FIISB|45.2.2,Vuln-ID|V-253885"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : BANNER_CHECK
  description : "JUEX-NM-000090 - The Juniper EX switch must be configured to display the Standard Mandatory DOD Notice and Consent Banner before granting access to the device."
  info        : "Display of the DOD-approved use notification before granting access to the network device ensures privacy and security notification verbiage used is consistent with applicable federal laws, Executive Orders, directives, policies, regulations, standards, and guidance.

System use notifications are required only for access via logon interfaces with human users."
  solution    : "Configure the network device to display the Standard Mandatory DOD Notice and Consent Banner before granting access to the device.

Set system login message:
'You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions:\n\n-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.\n\n-At any time, the USG may inspect and seize data stored on this IS.\n\n-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG authorized purpose.-This IS includes security measures (e.g., authentication and access controls) to protect USG interests-not for your personal benefit or privacy.\n\n-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.\n'"
  reference   : "800-171|3.1.9,800-53|AC-8a.,800-53r5|AC-8a.,CAT|II,CCI|CCI-000048,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|AC-8a.,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,Rule-ID|SV-253886r960843_rule,STIG-ID|JUEX-NM-000090,TBA-FIISB|45.2.4,Vuln-ID|V-253886"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login message"
  content     : "@BANNER_MESSAGE@"
</custom_item>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "structured-data"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ structured-data"
      number_of_lines : "^2$"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "explicit-priority"
      regex           : "set system syslog (time-format|(host|file)) .+"
      expect          : "set system syslog (time-format year|(host|file) .+ explicit-priority)"
      number_of_lines : "^3$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000120 - The Juniper device must be configured to produce audit log records containing sufficient information to establish what type of event occurred."
      info        : "It is essential for security personnel to know what is being done, what was attempted, where it was done, when it was done, and by whom it was done to compile an accurate risk assessment. Associating event types with detected events in the application and audit logs provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured network device. Without this capability, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack."
      solution    : "Configure the network device to produce audit log records containing sufficient information to establish what type of event occurred.

set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
set system syslog file <file name> any info
set system syslog file <file name> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
-or-
set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> explicit-priority <<< Only if log level and severity are required
set system syslog file <file name> any info
set system syslog file <file name> explicit-priority <<< Only if log level and severity are required
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,800-53r5|AU-3a.,CAT|II,CCI|CCI-000130,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253889r960891_rule,STIG-ID|JUEX-NM-000120,SWIFT-CSCv1|6.4,Vuln-ID|V-253889"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "structured-data"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ structured-data"
      number_of_lines : "^2$"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "explicit-priority"
      regex           : "set system syslog (time-format|(host|file)) .+"
      expect          : "set system syslog (time-format year|(host|file) .+ explicit-priority)"
      number_of_lines : "^3$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000130 - The Juniper EX switch must be configured to produce audit records containing information to establish when (date and time) the events occurred."
      info        : "It is essential for security personnel to know what is being done, what was attempted, where it was done, when it was done, and by whom it was done in order to compile an accurate risk assessment. Logging the date and time of each detected event provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured network device. In order to establish and correlate the series of events leading up to an outage or attack, it is imperative the date and time are recorded in all log records."
      solution    : "Configure the network device to produce audit records containing information to establish when (date and time) the events occurred.

set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
set system syslog file <file name> any info
set system syslog file <file name> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
-or-
set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> explicit-priority <<< Only if log level and severity are required
set system syslog file <file name> any info
set system syslog file <file name> explicit-priority <<< Only if log level and severity are required
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,800-53r5|AU-3b.,CAT|II,CCI|CCI-000131,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253890r960894_rule,STIG-ID|JUEX-NM-000130,SWIFT-CSCv1|6.4,Vuln-ID|V-253890"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "structured-data"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ structured-data"
      number_of_lines : "^2$"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "explicit-priority"
      regex           : "set system syslog (time-format|(host|file)) .+"
      expect          : "set system syslog (time-format year|(host|file) .+ explicit-priority)"
      number_of_lines : "^3$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000140 - The Juniper EX switch must be configured to produce audit records containing information to establish where the events occurred."
      info        : "To compile an accurate risk assessment and provide forensic analysis, it is essential for security personnel to know where events occurred, such as device hardware components, device software modules, session identifiers, filenames, host names, and functionality.

Associating information about where the event occurred within the network device provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured device."
      solution    : "Configure the network device to produce audit records containing information to establish where the events occurred.

set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
set system syslog file <file name> any info
set system syslog file <file name> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
-or-
set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> explicit-priority <<< Only if log level and severity are required
set system syslog file <file name> any info
set system syslog file <file name> explicit-priority <<< Only if log level and severity are required
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,800-53r5|AU-3c.,CAT|II,CCI|CCI-000132,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253891r960897_rule,STIG-ID|JUEX-NM-000140,SWIFT-CSCv1|6.4,Vuln-ID|V-253891"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "structured-data"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ structured-data"
      number_of_lines : "^2$"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "explicit-priority"
      regex           : "set system syslog (time-format|(host|file)) .+"
      expect          : "set system syslog (time-format year|(host|file) .+ explicit-priority)"
      number_of_lines : "^3$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000150 - The Juniper EX switch must be configured to produce audit log records containing information to establish the source of events."
      info        : "To compile an accurate risk assessment and provide forensic analysis, it is essential for security personnel to know the source of the event. The source may be a component, module, or process within the device or an external session, administrator, or device.

Associating information about where the source of the event occurred provides a means of investigating an attack; recognizing resource utilization or capacity thresholds; or identifying an improperly configured device."
      solution    : "Configure the network device to produce audit records containing information to establish the source of the event.

set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
set system syslog file <file name> any info
set system syslog file <file name> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
-or-
set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> explicit-priority <<< Only if log level and severity are required
set system syslog file <file name> any info
set system syslog file <file name> explicit-priority <<< Only if log level and severity are required
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,800-53r5|AU-3d.,CAT|II,CCI|CCI-000133,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253892r960900_rule,STIG-ID|JUEX-NM-000150,SWIFT-CSCv1|6.4,Vuln-ID|V-253892"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "structured-data"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ structured-data"
      number_of_lines : "^2$"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "explicit-priority"
      regex           : "set system syslog (time-format|(host|file)) .+"
      expect          : "set system syslog (time-format year|(host|file) .+ explicit-priority)"
      number_of_lines : "^3$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000160 - The Juniper EX switch must be configured to produce audit records that contain information to establish the outcome of the event."
      info        : "Without information about the outcome of events, security personnel cannot make an accurate assessment as to whether an attack was successful or if changes were made to the security state of the system.

Event outcomes can include indicators of event success or failure and event-specific results (e.g., the security state of the device after the event occurred). As such, they also provide a means to measure the impact of an event and help authorized personnel to determine the appropriate response."
      solution    : "Configure the network device to produce audit records that contain information to establish the outcome of the event.

set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
set system syslog file <file name> any info
set system syslog file <file name> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
-or-
set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> explicit-priority <<< Only if log level and severity are required
set system syslog file <file name> any info
set system syslog file <file name> explicit-priority <<< Only if log level and severity are required
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,800-53r5|AU-3e.,CAT|II,CCI|CCI-000134,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253893r960903_rule,STIG-ID|JUEX-NM-000160,SWIFT-CSCv1|6.4,Vuln-ID|V-253893"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "structured-data"
      regex           : "set system syslog (host|file) .+"
      expect          : "set system syslog (host|file) .+ structured-data"
      number_of_lines : "^2$"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "explicit-priority"
      regex           : "set system syslog (time-format|(host|file)) .+"
      expect          : "set system syslog (time-format year|(host|file) .+ explicit-priority)"
      number_of_lines : "^3$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000170 - The Juniper EX switch must be configured to generate audit records containing information that establishes the identity of any individual or process associated with the event."
      info        : "Without information that establishes the identity of the subjects (i.e., administrators or processes acting on behalf of administrators) associated with the events, security personnel cannot determine responsibility for the potentially harmful event.

Event identifiers (if authenticated or otherwise known) include, but are not limited to, user database tables, primary key values, user names, or process identifiers."
      solution    : "Configure the network device to generate audit records containing information that establishes the identity of any individual or process associated with the event.

set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
set system syslog file <file name> any info
set system syslog file <file name> structured-data <<< Includes the 'explicit-priority' and 'time-format year millisecond' directives
-or-
set system syslog host <syslog IPv4 or IPv6 address> any info
set system syslog host <syslog IPv4 or IPv6 address> explicit-priority <<< Only if log level and severity are required
set system syslog file <file name> any info
set system syslog file <file name> explicit-priority <<< Only if log level and severity are required
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,800-53r5|AU-3f.,CAT|II,CCI|CCI-001487,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253894r960906_rule,STIG-ID|JUEX-NM-000170,SWIFT-CSCv1|6.4,Vuln-ID|V-253894"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000190 - The Juniper EX switch must be configured to protect audit information from unauthorized modification."
  info        : "Audit information includes all information (e.g., audit records, audit settings, and audit reports) needed to successfully audit network device activity.

If audit data were to become compromised, then forensic analysis and discovery of the true source of potentially malicious system activity is impossible to achieve.

To ensure the veracity of audit data, the network device must protect audit information from unauthorized modification.

This requirement can be achieved through multiple methods, which will depend upon system architecture and design. Some commonly employed methods include ensuring log files receive the proper file system permissions and limiting log data locations.

Network devices providing a user interface to audit data will leverage user permissions and roles identifying the user accessing the data and the corresponding rights that the user enjoys to make access decisions regarding the modification of audit data.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to protect audit information from unauthorized modification.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9a.,CAT|II,CCI|CCI-000163,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,CSF2.0|PR.DS-10,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253896r960933_rule,STIG-ID|JUEX-NM-000190,Vuln-ID|V-253896"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000200 - The Juniper EX switch must be configured to protect audit information from unauthorized deletion."
  info        : "Audit information includes all information (e.g., audit records, audit settings, and audit reports) needed to successfully audit information system activity.

If audit data were to become compromised, then forensic analysis and discovery of the true source of potentially malicious system activity is impossible to achieve.

To ensure the veracity of audit data, the network device must protect audit information from unauthorized deletion. This requirement can be achieved through multiple methods, which will depend upon system architecture and design. Some commonly employed methods include ensuring log files receive the proper file system permissions utilizing file system protections, restricting access, and backing up log data to ensure log data is retained.

Network devices providing a user interface to audit data will leverage user permissions and roles identifying the user accessing the data and the corresponding rights the user enjoys in order to make access decisions regarding the deletion of audit data.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to protect audit information from unauthorized deletion.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9a.,CAT|II,CCI|CCI-000164,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,CSF2.0|PR.DS-10,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253897r960936_rule,STIG-ID|JUEX-NM-000200,Vuln-ID|V-253897"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000210 - The Juniper EX switch must be configured to protect audit tools from unauthorized access."
  info        : "Protecting audit data also includes identifying and protecting the tools used to view and manipulate log data. Therefore, protecting audit tools is necessary to prevent unauthorized operation on audit data.

Network devices providing tools to interface with audit data will leverage user permissions and roles identifying the user accessing the tools and the corresponding rights the user enjoys in order to make access decisions regarding the access to audit tools.

Audit tools include, but are not limited to, vendor-provided and open source audit tools needed to successfully view and manipulate audit information system activity and records. Audit tools include custom queries and report generators.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to protect audit tools from unauthorized access.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.3.8,800-53|AU-9,800-53r5|AU-9a.,CAT|II,CCI|CCI-001493,CN-L3|7.1.2.3(d),CN-L3|7.1.3.3(f),CN-L3|8.1.3.5(c),CN-L3|8.1.4.3(c),CSF|PR.PT-1,CSF2.0|PR.DS-10,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.2,ITSG-33|AU-9,NESA|M5.2.3,NESA|M5.5.2,NESA|T3.6.4,NESA|T8.2.9,NIAv2|SM5,NIAv2|SM6,PCI-DSSv3.2.1|10.5,PCI-DSSv3.2.1|10.5.2,PCI-DSSv4.0|10.3.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253898r960939_rule,STIG-ID|JUEX-NM-000210,Vuln-ID|V-253898"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000220 - The Juniper EX switch must be configured to limit privileges to change the software resident within software libraries."
  info        : "Changes to any software components of the network device can have significant effects on the overall security of the network. Therefore, only qualified and authorized individuals should be allowed administrative access to the network device for implementing any changes or upgrades. If the network device were to enable nonauthorized users to make changes to software libraries, those changes could be implemented without undergoing testing, validation, and approval.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to limit privileges to change the software resident within software libraries.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.4.5,800-53|CM-5(6),800-53r5|CM-5(6),CAT|II,CCI|CCI-001499,CSF|PR.IP-1,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(6),NESA|T3.2.3,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,QCSC-v1|7.2,Rule-ID|SV-253899r960960_rule,STIG-ID|JUEX-NM-000220,Vuln-ID|V-253899"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "telnet service is disabled"
      regex       : "set system services .+"
      not_expect  : "set system services telnet"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ftp service is disabled"
      regex       : "set system services .+"
      not_expect  : "set system services ftp"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "web-management is disabled"
      regex       : "set system services .+"
      not_expect  : "set system services web-management"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000230 - The Juniper EX switch must be configured to prohibit the use of all unnecessary and/or nonsecure functions, ports, protocols, and/or services."
      info        : "To prevent unauthorized connection of devices, unauthorized transfer of information, or unauthorized tunneling (i.e., embedding of data types within data types), organizations must disable unused or unnecessary physical and logical ports/protocols on information systems.

Network devices are capable of providing a wide variety of functions and services. Some of the functions and services provided by default may not be necessary to support essential organizational operations. Additionally, it is sometimes convenient to provide multiple services from a single component (e.g., email and web services); however, doing so increases risk over limiting the services provided by any one component.

To support the requirements and principles of least functionality, the network device must support the organizational requirements providing only essential capabilities and limiting the use of ports, protocols, and/or services to only those required, authorized, and approved. Some network devices have capabilities enabled by default; if these capabilities are not necessary, they must be disabled. If a particular capability is used, then it must be documented and approved."
      solution    : "Configure the network device to prohibit the use of all unnecessary and/or nonsecure functions, ports, protocols, and/or services.

delete system services ftp
delete system services telnet
delete system services web-management

Note: Delete other configured but unnecessary system services."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7b.,800-53r5|CM-7b.,CAT|I,CCI|CCI-000382,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-7a.,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|2.2.4,QCSC-v1|3.2,Rule-ID|SV-253900r960966_rule,STIG-ID|JUEX-NM-000230,SWIFT-CSCv1|2.3,Vuln-ID|V-253900"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh root-login deny"
      regex       : "set system services ssh .+"
      expect      : "set system services ssh root-login deny"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "console insecure"
      regex       : "set system ports console .+"
      expect      : "set system ports console insecure"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "single account of last resot"
      regex           : "set system login user .+ authentication .+"
      expect          : "set system login user .+ authentication .+"
      max_occurrences : "1"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000240 - The Juniper EX switch must be configured with only one local account to be used as the account of last resort in the event the authentication server is unavailable."
      info        : "Authentication for administrative (privileged level) access to the device is required at all times. An account is created on the device's local database for use when the authentication server is down or connectivity between the device and the authentication server is not operable. This account is referred to as the account of last resort since it is intended to be used as a last resort and when immediate administrative access is absolutely necessary.

The account of last resort logon credentials must be stored in a sealed envelope and kept in a safe. The safe must be periodically audited to verify the envelope remains sealed. The signature of the auditor and the date of the audit should be added to the envelope as a record. Administrators should secure the credentials and disable access to the root account (if possible) when not needed for system administration functions.

Junos does not have default passwords and the root account cannot be renamed or disabled. The root account password should be saved in the same manner as the account of last resort. Setting the console port 'insecure' prevents direct root login but also prevents password recovery without knowledge of the root password. Verify only a single local account has an authentication stanza. Local accounts without an authentication stanza are 'template accounts' and must be externally authenticated. Template accounts must match the logging-in username or a returned Vendor Specific Attribute (VSA) and are used to map permissions (assigned in the login class) to the user. The example given in the Check and Fix assumes a working external authentication server and appropriate authentication order."
      solution    : "1. Disable direct root login:
set system services ssh root-login deny
set system ports console insecure

2. Configure the account of last resort:
set system login user <account of last resort name> class <class name>
set system login user <account of last resort name> authentication plain-text-password
New password: <password - not echoed to the screen>
Retype new password: <password verification - not echoed to the screen>

3. Set all other template accounts:
set system login user <template account 1> class <class 1>
set system login user <template account 2> class <class 2>"
      reference   : "800-171|3.1.1,800-53|AC-2a.,800-53|AC-2(7)(a),800-53r5|AC-2(7)(a),CAT|II,CCI|CCI-001358,CCI|CCI-002111,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2a.,ITSG-33|AC-2(7)(a),NESA|M5.3.1,NESA|T5.2.1,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,PCI-DSSv3.2.1|1.1.5,PCI-DSSv4.0|1.1.2,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,Rule-ID|SV-253901r1028865_rule,STIG-ID|JUEX-NM-000240,Vuln-ID|V-253901"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000260 - The Juniper EX switch must be configured to implement replay-resistant authentication mechanisms for network access to privileged accounts."
  info        : "A replay attack may enable an unauthorized user to gain access to the application. Authentication sessions between the authenticator and the application validating the user credentials must not be vulnerable to a replay attack.

An authentication process resists replay attacks if it is impractical to achieve a successful authentication by recording and replaying a previous authentication message.

Techniques used to address this include protocols using nonces (e.g., numbers generated for a specific one-time use) or challenges (e.g., TLS, WS_Security). Additional techniques include time-synchronous or challenge-response one-time authenticators."
  solution    : "Configure the network device to implement replay-resistant authentication mechanisms for network access to privileged accounts.

set system services ssh protocol-version v2"
  reference   : "800-171|3.5.4,800-53|IA-2(8),800-53r5|IA-2(8),CAT|II,CCI|CCI-001941,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-2(8),NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM18,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253903r960993_rule,STIG-ID|JUEX-NM-000260,SWIFT-CSCv1|4.2,TBA-FIISB|35.1,TBA-FIISB|36.1,Vuln-ID|V-253903"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system services ssh .+"
  expect      : "set system services ssh protocol-version v2"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000270 - The Juniper EX switch must be configured to enforce a minimum 15-character password length."
  info        : "Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password.

The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised. Use of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password."
  solution    : "Configure the network device or its associated authentication server to enforce a minimum 15-character password length.

set system login password minimum-length 15"
  reference   : "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(h),CAT|II,CCI|CCI-000205,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253904r1018762_rule,STIG-ID|JUEX-NM-000270,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-253904"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login password .+"
  expect      : "set system login password minimum-length (1[5-9]|[2-9][0-9])$"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000280 - The Juniper EX switch must be configured to enforce password complexity by requiring that at least one uppercase character be used."
  info        : "Use of a complex passwords helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.

Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password is, the greater the number of possible combinations that need to be tested before the password is compromised.

Multifactor authentication (MFA) is required for all administrative and user accounts on network devices, except for an account of last resort and (where applicable) a root account. Passwords should only be used when MFA using PKI is not available, and for the account of last resort and root account."
  solution    : "Configure the network device and associated authentication server to enforce password complexity by requiring that at least one uppercase character be used.

set system login password minimum-upper-cases 1"
  reference   : "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(h),CAT|II,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253905r1028866_rule,STIG-ID|JUEX-NM-000280,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-253905"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login password .+"
  expect      : "set system login password minimum-upper-cases [1-9][0-9]*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000290 - The Juniper EX switch must be configured to enforce password complexity by requiring that at least one lowercase character be used."
  info        : "Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.

Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.

Multifactor authentication (MFA) is required for all administrative and user accounts on network devices, except for an account of last resort and (where applicable) a root account. Passwords should only be used when MFA using PKI is not available, and for the account of last resort and root account."
  solution    : "Configure the network device and associated authentication server to enforce password complexity by requiring that at least one lowercase character be used.

set system login password minimum-lower-cases 1"
  reference   : "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(h),CAT|II,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253906r1028873_rule,STIG-ID|JUEX-NM-000290,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-253906"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login password .+"
  expect      : "set system login password minimum-lower-cases [1-9][0-9]*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000300 - The Juniper EX switch must be configured to enforce password complexity by requiring that at least one numeric character be used."
  info        : "Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.

Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.

Multifactor authentication (MFA) is required for all administrative and user accounts on network devices, except for an account of last resort and (where applicable) a root account. Passwords should only be used when MFA using PKI is not available, and for the account of last resort and root account."
  solution    : "Configure the network device and associated authentication server to enforce password complexity by requiring that at least one numeric character be used.

set system login password minimum-numerics 1"
  reference   : "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(h),CAT|II,CCI|CCI-000194,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253907r1018765_rule,STIG-ID|JUEX-NM-000300,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-253907"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login password .+"
  expect      : "set system login password minimum-numerics [1-9][0-9]*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000310 - The Juniper EX switch must be configured to enforce password complexity by requiring that at least one punctuation (special) character be used."
  info        : "Use of a complex password helps to increase the time and resources required to compromise the password. Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.

Password complexity is one factor of several that determine how long it takes to crack a password. The more complex the password, the greater the number of possible combinations that need to be tested before the password is compromised.

Multifactor authentication (MFA) is required for all administrative and user accounts on network devices, except for an account of last resort and (where applicable) a root account. Passwords should only be used when MFA using PKI is not available, and for the account of last resort and root account."
  solution    : "Configure the network device and associated authentication server to enforce password complexity by requiring that at least one punctuation (special) character be used.

set system login password minimum-punctuations 1"
  reference   : "800-171|3.5.7,800-53|IA-5(1)(a),800-53r5|IA-5(1)(h),CAT|II,CCI|CCI-001619,CCI|CCI-004066,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(a),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253908r1018766_rule,STIG-ID|JUEX-NM-000310,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-253908"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login password .+"
  expect      : "set system login password minimum-punctuations [1-9][0-9]*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000320 - The Juniper EX switch must be configured to require that when a password is changed, the characters are changed in at least eight of the positions within the password."
  info        : "If the application allows the user to consecutively reuse extensive portions of passwords, this increases the chances of password compromise by increasing the window of opportunity for attempts at guessing and brute-force attacks.

The number of changed characters refers to the number of changes required with respect to the total number of positions in the current password. In other words, characters may be the same within the two passwords; however, the positions of the like characters must be different.

Multifactor authentication (MFA) is required for all administrative and user accounts on network devices, except for an account of last resort and (where applicable) a root account. Passwords should only be used when MFA using PKI is not available, and for the account of last resort and root account.

Note: For older Juniper EX versions, only four characters may be changed instead of the DOD-required eight characters. If so, four characters should be selected. This remains a finding when set to four characters, but is mitigated to a CAT 3."
  solution    : "Configure the network device and associated authentication server to require that when a password is changed, the characters are changed in at least eight of the positions within the password.

set system login password minimum-changes 8

Note: For older Juniper EX versions, only four characters may be changed instead of the DOD-required eight characters. If so, four characters should be selected. This remains a finding when set to four characters, but is mitigated to a CAT 3."
  reference   : "800-171|3.5.7,800-53|IA-5(1)(b),800-53r5|IA-5(1)(h),CAT|II,CCI|CCI-000195,CCI|CCI-004066,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1)(b),NESA|T5.2.3,NIAv2|AM22d,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253909r1018767_rule,STIG-ID|JUEX-NM-000320,SWIFT-CSCv1|4.1,Vuln-ID|V-253909"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login password .+"
  expect      : "set system login password minimum-changes ([89]|[1-9][0-9])$"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000330 - The Juniper EX switch must be configured to only store cryptographic representations of passwords."
  info        : "Passwords need to be protected at all times, and encryption is the standard method for protecting passwords. If passwords are not encrypted, they can be plainly read (i.e., clear text) and easily compromised.

Network devices must enforce cryptographic representations of passwords when storing passwords in databases, configuration files, and log files. Passwords must be protected at all times; using a strong one-way hashing encryption algorithm with a salt is the standard method for providing a means to validate a password without having to store the actual password.

Performance and time required to access are factors that must be considered, and the one-way hash is the most feasible means of securing the password and providing an acceptable measure of password security. If passwords are stored in clear text, they can be plainly read and easily compromised.

In many instances, verifying the user knows a password is performed using a password verifier. In its simplest form, a password verifier is a computational function that is capable of creating a hash of a password and determining if the value provided by the user matches the stored hash."
  solution    : "Configure the network device, and any associated authentication servers, to store all passwords using cryptographic representations.

set system login password format <sha-256|sha-512>
Note: Although Junos supports the SHA-1 hashing algorithm, it is included only for backwards compatibility when restoring a previous configuration from an older version.

Configure all associated databases, configuration files, and log files to use only encrypted representations of passwords, and that no password strings are readable/discernable.

Potential locations include the local file system where configurations and events are stored, or in a network device-related database table."
  reference   : "800-171|3.5.10,800-53|IA-5(1)(c),800-53r5|IA-5(1)(d),CAT|I,CCI|CCI-000196,CCI|CCI-004062,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(1)(c),NESA|T5.2.3,NIAv2|CY6,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253910r1018768_rule,STIG-ID|JUEX-NM-000330,SWIFT-CSCv1|4.1,TBA-FIISB|26.1,Vuln-ID|V-253910"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login password .+"
  expect      : "set system login password format (sha-256|sha-512)"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "login password format"
      regex       : "set system login password .+"
      expect      : "set system login password format (sha256|sha512)"
    </custom_item>

    <custom_item>
      type        : SHOW_CONFIG_CHECK
      description : "ssh ciphers"
      regex       : "ciphers"
      expect      : "ciphers \[ (aes256-ctr|aes192-ctr|\s+){3,} \];"
      hierarchy   : "system services ssh ciphers"
    </custom_item>

    <custom_item>
      type        : SHOW_CONFIG_CHECK
      description : "ssh macs"
      regex       : "macs"
      expect      : "macs \[ (hmac-sha2-512|hmac-sha2-256|\s+){3,} \];"
      hierarchy   : "system services ssh macs"
    </custom_item>

    <custom_item>
      type        : SHOW_CONFIG_CHECK
      description : "ssh key-exchange"
      regex       : "key-exchange"
      expect      : "key-exchange \[ (ecdh-sha2-nistp521|ecdh-sha2-nistp384|ecdh-sha2-nistp256|\s+){4,} \];"
      hierarchy   : "system services ssh key-exchange"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "system rng"
      regex       : "set system rng .+"
      expect      : "set system rng hmac-drbg"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000340 - The Juniper EX switch must be configured to use FIPS 140-2/140-3 validated algorithms for authentication to a cryptographic module."
      info        : "Unapproved mechanisms used for authentication to the cryptographic module are not validated and therefore, cannot be relied upon to provide confidentiality or integrity, and DOD data may be compromised.

Network devices utilizing encryption are required to use FIPS-compliant mechanisms for authenticating to cryptographic modules.

FIPS 140-2/140-3 is the current standard for validating that mechanisms used to access cryptographic modules utilize authentication that meets DOD requirements. However, authentication algorithms must configure security processes to use only FIPS-validated and NIST-recommended authentication algorithms.

Use only AES Counter (CTR) cipher block chaining modes in compliance with CVE-2008-5161, plugin 70658 based on vendor guidance in KB20853. This prevents certain plaintext attacks in OpenSSH."
      solution    : "Enter the CLI configuration mode and enter the following commands to set the password format, the SSH algorithms, and the RNG to meet site requirements.

user@host> configure
user@host# set system login password format <sha-256|sha-512>
user@host# set system services ssh ciphers aes256-ctr
user@host# set system services ssh ciphers aes192-ctr
user@host# set system services ssh macs hmac-sha2-512
user@host# set system services ssh macs hmac-sha2-256
user@host# set system services ssh key-exchange ecdh-sha2-nistp521
user@host# set system services ssh key-exchange ecdh-sha2-nistp384
user@host# set system services ssh key-exchange ecdh-sha2-nistp256
user@host# set system rng hmac-drbg
user@host# commit"
      reference   : "800-53|IA-7,800-53r5|IA-7,CAT|I,CCI|CCI-000803,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(d),ITSG-33|IA-7,ITSG-33|IA-7a.,NESA|M5.2.1,NESA|M5.2.6,NESA|M5.3.1,NESA|T7.4.1,QCSC-v1|13.2,Rule-ID|SV-253911r1028869_rule,STIG-ID|JUEX-NM-000340,Vuln-ID|V-253911"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000360 - The Juniper EX switch must be configured to end all network connections associated with a device management session at the end of the session, or the session must be terminated after 10 minutes of inactivity except to fulfill mission requirements."
  info        : "Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free up resources committed by the managed network element.

Terminating network connections associated with communications sessions includes, for example, de-allocating associated TCP/IP address/port pairs at the operating system level, or de-allocating networking assignments at the application level if multiple application sessions are using a single, operating system-level network connection. This does not mean that the device terminates all sessions or network access; it only ends the inactive session and releases the resources associated with that session."
  solution    : "Configure the network device to terminate the connection associated with a device management session at the end of the session or after 10 minutes of inactivity.

set system login idle-timeout 10"
  reference   : "800-171|3.13.9,800-53|SC-10,800-53r5|SC-10,CAT|I,CCI|CCI-001133,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-10,ITSG-33|SC-10a.,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,Rule-ID|SV-253913r961068_rule,STIG-ID|JUEX-NM-000360,SWIFT-CSCv1|2.6,Vuln-ID|V-253913"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login idle-timeout .+"
  expect      : "set system login idle-timeout 10[\s]*$"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000370 - The Juniper device must be configured to only allow authorized administrators to view or change the device configuration, system files, and other files stored either in the device or on removable media (such as a flash drive)."
  info        : "This requirement is intended to address the confidentiality and integrity of system information at rest (e.g., network device rule sets) when it is located on a storage device within the network device or as a component of the network device. This protection is required to prevent unauthorized alteration, corruption, or disclosure of information when not stored directly on the network device.

Files on the network device or on removable media used by the device must have their permissions set to allow read or write access to those accounts that are specifically authorized to access or change them. Note that different administrative accounts or roles will have varying levels of access.

File permissions must be set so that only authorized administrators can read or change their contents. Whenever files are written to removable media and the media removed from the device, the media must be handled appropriately for the classification and sensitivity of the data stored on the device.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the device to enforce RBAC permissions so only authorized administrators can read or change file contents.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system syslog archive size <file size> files <number of files> no-world-readable"
  reference   : "800-171|3.13.16,800-53|SC-28,800-53r5|SC-28,CAT|I,CCI|CCI-001199,CN-L3|8.1.4.7(b),CN-L3|8.1.4.8(b),CSF|PR.DS-1,CSF2.0|PR.DS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(iv),HIPAA|164.312(e)(2)(ii),ITSG-33|SC-28,ITSG-33|SC-28a.,PCI-DSSv3.2.1|3.4,PCI-DSSv4.0|3.3.2,PCI-DSSv4.0|3.5.1,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-253914r961128_rule,STIG-ID|JUEX-NM-000370,Vuln-ID|V-253914"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000390 - The Juniper EX switch must be configured to enforce organization-defined role-based access control policies over defined subjects and objects."
  info        : "Organizations can create specific roles based on job functions and the authorizations (i.e., privileges) to perform needed operations on organizational information systems associated with the organization-defined roles. When administrators are assigned to the organizational roles, they inherit the authorizations or privileges defined for those roles. RBAC simplifies privilege administration for organizations because privileges are not assigned directly to every administrator (which can be a significant number of individuals for mid- to large-size organizations) but are instead acquired through role assignments. RBAC can be implemented either as a mandatory or discretionary form of access control.

The RBAC policies and the subjects and objects are defined uniquely for each network device, so they cannot be specified in the requirement.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device or its associated authentication server to enforce role-based access control policy over defined subjects and objects.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.1.1,800-171|3.4.2,800-53|AC-3(7),800-53|CM-6b.,800-53r5|AC-3(7),800-53r5|CM-6b.,CAT|II,CCI|CCI-000366,CCI|CCI-002169,CN-L3|7.1.2.2(g),CN-L3|7.1.3.2(c),CN-L3|8.1.10.6(d),CSF|PR.AC-4,CSF|PR.IP-1,CSF|PR.PT-3,CSF2.0|DE.CM-09,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|CM-6b.,NESA|T3.2.1,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253916r987662_rule,STIG-ID|JUEX-NM-000390,SWIFT-CSCv1|2.3,TBA-FIISB|31.1,Vuln-ID|V-253916"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog primary server"
      regex       : "set system syslog .+"
      expect      : "set system syslog host @PRIMARY_SYSLOG_SERVER@ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog secondary server"
      regex       : "set system syslog .+"
      expect      : "set system syslog host @SECONDARY_SYSLOG_SERVER@ any info"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000410 - The Juniper EX switch must be configured to allocate audit record storage capacity in accordance with organization-defined audit record storage requirements."
      info        : "To ensure network devices have a sufficient storage capacity in which to write the audit logs, they need to be able to allocate audit record storage capacity. The task of allocating audit record storage capacity is usually performed during initial device setup if it is modifiable.

The value for the organization-defined audit record storage requirement will depend on the amount of storage available on the network device, the anticipated volume of logs, the frequency of transfer from the network device to centralized log servers, and other factors."
      solution    : "Configure the network device to allocate audit record storage capacity in accordance with organization-defined audit record storage requirements.

Configure external syslog server(s):
set system syslog host <address 1> any info
set system syslog host <address 2> any info"
      reference   : "800-53|AU-4,800-53r5|AU-4,CAT|II,CCI|CCI-001849,CSF|PR.DS-4,CSF|PR.PT-1,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253918r961392_rule,STIG-ID|JUEX-NM-000410,Vuln-ID|V-253918"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "disk-patition level full"
      regex       : "set chassis disk-partition /var level .+"
      expect      : "set chassis disk-partition /var level full free-space ([1-9]|[1-9][0-9]|100)[\s]*$"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "disk-patition level full percent"
      regex       : "set chassis disk-partition /var level .+"
      expect      : "set chassis disk-partition /var level full free-space percent"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "disk-patition level high"
      regex       : "set chassis disk-partition /var level .+"
      expect      : "set chassis disk-partition /var level high free-space ([1-9]|[1-9][0-9]|100)[\s]*$"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "disk-patition level high percent"
      regex       : "set chassis disk-partition /var level .+"
      expect      : "set chassis disk-partition /var level high free-space percent"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "snmp health-monitor interval"
      regex       : "set snmp health-monitor .+"
      expect      : "set snmp health-monitor interval [0-9]+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "snmp health-monitor rising-threshold"
      regex       : "set snmp health-monitor .+"
      expect      : "set snmp health-monitor rising-threshold ([1-9]|[1-9][0-9]|100)[\s]*$"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "snmp health-monitor falling-threshold"
      regex       : "set snmp health-monitor .+"
      expect      : "set snmp health-monitor falling-threshold ([1-9]|[1-9][0-9]|100)[\s]*$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000420 - The Juniper EX switch must be configured to generate an immediate real-time alert of all audit failure events requiring real-time alerts."
      info        : "It is critical for the appropriate personnel to be aware if a system is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability and system operation may be adversely affected.

Alerts provide organizations with urgent messages. Real-time alerts provide these messages immediately (i.e., the time from event detection to alert occurs in seconds or less)."
      solution    : "Configure the network device to generate an immediate real-time alert of all audit failure events requiring real-time alerts.

set chassis disk-partition /var level full free-space <0..100>
set chassis disk-partition /var level full free-space percent
set chassis disk-partition /var level high free-space <0..100>
set chassis disk-partition /var level high free-space percent
Note: 'High' disk free-space value must be equal to or greater than 'full' free-space value.

set snmp health-monitor interval <1..2147483647 seconds>
set snmp health-monitor rising-threshold <1..100 percent>
set snmp health-monitor falling-threshold <0..100 percent>
Note: Falling threshold value must be less than the rising-threshold value or commit fails."
      reference   : "800-171|3.3.4,800-53|AU-5(2),800-53r5|AU-5(2),CAT|II,CCI|CCI-001858,CN-L3|7.1.3.3(e),CSF|PR.PT-1,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-5(2),NESA|T3.6.2,NIAv2|GS7f,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253919r961401_rule,STIG-ID|JUEX-NM-000420,Vuln-ID|V-253919"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Verify primary NTP Server os configured"
      regex       : "set system ntp server .+"
      expect      : "set system ntp server @PRIMARY_NTP_SERVER@ (key [12] )?prefer"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "Verify secondary NTP Server os configured"
      regex       : "set system ntp server .+"
      expect      : "set system ntp server @SECONDARY_NTP_SERVER@( key [12])?"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000430 - The Juniper EX switch must be configured to synchronize internal information system clocks using redundant authoritative time sources."
      info        : "The loss of connectivity to a particular authoritative time source will result in the loss of time synchronization (free-run mode) and increasingly inaccurate time stamps on audit events and other functions.

Multiple time sources provide redundancy by including a secondary source. Time synchronization is usually a hierarchy; clients synchronize time to a local source while that source synchronizes its time to a more accurate source. The network device must utilize an authoritative time server and/or be configured to use redundant authoritative time sources. This requirement is related to the comparison done in CCI-001891.

DOD-approved solutions consist of a combination of a primary and secondary time source using a combination or multiple instances of the following: A time server designated for the appropriate DOD network (NIPRNet/SIPRNet); United States Naval Observatory (USNO) time servers; and/or the Global Positioning System (GPS). The secondary time source must be located in a different geographic region than the primary time source."
      solution    : "Configure the network device to synchronize internal information system clocks with the primary and secondary time sources.

set system ntp authentication-key 1 type sha256
set system ntp authentication-key 1 value 'PSK'
set system ntp authentication-key 2 type sha1
set system ntp authentication-key 2 value 'PSK'
set system ntp server <address 1> key 1
set system ntp server <address 1> prefer
set system ntp server <address 2> key 2
set system ntp trusted-key 1
set system ntp trusted-key 2
set system ntp source-address <lo0 or OOBM address>"
      reference   : "800-171|3.3.7,800-53|AU-8(2),800-53r5|SC-45,800-53r5|SC-45(1)(a),800-53r5|SC-45(2)(a),CAT|II,CCI|CCI-001893,CCI|CCI-004922,CCI|CCI-004923,CCI|CCI-004928,CN-L3|8.1.4.3(b),CSF|PR.PT-1,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),NESA|T3.6.7,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253920r1018769_rule,STIG-ID|JUEX-NM-000430,TBA-FIISB|37.4,Vuln-ID|V-253920"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000440 - The Juniper EX switch must be configured to record time stamps for audit records that can be mapped to Coordinated Universal Time (UTC) or Greenwich Mean Time (GMT)."
  info        : "If time stamps are not consistently applied and there is no common time reference, it is difficult to perform forensic analysis.

Time stamps generated by the application include date and time. Time is commonly expressed in UTC, a modern continuation of GMT, or local time with an offset from UTC."
  solution    : "Configure the network device to record time stamps for audit records that can be mapped to UTC or GMT.

set system time-zone UTC"
  reference   : "800-171|3.3.7,800-53|AU-8b.,800-53r5|AU-8b.,CAT|II,CCI|CCI-001890,CN-L3|8.1.4.3(b),CSF|PR.PT-1,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-8,NESA|T3.6.7,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253921r961443_rule,STIG-ID|JUEX-NM-000440,TBA-FIISB|37.4,Vuln-ID|V-253921"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system time-zone .+"
  expect      : "set system time-zone (?i)(UTC|GMT)(?-i)"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000450 - The Juniper EX switch must be configured to prohibit installation of software without explicit privileged status."
  info        : "Allowing anyone to install software, without explicit privileges, creates the risk that untested or potentially malicious software will be installed on the system. This requirement applies to code changes and upgrades for all network devices.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to prohibit installation of software without explicit privileged status.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.4.9,800-53|CM-11(2),800-53r5|CM-11(2),CAT|II,CCI|CCI-001812,CCI|CCI-003980,CSF|DE.CM-3,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,CSF2.0|PR.PS-02,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.2,QCSC-v1|8.2.1,Rule-ID|SV-253922r1018770_rule,STIG-ID|JUEX-NM-000450,SWIFT-CSCv1|5.1,Vuln-ID|V-253922"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000460 - The Juniper EX switch must be configured to enforce access restrictions associated with changes to device configuration."
  info        : "Failure to provide logical access restrictions associated with changes to device configuration may have significant effects on the overall security of the system.

When dealing with access restrictions pertaining to change control, it should be noted that any changes to the hardware, software, and/or firmware components of the device can potentially have significant effects on the overall security of the device.

Accordingly, only qualified and authorized individuals should be allowed to obtain access to device components for the purposes of initiating changes, including upgrades and modifications.

Logical access restrictions include, for example, controls that restrict access to workflow automation, media libraries, abstract layers (e.g., changes implemented into third-party interfaces rather than directly into information systems), and change windows (e.g., changes occur only during specified times, making unauthorized changes easy to discover).

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to enforce access restrictions associated with changes to device configuration.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.4.5,800-53|CM-5(1),800-53r5|CM-5(1)(a),CAT|II,CCI|CCI-001813,CSF|PR.IP-1,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5(1),NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.3,QCSC-v1|7.2,Rule-ID|SV-253923r961461_rule,STIG-ID|JUEX-NM-000460,Vuln-ID|V-253923"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "set snmp found"
      regex       : "set snmp .+"
      expect      : "set snmp .+"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "JUEX-NM-000480 - The Juniper EX switch must be configured to authenticate SNMP messages using a FIPS-validated Keyed-Hash Message Authentication Code (HMAC)."
      info        : "Without authenticating devices, unidentified or unknown devices may be introduced, thereby facilitating malicious activity. Bidirectional authentication provides stronger safeguards to validate the identity of other devices for connections that are of greater risk.

A local connection is any connection with a device communicating without the use of a network. A network connection is any connection with a device that communicates through a network (e.g., local area or wide area network, internet). A remote connection is any connection with a device communicating through an external network (e.g., the internet).

Because of the challenges of applying this requirement on a large scale, organizations are encouraged to only apply the requirement to those limited number (and type) of devices that truly need to support this capability."
      solution    : "Configure the network device to authenticate SNMP messages using a FIPS-validated Keyed-Hash Message Authentication Code (HMAC).

set snmp v3 usm local-engine user <SNMPv3 username> authentication-sha authentication-password 'PSK'"
      reference   : "800-53|IA-3(1),800-53r5|IA-3(1),CAT|I,CCI|CCI-001967,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3(1),NESA|T5.4.3,QCSC-v1|13.2,Rule-ID|SV-253925r961506_rule,STIG-ID|JUEX-NM-000480,TBA-FIISB|27.1,Vuln-ID|V-253925"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      regex       : "set snmp v3 usm local-engine user .+"
      expect      : "set snmp v3 usm local-engine user .+ authentication-sha.+"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "JUEX-NM-000480 - The Juniper EX switch must be configured to authenticate SNMP messages using a FIPS-validated Keyed-Hash Message Authentication Code (HMAC)."
      info        : "Without authenticating devices, unidentified or unknown devices may be introduced, thereby facilitating malicious activity. Bidirectional authentication provides stronger safeguards to validate the identity of other devices for connections that are of greater risk.

A local connection is any connection with a device communicating without the use of a network. A network connection is any connection with a device that communicates through a network (e.g., local area or wide area network, internet). A remote connection is any connection with a device communicating through an external network (e.g., the internet).

Because of the challenges of applying this requirement on a large scale, organizations are encouraged to only apply the requirement to those limited number (and type) of devices that truly need to support this capability."
      solution    : "Configure the network device to authenticate SNMP messages using a FIPS-validated Keyed-Hash Message Authentication Code (HMAC).

set snmp v3 usm local-engine user <SNMPv3 username> authentication-sha authentication-password 'PSK'"
      reference   : "800-53|IA-3(1),800-53r5|IA-3(1),CAT|I,CCI|CCI-001967,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3(1),NESA|T5.4.3,QCSC-v1|13.2,Rule-ID|SV-253925r961506_rule,STIG-ID|JUEX-NM-000480,TBA-FIISB|27.1,Vuln-ID|V-253925"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "Verify authentication-key is set correctly"
      regex           : "set system ntp authentication-key .+"
      expect          : "set system ntp authentication-key [0-9]+ type (md5|sha1|sha256)"
      min_occurrences : "2"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "Verify the trusted key is set correctly"
      regex           : "set system ntp trusted-key .+"
      expect          : "set system ntp trusted-key [0-9]+"
      min_occurrences : "2"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000490 - The Juniper EX switch must use an an NTP service that is hosted by a trusted source or a DOD-compliant enterprise or local NTP server."
      info        : "If a trusted time source is not used, an attacker can introduce a rogue NTP server. This rogue server can then be used to send incorrect time information to network devices, which will make log timestamps inaccurate which may hide attacks or result in inaccurate forensic analysis.

The recommended solution is that the application or endpoint is configured to point to an enterprise or site-owned time server that is DOD-compliant (instead of directly to an NTP source as implied by the current wording of the requirement). Most products are unable to meet the requirement, but DISA can mitigate the risk by using a trusted time source. So the requirement should state that NTPS is used with USNO NTP as an alternative mitigation for this to be marked as Not a Finding.

More information can be found at:
https://www.cnmoc.usff.navy.mil/Our-Commands/United-States-Naval-Observatory/Precise-Time-Department/Network-Time-Protocol-NTP/DoD-Customer-Servers/

DOD users should not use tick, tock, or ntp2. There are also instructions for obtaining authenticated NTP at the site listed above."
      solution    : "Configure the network device to authenticate Network Time Protocol sources using FIPS-validated algorithms.

set system ntp authentication-key 1 type sha256
set system ntp authentication-key 1 value 'PSK'
set system ntp authentication-key 2 type sha1
set system ntp authentication-key 2 value 'PSK'
set system ntp server <address 1> key 1
set system ntp server <address 1> prefer
set system ntp server <address 2> key 2
set system ntp trusted-key 1
set system ntp trusted-key 2

If the network device does not support FIPS-validated algorithms, configure NTP authentication using cryptographically based algorithms.
set system ntp authentication-key 3 type md5
set system ntp authentication-key 3 value 'PSK'
set system ntp server <address 3> key 3
set system ntp trusted-key 3"
      reference   : "800-53|IA-3(1),800-53r5|IA-3(1),CAT|III,CCI|CCI-001967,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-3(1),NESA|T5.4.3,QCSC-v1|13.2,Rule-ID|SV-253926r961506_rule,STIG-ID|JUEX-NM-000490,TBA-FIISB|27.1,Vuln-ID|V-253926"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "system login idle-timeout"
      regex       : "set system login idle-timeout .+"
      expect      : "set system login idle-timeout [0-9]+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "system services ssh protocol-version"
      regex       : "set system services ssh .+"
      expect      : "set system services ssh protocol-version v2"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh client-alive-count-max"
      regex       : "set system services ssh .+"
      expect      : "set system services ssh client-alive-count-max [0-9]+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh client-alive-interval"
      regex       : "set system services ssh .+"
      expect      : "set system services ssh client-alive-interval [0-9]+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh rekey data-limit"
      regex       : "set system services ssh .+"
      expect      : "set system services ssh rekey data-limit [0-9]+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh rekey data-limit"
      regex       : "set system services ssh .+"
      expect      : "set system services ssh rekey time-limit [0-9]+"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000500 - The Juniper EX switch must be configured to prohibit the use of cached authenticators after an organization-defined time period."
      info        : "Some authentication implementations can be configured to use cached authenticators.

If cached authentication information is out-of-date, the validity of the authentication information may be questionable.

The organization-defined time period should be established for each device depending on the nature of the device; for example, a device with just a few administrators in a facility with spotty network connectivity may merit a longer caching time period than a device with many administrators."
      solution    : "Configure the network device or its associated authentication server to prohibit the use of cached authenticators after an organization-defined time period.

set system login idle-timeout 10

set system services ssh protocol-version v2
set system services ssh client-alive-count-max (0..255)
set system services ssh client-alive-interval (0..65535 seconds)
set system services ssh rekey data-limit (51200..4294967295 bytes)
set system services ssh rekey time-limit (1..1440 minutes)"
      reference   : "800-171|3.5.2,800-53|IA-5(13),800-53r5|IA-5(13),CAT|II,CCI|CCI-002007,CSF|PR.AC-1,CSF2.0|PR.AA-01,CSF2.0|PR.AA-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,Rule-ID|SV-253927r961521_rule,STIG-ID|JUEX-NM-000500,Vuln-ID|V-253927"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh ciphers aes256-ctr"
      regex       : "set system services ssh ciphers .+"
      expect      : "set system services ssh ciphers aes256-ctr"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh ciphers aes192-ctr"
      regex       : "set system services ssh ciphers .+"
      expect      : "set system services ssh ciphers aes192-ctr"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh ciphers aes128-ctr"
      regex       : "set system services ssh ciphers .+"
      expect      : "set system services ssh ciphers aes128-ctr"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh macs hmac-sha2-512"
      regex       : "set system services ssh macs .+"
      expect      : "set system services ssh macs hmac-sha2-512"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh macs hmac-sha2-256"
      regex       : "set system services ssh macs .+"
      expect      : "set system services ssh macs hmac-sha2-256"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange ecdh-sha2-nistp521"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange ecdh-sha2-nistp521"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange ecdh-sha2-nistp384"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange ecdh-sha2-nistp384"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange ecdh-sha2-nistp256"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange ecdh-sha2-nistp256"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange dh-group14-sha1"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange dh-group14-sha1"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "snmp v3 authentication"
      regex       : "set snmp v3 usm local-engine user .+"
      expect      : "set snmp v3 usm local-engine user .+ authentication-sha.+"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000510 - The Juniper EX switches must be configured to use FIPS-validated Keyed-Hash Message Authentication Code (HMAC) to protect the integrity of nonlocal maintenance and diagnostic communications."
      info        : "Unapproved mechanisms that are used for authentication to the cryptographic module are not verified and therefore cannot be relied upon to provide confidentiality or integrity, and DOD data may be compromised.

Nonlocal maintenance and diagnostic activities are those activities conducted by individuals communicating through a network, either an external network (e.g., the internet) or an internal network.

Currently, HMAC is the only FIPS-approved algorithm for generating and verifying message/data authentication codes in accordance with FIPS 198-1. Products that are FIPS 140-2 validated will have an HMAC that meets specification; however, the option must be configured for use as the only message authentication code used for authentication to cryptographic modules.

Separate requirements for configuring applications and protocols used by each application (e.g., SNMPv3, SSHv2, HTTPS, and other protocols and applications that require server/client authentication) are required to implement this requirement. Where SSH is used, the SSHv2 protocol suite is required because it includes Layer 7 protocols such as SCP and SFTP, which can be used for secure file transfers.

Use only AES Counter (CTR) cipher block chaining modes in compliance with CVE-2008-5161, plugin 70658 based on vendor guidance in KB20853. This prevents certain plaintext attacks in OpenSSH."
      solution    : "Configure the network device to use FIPS-validated HMAC to protect the integrity of nonlocal maintenance and diagnostic communications.

set snmp v3 usm local-engine user <SNMPv3 user> authentication-sha authentication-password 'PSK'
set snmp v3 usm local-engine user <SNMPv3 user> privacy-aes128 privacy-password 'PSK'
Note: Use the strongest HMAC mutually supported with the NMS (e.g., authentication-sha256, authentication-sha512)

set system services ssh protocol-version v2
set system services ssh ciphers aes256-ctr
set system services ssh ciphers aes192-ctr
set system services ssh ciphers aes128-ctr
set system services ssh macs hmac-sha2-512
set system services ssh macs hmac-sha2-256
set system services ssh key-exchange ecdh-sha2-nistp521
set system services ssh key-exchange ecdh-sha2-nistp384
set system services ssh key-exchange ecdh-sha2-nistp256"
      reference   : "800-171|3.7.5,800-53|MA-4(6),800-53r5|MA-4(6),CAT|I,CCI|CCI-002890,CSF|PR.MA-2,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|MA-4(6),NESA|T2.3.4,NESA|T5.4.4,QCSC-v1|5.2.2,Rule-ID|SV-253928r961554_rule,STIG-ID|JUEX-NM-000510,SWIFT-CSCv1|2.6,TBA-FIISB|45.2.3,Vuln-ID|V-253928"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh ciphers aes256-ctr"
      regex       : "set system services ssh ciphers .+"
      expect      : "set system services ssh ciphers aes256-ctr"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh ciphers aes192-ctr"
      regex       : "set system services ssh ciphers .+"
      expect      : "set system services ssh ciphers aes192-ctr"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh ciphers aes128-ctr"
      regex       : "set system services ssh ciphers .+"
      expect      : "set system services ssh ciphers aes128-ctr"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh macs hmac-sha2-512"
      regex       : "set system services ssh macs .+"
      expect      : "set system services ssh macs hmac-sha2-512"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh macs hmac-sha2-256"
      regex       : "set system services ssh macs .+"
      expect      : "set system services ssh macs hmac-sha2-256"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange ecdh-sha2-nistp521"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange ecdh-sha2-nistp521"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange ecdh-sha2-nistp384"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange ecdh-sha2-nistp384"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange ecdh-sha2-nistp256"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange ecdh-sha2-nistp256"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "ssh key-exchange dh-group14-sha1"
      regex       : "set system services ssh key-exchange .+"
      expect      : "set system services ssh key-exchange dh-group14-sha1"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "snmp v3 authentication"
      regex       : "set snmp v3 usm local-engine user .+"
      expect      : "set snmp v3 usm local-engine user .+ authentication-sha.+"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000520 - The Juniper EX switch must be configured to implement cryptographic mechanisms using a FIPS 140-2 approved algorithm to protect the confidentiality of remote maintenance sessions."
      info        : "This requires the use of secure protocols instead of their unsecured counterparts, such as SSH instead of telnet, SCP instead of FTP, and HTTPS instead of HTTP. If unsecured protocols (lacking cryptographic mechanisms) are used for sessions, the contents of those sessions will be susceptible to eavesdropping, potentially putting sensitive data (including administrator passwords) at risk of compromise and potentially allowing hijacking of maintenance sessions.

Use only CTR cipher block chaining modes in compliance with CVE-2008-5161, plugin 70658 based on vendor guidance in KB20853. This prevents certain plaintext attacks in OpenSSH."
      solution    : "Configure the network device to implement cryptographic mechanisms to protect the confidentiality of remote maintenance sessions using a FIPS 140-2 approved algorithm.

set snmp v3 usm local-engine user <SNMPv3 user> authentication-sha authentication-password 'PSK'
set snmp v3 usm local-engine user <SNMPv3 user> privacy-aes128 privacy-password 'PSK'
Note: Use the strongest HMAC mutually supported with the NMS (e.g., authentication-sha256, authentication-sha512)

set system services ssh protocol-version v2
set system services ssh ciphers aes256-ctr
set system services ssh ciphers aes192-ctr
set system services ssh ciphers aes128-ctr
set system services ssh macs hmac-sha2-512
set system services ssh macs hmac-sha2-256
set system services ssh key-exchange ecdh-sha2-nistp521
set system services ssh key-exchange ecdh-sha2-nistp384
set system services ssh key-exchange ecdh-sha2-nistp256"
      reference   : "800-171|3.7.5,800-53|MA-4(6),800-53r5|MA-4(6),CAT|I,CCI|CCI-003123,CSF|PR.MA-2,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|MA-4(6),NESA|T2.3.4,NESA|T5.4.4,QCSC-v1|5.2.2,Rule-ID|SV-253929r961557_rule,STIG-ID|JUEX-NM-000520,SWIFT-CSCv1|2.6,TBA-FIISB|45.2.3,Vuln-ID|V-253929"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000530 - The Juniper EX switch must be configured to protect against known types of denial-of-service (DoS) attacks by employing organization-defined security safeguards."
  info        : "DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.

This requirement addresses the configuration of network devices to mitigate the impact of DoS attacks that have occurred or are ongoing on device availability. For each network device, known and potential DoS attacks must be identified and solutions for each type implemented. A variety of technologies exist to limit or, in some cases, eliminate the effects of DoS attacks (e.g., limiting processes or restricting the number of sessions the device opens at one time). Employing increased capacity and bandwidth, combined with service redundancy, may reduce the susceptibility to some DoS attacks.

The security safeguards cannot be defined at the DoD-level because they vary according to the capabilities of the individual network devices and the security controls applied on the adjacent networks (for example, firewalls performing packet filtering to block DoS attacks).

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to protect against or limit the effects of all known types of DoS attacks by employing organization-defined security safeguards.

SSH example:
set system services ssh connection-limit <1..250>
set system services ssh rate-limit <1..250>

NETCONF over SSH example:
set system services netconf ssh connection-limit <1..250>
set system services netconf ssh rate-limit <1..250>

Example firewall filters:
set firewall family inet filter <filter name> term 1 from destination-address <device OOBM or loopback address>
set firewall family inet filter <filter name> term 1 from source-prefix-list <management address list name>
set firewall family inet filter <filter name> term 1 from protocol tcp
set firewall family inet filter <filter name> term 1 from destination-port 22
set firewall family inet filter <filter name> term 1 from tcp-initial
set firewall family inet filter <filter name> term 1 then policer policer-32k
set firewall family inet filter <filter name> term 1 then syslog
set firewall family inet filter <filter name> term 1 then accept
set firewall family inet filter <filter name> term 2 from destination-address <device OOBM or loopback address>
set firewall family inet filter <filter name> term 2 from source-prefix-list <management address list name>
set firewall family inet filter <filter name> term 2 from protocol tcp
set firewall family inet filter <filter name> term 2 from destination-port 22
set firewall family inet filter <filter name> term 2 then syslog
set firewall family inet filter <filter name> term 2 then accept
set firewall family inet filter <filter name> term default then syslog
set firewall family inet filter <filter name> term default then discard
set firewall family inet6 filter <filter name-1> term 1 from destination-address <device OOBM or loopback address>
set firewall family inet6 filter <filter name-1> term 1 from source-prefix-list <management address list name-1>
set firewall family inet6 filter <filter name-1> term 1 from next-header tcp
set firewall family inet6 filter <filter name-1> term 1 from destination-port 22
set firewall family inet6 filter <filter name-1> term 1 from tcp-initial
set firewall family inet6 filter <filter name-1> term 1 then policer policer-32k
set firewall family inet6 filter <filter name-1> term 1 then syslog
set firewall family inet6 filter <filter name-1> term 1 then accept
set firewall family inet6 filter <filter name-1> term 2 from destination-address <device OOBM or loopback address>
set firewall family inet6 filter <filter name-1> term 2 from source-prefix-list <management address list name-1>
set firewall family inet6 filter <filter name-1> term 2 from next-header tcp
set firewall family inet6 filter <filter name-1> term 2 from destination-port 22
set firewall family inet6 filter <filter name-1> term 2 then syslog
set firewall family inet6 filter <filter name-1> term 2 then accept
set firewall family inet6 filter <filter name-1> term default then syslog
set firewall family inet6 filter <filter name-1> term default then discard

Example interface configuration:
set interfaces <OOBM interface> unit 0 family inet filter input <filter name>
set interfaces <OOBM interface> unit 0 family inet address <IPv4 address>/<mask>
set interfaces <OOBM interface> unit 0 family inet6 filter input <filter name-1>
set interfaces <OOBM interface> unit 0 family inet6 address <IPv6 address>/<prefix>"
  reference   : "800-53|SC-5,800-53r5|SC-5a.,CAT|II,CCI|CCI-002385,CSF|DE.CM-1,CSF|PR.DS-4,CSF2.0|DE.CM-01,CSF2.0|PR.IR-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-5,ITSG-33|SC-5a.,NESA|T3.3.1,NIAv2|GS8e,NIAv2|GS10c,QCSC-v1|8.2.1,Rule-ID|SV-253930r961620_rule,STIG-ID|JUEX-NM-000530,Vuln-ID|V-253930"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set firewall family inet6? filter .+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file any info"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file structured-data"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ structured-data"
      required    : NO
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host authorization info"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ authorization info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host structured-data"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ structured-data"
      required    : NO
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog time-format"
      regex       : "set system syslog time-format .+"
      expect      : "set system syslog time-format (year|millisecond)"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000560 - The Juniper EX switch must be configured to generate audit records when successful/unsuccessful logon attempts occur."
      info        : "Without generating audit records that are specific to the security and mission needs of the organization, it would be difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.

Audit records can be generated from various components within the network device (e.g., module or policy filter)."
      solution    : "Configure the network device to generate audit records when successful/unsuccessful logon attempts occur.

set system syslog file <file name> any info
set system syslog file <file name> structured-data << (Optional) Only if structured data format is required
set system syslog host <external syslog address> authorization info
set system syslog host <external syslog address> structured-data << (Optional) Only if structured data format is required
set system syslog time-format <(year|millisecond)>"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|II,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253933r961824_rule,STIG-ID|JUEX-NM-000560,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-253933"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host authorization info"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ authorization info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host explicit-priority"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ explicit-priority"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file any info"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog time-format"
      regex       : "set system syslog time-format .+"
      expect      : "set system syslog time-format (year|millisecond)"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000570 - The Juniper EX switch must be configured to generate audit records for privileged activities or other system-level access."
      info        : "Without generating audit records that are specific to the security and mission needs of the organization, it would be difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.

Audit records can be generated from various components within the network device (e.g., module or policy filter)."
      solution    : "Configure the network device to generate audit records for privileged activities or other system-level access.

set system syslog host <syslog address> any info
set system syslog host <syslog address> explicit-priority
set system syslog file <file name> any info
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|II,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253934r961827_rule,STIG-ID|JUEX-NM-000570,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-253934"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host authorization info"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file any info"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog time-format"
      regex       : "set system syslog time-format .+"
      expect      : "set system syslog time-format (year|millisecond)"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000580 - The Juniper EX switch must be configured to generate audit records showing starting and ending time for administrator access to the system."
      info        : "Without generating audit records that are specific to the security and mission needs of the organization, it would be difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.

Audit records can be generated from various components within the network device (e.g., module or policy filter)."
      solution    : "Configure the network device to generate audit records showing starting and ending time for administrator access to the system.

set system syslog file <file name> any info
set system syslog host <external syslog address> any info
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|II,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253935r961830_rule,STIG-ID|JUEX-NM-000580,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-253935"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host authorization info"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file any info"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog time-format"
      regex       : "set system syslog time-format .+"
      expect      : "set system syslog time-format (year|millisecond)"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000590 - The Juniper EX switch must be configured to generate audit records when concurrent logons from different workstations occur."
      info        : "Without generating audit records that are specific to the security and mission needs of the organization, it would be difficult to establish, correlate, and investigate the events relating to an incident or identify those responsible for one.

Audit records can be generated from various components within the network device (e.g., module or policy filter)."
      solution    : "Configure the network device to generate audit records when concurrent logons from different workstations occur.

set system syslog file <file name> any info
set system syslog host <external syslog address> any info
set system syslog time-format year"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12c.,800-53r5|AU-12c.,CAT|II,CCI|CCI-000172,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12c.,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253936r961833_rule,STIG-ID|JUEX-NM-000590,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-253936"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "set file any info"
      regex       : "set file .+"
      expect      : "set file any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file any info"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file archive size"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ archive size .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file archive files"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ archive files .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file transfer-interval"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ archive transfer-interval .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file start-time"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ archive start-time .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file archive-sites"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ archive archive-sites .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "system syslog host any info"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ any info"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000600 - The Juniper EX switch must be configured to offload audit records onto a different system or media than the system being audited."
      info        : "Information stored in one location is vulnerable to accidental or incidental deletion or alteration.

Offloading is a common process in information systems with limited audit storage capacity. Archiving is not required unless space is limited in the audit server."
      solution    : "Archiving is not required unless space is limited in the audit server. Configure the network device to offload audit records onto a different system or media than the system being audited.

set file <file name> any info
set system syslog file <file name> any info
set system syslog file <file name> archive size <65536..1073741824 bytes>
set system syslog file <file name> archive files <1..1000>
set system syslog file <file name> archive transfer-interval <5..2880 minutes>
set system syslog file <file name> archive start-time '<yyyy-mm-dd.hh:mm>'
set system syslog file <file name> archive archive-sites '<scp|sftp>://<username>@<repository address>/<path without trailing slash (/)>' password '<PSK>'
set system syslog host <external syslog address> any info"
      reference   : "800-53|AU-4(1),800-53r5|AU-4(1),CAT|II,CCI|CCI-001851,CSF|PR.DS-4,CSF|PR.PT-1,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-4,NESA|T3.3.1,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253937r961860_rule,STIG-ID|JUEX-NM-000600,Vuln-ID|V-253937"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file messages any info"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ messages any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file structured-data"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ structured-data"
      required    : NO
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host any info"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ any info"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog host structured-data"
      regex       : "set system syslog host .+"
      expect      : "set system syslog host .+ structured-data"
      required    : NO
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog time-format"
      regex       : "set system syslog time-format .+"
      expect      : "set system syslog time-format (year|millisecond)"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "syslog file regex or string match"
      regex       : "set system syslog file .+"
      expect      : "set system syslog file .+ (match)"
      required    : NO
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000620 - The Juniper EX switch must be configured to generate log records for a locally developed list of auditable events."
      info        : "Auditing and logging are key components of any security architecture. Logging the actions of specific events provides a means to investigate an attack; to recognize resource utilization or capacity thresholds; or to identify an improperly configured network device. If auditing is not comprehensive, it will not be useful for intrusion monitoring, security investigations, and forensic analysis."
      solution    : "Configure the network device to generate audit log events for a locally developed list of auditable events.

set system syslog file <file name> messages any info
set system syslog file <file name> structured-data << (Optional) Only if structured data format is required
set system syslog host <external syslog address> any info
set system syslog host <external syslog address> structured-data << (Optional) Only if structured data format is required
set system syslog time-format year

If using REGEX or string match conditions:
set system syslog file <name> any <info|any>
set system syslog file <name> match <REGEX>
-or-
set system syslog file <name> match-strings [ 'string 1' 'string 2' ]"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.4.2,800-53|AU-12a.,800-53|CM-6b.,800-53r5|AU-12a.,800-53r5|CM-6b.,CAT|II,CCI|CCI-000169,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.IP-1,CSF|PR.PT-1,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,CSF2.0|PR.PS-04,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-12a.,ITSG-33|CM-6b.,NESA|T3.2.1,PCI-DSSv3.2.1|10.1,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,Rule-ID|SV-253939r961863_rule,STIG-ID|JUEX-NM-000620,SWIFT-CSCv1|2.3,SWIFT-CSCv1|6.4,Vuln-ID|V-253939"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000630 - The Juniper EX switch must be configured to enforce access restrictions associated with changes to the system components."
  info        : "Changes to the hardware or software components of the network device can have significant effects on the overall security of the network. Therefore, only qualified and authorized individuals should be allowed administrative access to the network device for implementing any changes or upgrades. This requirement applies to updates of the application files, configuration, firewall filters, and policy filters.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to enforce access restrictions associated with changes to the system components.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.4.2,800-171|3.4.5,800-53|CM-5,800-53|CM-6b.,800-53r5|CM-5,800-53r5|CM-6b.,CAT|II,CCI|CCI-000345,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-5,ITSG-33|CM-6b.,NESA|T3.2.1,NESA|T3.2.3,NESA|T5.1.1,NESA|T5.6.1,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.3,QCSC-v1|7.2,Rule-ID|SV-253940r961863_rule,STIG-ID|JUEX-NM-000630,SWIFT-CSCv1|2.3,Vuln-ID|V-253940"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Primary authentication server is configured"
      regex       : "set system (tacplus|radius)-server @PRIMARY_RADIUS_SERVER@ secret .+"
      expect      : "set system (tacplus|radius)-server @PRIMARY_RADIUS_SERVER@ secret .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "Secondary authentication server is configured"
      regex       : "set system (tacplus|radius)-server @SECONDARY_RADIUS_SERVER@ secret .+"
      expect      : "set system (tacplus|radius)-server @SECONDARY_RADIUS_SERVER@ secret .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "Verify the authentication order is configured to use the authentication servers"
      regex       : "set system authentication-order .+"
      expect      : "set system authentication-order (radius|tacplus)"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000640 - The Juniper EX switch must be configured to use an authentication server for the purpose of authenticating users prior to granting administrative access."
      info        : "Centralized management of authentication settings increases the security of remote and nonlocal access methods. This control is particularly important protection against the insider threat. With robust centralized management, audit records for administrator account access to the organization's network devices can be more readily analyzed for trends and anomalies. The alternative method of defining administrator accounts on each device exposes the device configuration to remote access authentication attacks and system administrators with multiple authenticators for each network device."
      solution    : "Configure the network device to use an authentication server.
set system radius-server <RADIUS-1 address> secret '<PSK>'
set system tacplus-server <TACPLUS-1 address> secret '<PSK>'

Configure the authentication order to use the authentication server as primary source for authentication.
set system authentication-order radius
set system authentication-order tacplus
set system authentication-order password"
      reference   : "800-171|3.4.2,800-53|CM-6b.,800-53|CM-6(1),800-53r5|AC-2(3)(a),800-53r5|AC-2(3)(b),800-53r5|AU-9b.,800-53r5|CM-6b.,800-53r5|CM-6(1),800-53r5|IA-2(6)(a),800-53r5|IA-2(6)(b),800-53r5|IA-5(1)(a),800-53r5|IA-5(1)(b),800-53r5|IA-5(1)(e),800-53r5|IA-5(1)(f),800-53r5|IA-5(1)(g),800-53r5|IA-5(2)(b)(2),CAT|I,CCI|CCI-000366,CCI|CCI-000370,CCI|CCI-003627,CCI|CCI-003628,CCI|CCI-003831,CCI|CCI-004046,CCI|CCI-004047,CCI|CCI-004058,CCI|CCI-004059,CCI|CCI-004060,CCI|CCI-004061,CCI|CCI-004063,CCI|CCI-004064,CCI|CCI-004065,CCI|CCI-004068,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,ITSG-33|CM-6(1),NESA|T3.2.1,NIAv2|NS5f,Rule-ID|SV-253941r1001014_rule,STIG-ID|JUEX-NM-000640,SWIFT-CSCv1|2.3,Vuln-ID|V-253941"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"OR">
    <custom_item>
      type            : CONFIG_CHECK
      description     : "system services netconf"
      regex           : "set system services netconf .+"
      expect          : "set system services netconf (ssh|rfc-compliant)"
      min_occurrences : "2"
    </custom_item>

    <custom_item>
      type            : CONFIG_CHECK
      description     : "system archival configuration"
      regex           : "set system archival configuration .+"
      expect          : "set system archival configuration .+ (transfer-on-commit|archive-sites)"
      min_occurrences : "2"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "JUEX-NM-000650 - The Juniper EX switch must be configured to conduct backups of system level information contained in the information system when changes occur."
      info        : "System-level information includes default and customized settings and security attributes, including firewall filters that relate to the network device configuration, as well as software required for the execution and operation of the device. Information system backup is a critical step in ensuring system integrity and availability. If the system fails and there is no backup of the system-level information, a denial-of-service condition is possible for all who utilize this critical network component.

This control requires the network device to support the organizational central backup process for system-level information associated with the network device. This function may be provided by the network device itself; however, the preferred best practice is a centralized backup rather than each network device performing discrete backups."
      solution    : "Configure the network device to conduct backups of system-level information contained in the information system when changes occur.

For NETCONF connections:
set system services netconf ssh
set system services netconf rfc-compliant

Note: The rfc command is recommended for compatibility in large enterprise but can be omitted if there are overriding operational considerations.

For device automated configuration offload:
set system archival configuration transfer-on-commit
set system archival configuration archive-sites '<scp|sftp>://<username>@<address>/<path without trailing slash (/)>' password '<PSK>'"
      reference   : "800-171|3.4.2,800-171|3.8.9,800-53|CM-6b.,800-53|CP-9b.,800-53r5|CM-6b.,800-53r5|CP-9b.,CAT|II,CCI|CCI-000366,CCI|CCI-000537,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF|PR.IP-4,CSF2.0|DE.CM-09,CSF2.0|PR.DS-01,CSF2.0|PR.DS-10,CSF2.0|PR.DS-11,CSF2.0|PR.PS-01,CSF2.0|RC.RP-03,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,GDPR|32.1.c,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.3.1,ITSG-33|CM-6b.,ITSG-33|CP-9b.,NESA|T3.2.1,NESA|T3.5.1,Rule-ID|SV-253942r961863_rule,STIG-ID|JUEX-NM-000650,SWIFT-CSCv1|2.3,Vuln-ID|V-253942"
      see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000660 - The Juniper EX switch must be configured to obtain its public key certificates from an appropriate certificate policy through an approved service provider."
  info        : "For user certificates, each organization obtains certificates from an approved, shared service provider, as required by OMB policy. For federal agencies operating a legacy public key infrastructure cross-certified with the Federal Bridge Certification Authority at medium assurance or higher, this Certification Authority will suffice.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to obtain its public key certificates from an appropriate certificate policy through an approved service provider. To view installed certificates:
show security pki (ca-certificate | local-certificate)

Generate a public/private keypair:
request security pki generate-key-pair type <ecdsa|rsa> size <bit size> certificate-id <name>
Note: ECDSA certificates support 256, 384, or 512 key sizes and RSA supports 1024, 2048, or 4096.

Generate a certificate signing request:
request security pki generate-certificate-request certificate-id <key name> digest <sha-1|sha-256|sha-384> domain-name <FQDN> ip-address <IPv4 address> ipv6-address <IPv6 address> subject <LDAP format>
Note: The subject is LDAP formatted. For example, 'CN=switch-01,DC=example,DC=com,O=Company,OU=HR,L=Some City,ST=Some State,C=US'. Not all key => value pairs are required but those used must match organizational policy.

After securely transferring the CSR to the certificate authority for signing, and securely transferring the certificate to the device, add the certificate:
request security pki local-certificate load filename <path/filename of certificate> certificate-id <key name>

The certificate can also be generated externally, with separate public and private key files, or a PKCS#12 package containing both certificate and private key. When importing externally generated certificate and private key, use the 'key' directive to identify the path and filename of the private key. If the private key, or the PKCS#12 package, uses a passphrase, use the 'passphrase' directive and provide the correct value."
  reference   : "800-171|3.4.2,800-53|CM-6b.,800-53|SC-17,800-53r5|CM-6b.,800-53r5|SC-17a.,CAT|II,CCI|CCI-000366,CCI|CCI-001159,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,ITSG-33|SC-17,ITSG-33|SC-17a.,NESA|T3.2.1,NESA|T7.4.2,NIAv2|CY5a,NIAv2|CY10,NIAv2|CY12,NIAv2|SS25,Rule-ID|SV-253943r961863_rule,STIG-ID|JUEX-NM-000660,SWIFT-CSCv1|2.3,Vuln-ID|V-253943"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  cmd         : "show security pki local-certificate"
  regex       : ".*"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000670 - The Juniper EX switch must be configured to send log data to at least two central log servers for the purpose of forwarding alerts to the administrators and the information system security officer (ISSO)."
  info        : "The aggregation of log data kept on a syslog server can be used to detect attacks and trigger an alert to the appropriate security personnel. Information stored in one location is vulnerable to accidental or incidental deletion or alteration."
  solution    : "Add the following stanzas to the configuration.

set system syslog host <external syslog host1 IPv4 or IPv6 address> any info
set system syslog host <external syslog host2 IPv4 or IPv6 address> any info

Note: The time-format command supports including the year and/or the time in milliseconds. The default format does not include the year and time is recorded in seconds."
  reference   : "800-171|3.14.1,800-53|AU-4(1),800-53|SI-2c.,800-53r5|AU-4(1),800-53r5|SI-2c.,CAT|I,CCI|CCI-001851,CCI|CCI-002605,CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|ID.RA-1,CSF|PR.DS-4,CSF|PR.IP-12,CSF|PR.PT-1,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|PR.PS-02,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-4,ITSG-33|SI-2,NESA|T3.3.1,NESA|T3.6.2,NESA|T7.6.2,NESA|T7.7.1,NIAv2|AM38,NIAv2|AM39,NIAv2|SS14b,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.3,QCSC-v1|8.2.1,QCSC-v1|11.2,QCSC-v1|13.2,Rule-ID|SV-253944r1028872_rule,STIG-ID|JUEX-NM-000670,SWIFT-CSCv1|2.2,Vuln-ID|V-253944"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system syslog host .+"
  expect      : "set system syslog host .+ any info"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000680 - The Juniper EX switch must be configured with an operating system release that is currently supported by the vendor."
  info        : "Network devices running an unsupported operating system lack current security fixes required to mitigate the risks associated with recent vulnerabilities.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Upgrade the network device to an operating system that is supported by the vendor.

request system software add <supported installation package>"
  reference   : "800-171|3.4.2,800-53|CM-6b.,800-53r5|CM-6b.,CAT|I,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,CSF2.0|DE.CM-09,CSF2.0|PR.PS-01,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|CM-6b.,NESA|T3.2.1,Rule-ID|SV-253945r961863_rule,STIG-ID|JUEX-NM-000680,SWIFT-CSCv1|2.3,Vuln-ID|V-253945"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set version"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

<report type:"WARNING">
  description : "JUEX-NM-000910 - The Juniper EX switch must change credentials for account of last resort when administrators who know the credential leave the organization."
  info        : "A shared/group account credential is a shared form of authentication that allows multiple individuals to access the network device using a single account. If shared/group account credentials are not terminated when individuals leave the group, the user that left the group can still gain access even though they are no longer authorized. There may also be instances when specific user actions need to be performed on the network device without unique administrator identification or authentication. Examples of credentials include passwords and group membership certificates.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Document this process in the SSP. Change the account of last resort to a new password when administrators who know the credential leave the organization

Set the password for the account of last resort:
set system login user <account of last resort name> authentication plain-text-password
New password: <password - not echoed to the screen>
Retype new password: <password verification - not echoed to the screen>"
  reference   : "800-171|3.1.1,800-53|AC-2(10),800-53r5|IA-2(5),CAT|II,CCI|CCI-002142,CCI|CCI-004045,CN-L3|7.1.3.2(d),CSF|PR.AC-1,CSF|PR.AC-4,CSF2.0|DE.CM-01,CSF2.0|DE.CM-03,CSF2.0|PR.AA-01,CSF2.0|PR.AA-05,CSF2.0|PR.DS-10,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e,QCSC-v1|5.2.2,QCSC-v1|8.2.1,QCSC-v1|13.2,QCSC-v1|15.2,Rule-ID|SV-253946r1018771_rule,STIG-ID|JUEX-NM-000910,Vuln-ID|V-253946"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "JUEX-NM-000930 - The Juniper EX switch must prevent nonprivileged users from executing privileged functions to include disabling, circumventing, or altering implemented security safeguards/countermeasures."
  info        : "Preventing nonprivileged users from executing privileged functions mitigates the risk that unauthorized individuals or processes may gain unnecessary access to information or privileges.

Privileged functions include, for example, establishing accounts, performing system integrity checks, or administering cryptographic key management activities. Nonprivileged users are individuals that do not possess appropriate authorizations.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device to assign appropriate user roles or access levels to authenticated users, or configure the network device to leverage an AAA solution that will satisfy this objective.

set system login class <name> permissions <permission sets or 'all'>
set system login class <name> deny-commands <appropriate commands to deny>
set system login class <name> deny-configuration-regexps <appropriate configuration hierarchy to deny>

set system login user <account name> class <name>"
  reference   : "800-171|3.1.7,800-53|AC-6(10),800-53r5|AC-6(10),CAT|I,CCI|CCI-002235,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSF|PR.AC-4,CSF2.0|PR.AA-05,DISA_Benchmark|Juniper_EX_NDM_STIG,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,Rule-ID|SV-253947r961353_rule,STIG-ID|JUEX-NM-000930,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,Vuln-ID|V-253947"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_Juniper_EX_Switches_Y24M10_STIG.zip"
  regex       : "set system login class .+ (permissions|deny).+"
  expect      : "Manual Review Required"
  severity    : MEDIUM
</custom_item>

</check_type>
