#TRUSTED a97859343268213ecb8043a79381cd642cb3caa5bf331f736ebfdacb156287b1785c25b17a31b05ba3b500b1d1b4ec1f197c1ad81d0c5314af4af1d1f3f063907990dbd8e86f0a6491a35610d9b2666505b58db2850304d3a66624bfccd3695b31ea3f19f90eb6d77b317b557c496679ab78b207ebf844fe95ae559ec59a1fca8d88d814806a8fdcc265ab60c9d9eb222f4806775dd6f46b991b8ca4a053c161c118769ca814bf2f389a1c9ea0fd76e105f0c071d092fe381e036ee3d9f6a9d0613e7655a988bb9455a5440935605639b20b7a13b8dcbd09417f5b7d53d0fa6392f1eb4a038e756236bf813225804fef2ffe791a6f4214ec1605a85b4b40978ce01f4c2f3bd734eefa563eb7c51b613fc8a38f912e6980884b41e76a89b9c4bd4612cb2039efb440cc598c8197bb32c05bd8e14f8753090a4bdb9a7a23dcd542832c6a45cb9dc333a67c9cccc1d7210af4e3eca94c5d816934ae6dedf75c12718fd9ff83a78f6a1f57b76093f96cb4458588eb3d9f7608f87bc42952b3c758e711ad9a77362540b49cfe41ba7cd1b7e4e22158c56a53efc15552bf99f421c01770ad14c47f2a6aa701dd1a446f9bd7817916d820925496d7ae308403c444cd35bd93b86d8a1dfde09c4a27201e07a6d3a2e2e86cf9ef55ddb8e9b8e431ba6327e69923bd52de6ff46e1fa5cbd56dd2bb6bb710591eb97bda3d8a56757bcdd33a
#TRUST-RSA-SHA256 07acaa764256f1a2993ba77f78b62efae31e2ade919bb2dc41788340f6ef7f9e26f627e6a27b9727562b7eb4c95acdbe690a63ce013f76d7aac4d71d1d173005e7e93131417c52c4e813e3374e0164deddfd556b6bb42db7656f0ec37e177e2984ffb6f73c3b2baf660e983d5cc5840197a2d60d6c62dbc1e6ed6ab62932732cebc5b362dae85ae2e1141a6dd4c27bd4b4a4cc1177d8a17ef5946e433f6cc5fec421803db7ee7ecbb64ec7c5fa70e064c7e3d85417e781f421c663de06b76ea253e7e762c9d091401039064baee84a72a12ddb39060378516d63409228b47ed4196e22fa5d5ff6b2853b7ab25ca1e3a417f4e3dcbcbc3443269133f9be5efc9811fcd86072dfbf3490a6e3b3b80b47cbf1e41d4e7a645ecdde85809d6e1f5200c35c3298a4e28aaf40510aed6ce689edbf207d36fc0c5c74a414db45bc64fec6bca6f096e83dbb7434e6068c06f502cf03a16ddf160724dd140d7249e75e990fb71b194b0f91355c2ba7058b2aa9f9ae67356af010fcfd14ac783656cf7fba5a1923f46bc3f2bf6630983b47bc3b098ea7504be1f5b93b64020a8fa4e37f8b9e9f4422680ab50e0e1ef52db646e8cd34ce39a5c132d25030caefc85926e02f5e268c10a8a924351af7e4618b7ecd7c288038ea87ae8667d1932f7f92d7746351d6c0978c8a82eeafffd0596aac0df7ee6c37b2ae323b67c7ce65869b6eb60c6f
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2024/06/24 $
#
# description : This .audit is designed against the CIS Fortigate 7.0.x Benchmark v1.3.0
#
#<ui_metadata>
#<display_name>CIS Fortigate 7.0.x v1.3.0 L1</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Fortigate 7.0.x</name>
#  <profile>L1</profile>
#  <version>1.3.0</version>
#  <link>https://workbench.cisecurity.org/benchmarks/15284</link>
#</spec>
#<labels>cis,fortigate_7.0.x</labels>
#<benchmark_refs>CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#<variables>
#  <variable>
#    <name>ADMIN_LOCKOUT_DURATION</name>
#    <default>900</default>
#    <description>2.2.2 - Admin lockout duration</description>
#    <info>The duration (in seconds) of an admin account lockout on the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>ADMIN_LOCKOUT_THRESHOLD</name>
#    <default>3</default>
#    <description>2.2.2 - Admin lockout threshold</description>
#    <info>The number of failed attempts before admin accounts are locked out on the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>ADMIN_TIMEOUT</name>
#    <default>5</default>
#    <description>2.4.4 Admin Session Timeout</description>
#    <info>The amount of idle time in an admin session before automatic logout occurs.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>APPLIES_TO</name>
#    <default>admin-password ipsec-preshared-key</default>
#    <description>2.2.1 - password scope</description>
#    <info>The scope for which password policy applies on the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>DNS_SERVER_1</name>
#    <default>10.0.0.1</default>
#    <description>DNS Server 1</description>
#    <info>This is the IP address of the 1st DNS server utilized by your organization.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>DNS_SERVER_2</name>
#    <default>10.0.0.2</default>
#    <description>DNS Server 2</description>
#    <info>This is the IP address of the 2nd DNS server utilized by your organization.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>EXPIRE_PASSWORDS</name>
#    <default>enable</default>
#    <description>2.2.1 - password expiration</description>
#    <info>Whether to enforce password expiration in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>HA_GATEWAY</name>
#    <default>192.168.0.1</default>
#    <description>2.5.3 - HA Gateway</description>
#    <info>The IPv4 (or IPv6) gateway address for the primary HA management interface.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>HA_INTERFACE</name>
#    <default>port6</default>
#    <description>2.5.3 - HA interface</description>
#    <info>The port for the primary HA management interface</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>HA_MONITOR_PORT_1</name>
#    <default>port8</default>
#    <description>2.5.2 Monitor Interface 1 for High Availability</description>
#    <info>First port to monitor for High Availability Link</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>HA_MONITOR_PORT_2</name>
#    <default>port9</default>
#    <description>2.5.2 Monitor Interface 2 for High Availability</description>
#    <info>Second port to monitor for High Availability Link</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>INBOUND_POLICY</name>
#    <default>1</default>
#    <description>3.3 - Inbound Policy ID</description>
#    <info>The Policy ID number for the firewall policy containing the specified rules.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>OUTBOUND_POLICY</name>
#    <default>2</default>
#    <description>3.3 - Outbound Policy ID</description>
#    <info>The Policy ID number for the firewall policy containing the specified rules.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MAX_AGE</name>
#    <default>90</default>
#    <description>2.2.1 - maximum password age</description>
#    <info>The maximum password age in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MIN_LENGTH</name>
#    <default>8</default>
#    <description>2.2.1 - minimum password length</description>
#    <info>The minimum password length in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MIN_LOWERCASE</name>
#    <default>1</default>
#    <description>2.2.1 - minimum number of lowercase letters</description>
#    <info>The minimum number of lowercase letters in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MIN_NON_ALPHANUM</name>
#    <default>1</default>
#    <description>2.2.1 - minimum number of non-alphanumeric characters</description>
#    <info>The minimum number of non-alphanumeric characters in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MIN_NUMBER</name>
#    <default>1</default>
#    <description>2.2.1 - minimum number of numbers</description>
#    <info>The minimum number of numbers in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>MIN_UPPERCASE</name>
#    <default>1</default>
#    <description>2.2.1 - minimum number of uppercase letters</description>
#    <info>The minimum number of uppercase letters in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>REUSE_PASSWORDS</name>
#    <default>disable</default>
#    <description>2.2.1 - password reuse</description>
#    <info>Whether to allow password reuse in the password policy for the Fortigate device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>NTP_SERVER_1</name>
#    <default>10.0.0.3</default>
#    <description>NTP Server 1</description>
#    <info>This is the IP address of the 1st NTP server utilized by your organization.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>NTP_SERVER_2</name>
#    <default>10.0.0.4</default>
#    <description>NTP Server 2</description>
#    <info>This is the IP address of the 2nd NTP server utilized by your organization.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>PRE_BANNER</name>
#    <default>All unauthorized activity is monitored and logged.</default>
#    <description>2.1.1 Pre-login banner text</description>
#    <info>The banner displayed from the 'pre-login-banner' configuration.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>POST_BANNER</name>
#    <default>All unauthorized activity is monitored and logged.</default>
#    <description>2.1.2 Post-login banner text</description>
#    <info>The banner displayed from the 'post-login-banner' configuration.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>TIMEZONE</name>
#    <default>12</default>
#    <description>2.1.3 device timezone</description>
#    <info>The specified timezone for the device.</info>
#    <value_type>STRING</value_type>
#  </variable>
#  <variable>
#    <name>WAN_PORT</name>
#    <default>port1</default>
#    <description>WAN Port</description>
#    <info>The WAN Port used for public connections</info>
#    <value_type>STRING</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"FortiGate">

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check that primary dns is set"
      context     : "config system dns$"
      regex       : "set[\s]+primary[\s]+"
      expect      : "set[\s]+primary[\s]+@DNS_SERVER_1@"
    </custom_item>

    <custom_item>
      description : "check that secondary dns is set"
      context     : "config system dns$"
      regex       : "set[\s]+secondary[\s]+"
      expect      : "set[\s]+secondary[\s]+@DNS_SERVER_2@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "1.1 Ensure DNS server is configured"
      info        : "Fortinet uses the Domain Name Service (DNS) to translate host names into IP addresses. To enable DNS lookups, you must specify the primary DNS server for your system. You can also specify secondary and tertiary DNS servers. When resolving host names, the system consults the primary name server. If a failure or time-out occurs, the system consults the secondary name server.

For security purpose, trusted DNS servers should be configured to prevent man-in-the-middle attacks.

The purpose is to perform the resolution of system hostnames to Internet Protocol (IP) addresses using trusted DNS servers."
      solution    : "In this example, we will assign 8.8.8.8 as primary DNS and 8.8.4.4 as secondary DNS.

In CLI:

FGT1 # config system dns
FGT1 (dns) # set primary 8.8.8.8
FGT1 (dns) # set secondary 8.8.4.4
FGT1 (dns) # end
FGT1 #

In the GUI, go to Networks > DNS. Click on \"Specify\" and put in 8.8.8.8 as \"Primary DNS Server\" and 8.8.4.4 as \"Secondary DNS Server\""
      reference   : "800-53|SC-20,800-53|SC-21,800-53|SC-22,800-53r5|SC-20,800-53r5|SC-21,800-53r5|SC-22,CSCv7|11.1,CSCv8|4.9,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,ITSG-33|SC-21,ITSG-33|SC-21a.,ITSG-33|SC-22,ITSG-33|SC-22a.,LEVEL|1A,NESA|T4.5.1,NIAv2|NS17,NIAv2|NS18,NIAv2|NS19,NIAv2|NS20,NIAv2|NS21,NIAv2|NS22,NIAv2|NS23,QCSC-v1|5.2.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "1.2 Ensure intra-zone traffic is not always allowed"
  info        : "This is to make sure that only specific, authorized traffic is allowed between networks in the same zone.

This adds an extra layer of protection between different networks."
  solution    : "In this example, we'll turn off intra-zone traffic in the zone DMZ.In CLI:

FGT1 # config system zone
FGT1 (zone) # edit DMZ
FGT1 (DMZ) # set intrazone deny
FGT1 (DMZ) # end
FGT1 #

In the GUI, click on Network -> Interfaces, select the zone and click on \"Edit\" and turn on \"Block intra-zone traffic\""
  reference   : "800-171|3.1.16,800-171|3.1.17,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,CSCv7|2.10,CSCv8|4.2,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T5.4.2,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS15a,NIAv2|SS16,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system zone"
  expect      : "set[\s]+intrazone[\s]+deny"
</custom_item>

<custom_item>
  description : "1.3 Disable all management related services on WAN port"
  info        : "Enabling any management related services on WAN interface is high risk. Management related services such as HTTPS, HTTP, ping, SSH, SNMP, and Radius should be disabled on WAN.

Management related services should only be enabled on management interface. This is part of defending the firewall from attacks and reducing the attack surface. For WAN related services such as IPSec and SSLVPN, make use of local-in-policy (refer to CIS Section 2.4) to tighten firewall defenses."
  solution    : "On GUI:

Go to \"Network\" > \"Interfaces\".

Review WAN interface and disable HTTPS, HTTP, ping, SSH, SNMP, and Radius services.

On CLI:

FGT1 # config system interface
FGT1 (interface) # edit \"port1\"
FGT1 (port1) # unselect allowaccess ping https ssh snmp http radius-acct

Note:

 -

Interface name may differ based on deployment. For this example, port1 is deployed as WAN interface.

 -

\"unselect allowaccess\" will only show services that you have enabled. If you have not enabled snmp on that interface, then snmp option will not be available.

Impact:

Enabling management related services on WAN port is convenient, but it exposes the firewall to unnecessary risks. Vulnerabilities found on vendor devices are commonly related to management services, and opening access to these allows attackers to exploit its vulnerabilities."
  reference   : "800-171|3.1.16,800-171|3.1.17,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,CSCv7|1.6,CSCv8|4.2,CSCv8|4.8,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T5.4.2,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS15a,NIAv2|SS16,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system interface"
  context     : "edit \"@WAN_PORT@\""
  not_expect  : "set allowaccess .+"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check pre-login banner enabled"
      context     : "config system global"
      expect      : "set[\s]+pre-login-banner[\s]+enable"
    </custom_item>

    <custom_item>
      description : "check pre-login banner configured"
      context     : "config system replacemsg admin \"pre_admin-disclaimer-text\""
      expect      : "@PRE_BANNER@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.1.1 Ensure 'Pre-Login Banner' is set"
      info        : "Configure a pre-login banner, ideally approved by the organization's legal team. This banner should, at minimum, prohibit unauthorized access, provide notice of logging or monitoring, and avoid using the word \"welcome\" or similar words of invitation.

Through a properly stated login banner, the risk of unintentional access to the device by unauthorized users is reduced. Should legal action take place against a person accessing the device without authorization, the login banner greatly diminishes a defendant's claim of ignorance."
      solution    : "Run the following command in the CLI to enable the pre-login-banner:

FG1 # config system global
FG1 (global) # set pre-login-banner enable
FG1 (global) # end
FG1 #

In the GUI, to edit the content of the pre-login disclaimer message:

 - Go to 'System' -> 'Replacement Messages' -> 'Extended View' -> 'Pre-login Disclaimer Message'. The edit screen is on the bottom right corner of the page. Click on \"Save\" after the editing is done.

Impact:

Login banners provide a definitive warning to any possible intruders who may want to access the FortiGate that certain types of activity are illegal. At the same time, it also advises the authorized and legitimate users of their obligations relating to acceptable use."
      reference   : "800-171|3.2.1,800-171|3.2.2,800-53|AT-1,800-53|AT-2,800-53|PM-13,800-53r5|AT-1,800-53r5|AT-2,800-53r5|PM-13,CSCv7|17.3,CSCv8|14.1,CSF|ID.GV-1,CSF|ID.GV-3,CSF|PR.AT-1,CSF|PR.AT-2,CSF|PR.AT-4,CSF|PR.AT-5,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|AT-1,ITSG-33|AT-2,LEVEL|1A,NESA|M1.2.2,NESA|M1.3.6,NESA|M3.4.1,NESA|T3.4.1,NIAv2|AM13,QCSC-v1|11.2,SWIFT-CSCv1|7.2"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "2.1.10 Ensure management GUI listens on secure TLS version"
  info        : "As we move towards better encryption capabilities, we need to also ensure GUI access is properly secured. TLS 1.3 is currently the most secure SSL/TLS supported version for SSL-encrypted administrator access (at this time of writing).

Use higher version of SSL/TLS to prevent MiTM attacks."
  solution    : "CLI:

config system global
set admin-https-ssl-versions tlsv1-3"
  reference   : "800-171|3.1.16,800-53|AC-18,800-53r5|AC-18,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,LEVEL|1A,QCSC-v1|5.2.1,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system global"
  expect      : "set[\s]+admin-https-ssl-versions[\s]+tlsv1-3"
</custom_item>

<custom_item>
  description : "2.1.12 Ensure single CPU core overloaded event is logged"
  info        : "Add log-single-cpu-high option under config system global. When enabled, CPU single core usage will be polled every three seconds, and any single CPU core usage above the CPU usage threshold will report an event log. If a core is reported, that core will not be checked again for the next 30 seconds.

There are instances where overall CPU usage is low, but there is a single CPU core that is overloaded. But because reporting and dashboard in FortiGate shows the overall CPU usage, a single CPU core spike may get overlooked on a FortiGate with multiple CPU cores. This causes performance issues where there are instances which traffic has been stopped processing."
  solution    : "On CLI:

config system global
    set log-single-cpu-high enable
end"
  reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.3.6,800-53|AU-2,800-53|AU-3,800-53|AU-3(1),800-53|AU-7,800-53|AU-12,800-53r5|AU-2,800-53r5|AU-3,800-53r5|AU-3(1),800-53r5|AU-7,800-53r5|AU-12,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.2.3(c),CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|8.1.4.3(a),CN-L3|8.1.4.3(b),CSCv8|8.2,CSCv8|8.5,CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-2,ITSG-33|AU-3,ITSG-33|AU-3(1),ITSG-33|AU-7,ITSG-33|AU-12,LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NESA|T3.6.2,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.1,PCI-DSSv3.2.1|10.3,PCI-DSSv3.2.1|10.3.1,PCI-DSSv3.2.1|10.3.2,PCI-DSSv3.2.1|10.3.3,PCI-DSSv3.2.1|10.3.4,PCI-DSSv3.2.1|10.3.5,PCI-DSSv3.2.1|10.3.6,PCI-DSSv4.0|10.2.2,QCSC-v1|3.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system global"
  expect      : "set[\s]+log-single-cpu-high[\s]+enable"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check post-login banner is enabled"
      context     : "config system global"
      expect      : "set[\s]+post-login-banner[\s]+enable"
    </custom_item>

    <custom_item>
      description : "check post-login banner content is set"
      context     : "config system replacemsg admin \"post_admin-disclaimer-text\""
      expect      : "@POST_BANNER@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.1.2 Ensure 'Post-Login-Banner' is set"
      info        : "Sets the banner after users successfully log in. This is equivalent to Message of the Day (MOTD) in some other systems.

Network banners are electronic messages that provide notice of legal rights to users of computer networks. From a legal standpoint, banners have four primary functions:

First, banners may be used to generate consent to real-time monitoring under Title III.Second, banners may be used to generate consent to the retrieval of stored files and records pursuant to ECPA.Third, in the case of government networks, banners may eliminate any Fourth Amendment \"reasonable expectation of privacy\" that government employees or other users might otherwise retain in their use of the government's network under O'Connor v."
      solution    : "Run the following command in the CLI to enable the post-login-banner:

FG1 # config system global
FG1 (global) # set post-login-banner enable
FG1 (global) # end
FG1 #

In the GUI, to edit the content of the post-login disclaimer message, go to

System -> Replace Messages -> Extended View -> \"Post-login Disclaimer Message\". The edit screen is on the bottom right corner of the page. Click on \"Save\" after the editing is done.

Impact:

When post-login banner is enabled, some automated-script might be affected because both CLI and GUI need an acceptance action (press \"A\" or \"Accept\") to continue."
      reference   : "800-171|3.1.16,800-171|3.1.17,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,CSCv7|11.1,CSCv8|4.2,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T5.4.2,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS15a,NIAv2|SS16,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "2.1.3 Ensure timezone is properly configured"
  info        : "Sets the local time zone information so that the time displayed by the device is more relevant to those who are viewing it.

Having a correct time set on the device is important for two main reasons. The first reason is that digital certificates compare this time to the range defined by their Valid From and Valid To fields to define a specific validity period. The second reason is to have relevant time stamps when logging information. Whether you are sending messages to a Syslog server, sending messages to an SNMP monitoring station, or performing packet captures, timestamps have little usefulness if you cannot be certain of their accuracy."
  solution    : "In this example, we will set Eastern Timezone (GMT-5:00) for the Fortigate. Each timezone will have its corresponding ID. To find the correct ID, when you type in the command \"set timezone \", also type the question mark '?' to list all of the available timezones and their IDs. The ID of the Eastern Timezone is 12In the CLI:

FGT1 # config system global
FGT1 (global) # set timezone 12
FGT1 (global) # end
FGT1 #

In the GUI, do the following:

1) After login to fortigate, go to 'System' -> 'Settings'
2) Select '(GMT-5:00) Eastern Time (US &amp; Canada)' under 'System Time'

Impact:

For many features to work, including scheduling, logging, and SSL-dependent features, the FortiOS system time must be accurate."
  reference   : "800-171|3.3.6,800-171|3.3.7,800-53|AU-7,800-53|AU-8,800-53r5|AU-7,800-53r5|AU-8,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(b),CSCv7|6.1,CSCv8|8.4,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-7,ITSG-33|AU-8,LEVEL|1A,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4,TBA-FIISB|37.4"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system global"
  regex       : "set timezone[\s]+"
  expect      : "@TIMEZONE@"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check ntp server #1"
      context     : "config system ntp$"
      regex       : "set[\s]+server[\s]+"
      expect      : "set[\s]+server[\s]+\"?@NTP_SERVER_1@\"?"
    </custom_item>

    <custom_item>
      description : "check ntp server #2 set"
      context     : "config system ntp$"
      regex       : "set[\s]+server[\s]+"
      expect      : "set[\s]+server[\s]+\"?@NTP_SERVER_2@\"?"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.1.4 Ensure correct system time is configured through NTP"
      info        : "You can either manually set the FortiOS system time, or configure the device to automatically keep its system time correct by synchronizing with a Network Time Protocol (NTP) server.

These settings enable the use of primary and secondary NTP servers to provide redundancy in case of a failure involving the primary NTP server.

NTP enables the device to maintain accurate time and date when receiving updates from a reliable NTP server. Accurate timestamps are critical when correlating events with other systems, troubleshooting, or performing investigative work. Logs and certain cryptographic functions, such as those utilizing certificates, rely on accurate time and date parameters. In addition, rules referencing a Schedule object will not function as intended if the device's time and date are incorrect. For additional security, authenticated NTP can be utilized. If Symmetric Key authentication is selected, only SHA1 should be used, as MD5 is considered severely compromised."
      solution    : "You can only customize NTP setting using CLI. In this example, we'll assign pool.ntp.org as primary NTP server and 1.1.1.1 as secondary NTP server.

FGT1 # config system ntp
FGT1 (ntp) # set type custom
FGT1 (ntp) # config ntpserver
FGT1 (ntpserver) # edit 1
FGT1 (1) # set server pool.ntp.org
FGT1 (1) # next
FGT1 (ntpserver) # edit 2
FGT1 (2) # set server 1.1.1.1
FGT1 (2) # end
FGT1 (ntp) # end
FGT1 #

Impact:

For many features to work, including scheduling, logging, and SSL-dependent features, the FortiOS system time must be accurate."
      reference   : "800-171|3.3.6,800-171|3.3.7,800-53|AU-7,800-53|AU-8,800-53r5|AU-7,800-53r5|AU-8,CN-L3|7.1.2.3(c),CN-L3|8.1.4.3(b),CSCv7|6.1,CSCv8|8.4,CSF|PR.PT-1,CSF|RS.AN-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-7,ITSG-33|AU-8,LEVEL|1A,NESA|T3.6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4,TBA-FIISB|37.4"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "2.1.5 Ensure hostname is set"
  info        : "Changes the device default hostname.

The device hostname plays an important role in asset inventory and identification as a security requirement. It is also crucial in the public keys and certificate deployments, as well as when correlating logs from different systems during an incident handling.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "In CLI, set the hostname to 'New_FGT1' as follows:

FGT1 # config system global
FGT1 (global) # set hostname \"New_FGT1\"
FGT1 (global) # end
New_FGT1 #

In GUI

1) Go to 'System' > 'Settings'
2) Update the field 'Hostname' with the new hostname
3) click 'Apply'"
  reference   : "800-53|SC-20,800-53r5|SC-20,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-20,LEVEL|1A,QCSC-v1|5.2.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system global"
  regex       : "set[\s]+hostname[\s]+"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check special characters"
      context     : "config system password-policy$"
      expect      : "set[\s]+min-non-alphanumeric[\s]+@MIN_NON_ALPHANUM@$"
    </custom_item>

    <custom_item>
      description : "check password reuse"
      context     : "config system password-policy$"
      expect      : "set[\s]+reuse-password[\s]+@REUSE_PASSWORDS@"
    </custom_item>

    <custom_item>
      description : "check minimum uppercase letters"
      context     : "config system password-policy$"
      expect      : "set[\s]+min-upper-case-letter[\s]+@MIN_UPPERCASE@$"
    </custom_item>

    <custom_item>
      description : "check minimum length"
      context     : "config system password-policy$"
      expect      : "set[\s]+minimum-length[\s]+@MIN_LENGTH@$"
    </custom_item>

    <custom_item>
      description : "check password expiry time"
      context     : "config system password-policy$"
      expect      : "set[\s]+expire-day[\s]+@MAX_AGE@$"
    </custom_item>

    <custom_item>
      description : "check that passwords expire"
      context     : "config system password-policy$"
      expect      : "set[\s]+expire-status[\s]+@EXPIRE_PASSWORDS@"
    </custom_item>

    <custom_item>
      description : "check minimum lowercase letters"
      context     : "config system password-policy$"
      expect      : "set[\s]+min-lower-case-letter[\s]+@MIN_LOWERCASE@$"
    </custom_item>

    <custom_item>
      description : "check that password policy is enabled"
      context     : "config system password-policy$"
      expect      : "set[\s]+status[\s]+enable"
    </custom_item>

    <custom_item>
      description : "check which accounts password policy applies to"
      context     : "config system password-policy$"
      expect      : "set[\s]+apply-to[\s]+@APPLIES_TO@"
    </custom_item>

    <custom_item>
      description : "check minimum number of numbers"
      context     : "config system password-policy$"
      expect      : "set[\s]+min-number[\s]+@MIN_NUMBER@$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.2.1 Ensure 'Password Policy' is enabled"
      info        : "It is important to use secure and complex passwords for preventing unauthorized access to the FortiGate device.

Attackers can use brute force password software to launch more than just dictionary attacks. Such attacks can discover common passwords where a letter is replaced by a number or symbol."
      solution    : "Can be modified from CLI or GUI.

From CLI, do the following:

config system password-policy
	set status enable
	set apply-to admin-password ipsec-preshared-key
	set minimum-length 8
	set min-lower-case-letter 1
	set min-upper-case-letter 1
	set min-non-alphanumeric 1
	set min-number 1
	set expire-status enable
	set expire-day 90
	set reuse-password disable
end

Or from GUI, do the following:

1) Log in to FortiGate as Super Admin
2) Go to 'System' > 'Settings'
3) Find the 'Password Policy' section
4) Default 'Password scope' is 'Off', change it to 'Both'
5) set 'Minimum length' to '8'
6) Enable 'Character requirements'
7) set minimum '1' in the filed of 'Upper Case', 'Lower Case', 'Numbers (0-9)' and 'Special'
8) Disable 'Allow password reuse'
9) Enable 'Password expiration' and set it to 90

Impact:

Weak passwords can be easily discovered by hackers, which leads to unauthorized access to FortiGate. Depending on the access privilege of the compromised account, the attacker may modify important settings."
      reference   : "800-171|3.5.2,800-53|IA-5(1),800-53r5|IA-5(1),CSCv7|4.4,CSCv8|5.2,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5(1),LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2,SWIFT-CSCv1|4.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check admin lockout duration"
      context     : "config system global"
      regex       : "set[\s]+admin-lockout-duration[\s]+"
      expect      : "@ADMIN_LOCKOUT_DURATION@"
    </custom_item>

    <custom_item>
      description : "check admin lockout threshold"
      context     : "config system global"
      regex       : "set[\s]+admin-lockout-threshold[\s]+"
      expect      : "@ADMIN_LOCKOUT_THRESHOLD@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.2.2 Ensure administrator password retries and lockout time are configured"
      info        : "Failed login attempts can indicate malicious attempts to gain access to your network. To prevent this security risk, FortiGate is preconfigured to limit the number of failed administrator login attempts. After the maximum number of failed login attempts is reached, access to the account is blocked for the configured lockout period.

When you log in and fail to enter the correct password, you could potentially be a valid user or a hacker attempting to gain access. For this reason, best practice dictates limiting the number of failed login attempts before a lockout period in which you cannot log in for a certain period of time.Lockout period will minimize hacker attempts to gain access to the firewall."
      solution    : "To configure the lockout options, from CLI:

config system global
	set admin-lockout-threshold 3
	set admin-lockout-duration 900
end

Lockout affects the offending IP address, not the entire account.

Impact:

Attackers will keep attempting to access the device through brute force attacks without any interruption, which may lead to a successful login."
      reference   : "800-171|3.1.5,800-171|3.1.6,800-53|AC-6(2),800-53|AC-6(5),800-53r5|AC-6(2),800-53r5|AC-6(5),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.3,CSCv8|5.4,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),LEVEL|1A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "2.4.1 Ensure default 'admin' password is changed"
  info        : "Before deploying any new FortiGate, it is important to change the password of the default admin account.

It is also recommended that you change even the user name of the default admin account, However, since you cannot change the user name of an account that is currently in use, a second administrator account must be created in order to do this.

Default credentials are well documented by most vendors, including Fortinet. Therefore, it will be one of the first things that will be tried to illegally gain access to the system.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "In the CLI, to change the password of account \"admin\":

FG1 # config system admin
FG1 (admin) # edit \"admin\"
FG1 (admin) # set password <your passwords>
FG1 (admin) # end
FG1 #

To change the default password in the GUI:

1) Login to FortiGate with admin account
2) Go to System > Administrators.
3) Edit the admin account.
4) Click Change Password.
5) If applicable, enter the current password in the Old Password field.
6) Enter a password in the New Password field, then enter it again in the Confirm Password field.
7) Click OK.

Impact:

If not changed, then any scripts that use default credentials will be able to access the system."
  reference   : "800-171|3.5.2,800-53|IA-5,800-53r5|IA-5,CSCv7|4.2,CSCv8|4.7,CSF|PR.AC-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),ITSG-33|IA-5,LEVEL|1A,NESA|T5.2.3,QCSC-v1|5.2.2,QCSC-v1|13.2"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
</report>

<custom_item>
  description : "2.4.2 Ensure all the login accounts having specific trusted hosts enabled"
  info        : "Configure an administrative account to be accessible only to someone who is using a trusted host. You can set a specific IP address for the trusted host or use a subnet.

Access to a firewall to perform administrative tasks should only come from specific network segments reserved for administrators only. This additional layer of security ensures that no one from anywhere else on the network is able to log in, even with correct credentials.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "To remove a trusted host item from the list in CLI:

FG1 # config system admin
FG1 (admin) # edit \"test_admin\"
FG1 (test_admin) # unset trusthost1
FG1 (test_admin) # end
FG1 #

To add a trusted host into the list in CLI:

FG1 # config system admin
FG1 (admin) # edit \"test_admin\"
FG1 (test_admin) # set trusthost6 1.1.1.1 255.255.255.255
FG1 (test_admin) # end
FG1 #

Before adding an item, please make sure that it does not already exist. For example, if trusthost3 is already in the list, using it again will override the existing host/network.

In the Web GUI:

1. System > Administrators.
2. select the account and click on edit.
3. In the account setting page, make sure that \"Restrict login to trusted hosts\" is enabled and all the allowed hosts / subnets are in the list of trusted host.

Please take note that certain versions of FortiOS will only show the first 3 trusted hosts in the list. If you want to see more, you have to click on the \"+\" sign as if you're adding a new item into the list. Keep clicking until you see an empty field of trusted host. That's when you know that you have reached the bottom of the list. To add another trusted host, fill in the empty field of the new \"Trusted Host\". To remove a trusted host, simply erase everything in the field of that corresponding host.

Impact:

All access outside of the allowed segment will be stopped, including from both legitimate and illegitimate users. Thus, administrators working remotely will have to make sure that they have access to jump hosts that sit in the allowed segment."
  reference   : "800-171|3.1.5,800-171|3.1.6,800-171|3.1.14,800-53|AC-6(2),800-53|AC-6(5),800-53|AC-17(3),800-53|SI-7,800-53r5|AC-6(2),800-53r5|AC-6(5),800-53r5|AC-17(3),800-53r5|SI-7,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.4(c),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(i),CSCv7|4.6,CSCv7|11.6,CSCv7|11.7,CSCv8|5.4,CSCv8|12.8,CSF|PR.AC-3,CSF|PR.AC-4,CSF|PR.DS-6,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(c)(1),HIPAA|164.312(c)(2),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),ITSG-33|AC-17(3),ITSG-33|SI-7,ITSG-33|SI-7a.,LEVEL|1A,NESA|T3.4.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.6,NESA|T5.6.1,NESA|T7.3.2,NESA|T7.3.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv3.2.1|10.5.5,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system admin"
  regex       : "set[\s]+trusthost[0-9]+[\s]+[0-9.]+[\s]+[0-9.]+"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<report type:"WARNING">
  description : "2.4.3 Ensure admin accounts with different privileges have their correct profiles assigned"
  info        : "Verify that users with access to the Fortinet should only have the minimum privileges required for that particular user.

In some organizations, it is necessary to create different levels of administrative accounts. For example, technicians from tier 1 support should not have total access to the system compared to a tier 3 support.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "In this example, the goal is to provide the profile \"tier_1\" the ability to view and modify address objects. This sub-privilege is under fwgrp privilege.

In CLI:

FGT1 # config system accprofile
FGT1 (accprofile) # edit \"tier_1\"
FGT1 (tier_1) # set fwgrp custom
FGT1 (tier_1) # config fwgrp-permission
FGT1 (fwgrp-permission) # set address read-write
FGT1 (fwgrp-permission) # end
FGT1 (tier_1) # end
FGT1 #

For the GUI, go to:

1. System > Admin Profiles, select \"tier_1\" and click \"Edit\".
2. On \"Firewall\", click on \"Custom\".
3. Click on \"Read/Write\" option for \"Address\".

In the next example, assign the profile \"tier_1\" to the account \"support1\".

In the CLI:

FGT1 # config system admin
FGT1 (admin) # edit \"support1\"
FGT1 (support1) # set accprofile \"tier_1\"
FGT1 (support1) # end
FGT1 #

For the GUI, go to:

1. System > Administrators.
2. Select \"support1\" and click \"Edit\".
3. Under \"Administrator Profile\", select \"tier_1\"."
  reference   : "800-171|3.1.5,800-171|3.1.6,800-53|AC-6(2),800-53|AC-6(5),800-53r5|AC-6(2),800-53r5|AC-6(5),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.3,CSCv8|5.4,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),LEVEL|1A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
</report>

<custom_item>
  description : "2.4.4 Ensure idle timeout time is configured"
  info        : "The idle timeout period is the amount of time that an administrator will stay logged in to the GUI without any activity.

Best practice dictates setting admin idle timeout to prevent the risk of unauthorized access to the device, such as someone using a logged-in GUI on a PC that has been left unattended."
  solution    : "To change the idle timeout in the GUI:

1) Login to FortiGate with Super Admin privileges
2) Go to 'System' > 'Settings'.
3) In the 'Administration Settings' section, set the 'Idle timeout' value to five minutes by typing 5.
4) Click Apply.

To change the idle timeout in the CLI:

config system global
	set admintimeout 5
end

Impact:

This is to prevent someone from accessing the FortiGate if the management PC is left unattended."
  reference   : "800-171|3.1.16,800-171|3.1.17,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,CSCv7|11.1,CSCv8|4.2,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T5.4.2,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS15a,NIAv2|SS16,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system global"
  regex       : "set[\s]+admintimeout[\s]+"
  expect      : "@ADMIN_TIMEOUT@$"
</custom_item>

<custom_item>
  description : "2.4.5 Ensure only encrypted access channels are enabled"
  info        : "Allow only HTTPS access to the GUI and SSH access to the CLI.

By only allowing encrypted access, we are making it harder to use \"Man in the Middle\" attacks to sniff login credentials."
  solution    : "If HTTP or Telnet is in the allowaccess list, you will have to set that list again with the same elements except for http or telnet.

On CLI:

FG1 # config system interface
FG1 (interface) # edit port1
FG1 (port1) # set allowaccess ssh https ping snmp
FG1 (port1) # end
FG1 #

In the web GUI, click on:

1. Network > Interfaces, select the interface and click \"Edit\".
2. In the interface setting page, uncheck HTTP and Telnet in the section \"Administrative Access\"."
  reference   : "800-171|3.1.13,800-171|3.5.2,800-171|3.13.8,800-53|AC-17(2),800-53|IA-5,800-53|IA-5(1),800-53|SC-8,800-53|SC-8(1),800-53r5|AC-17(2),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|SC-8,800-53r5|SC-8(1),CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSCv7|4.5,CSCv8|3.10,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(1),LEVEL|1A,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.2.3,NESA|T5.4.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS5d,NIAv2|NS6b,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|29.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system interface"
  context     : "edit .+"
  regex       : "set[\s]+allowaccess[\s]+"
  not_expect  : "\b(http|telnet)\b"
</custom_item>

<custom_item>
  description : "2.4.6 Apply Local-in Policies"
  info        : "Configure Local-in Policies to control inbound traffic that is destined to a FortiGate interface.

Local-in Policies allow for more granular and specific control of all types of traffic that are destined for a FortiGate interface. They are not limited to management-only protocols, therefore they can extend past \"trusted host\" configurations and be configured with source and destination addresses as well as specific services.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Local-in Policies can only be configured through the CLI:

config firewall {local-in-policy | local-in-policy6}
    edit <policy_number>
        set intf <interface>
        set srcaddr <source_address> [source_address] ...
        set dstaddr <destination_address> [destination_address] ...
        set action {accept | deny}
        set service <service_name> [service_name] ...
        set schedule <schedule_name>
        set comments <string>
    next
end

For example, to prevent the source subnet 10.10.10.0/24 from pinging port1, but allow administrative access for PING on port1:

config firewall address
    edit \"10.10.10.0\"
        set subnet 10.10.10.0 255.255.255.0
    next
end
config firewall local-in-policy
    edit 1
        set intf \"port1\"
        set srcaddr \"10.10.10.0\"
        set dstaddr \"all\"
        set service \"PING\"
        set schedule \"always\"
    next
end

Impact:

Local-in Policies are processed before \"trusted host\" configurations, so it is important to validate that management access will be maintained once the Local-in policies are put in place."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.4.6,800-171|3.4.7,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|CM-7,800-53|CP-6,800-53|CP-7,800-53|MP-2,800-53|PL-8,800-53|PM-7,800-53|SA-8,800-53|SC-7,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|CM-7,800-53r5|CP-6,800-53r5|CP-7,800-53r5|MP-2,800-53r5|PL-8,800-53r5|PM-7,800-53r5|SA-8,800-53r5|SC-7,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(j),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSCv8|12.2,CSF|DE.CM-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-4,CSF|PR.PT-2,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,GDPR|32.1.c,GDPR|32.1.d,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|CM-7,ITSG-33|CP-6,ITSG-33|CP-7,ITSG-33|MP-2,ITSG-33|MP-2a.,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SC-7,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T2.2.4,NESA|T3.4.1,NESA|T4.2.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NESA|T7.6.5,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS3,NIAv2|SS13c,NIAv2|SS15a,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL2,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|13.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,TBA-FIISB|43.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config firewall local-in-policy"
  regex       : ".*"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check admin UI port not set to 80"
      context     : "config system global"
      not_expect  : "set[\s]+admin-port[\s]+80$"
    </custom_item>

    <custom_item>
      description : "check admin UI redirects to HTTPS"
      context     : "config system global"
      expect      : "set[\s]+admin-https-redirect[\s]+disable"
    </custom_item>

    <custom_item>
      description : "check that cert is in place"
      context     : "config system global"
      expect      : "set[\s]+admin-server-cert[\s]+\"self-sign\""
    </custom_item>

    <custom_item>
      description : "check admin UI port set to 443"
      context     : "config system global"
      not_expect  : "set[\s]+admin-sport[\s]+443$"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.4.7 Ensure default Admin ports are changed"
      info        : "FortiGate admin ports listen on the common ports of 80 and 443. This is default behavior. While interface access is controlled by configuring network interfaces, the FortiGate still listens on the admin ports that have been configured, which can also cause a conflict should 80 or 443 be needed as part of additional configuration later on.

To increase security of the FortiGate Admin Ports, changing it from the default ports will reduce the attack surface should FortiGate Admin Access be targeted. As mentioned, a possible port conflict can also be avoided."
      solution    : "config system global
    set admin-https-redirect disable
    set admin-port 8082 **(or any other uncommon port)**
    set admin-server-cert \"self-sign\"
    set admin-sport 4343 **(or any other uncommon port)**
end

OR

From Web GUI:

1. System > Settings
2. Change the ports/settings under 'Administration Settings' section.

NOTE: https redirection must be turned off as well as changing port 80. This is due to the nature of how browser port redirection works. The browser will be redirected from port 80 to port 443 or whichever 'admin-sport' is configured, meaning that it will still listen on port 80 even when the port has been reconfigured.

Impact:

Unauthorized access to a FortiGate or any firewall could prove very costly. While this is a single hardening step of many, it is an important one when hardening any firewall."
      reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.4.6,800-171|3.4.7,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|CM-7,800-53|CP-6,800-53|CP-7,800-53|MP-2,800-53|PL-8,800-53|PM-7,800-53|SA-8,800-53|SC-7,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|CM-7,800-53r5|CP-6,800-53r5|CP-7,800-53r5|MP-2,800-53r5|PL-8,800-53r5|PM-7,800-53r5|SA-8,800-53r5|SC-7,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(j),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|9.2,CSCv7|9.4,CSCv8|3.3,CSCv8|12.2,CSF|DE.CM-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-4,CSF|PR.PT-2,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,GDPR|32.1.c,GDPR|32.1.d,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|CM-7,ITSG-33|CP-6,ITSG-33|CP-7,ITSG-33|MP-2,ITSG-33|MP-2a.,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SC-7,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T2.2.4,NESA|T3.4.1,NESA|T4.2.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NESA|T7.6.5,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS3,NIAv2|SS13c,NIAv2|SS15a,NIAv2|SS15c,NIAv2|SS29,NIAv2|VL2,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|13.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,TBA-FIISB|43.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "2.4.8 Virtual patching on the local-in management interface"
  info        : "Allow virtual patching to be applied to traffic destined to the FortiGate by applying IPS signatures to the local in interface using local in policies. Attacks geared towards GUI and SSH management access, for example, can be mitigated using IPS signatures pushed from FortiGuard, thereby virtually patching these vulnerabilities.

Patches require scheduling of downtime, which means there is some attack window from the time Fortinet announced the vulnerability to when patch is applied. To minimise the risk, virtual patching on GUI and SSH management access is needed."
  solution    : "On CLI:

config firewall local-in-policy
    edit <id>
        set virtual-patch enable
    next
end"
  reference   : "800-171|3.11.2,800-171|3.11.3,800-171|3.12.2,800-171|3.14.1,800-53|CA-5,800-53|RA-1,800-53|RA-5,800-53|SI-2,800-53|SI-2(2),800-53r5|CA-5,800-53r5|RA-1,800-53r5|RA-5,800-53r5|SI-2,800-53r5|SI-2(2),CN-L3|8.1.4.4(e),CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSCv7|3.4,CSCv8|7.4,CSCv8|16.2,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.GV-1,CSF|ID.GV-3,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,GDPR|32.2,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|CA-5,ITSG-33|RA-1,ITSG-33|RA-5,ITSG-33|SI-2,ITSG-33|SI-2(2),LEVEL|1A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.6.2,NESA|T7.7.1,NIAv2|NS9,NIAv2|PR9,PCI-DSSv3.2.1|6.1,PCI-DSSv3.2.1|6.2,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,PCI-DSSv4.0|6.3.3,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.2,SWIFT-CSCv1|2.7"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config firewall local-in-policy"
  expect      : "set[\s]+virtual-patch[\s]+enable"
</custom_item>

<custom_item>
  description : "2.5.2 Ensure \"Monitor Interfaces\" for High Availability devices is enabled"
  info        : "Configure Interface Monitoring within High Availability settings. Interface Monitoring should be enabled on all critical interfaces.

With Interface Monitoring enabled on devices, failover can occur if there are physical media issues or issues with the specific port to which the FortiGate is connected."
  solution    : "To remediate from GUI:

1. Go to System > HA.
2. Under \"Monitor Interfaces\" select all applicable interfaces.
3. Select \"OK\".

To validate from CLI:

FGT1 # config system ha
FGT1 (ha) # set monitor \"port6\" \"port7\"
FGT1 (ha) # show ###To Review changes to monitored interfaces before applying
config system ha
    set group-name \"FGT-HA\"
    set mode a-p
    set password ENC enrwD467hJmO6j6YW/l6FEOa1YNVYdo8Z5mCcTDEKUFpOVXcNYnPBmQDGX//ViXk6TkwNH0il5aJr/fZY25lq+husndQHZVWp2LIlXmCv/n81U43nkZUWaIKvqkellGFbhv0/IHoOLzQPCsVcBbyrsgoprYMvh6w7F06+nRriBtMNQxpiTE+12xAHz7lA3EoYZzf8A==
    set override disable
    set monitor \"port6\" \"port7\"
end

Impact:

Not configuring Interface Monitoring can directly impact services due to a failure to trigger a High Availability failover if an interface is impacted only on the primary device and is not being monitored. Without the Interface Monitoring enabled, failover would be limited to hardware, system, or power faults."
  reference   : "800-171|3.1.16,800-171|3.1.17,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,CSCv7|11.1,CSCv8|4.2,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T5.4.2,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS15a,NIAv2|SS16,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config system ha[\s]*$"
  expect      : "set[\s]+monitor[\s]+\"@HA_MONITOR_PORT_1@\"[\s]+\"@HA_MONITOR_PORT_2@\""
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check that HA gateway is set"
      context     : "config system ha$"
      context     : "config ha-mgmt-interfaces"
      context     : "edit .+"
      regex       : "set[\s]+gateway(6)?[\s]+.+"
      expect      : "@HA_GATEWAY@"
    </custom_item>

    <custom_item>
      description : "check that HA interface is set"
      context     : "config system ha$"
      context     : "config ha-mgmt-interfaces"
      context     : "edit .+"
      regex       : "set[\s]+interface[\s]+.+"
      expect      : "@HA_INTERFACE@"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "2.5.3 Ensure HA Reserved Management Interface is configured"
      info        : "Ensure Reserved Management Interfaces are configured on HA devices.

To be able to access both the primary and secondary firewalls in an HA cluster, Reserved Management Interfaces need to be configured to prevent them from syncing with HA and sharing a virtual MAC address."
      solution    : "Remediate through the GUI:

1. Go to System > HA edit the \"Master\" device.
2. Enable \"Management Interface Reservation\" once this is enabled select an an interface, and configure the appropriate gateway.

Remediate through the CLI:

FGT1 #config system ha
FGT1 (ha) # set ha-mgmt-status enable
FGT1 (ha) # config ha-mgmt-interfaces
FGT1 (ha-mgmt-interfaces) # edit 1
new entry '1' added
FGT1 (1) # set interface port6
FGT1 (1) # set gateway 10.10.10.1
FGT1 (1) # end
FGT1 (ha) # show
config system ha
    set group-name \"FGT-HA\"
    set mode a-p
    set password ENC enrwD467hJmO6j6YW/l6FEOa1YNVYdo8Z5mCcTDEKUFpOVXcNYnPBmQDGX//ViXk6TkwNH0il5aJr/fZY25lq+husndQHZVWp2LIlXmCv/n81U43nkZUWaIKvqkellGFbhv0/IHoOLzQPCsVcBbyrsgoprYMvh6w7F06+nRriBtMNQxpiTE+12xAHz7lA3EoYZzf8A==
    set ha-mgmt-status enable
    config ha-mgmt-interfaces
        edit 1
            set interface \"port6\"
            set gateway 10.10.10.1
        next
    end
    set override disable
end
FGT1 (ha) # end

Impact:

Not configuring Reserved Management Interfaces impacts the ability to access secondary devices directly due to the primary and secondary devices syncing configuration exactly and floating a virtualized mac address between them for failover."
      reference   : "800-171|3.1.16,800-171|3.1.17,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,CSCv7|11.1,CSCv8|4.2,CSF|DE.AE-1,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NESA|T3.2.5,NESA|T5.4.2,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS15a,NIAv2|SS16,PCI-DSSv3.2.1|2.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "3.2 Ensure that policies do not use  \"ALL\" as Service"
  info        : "Ensure that all security policies in effect clearly state which protocols / services they are allowing.

This is to make sure that the firewall do not allow traffic with unauthorized protocols/services by mistake."
  solution    : "This is an example showing how to modify policy with ID of 2 to change the service from \"ALL\" to FTP and SNMP.

In CLI:

FGT1 # config firewall policy
FGT1 (policy) # edit 2
FGT1 (2) # set service \"FTP\" \"SNMP\"
FGT1 (2) # end
FGT1 #

In the GUI,

1. Go to Policy &amp; Objects.
2. Click on Firewall Policy.
3. Select the policy, click \"Edit\".
4. In the Service section, click on it and select FTP and SNMP. Click OK."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|9.2,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config firewall policy"
  context     : "edit .+"
  regex       : "set[\s]+service[\s]+"
  not_expect  : "\"ALL\""
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "set default deny on inbound firewall"
      context     : "config firewall policy"
      context     : "edit @INBOUND_POLICY@"
      expect      : "set action deny"
    </custom_item>

    <custom_item>
      description : "check that outbound policy denies access to TOR or botnet CNC"
      context     : "config firewall policy"
      context     : "edit @OUTBOUND_POLICY@"
      regex       : "set internet-service-name"
      expect      : "(\"Malicious-Malicious.Server\"|\"Tor-(Exit|Relay).Node\")"
    </custom_item>

    <custom_item>
      description : "check that inbound policy denies access to TOR or botnet CNC"
      context     : "config firewall policy"
      context     : "edit @INBOUND_POLICY@"
      regex       : "set internet-service-src-name"
      expect      : "(\"Malicious-Malicious.Server\"|\"Tor-(Exit|Relay).Node\")"
    </custom_item>

    <custom_item>
      description : "set default deny on outbound firewall"
      context     : "config firewall policy"
      context     : "edit @OUTBOUND_POLICY@"
      expect      : "set action deny"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "3.3 Ensure firewall policy denying all traffic to/from Tor, malicious server, or scanner IP addresses using ISDB"
      info        : "Firewall policies should include a deny rule for traffic going to/from Tor, malicious server, or scanner IP addresses using ISDB (Internet Service Database).

FortiGate includes Tor or malicious server related IP address using ISDB. The idea is to filter out malicious traffic using firewall policies as first level filtering. This is done without involving more resource intensive processes such as IPS inspection, hence optimizing FortiGate's performance."
      solution    : "Review firewall policies and ensure there are:

 - A firewall policy created to block inbound connections with these settings:

From: Any
To: Any
Source: \"Tor-Exit.Node\", \"Tor-Relay.Node\", \"Censys-Scanner\", \"Shodan-Scanner\", \"Botnet-C&amp;amp;C.Server\", \"Phishing-Phishing.Server\", \"Proxy-Proxy.Server\", \"Spam-Spamming.Server\", \"VPN-Anonymous.VPN\", and \"Malicious-Malicious.Server\"
Destination: all
Schedule: Always
Services: All
Action: Deny
Log Violation Traffic: Enabled
Enable this policy: Enabled <xhtml:ol start=\"2\"> - A firewall policy created to block outbound connections with these settings:

From: Any
To: Any
Source: All
Destination: \"Tor-Relay.Node\", \"Botnet-C&amp;amp;C.Server\", \"Phishing-Phishing.Server\", \"Proxy-Proxy.Server\", \"Spam-Spamming.Server\", \"VPN-Anonymous.VPN\", and \"Malicious-Malicious.Server\"
Schedule: Always
Action: Deny
Log Violation Traffic: Enabled
Enable this policy: Enabled"
      reference   : "800-171|3.1.16,800-171|3.1.17,800-171|3.4.1,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.2,800-171|3.13.5,800-53|AC-18,800-53|AC-18(1),800-53|AC-18(3),800-53|CM-2,800-53|CM-6,800-53|CM-7,800-53|CM-7(1),800-53|CM-9,800-53|CP-6,800-53|CP-7,800-53|PL-8,800-53|PM-7,800-53|SA-8,800-53|SC-7,800-53r5|AC-18,800-53r5|AC-18(1),800-53r5|AC-18(3),800-53r5|CM-2,800-53r5|CM-6,800-53r5|CM-7,800-53r5|CM-7(1),800-53r5|CM-9,800-53r5|CP-6,800-53r5|CP-7,800-53r5|PL-8,800-53r5|PM-7,800-53r5|SA-8,800-53r5|SC-7,CN-L3|8.1.10.6(j),CSCv7|12.2,CSCv7|12.3,CSCv7|13.3,CSCv8|4.2,CSCv8|12.2,CSF|DE.AE-1,CSF|DE.CM-1,CSF|ID.AM-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.DS-7,CSF|PR.IP-1,CSF|PR.IP-2,CSF|PR.IP-4,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,GDPR|32.1.c,GDPR|32.1.d,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.13.1.3,ITSG-33|AC-18,ITSG-33|AC-18(1),ITSG-33|AC-18(3),ITSG-33|CM-2,ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|CM-7(1),ITSG-33|CM-9,ITSG-33|CP-6,ITSG-33|CP-7,ITSG-33|SA-8,ITSG-33|SA-8a.,ITSG-33|SC-7,LEVEL|1A,NESA|T1.2.1,NESA|T1.2.2,NESA|T2.2.4,NESA|T3.2.5,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T5.4.2,NESA|T7.5.1,NESA|T7.5.3,NESA|T7.6.1,NESA|T7.6.2,NESA|T7.6.3,NESA|T7.6.5,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|NS33,NIAv2|NS34,NIAv2|NS38,NIAv2|SS3,NIAv2|SS15a,NIAv2|SS16,NIAv2|VL2,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|3.2,QCSC-v1|4.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,SWIFT-CSCv1|2.3,TBA-FIISB|43.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "3.4 Ensure logging is enabled on all firewall policies"
  info        : "Logging should be enabled for all firewall policies including the default implicit deny policy.

Firewall policies should log for all traffic (both allow and deny policies). This enables SOC or security analyst to do further investigations on security incidents especially on threat hunting or incident response activities. Although there are many data sources that can provide DNS query logs (AD or EDR), this option should be enabled out of best practice and with assumption that no other data sources are available."
  solution    : "Review firewall policies and ensure that:

 -

For allowed policies, \"Log Allowed Traffic\" is set on \"All Sessions\" option.

 -

For denied policies, \"Log Violation Traffic\" is enabled.

Impact:

By default, when creating firewall policies, a logging option is not enabled. Also, the default implicit deny policy is not logged. This creates a data gap in threat hunting or incident response activities."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-171|3.14.6,800-171|3.14.7,800-53|AU-1,800-53|AU-2,800-53|SI-4,800-53|SI-4(4),800-53r5|AU-1,800-53r5|AU-2,800-53r5|SI-4,800-53r5|SI-4(4),CN-L3|7.1.2.2(c),CN-L3|7.1.3.5(a),CN-L3|8.1.4.3(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv7|12.5,CSCv7|12.8,CSCv8|8.1,CSCv8|13.6,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.GV-1,CSF|ID.GV-3,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|PR.PT-1,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-1,ITSG-33|AU-2,ITSG-33|SI-4,ITSG-33|SI-4(4),LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|NS32,NIAv2|SS30,NIAv2|VL8,PCI-DSSv3.2.1|10.8,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,QCSC-v1|13.2,SWIFT-CSCv1|6.4,SWIFT-CSCv1|6.5"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config firewall policy"
  context     : "edit .+"
  regex       : "set logtraffic[\s]"
  expect      : "all"
</custom_item>

<custom_item>
  description : "4.1.2 Apply IPS Security Profile to Policies"
  info        : "Ensuring that traffic traversing between networks on the FortiGate have an IPS security profile inspecting it.

Traffic moving between \"interfaces\" on the FortiGate should have firewall policies applied with an IPS security profile applied.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure on all \"Allowed\" firewall policies to have an appropriate IPS security profile applied to policies."
  reference   : "800-171|3.11.2,800-171|3.11.3,800-53|RA-5,800-53r5|RA-5,CSCv7|12.7,CSCv8|7.5,CSF|DE.CM-8,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.IP-12,CSF|RS.CO-3,CSF|RS.MI-3,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.6.1,ITSG-33|RA-5,LEVEL|1A,NESA|M1.2.2,NESA|M5.4.1,NESA|T7.7.1,PCI-DSSv3.2.1|6.1,PCI-DSSv4.0|6.3,PCI-DSSv4.0|6.3.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.7"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config firewall policy"
  context     : "edit .+"
  regex       : "set ips-sensor"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check that antivirus profile is set to sandbox mode"
      context     : "config antivirus profile"
      context     : "edit .+"
      regex       : "set fortisandbox-mode"
      expect      : "inline"
    </custom_item>

    <custom_item>
      description : "check that antivirus profiles are explicitly defined"
      context     : "config antivirus profile"
      context     : "edit .+"
      context     : "config (http|ftp|imap|pop3|smtp|nntp|cifs)"
      regex       : "set fortisandbox"
      expect      : "block"
    </custom_item>

    <custom_item>
      description : "check that inline virus scanning is enabled"
      context     : "config system fortiguard"
      regex       : "set sandbox-inline-scan"
      expect      : "enable"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "4.2.6 Ensure inline scanning with FortiGuard AI-Based Sandbox Service is enabled"
      info        : "Inline scanning is supported when the FortiGate is licensed with the FortiGuard AI-Based Sandbox Service (FAIS). It works similar to inline scanning for the FortiSandbox appliance, by holding a file up to 50 seconds for the verdict to be returned. Timed out scans can either be set to block, log, or ignore. Inline scanning can be enabled from the GUI on the Cloud Sandbox configuration page.

With FAIS, unknown malware can be detected and blocked using cloud sandboxing technology. Using inline scanning with FAIS, patient zero can also be prevented. This complements the existing antivirus signature-based detection and also acts as an additional layer of defense on top of FortiGate's AV heuristics feature."
      solution    : "On GUI:

Enable the FortiGate Cloud feature visibility:

1. Go to System > Feature Visibility.
2. In the Additional Features section, enable FortiGate Cloud Sandbox.
3. Click Apply.

Configure the Cloud Sandbox Fabric connector:

1. Go to Security Fabric > Fabric Connectors and double-click the Cloud Sandbox card.
2. Set the Type to FortiGate Cloud.
3. Select a Region.
4. Enable Inline scan.
5. Click OK.

Configure the antivirus profile:

1. Go to Security Profiles > AntiVirus and click Create New.
2. Set the Feature set to Proxy-based.
3. Enable the protocols to inspect.
4. Enable Send files to FortiSandbox for inspection.
5. Set the Scan strategy to Inline, and set the Action to Block.
6. Click OK.

On CLI:Disable FortiSandbox appliance and FortiSandbox Cloud:

config system fortisandbox
    set status disable
end

Configure FortiGate Cloud Sandbox (example given is setting it as \"Global\" region):

# execute forticloud-sandbox region
0 Global
1 Europe
2 Japan
3 US
Please select cloud sandbox region[0-3]:0
Cloud sandbox region is selected: Global

Enable inline scanning for FortiGate Cloud:

config system fortiguard
    set sandbox-region \"Global\"
    set sandbox-inline-scan enable
end

Enforced on AV security profile:

config antivirus profileedit set feature-set proxyset fortisandbox-mode inlineconfig httpset fortisandbox blockendconfig ftpset fortisandbox blockendconfig imapset fortisandbox block.....end"
      reference   : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53r5|SI-3,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSF|DE.CM-4,CSF|DE.DP-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

<custom_item>
  description : "4.3.2 Ensure DNS Filter logs all DNS queries and responses"
  info        : "DNS filter should log all DNS queries and responses.

DNS filter should log all DNS queries and responses (whether the DNS category is blocked, monitored, or allowed). This enables SOC or security analysts to do further investigations on security incidents, especially on threat hunting or incident response activities. Although there are many data sources that can provide DNS query logs (AD or EDR), this option should be enabled out of best practice and with the assumption that no other data source is available."
  solution    : "Review DNS Filter Security Profiles and validate that \"Log all DNS queries and responses\" is enabled.

Impact:

By default, allowed DNS is not logged. This creates a data gap in threat hunting or incident response activities."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-2,800-53r5|AU-2,CN-L3|8.1.4.3(a),CSCv7|8.7,CSCv8|8.6,CSF|PR.PT-1,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|AU-2,LEVEL|1A,NESA|M1.2.2,NESA|M5.5.1,NIAv2|AM7,NIAv2|AM11a,NIAv2|AM11b,NIAv2|AM11c,NIAv2|AM11d,NIAv2|AM11e,NIAv2|SS30,NIAv2|VL8,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|6.4"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config dnsfilter profile"
  regex       : "set log-all-domain"
  expect      : "set log-all-domain enable"
</custom_item>

<custom_item>
  description : "4.3.3 Apply DNS Filter Security Profile to Policies"
  info        : "Ensuring that traffic traversing to the Internet on the FortiGate has a DNS Filter security profile inspecting it.

Traffic outbound to the Internet on the FortiGate should have firewall policies applied with an DNS Filter security profile applied.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure on \"Allowed\" firewall policies that handle traffic outbound to Internet to have an appropriate DNS Filter security profile applied to policies."
  reference   : "800-171|3.14.2,800-171|3.14.4,800-171|3.14.5,800-53|SI-3,800-53r5|SI-3,CN-L3|7.1.3.6(b),CN-L3|8.1.4.5,CN-L3|8.1.9.6(a),CN-L3|8.1.9.6(b),CN-L3|8.1.10.5(b),CN-L3|8.1.10.7(a),CN-L3|8.1.10.7(b),CSCv7|8.1,CSCv8|10.1,CSF|DE.CM-4,CSF|DE.DP-3,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.12.2.1,ITSG-33|SI-3,LEVEL|1A,NIAv2|GS8a,PCI-DSSv3.2.1|5.1,PCI-DSSv3.2.1|5.1.1,PCI-DSSv4.0|5.2.1,QCSC-v1|3.2,QCSC-v1|5.2.3,QCSC-v1|8.2.1,TBA-FIISB|49.2.1,TBA-FIISB|49.2.2,TBA-FIISB|49.3.1,TBA-FIISB|49.3.2,TBA-FIISB|50.2.1,TBA-FIISB|51.2.4,TBA-FIISB|51.2.7"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config firewall policy"
  context     : "edit .+"
  regex       : "set dnsfilter-profile"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<custom_item>
  description : "4.4.1 Block high risk categories on Application Control"
  info        : "Ensure FortiGate Application Control blocks high risk applications to reduce attack surface.

High risk applications such as those in \"P2P\" and \"Proxy\" are known for spreading malware. Some of this traffic is encrypted and therefore is able to bypass network security inspection (for those without decryption implemented). Blocking these applications from running eliminates this risk.

If any application that falls under \"P2P\" and \"Proxy\" is required to be allowed based on an organization's policy, that specific application needs to be under \"Monitor\" mode in the \"Application and Filter Override\" configuration.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Review Application Control Security Profiles and validate that \"P2P\" and \"Proxy\" category is blocked."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171|3.13.1,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53|SC-7(8),800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,800-53r5|SC-7(8),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.1.10.6(j),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|14.6,CSCv8|3.3,CSCv8|13.10,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,CSF|PR.PT-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,ITSG-33|SC-7(8),LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T4.5.4,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,NIAv2|SU4,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,TBA-FIISB|43.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config application list"
  context     : "edit .+"
  context     : "config entries"
  context     : "edit .+"
  regex       : "set category 2 6"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<custom_item>
  description : "4.4.3 Ensure all Application Control related traffic is logged"
  info        : "Ensure no category is set to \"Allow\" on FortiGate Application Control.

Any category that is set as \"Allow\" on Application Control will not be logged. This creates a visibility gap on security investigation. This includes \"Unknown Applications\" category."
  solution    : "On GUI:

1. Go to \"Security Profiles\" > \"Application Control\".
2. Select the relevant App Control profile.
3. Change any categories with \"Allow\" action to \"Monitor\".

Impact:

Visibility gap, which affects incident forensics and response."
  reference   : "800-171|3.14.6,800-171|3.14.7,800-53|SI-4,800-53|SI-4(4),800-53r5|SI-4,800-53r5|SI-4(4),CN-L3|7.1.2.2(c),CN-L3|7.1.3.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CSCv8|13.6,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.DS-5,CSF|PR.IP-8,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(b),ITSG-33|SI-4,ITSG-33|SI-4(4),LEVEL|1A,NESA|M1.2.2,NIAv2|NS32,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|6.5"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config application list"
  context     : "edit .+"
  regex       : "set unknown-application-log"
  expect      : "enable"
</custom_item>

<custom_item>
  description : "4.4.4 Apply Application Control Security Profile to Policies"
  info        : "Ensuring that traffic traversing between networks on the FortiGate have an Application Control security profile inspecting it.

Traffic moving between \"interfaces\" on the FortiGate should have firewall policies applied with an Application Control security profile applied.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure on all \"Allowed\" firewall policies to have an appropriate Application Control security profile applied to policies."
  reference   : "800-171|3.1.1,800-171|3.1.4,800-171|3.1.5,800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|AC-3,800-53|AC-5,800-53|AC-6,800-53|MP-2,800-53r5|AC-3,800-53r5|AC-5,800-53r5|AC-6,800-53r5|MP-2,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.4.2(f),CN-L3|8.1.4.11(b),CN-L3|8.1.10.2(c),CN-L3|8.1.10.6(a),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSCv7|9.5,CSCv7|18.10,CSCv8|3.3,CSF|PR.AC-4,CSF|PR.DS-5,CSF|PR.PT-2,CSF|PR.PT-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.6.1.2,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,ITSG-33|AC-5,ITSG-33|AC-6,ITSG-33|MP-2,ITSG-33|MP-2a.,LEVEL|1A,NESA|T1.3.2,NESA|T1.3.3,NESA|T1.4.1,NESA|T4.2.1,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM3,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,NIAv2|SS29,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|3.2,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "config firewall policy"
  context     : "edit .+"
  regex       : "set application-list"
  expect      : "^Manual Review Required$"
  severity    : MEDIUM
</custom_item>

<custom_item>
  description : "5.1.1 Enable Compromised Host Quarantine"
  info        : "Default automation trigger configuration for when a high severity compromised host is detected.

By enabling this feature you protect your environment against compromised hosts. Default automation stitch to quarantine a high severity compromised host on FortiAPs, FortiSwitches, and FortiClient EMS.

Please note that this is only applicable if you have Fortinet's solution ecosystem (FortiGate with FortiAP, FortiSwitches, or FortiClient EMS)."
  solution    : "GUI

Security Fabric > Automation

Edit and change Disabled to Enabled

CLI

config system automation-action
    edit \"Quarantine on FortiSwitch + FortiAP\"
        set description \"Default automation action configuration for quarantining a MAC address on FortiSwitches and FortiAPs.\"
        set action-type quarantine
    next
    edit \"Quarantine FortiClient EMS Endpoint\"
        set description \"Default automation action configuration for quarantining a FortiClient EMS endpoint device.\"
        set action-type quarantine-forticlient
    next
end
config system automation-trigger
    edit \"Compromised Host - High\"
        set description \"Default automation trigger configuration for when a high severity compromised host is detected.\"
    next
end
config system automation-stitch
    edit \"Compromised Host Quarantine\"
        set description \"Default automation stitch to quarantine a high severity compromised host on FortiAPs, FortiSwitches, and FortiClient EMS.\"
        set status enable
        set trigger \"Compromised Host - High\"
        config actions
            edit 1
                set action \"Quarantine on FortiSwitch + FortiAP\"
            next
            edit 2
                set action \"Quarantine FortiClient EMS Endpoint\"
            next
        end
    next
end"
  reference   : "800-171|3.1.1,800-171|3.1.2,800-171|3.1.12,800-171|3.4.2,800-171|3.4.6,800-171|3.4.7,800-171|3.13.1,800-171|3.13.5,800-171|3.14.6,800-171|3.14.7,800-53|AC-17,800-53|AC-17(1),800-53|CM-6,800-53|CM-7,800-53|SC-7,800-53|SI-4,800-53r5|AC-17,800-53r5|AC-17(1),800-53r5|CM-6,800-53r5|CM-7,800-53r5|SC-7,800-53r5|SI-4,CN-L3|7.1.3.5(a),CN-L3|8.1.4.4(c),CN-L3|8.1.10.5(b),CN-L3|8.1.10.6(f),CN-L3|8.1.10.6(i),CN-L3|8.1.10.6(j),CSCv7|8.1,CSCv7|8.3,CSCv8|13.5,CSCv8|13.9,CSF|DE.AE-1,CSF|DE.AE-2,CSF|DE.AE-3,CSF|DE.AE-4,CSF|DE.CM-1,CSF|DE.CM-5,CSF|DE.CM-6,CSF|DE.CM-7,CSF|DE.DP-2,CSF|DE.DP-3,CSF|DE.DP-4,CSF|DE.DP-5,CSF|ID.RA-1,CSF|PR.AC-3,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.IP-1,CSF|PR.IP-8,CSF|PR.PT-3,CSF|PR.PT-4,CSF|RS.AN-1,CSF|RS.CO-3,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(b),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.13.1.3,ITSG-33|AC-17,ITSG-33|AC-17(1),ITSG-33|CM-6,ITSG-33|CM-7,ITSG-33|SC-7,ITSG-33|SI-4,LEVEL|1A,NESA|M1.2.2,NESA|T4.5.4,NESA|T5.4.4,NESA|T5.4.5,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,NIAv2|SS15a,PCI-DSSv3.2.1|1.1,PCI-DSSv3.2.1|1.2,PCI-DSSv3.2.1|1.2.1,PCI-DSSv3.2.1|1.3,PCI-DSSv3.2.1|2.2.2,PCI-DSSv4.0|1.2.1,PCI-DSSv4.0|1.4.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2,QCSC-v1|8.2.1,QCSC-v1|10.2.1,QCSC-v1|11.2,SWIFT-CSCv1|2.3,SWIFT-CSCv1|2.6,TBA-FIISB|43.1"
  see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
  context     : "edit \"Compromised Host Quarantine\""
  expect      : "set[\s]+status[\s]+enable"
</custom_item>

<if>
  <condition auto:"FAILED" type:"AND">
    <custom_item>
      description : "check that fortianalyzer is set to reliable"
      context     : "config log fortianalyzer setting"
      expect      : "set[\s]+reliable[\s]+enable"
    </custom_item>

    <custom_item>
      description : "check that encryption algorithm is set to high"
      context     : "config log fortianalyzer setting"
      expect      : "set[\s]+enc-algorithm[\s]+high"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "7.2.1 Encrypt Log Transmission to FortiAnalyzer / FortiManager"
      info        : "Enable encryption for logs that are sent to FortiAnalyzer or FortiManager.

Provides encryption for logs that are sent to FortiAnalyzer or FortiManager to prevent logs being collected and viewed as they traverse the network."
      solution    : "Secure log transfer settings can only be configured on CLI:

config log fortianalyzer setting
set reliable enable
set enc-algorithm high
end"
      reference   : "800-171|3.1.13,800-171|3.5.2,800-171|3.13.8,800-53|AC-17(2),800-53|IA-5,800-53|IA-5(1),800-53|SC-8,800-53|SC-8(1),800-53r5|AC-17(2),800-53r5|IA-5,800-53r5|IA-5(1),800-53r5|SC-8,800-53r5|SC-8(1),CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.2.2(a),CN-L3|8.1.2.2(b),CN-L3|8.1.4.1(c),CN-L3|8.1.4.7(a),CN-L3|8.1.4.8(a),CN-L3|8.2.4.5(c),CN-L3|8.2.4.5(d),CN-L3|8.5.2.2,CSCv7|14.4,CSCv8|3.10,CSF|PR.AC-1,CSF|PR.AC-3,CSF|PR.DS-2,CSF|PR.DS-5,CSF|PR.PT-4,GDPR|32.1.a,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),HIPAA|164.312(a)(2)(i),HIPAA|164.312(d),HIPAA|164.312(e)(1),HIPAA|164.312(e)(2)(i),ISO/IEC-27001|A.6.2.2,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|AC-17(2),ITSG-33|IA-5,ITSG-33|IA-5(1),ITSG-33|SC-8,ITSG-33|SC-8a.,ITSG-33|SC-8(1),LEVEL|1A,NESA|T4.3.1,NESA|T4.3.2,NESA|T4.5.1,NESA|T4.5.2,NESA|T5.2.3,NESA|T5.4.2,NESA|T7.3.3,NESA|T7.4.1,NIAv2|AM37,NIAv2|IE8,NIAv2|IE9,NIAv2|IE12,NIAv2|NS5d,NIAv2|NS6b,NIAv2|NS29,NIAv2|SS24,PCI-DSSv3.2.1|2.3,PCI-DSSv3.2.1|4.1,PCI-DSSv4.0|2.2.7,PCI-DSSv4.0|4.2.1,QCSC-v1|3.2,QCSC-v1|5.2.1,QCSC-v1|5.2.2,QCSC-v1|6.2,QCSC-v1|13.2,SWIFT-CSCv1|2.1,SWIFT-CSCv1|2.6,SWIFT-CSCv1|4.1,TBA-FIISB|29.1"
      see_also    : "https://workbench.cisecurity.org/benchmarks/15284"
      show_output : YES
    </report>
  </then>
</if>

</check_type>
