#TRUSTED 2dbae7f78e1e0cc5974f2fb66bf7402ca1ae42c6393ea3321c428d4bd787b9b1422252b99c31baf794485f4a605b34ea16bde0e31ff38dc918a24216135728aa60082d6f843b468e75d58a9fd878c0b04a1ded8722e92e6c4aea581abf846a97ba0e6a14b63b11868b4e0820a2cc302beab7f96b6c2a274d6823bea7e4729bd48cd9f1399baf7e21b078af6a591c41b1f1e20a9bbf51c48faa0b16f63374fad3db5dd351625a4570cec1eeb7151815ac5dac54cb21893ce9ab333a0a0849516b61a1459265d977782aab6f2e515f6e285efb1ba12e4bfc576a611168b3461d00eb2a4a74123cff77dd740d83b856c8f7fe45d81177f7b9d257fcec7bc6564cc253b2df3798517a026fa7c473104c45a1272c8602f71f7e4cda308efe86931bd4e6fdcadb68dd918c6c0d448ff90e4a254257d3b0b9f9b8df510d778b69af10a2a9c694081e17c3472a0f500eb760f71e72e12b2c3be2c5609628ec37d50a12156b9c1c28e5d959483de6db9e408bb5acc826e2565713fc038b28d48e2ddb4fe60a8fb306432ca4b4c2ea689c55188d1ab04b3aad89737395791c53288ee0883924a5ec83e5083b87051f55526c16d6edb4cce02a1d12469079cb663d3de5db1588d8590b29b83d90ac61ff5c7723716735c51fa96345449dcdfe6f2eee2bafba1390fb3b3fdf08476408352a4fd81c053f4ab3fcac51d19a118d8421b8c02df4
#TRUST-RSA-SHA256 169070845c208108e59e4e0915a3b26e86cf1766e95739add98c0ab01d54a56ac23a543a6f416b14379285a986395fda3625a63bf6adeddf5de2f225ebad170b94a75e68b3ab283f202b09252ee545b17a1705aa139ff3a7ec6b2acca770f746d33b67cd35eb7c344326ba1d0346a456327b8990ca82bb1c410f62830e9e9bbdc75eb7130e1716daea1008a4d1fb0187b5a0f736403cb300b7a946e3519436ecc70fa6a1990a81da9347967fa099196c783374a2b18ade1312e299af720bddcbe2fe41b301a54298d675f97acbb6d52581f56cc8b7375d7944f7c48966a51700f3f6e017d6273b697254c1e6101e3c62fc02c814851bcba871db084cd8a837120a391c1d91a46e68d268597eed851cef41525d7bf3adf2c9fef1f746ad83a4feb9da63742064c5c903afa52bf73a7763d4e228d70b2f6ac1d44698417f2bce6325a92d44e29b8f119d5ebf774136bf2a3dd8aab3fa5afdad40fa137c1a41aa0fcdd22bb24251284b0d2ca74defb4d86e2404702f3cab885525384d88f836998b151645010b9bb0ae506395e3a9f83cd3ea51059d084cecd2ff173a23c2fbb43ce263606dfce05c283065d2da143bc7ad2405766c29841542946b5e3b3d244a60d6a1f916fe989cdcc9bde2790425e837ced8f3bad46c1ae43f1a85c92b708c9c69e7a9d0b8c1549331a932a60b9b77561c9732332839b6028761ef6a925fe4c0
#
# This script is Copyright (C) 2004-2025 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2025/04/21 $
#
# description : This .audit is designed against the CIS Oracle MySQL Community Server 8.4 Benchmark v1.0.0
#
#<ui_metadata>
#<display_name>CIS Oracle MySQL Community Server 8.4 v1.0.0 L2 OS Linux</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Oracle MySQL Community Server 8.4</name>
#  <profile>L2 OS Linux</profile>
#  <version>1.0.0</version>
#  <link>https://workbench.cisecurity.org/benchmarks/20223</link>
#</spec>
#<labels>database,cis,mysql,oracle_mysql_community_server_8.4,distribution_independent_linux</labels>
#<benchmark_refs>CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : CMD_EXEC
      description : "Linux found"
      cmd         : "uname -a"
      expect      : "Linux"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_MySQL_8.4_Community_Benchmark_v1.0.0_Level_2_OS_Linux.audit from CIS Oracle MySQL 8.4 Community Edition Benchmark"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20223"
    </report>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : FIND_CMD
          description : "check for .mysql_history in user home directories"
          not_expect  : ".+"
          find_name   : ".mysql_history"
          target      : "~"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "1.3 Disable MySQL Command History"
          info        : "On Linux/UNIX, the MySQL client and MySQL Shell log statements executed interactively to a history file. The default MySQL Client file is namedmysql_history in the user's home directory. The files are split by language and named history.sql history.js and history.py Most interactive commands run in the MySQL client application are saved to a history file. The MySQL command history should be disabled. By default, the MySQL Shell does not save history between sessions.

Disabling the MySQL Client and MySQL Shell command history reduces the probability of exposing sensitive information, such as passwords, encryption keys, or other sensitive data or information."
          solution    : "For MySQL Client perform the following steps to remediate this setting:

 - Removemysql_history if it exists.
 - Use either of the techniques below to prevent it from being created again:
 - Set the MYSQL_HISTFILE environment variable to /dev/null. This will need to be placed in the shell's startup script.
 - Create $HOME/.mysql_history as a symbolic to /dev/null > ln -s /dev/null $HOME/.mysql_history

Another way to prevent history from being recorded is to use --batch option.

For MySQL Shell perform the following steps to remediate this setting:

 - Remove $HOME/.mysqlsh/history.* if files exists.
 - Use either of the techniques below to prevent it from being created again:
 - Start shell and list show options using \\option -l
 - Set to no history using the command \\option --persist history.autoSave=1"
          reference   : "800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.08.03,800-53|MP-6,800-53r5|MP-6,800-53r5|SR-12,CSCv7|13.2,CSCv8|3.5,CSF|PR.DS-3,CSF|PR.IP-6,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.10,ISO-27001-2022|A.7.10,ISO-27001-2022|A.7.14,ISO-27001-2022|A.8.10,ISO/IEC-27001|A.8.3.2,ITSG-33|MP-6,LEVEL|2A,NESA|T1.4.1,NESA|T1.4.2,NIAv2|MS5b,NIAv2|MS6,NIAv2|MS9,NIAv2|MS10a,NIAv2|MS10b,NIAv2|MS10c,NIAv2|MS10d,NIAv2|MS10e,NIAv2|MS10f,NIAv2|MS11a,NIAv2|MS11b,NIAv2|MS12a,NIAv2|MS12b,NIAv2|MS12c,NIAv2|MS13,NIAv2|MS14,NIAv2|MS17,NIAv2|MS18a,NIAv2|MS18b,NIAv2|MS18c,NIAv2|MS20,NIAv2|MS21,NIAv2|NS16,QCSC-v1|3.2,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/benchmarks/20223"
          show_output : YES
        </report>
      </then>

      <else>
        <custom_item>
          type        : FIND_CMD
          description : "1.3 Disable MySQL Command History"
          info        : "On Linux/UNIX, the MySQL client and MySQL Shell log statements executed interactively to a history file. The default MySQL Client file is namedmysql_history in the user's home directory. The files are split by language and named history.sql history.js and history.py Most interactive commands run in the MySQL client application are saved to a history file. The MySQL command history should be disabled. By default, the MySQL Shell does not save history between sessions.

Disabling the MySQL Client and MySQL Shell command history reduces the probability of exposing sensitive information, such as passwords, encryption keys, or other sensitive data or information."
          solution    : "For MySQL Client perform the following steps to remediate this setting:

 - Removemysql_history if it exists.
 - Use either of the techniques below to prevent it from being created again:
 - Set the MYSQL_HISTFILE environment variable to /dev/null. This will need to be placed in the shell's startup script.
 - Create $HOME/.mysql_history as a symbolic to /dev/null > ln -s /dev/null $HOME/.mysql_history

Another way to prevent history from being recorded is to use --batch option.

For MySQL Shell perform the following steps to remediate this setting:

 - Remove $HOME/.mysqlsh/history.* if files exists.
 - Use either of the techniques below to prevent it from being created again:
 - Start shell and list show options using \\option -l
 - Set to no history using the command \\option --persist history.autoSave=1"
          reference   : "800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-171r3|03.08.03,800-53|MP-6,800-53r5|MP-6,800-53r5|SR-12,CSCv7|13.2,CSCv8|3.5,CSF|PR.DS-3,CSF|PR.IP-6,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.10,ISO-27001-2022|A.7.10,ISO-27001-2022|A.7.14,ISO-27001-2022|A.8.10,ISO/IEC-27001|A.8.3.2,ITSG-33|MP-6,LEVEL|2A,NESA|T1.4.1,NESA|T1.4.2,NIAv2|MS5b,NIAv2|MS6,NIAv2|MS9,NIAv2|MS10a,NIAv2|MS10b,NIAv2|MS10c,NIAv2|MS10d,NIAv2|MS10e,NIAv2|MS10f,NIAv2|MS11a,NIAv2|MS11b,NIAv2|MS12a,NIAv2|MS12b,NIAv2|MS12c,NIAv2|MS13,NIAv2|MS14,NIAv2|MS17,NIAv2|MS18a,NIAv2|MS18b,NIAv2|MS18c,NIAv2|MS20,NIAv2|MS21,NIAv2|NS16,QCSC-v1|3.2,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/benchmarks/20223"
          expect      : "'/dev/null'"
          exec        : "stat -c \"%N\" '{}' \\;"
          find_name   : ".mysql_history"
          target      : "~"
        </custom_item>
      </else>
    </if>

    <custom_item>
      type        : CMD_EXEC
      description : "1.5 Ensure Interactive Login is Disabled"
      info        : "When created, the MySQL user may have interactive access to the operating system, which means that the MySQL user could login to the host as any other user would.

Preventing the MySQL user from logging in interactively may reduce the impact of a compromised MySQL account. There is also more accountability, as accessing the operating system where the MySQL server lies will require the user's own account. Interactive access by the MySQL user is unnecessary and should be disabled."
      solution    : "Execute one of the following commands in a terminal:

usermod -s /bin/false mysql

Or

usermod -s /sbin/nologin mysql

Impact:

This setting will prevent the MySQL administrator from interactively logging into the operating system using the MySQL user. Instead, the administrator will need to log in using one's own account."
      reference   : "800-171|3.1.5,800-171|3.1.6,800-171r3|03.01.06a.,800-171r3|03.01.06b.,800-53|AC-6(2),800-53|AC-6(5),800-53r5|AC-6(2),800-53r5|AC-6(5),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.3,CSCv8|5.4,CSF|PR.AC-4,CSF2.0|PR.AA-05,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO-27001-2022|A.5.15,ISO-27001-2022|A.8.2,ISO-27001-2022|A.8.18,ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),LEVEL|2A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20223"
      cmd         : "/bin/getent passwd mysql | /bin/grep -E \"^.*[\/bin\/false|\/sbin\/nologin]$\" | /bin/awk '{print} END {if (NR == 1) print \"pass\"}'"
      expect      : "(?i)^[\\s]*\\**[\\s]*pass:?[\\s]*\\**$"
    </custom_item>

    <report type:"WARNING">
      description : "1.7 Ensure MySQL is Run Under a Sandbox Environment"
      info        : "Use of the chroot() system call at startup, Systemd with settings to achieve isolation, or docker will put MySQL in a Sandbox environment.

Running MySQL in a Sandbox environment may reduce the impact of a MySQL-born vulnerability by making portions of the file system inaccessible to the MySQL instance.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Perform one of the following steps to remediate this setting:

 - Configure MySQL to use chroot:
 - Choose a non-system partition

<chroot location>

for MySQL
 - Add chroot=

<chroot_location>

to the my.cnf option file

 - Configure MySQL to run under systemd:
 - If mysql is managed by systemd and running, stop the service: $ sudo systemctl stop <mysqld>.service
 - If a mysql user and group do not already exist, create them: $ sudo groupadd mysql$ sudo useradd -r -g mysql -s /bin/false mysql
 - Set the oenwership of the base director: $ sudo chown -R mysql:mysql /usr/local/mysql/
 - Create or modify the

<mysqld>

service file in /lib/systemd/system to include the following entries, if not already present: [Unit]Description=MySQL Server[Install]WantedBy=multi-user.target[Service]User=mysqlGroup=mysql
 - If mysql was not already already managed by systemd execute this command: $ sudo systemctl daemon-reload
 - Start the MySQL server: $ sudo systemctl start <mysqld>.service
 - If you would like mysql to automatically run at startup execute this command: $ sudo systemctl enable <mysqld>.service

 - Follow documentation in the references for standing up MySQL in a Docker container.

Impact:

Use of the chroot option somewhat limits LOAD DATA INFILE and SELECT ... INTO OUTFILE"
      reference   : "800-171|3.13.4,800-171r3|03.13.04,800-53|SC-4,800-53r5|SC-4,CSCv7|2.10,CSCv8|3.12,CSF2.0|PR.DS-01,CSF2.0|PR.DS-02,CSF2.0|PR.DS-10,CSF2.0|PR.IR-01,GDPR|32.1.b,HIPAA|164.306(a)(1),ITSG-33|SC-4,ITSG-33|SC-4a.,LEVEL|2M"
      see_also    : "https://workbench.cisecurity.org/benchmarks/20223"
    </report>

    <if>
      <condition auto:"FAILED" type:"OR">
        <custom_item>
          type        : CMD_EXEC
          description : "check for default setting"
          cmd         : "/bin/my_print_defaults mysqld | /bin/grep allow-suspicious-udfs | /bin/awk '{print} END {if (NR == 0) print \"pass\"}'"
          expect      : "(?i)^[\\s]*\\**[\\s]*pass:?[\\s]*\\**$"
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "check for explicitly enabled setting"
          cmd         : "/bin/my_print_defaults mysqld | /bin/grep allow-suspicious-udfs"
          expect      : "(?i)^[\\s]*--allow-suspicious-udfs=OFF"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "4.3 Ensure 'allow-suspicious-udfs' is Set to 'OFF'"
          info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init _deinit _reset _clear or _add

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
          solution    : "Perform the following to establish the recommended state:

 - Remove --allow-suspicious-udfs from the mysqld start up command line.
 - Remove allow-suspicious-udfs from the MySQL option file."
          reference   : "800-171|3.13.1,800-171|3.13.2,800-171r3|03.16.01,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,CSF2.0|ID.AM-03,CSF2.0|ID.AM-08,CSF2.0|ID.IM-01,CSF2.0|ID.IM-02,CSF2.0|ID.IM-03,CSF2.0|PR.DS-10,CSF2.0|PR.IR-03,CSF2.0|PR.PS-06,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ISO-27001-2022|A.5.8,ISO-27001-2022|A.8.27,ISO-27001-2022|A.8.28,ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2A,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/benchmarks/20223"
          show_output : YES
        </report>
      </then>
    </if>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_MySQL_8.4_Community_Benchmark_v1.0.0_Level_2_OS_Linux.audit from CIS Oracle MySQL 8.4 Community Edition Benchmark"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/benchmarks/20223"
      show_output : YES
    </report>
  </else>
</if>

</check_type>
