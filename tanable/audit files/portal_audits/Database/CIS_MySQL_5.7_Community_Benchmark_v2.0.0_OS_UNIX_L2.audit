#TRUSTED 44abf8c31f7fa3a7f682988f0f1e99609c181ec1e8639b43a1a5a58de3c52d42f9eb5e40b35d76b6e9062461d55af8f9b72e4183eb03e952b8b62384685e8bb3817f4427dd361495b3ecf648c966b3f635b812242d79563e419c2cb033eb75b85f758021aaa49b36efd87fa1b2d0151af0eeb9cdd944bc3f2f0d1611234beaf103114de3cd90e27e055d70ba10cc275df15b34c0f43d8cf2353cb8d20bfdf443c07e17c1d9bf8928e93d8380a2b3f8a7f767f3781aaa1d24e8875a23691a523bb4872a67124a6ef81a181118057f4b4ef79189054cb0a9d92c7eea74108e1b60072ea3fb504cea46a55fab72efb31f93da0d3859918dc0320bd3fe1fe348b1ea0ee202af409c6715a9654182919f31988419f2b8a46675d142662440b8586ffdb9a639e085d880c5e7d89231f00b65a7e437fa59e3c6d44bbd4fd2a1bc5966ea6e58163e3f34d4b0b3a1574a0ec92e29d458c8f0844ae99aac2bfac68d606337a3c335ed734ba460ed618d5a94c93083b1e1b5822a69a9ecdfade18b4addb3336f18c9cc65b3cffc65edef903658f8e733a9c945b9b6bb382cc8147c40272fd469bf49c33ac57b2ad764aa6532269aa223b5e2082bb5af10f1464de39514703e2497ad365b11c5cdb957749e21ef2a1e988d1613166d7f8e7c17a88534c60748be93b38a9cf81a0f6d417285235d718b8940698b94552cd7f27b5707f7ba8582
#TRUST-RSA-SHA256 6d06e9af4f6f2bc6b9ae9212b28aa44e4b9e5476f942cd51e97707660217aedd76aff3b1de51be8c07a49684e390a259d7d22d3f03c5215f7934da8e0a54a72f5ca131b1bc365f7772234da8d3f9be74508887b0b0bed29af049d9b7698179f6d2dd7208a1b5eb3668dc480f1403c48fdf4795a00eb4d1d831a3984bc5f1d96af09e7d5393a56f1e2ba320f09d5fc89910e8cf301aaa5a69bc6d8ba2ad73e0cee9b7c5bdeb1cfe864739df6e6ca0a341a8b616d41e557dd1a43ce3ee5387f81018cbe2f043ae000cfdaf220a8ce3b275d5ca746678dc847e84186de98b1440e0518b2f57069b5e6e105580fa32df42dea627a93470e338d8791d58afb02b2d4bacf430cfbb8b1bdfe2f61ad186930f308d03e74de3011ed766ec4b293ec13390e2940821ee8be87b70a3c6a38f772167c16f5de34e2a3db10a0689a67f73dcd5a6c4c04fbd4b71e8834554068291c5e3519854320bd874b9a75c5e51fb0fa9eab099337c120a1ffa41b5da85b771ab93e03264ec0413bedec8daa274d93e80cf1ebd6eac5963195b7542da96d7438ed1c55624a61d8a1223f0c197b43b5554b8e44aed1aca4e05a1fbe4d7a9367cecc8a3a98e9f9af064a27aeeff66347fe9fe7a60fea084a704622dfba1087bb9dba96e471a2a688c50883453cfba855a194db17549a7573ac91be7fb338b63d161acde6c9cb8d6bb3182297125ddeccd0cf5
#
# This script is Copyright (C) 2004-2024 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.5 $
# $Date: 2024/06/17 $
#
# Description : This document implements the security configuration as recommended by the
#               CIS Oracle MySQL 5.7 Community Edition Benchmark
#
#<ui_metadata>
#<display_name>CIS MySQL 5.7 Community Linux OS L2 v2.0.0</display_name>
#<spec>
#  <type>CIS</type>
#  <name>MySQL 5.7 Community</name>
#  <profile>L2 OS Linux</profile>
#  <version>2.0.0</version>
#  <link>https://workbench.cisecurity.org/files/3844</link>
#</spec>
#<labels>database,cis,mysql,mysql_5,mysql_5.7,mysql_5.7_community,distribution_independent_linux,update_20230227</labels>
#<benchmark_refs>CCE,CIS_Recommendation,CSCv6,CSCv7,CSCv8,LEVEL</benchmark_refs>
#<variables>
#  <variable>
#    <name>SYSCONFDIR</name>
#    <default>SYSCONFDIR/my.cnf</default>
#    <description>sysconfdir Path</description>
#    <info>This is the directory specified with the --sysconfdir option to configure when MySQL was built.</info>
#    <value_type>UNIX_FILE_PATH</value_type>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"OR">
    <custom_item>
      type        : CMD_EXEC
      description : "Linux found"
      cmd         : "uname -a"
      expect      : "Linux"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_MySQL_5.7_Community_Benchmark_v2.0.0_Level_2_OS_Linux.audit from CIS Oracle MySQL 5.7 Community Edition Benchmark"
      see_also    : "https://workbench.cisecurity.org/files/3844"
    </report>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : CMD_EXEC
          description : "~/.mysql_history Exists"
          cmd         : "/bin/find / -name \".mysql_history\" | /usr/bin/awk '{ print } END { if (NR!=0) print \"none\" }'"
          expect      : "none"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          system      : "Linux"
          type        : CMD_EXEC
          description : "1.3 Disable MySQL Command History - .mysql_history"
          info        : "On Linux/UNIX, the MySQL client and MySQL Shell log statements executed interactively to a history file. The default MySQL Client file is named .mysql_history in the user's home directory. The files are split by language and named history.sql, history.js and history.py. Most interactive commands run in the MySQL client application are saved to a history file. The MySQL command history should be disabled. By default, the MySQL Shell does not save history between sessions.

Rationale:

Disabling the MySQL Client and MySQL Shell command history reduces the probability of exposing sensitive information, such as passwords, encryption keys, or other sensitive data or information."
          solution    : "Perform the following steps to remediate this setting:

Remove .mysql_history if it exists.

Use either of the techniques below to prevent it from being created again:

Set the MYSQL_HISTFILE environment variable to /dev/null. This will need to be placed in the shell's startup script.

Create $HOME/.mysql_history as a symbolic to /dev/null.

> ln -s /dev/null $HOME/.mysql_history

Another way to prevent history from being recorded is to use --batch option.

Default Value:

By default, the MySQL command history file is located in $HOME/.mysql_history."
          reference   : "800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|MP-6,800-53r5|MP-6,CSCv7|13.2,CSCv8|3.5,CSF|PR.DS-3,CSF|PR.IP-6,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.8.3.2,ITSG-33|MP-6,LEVEL|2A,NESA|T1.4.1,NESA|T1.4.2,NIAv2|MS5b,NIAv2|MS6,NIAv2|MS9,NIAv2|MS10a,NIAv2|MS10b,NIAv2|MS10c,NIAv2|MS10d,NIAv2|MS10e,NIAv2|MS10f,NIAv2|MS11a,NIAv2|MS11b,NIAv2|MS12a,NIAv2|MS12b,NIAv2|MS12c,NIAv2|MS13,NIAv2|MS14,NIAv2|MS17,NIAv2|MS18a,NIAv2|MS18b,NIAv2|MS18c,NIAv2|MS20,NIAv2|MS21,NIAv2|NS16,QCSC-v1|3.2,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/files/3844"
          cmd         : "a=$(for f in $(/bin/find / -name \".mysql_history\"); do /usr/bin/file $f | /bin/egrep -cv \"symbolic link to \\`/dev/null'\"; done;); if [ \"$a\" = \"0\" ]; then echo \"none\";else for g in $(/bin/find / -name \".mysql_history\"); do /usr/bin/file $g |/bin/egrep -v \"symbolic link to \\`/dev/null'\";done; fi"
          expect      : "none"
        </custom_item>
      </then>

      <else>
        <custom_item>
          system      : "Linux"
          type        : CMD_EXEC
          description : "1.3 Disable MySQL Command History - ~/.mysql_history"
          info        : "On Linux/UNIX, the MySQL client and MySQL Shell log statements executed interactively to a history file. The default MySQL Client file is named .mysql_history in the user's home directory. The files are split by language and named history.sql, history.js and history.py. Most interactive commands run in the MySQL client application are saved to a history file. The MySQL command history should be disabled. By default, the MySQL Shell does not save history between sessions.

Rationale:

Disabling the MySQL Client and MySQL Shell command history reduces the probability of exposing sensitive information, such as passwords, encryption keys, or other sensitive data or information."
          solution    : "Perform the following steps to remediate this setting:

Remove .mysql_history if it exists.

Use either of the techniques below to prevent it from being created again:

Set the MYSQL_HISTFILE environment variable to /dev/null. This will need to be placed in the shell's startup script.

Create $HOME/.mysql_history as a symbolic to /dev/null.

> ln -s /dev/null $HOME/.mysql_history

Another way to prevent history from being recorded is to use --batch option.

Default Value:

By default, the MySQL command history file is located in $HOME/.mysql_history."
          reference   : "800-171|3.8.1,800-171|3.8.2,800-171|3.8.3,800-53|MP-6,800-53r5|MP-6,CSCv7|13.2,CSCv8|3.5,CSF|PR.DS-3,CSF|PR.IP-6,GDPR|32.1.b,HIPAA|164.306(a)(1),ISO/IEC-27001|A.8.3.2,ITSG-33|MP-6,LEVEL|2A,NESA|T1.4.1,NESA|T1.4.2,NIAv2|MS5b,NIAv2|MS6,NIAv2|MS9,NIAv2|MS10a,NIAv2|MS10b,NIAv2|MS10c,NIAv2|MS10d,NIAv2|MS10e,NIAv2|MS10f,NIAv2|MS11a,NIAv2|MS11b,NIAv2|MS12a,NIAv2|MS12b,NIAv2|MS12c,NIAv2|MS13,NIAv2|MS14,NIAv2|MS17,NIAv2|MS18a,NIAv2|MS18b,NIAv2|MS18c,NIAv2|MS20,NIAv2|MS21,NIAv2|NS16,QCSC-v1|3.2,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/files/3844"
          cmd         : "/bin/find / -name \".mysql_history\" | /usr/bin/awk '{ print } END { if (NR==0) print \"none\" }'"
          expect      : "none"
        </custom_item>
      </else>
    </if>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.5 Ensure Interactive Login is Disabled"
      info        : "When created, the MySQL user may have interactive access to the operating system, which means that the MySQL user could login to the host as any other user would.

Rationale:

Preventing the MySQL user from logging in interactively may reduce the impact of a compromised MySQL account. There is also more accountability, as accessing the operating system where the MySQL server lies will require the user's own account. Interactive access by the MySQL user is unnecessary and should be disabled.

Impact:

This setting will prevent the MySQL administrator from interactively logging into the operating system using the MySQL user. Instead, the administrator will need to log in using one's own account."
      solution    : "Execute one of the following commands in a terminal:

usermod -s /bin/false mysql

Or

usermod -s /sbin/nologin mysql"
      reference   : "800-171|3.1.5,800-171|3.1.6,800-53|AC-6(2),800-53|AC-6(5),800-53r5|AC-6(2),800-53r5|AC-6(5),CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.4.2(d),CN-L3|8.1.10.6(a),CSCv7|4.3,CSCv8|5.4,CSF|PR.AC-4,GDPR|32.1.b,HIPAA|164.306(a)(1),HIPAA|164.312(a)(1),ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6(2),ITSG-33|AC-6(5),LEVEL|2A,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.6.1,NIAv2|AM1,NIAv2|AM23f,NIAv2|AM32,NIAv2|AM33,NIAv2|SS13c,NIAv2|SS15c,NIAv2|VL3a,PCI-DSSv3.2.1|7.1.2,PCI-DSSv4.0|7.2.1,PCI-DSSv4.0|7.2.2,QCSC-v1|5.2.2,QCSC-v1|6.2,SWIFT-CSCv1|1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/files/3844"
      cmd         : "/usr/bin/getent passwd mysql | /usr/bin/egrep \"^.*[\/bin\/false|\/sbin\/nologin]$\" | /usr/bin/awk '{print} END {if (NR == 1) print \"pass\"}'"
      expect      : "pass"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - mysqld start-up"
      info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
      solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
      reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
      see_also    : "https://workbench.cisecurity.org/files/3844"
      cmd         : "/bin/ps aux | /bin/grep mysqld\\  | /bin/grep -v grep | /bin/grep -q -e --allow-suspicious-udfs ; /bin/echo $?"
      expect      : "1"
    </custom_item>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : FILE_CHECK
          description : "/etc/my.cnf Exists"
          file        : "/etc/my.cnf"
        </custom_item>
      </condition>

      <then>
        <if>
          <condition type:"AND">
            <custom_item>
              type        : FILE_CONTENT_CHECK
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - /etc/my.cnf"
              file        : "/etc/my.cnf"
              regex       : "^[\\s]*allow-suspicious-udfs[\\s]*="
              expect      : "^[\\s]*allow-suspicious-udfs[\\s]*="
            </custom_item>
          </condition>

          <then>
            <custom_item>
              system      : "Linux"
              type        : FILE_CONTENT_CHECK
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - /etc/my.cnf"
              info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
              solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
              reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
              see_also    : "https://workbench.cisecurity.org/files/3844"
              file        : "/etc/my.cnf"
              regex       : "^[\\s]*allow-suspicious-udfs[\\s]*="
              expect      : "^[\\s]*allow-suspicious-udfs[\\s]*=[\\s]*OFF"
            </custom_item>
          </then>

          <else>
            <report type:"PASSED">
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - /etc/my.cnf"
              info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
              solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
              reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
              see_also    : "https://workbench.cisecurity.org/files/3844"
            </report>
          </else>
        </if>
      </then>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : FILE_CHECK
          description : "/etc/mysql/my.cnf Exists"
          file        : "/etc/mysql/my.cnf"
        </custom_item>
      </condition>

      <then>
        <if>
          <condition type:"AND">
            <custom_item>
              type        : FILE_CONTENT_CHECK
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - /etc/mysql/my.cnf"
              file        : "/etc/mysql/my.cnf"
              regex       : "^[\\s]*allow-suspicious-udfs[\\s]*="
              expect      : "^[\\s]*allow-suspicious-udfs[\\s]*="
            </custom_item>
          </condition>

          <then>
            <custom_item>
              system      : "Linux"
              type        : FILE_CONTENT_CHECK
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - /etc/mysql/my.cnf"
              info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
              solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
              reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
              see_also    : "https://workbench.cisecurity.org/files/3844"
              file        : "/etc/mysql/my.cnf"
              regex       : "^[\\s]*allow-suspicious-udfs[\\s]*="
              expect      : "^[\\s]*allow-suspicious-udfs[\\s]*=[\\s]*OFF"
            </custom_item>
          </then>

          <else>
            <report type:"PASSED">
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - /etc/mysql/my.cnf"
              info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
              solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
              reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
              see_also    : "https://workbench.cisecurity.org/files/3844"
            </report>
          </else>
        </if>
      </then>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : FILE_CHECK
          description : "SYSCONFDIR/my.cnf Exists"
          file        : "@SYSCONFDIR@/my.cnf"
        </custom_item>
      </condition>

      <then>
        <if>
          <condition type:"AND">
            <custom_item>
              type        : FILE_CONTENT_CHECK
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - SYSCONFDIR/my.cnf"
              file        : "@SYSCONFDIR@/my.cnf"
              regex       : "^[\\s]*allow-suspicious-udfs[\\s]*="
              expect      : "^[\\s]*allow-suspicious-udfs[\\s]*="
            </custom_item>
          </condition>

          <then>
            <custom_item>
              system      : "Linux"
              type        : FILE_CONTENT_CHECK
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - SYSCONFDIR/my.cnf"
              info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
              solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
              reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
              see_also    : "https://workbench.cisecurity.org/files/3844"
              file        : "@SYSCONFDIR@/my.cnf"
              regex       : "^[\\s]*allow-suspicious-udfs[\\s]*="
              expect      : "^[\\s]*allow-suspicious-udfs[\\s]*=[\\s]*OFF"
            </custom_item>
          </then>

          <else>
            <report type:"PASSED">
              description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - SYSCONFDIR/my.cnf passed"
              info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
              solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
              reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
              see_also    : "https://workbench.cisecurity.org/files/3844"
            </report>
          </else>
        </if>
      </then>
    </if>

    <if>
      <condition type:"AND">
        <custom_item>
          type        : FILE_CHECK_NOT
          description : "/etc/my.cnf Does not exist"
          file        : "/etc/my.cnf"
        </custom_item>

        <custom_item>
          type        : FILE_CHECK_NOT
          description : "/etc/mysql/my.cnf Does not exist"
          file        : "/etc/mysql/my.cnf"
        </custom_item>

        <custom_item>
          type        : FILE_CHECK_NOT
          description : "SYSCONFDIR/my.cnf Does not exist"
          file        : "@SYSCONFDIR@/my.cnf"
        </custom_item>
      </condition>

      <then>
        <report type:"FAILED">
          description : "4.3 Ensure 'allow-suspicious-udfs' Is Set to 'OFF' - config files not found"
          info        : "This option prevents attaching arbitrary shared library functions as user-defined functions by checking for at least one corresponding method named _init, _deinit, _reset, _clear, or _add.

Rationale:

Preventing shared libraries that do not contain user-defined functions from loading will reduce the attack surface of the server."
          solution    : "Perform the following to establish the recommended state:

Remove --allow-suspicious-udfs from the mysqld start up command line.

Remove allow-suspicious-udfs from the MySQL option file.

Default Value:

OFF"
          reference   : "800-171|3.13.1,800-171|3.13.2,800-53|PL-8,800-53|SA-8,800-53r5|PL-8,800-53r5|SA-8,CSCv8|16.10,CSF|ID.AM-3,CSF|PR.IP-2,GDPR|32.1.b,GDPR|32.1.d,HIPAA|164.306(a)(1),ITSG-33|SA-8,ITSG-33|SA-8a.,LEVEL|2M,NESA|T3.4.1,NESA|T4.5.3,NESA|T4.5.4,NESA|T7.6.5,NIAv2|SS3,NIAv2|VL2,QCSC-v1|4.2,QCSC-v1|5.2.2,QCSC-v1|5.2.3,QCSC-v1|6.2"
          see_also    : "https://workbench.cisecurity.org/files/3844"
        </report>
      </then>
    </if>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_MySQL_5.7_Community_Benchmark_v2.0.0_Level_2_OS_Linux.audit from CIS Oracle MySQL 5.7 Community Edition Benchmark"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/files/3844"
    </report>
  </else>
</if>

</check_type>
